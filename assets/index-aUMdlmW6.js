import{r as Lh,g as Fh,a as rr}from"./phaser-DdsT-G5U.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var mt=Lh();const wt=Fh(mt);if(typeof window<"u"&&window.Phaser){let l=window.require;window.require=e=>{if(l)return l(e);if(e==="Phaser")return window.Phaser}}class no{entries={};size=0;add(e){let t=this.entries[e];return this.entries[e]=!0,t?!1:(this.size++,!0)}addAll(e){let t=this.size;for(var s=0,i=e.length;s<i;s++)this.add(e[s]);return t!=this.size}contains(e){return this.entries[e]}clear(){this.entries={},this.size=0}}class ue{r;g;b;a;static WHITE=new ue(1,1,1,1);static RED=new ue(1,0,0,1);static GREEN=new ue(0,1,0,1);static BLUE=new ue(0,0,1,1);static MAGENTA=new ue(1,0,1,1);constructor(e=0,t=0,s=0,i=0){this.r=e,this.g=t,this.b=s,this.a=i}set(e,t,s,i){return this.r=e,this.g=t,this.b=s,this.a=i,this.clamp()}setFromColor(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}setFromString(e){return e=e.charAt(0)=="#"?e.substr(1):e,this.r=parseInt(e.substr(0,2),16)/255,this.g=parseInt(e.substr(2,2),16)/255,this.b=parseInt(e.substr(4,2),16)/255,this.a=e.length!=8?1:parseInt(e.substr(6,2),16)/255,this}add(e,t,s,i){return this.r+=e,this.g+=t,this.b+=s,this.a+=i,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(e,t){e.r=((t&4278190080)>>>24)/255,e.g=((t&16711680)>>>16)/255,e.b=((t&65280)>>>8)/255,e.a=(t&255)/255}static rgb888ToColor(e,t){e.r=((t&16711680)>>>16)/255,e.g=((t&65280)>>>8)/255,e.b=(t&255)/255}toRgb888(){const e=t=>("0"+(t*255).toString(16)).slice(-2);return+("0x"+e(this.r)+e(this.g)+e(this.b))}static fromString(e,t=new ue){return t.setFromString(e)}}class te{static PI=3.1415927;static PI2=te.PI*2;static invPI2=1/te.PI2;static radiansToDegrees=180/te.PI;static radDeg=te.radiansToDegrees;static degreesToRadians=te.PI/180;static degRad=te.degreesToRadians;static clamp(e,t,s){return e<t?t:e>s?s:e}static cosDeg(e){return Math.cos(e*te.degRad)}static sinDeg(e){return Math.sin(e*te.degRad)}static atan2Deg(e,t){return Math.atan2(e,t)*te.degRad}static signum(e){return e>0?1:e<0?-1:0}static toInt(e){return e>0?Math.floor(e):Math.ceil(e)}static cbrt(e){let t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t}static randomTriangular(e,t){return te.randomTriangularWith(e,t,(e+t)*.5)}static randomTriangularWith(e,t,s){let i=Math.random(),n=t-e;return i<=(s-e)/n?e+Math.sqrt(i*n*(s-e)):t-Math.sqrt((1-i)*n*(t-s))}static isPowerOfTwo(e){return e&&(e&e-1)===0}}class se{static SUPPORTS_TYPED_ARRAYS=typeof Float32Array<"u";static arrayCopy(e,t,s,i,n){for(let a=t,o=i;a<t+n;a++,o++)s[o]=e[a]}static arrayFill(e,t,s,i){for(let n=t;n<s;n++)e[n]=i}static setArraySize(e,t,s=0){let i=e.length;if(i==t)return e;if(e.length=t,i<t)for(let n=i;n<t;n++)e[n]=s;return e}static ensureArrayCapacity(e,t,s=0){return e.length>=t?e:se.setArraySize(e,t,s)}static newArray(e,t){let s=new Array(e);for(let i=0;i<e;i++)s[i]=t;return s}static newFloatArray(e){if(se.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);{let t=new Array(e);for(let s=0;s<t.length;s++)t[s]=0;return t}}static newShortArray(e){if(se.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);{let t=new Array(e);for(let s=0;s<t.length;s++)t[s]=0;return t}}static toFloatArray(e){return se.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}static toSinglePrecision(e){return se.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}static webkit602BugfixHelper(e,t){}static contains(e,t,s=!0){for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1}static enumValue(e,t){return e[t[0].toUpperCase()+t.slice(1)]}}class Gi{items=new Array;instantiator;constructor(e){this.instantiator=e}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(e){e.reset&&e.reset(),this.items.push(e)}freeAll(e){for(let t=0;t<e.length;t++)this.free(e[t])}clear(){this.items.length=0}}class Zs{x;y;constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}length(){let e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}normalize(){let e=this.length();return e!=0&&(this.x/=e,this.y/=e),this}}class ro{name;constructor(e){if(!e)throw new Error("name cannot be null.");this.name=e}}class Ft extends ro{static nextID=0;id=Ft.nextID++;bones=null;vertices=[];worldVerticesLength=0;timelineAttachment=this;constructor(e){super(e)}computeWorldVertices(e,t,s,i,n,a){s=n+(s>>1)*a;let o=e.bone.skeleton,r=e.deform,h=this.vertices,c=this.bones;if(!c){r.length>0&&(h=r);let m=e.bone,y=m.worldX,b=m.worldY,E=m.a,v=m.b,S=m.c,x=m.d;for(let A=t,C=n;C<s;A+=2,C+=a){let k=h[A],_=h[A+1];i[C]=k*E+_*v+y,i[C+1]=k*S+_*x+b}return}let d=0,g=0;for(let m=0;m<t;m+=2){let y=c[d];d+=y+1,g+=y}let u=o.bones;if(r.length==0)for(let m=n,y=g*3;m<s;m+=a){let b=0,E=0,v=c[d++];for(v+=d;d<v;d++,y+=3){let S=u[c[d]],x=h[y],A=h[y+1],C=h[y+2];b+=(x*S.a+A*S.b+S.worldX)*C,E+=(x*S.c+A*S.d+S.worldY)*C}i[m]=b,i[m+1]=E}else{let m=r;for(let y=n,b=g*3,E=g<<1;y<s;y+=a){let v=0,S=0,x=c[d++];for(x+=d;d<x;d++,b+=3,E+=2){let A=u[c[d]],C=h[b]+m[E],k=h[b+1]+m[E+1],_=h[b+2];v+=(C*A.a+k*A.b+A.worldX)*_,S+=(C*A.c+k*A.d+A.worldY)*_}i[y]=v,i[y+1]=S}}}copyTo(e){this.bones?(e.bones=new Array(this.bones.length),se.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,this.vertices&&(e.vertices=se.newFloatArray(this.vertices.length),se.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)),e.worldVerticesLength=this.worldVerticesLength,e.timelineAttachment=this.timelineAttachment}}class Js{static _nextID=0;id=Js.nextID();regions;start=0;digits=0;setupIndex=0;constructor(e){this.regions=new Array(e)}copy(){let e=new Js(this.regions.length);return se.arrayCopy(this.regions,0,e.regions,0,this.regions.length),e.start=this.start,e.digits=this.digits,e.setupIndex=this.setupIndex,e}apply(e,t){let s=e.sequenceIndex;s==-1&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);let i=this.regions[s];t.region!=i&&(t.region=i,t.updateRegion())}getPath(e,t){let s=e,i=(this.start+t).toString();for(let n=this.digits-i.length;n>0;n--)s+="0";return s+=i,s}static nextID(){return Js._nextID++}}var rt;(function(l){l[l.hold=0]="hold",l[l.once=1]="once",l[l.loop=2]="loop",l[l.pingpong=3]="pingpong",l[l.onceReverse=4]="onceReverse",l[l.loopReverse=5]="loopReverse",l[l.pingpongReverse=6]="pingpongReverse"})(rt||(rt={}));const ao=[rt.hold,rt.once,rt.loop,rt.pingpong,rt.onceReverse,rt.loopReverse,rt.pingpongReverse];class ar{name;timelines=[];timelineIds=new no;duration;constructor(e,t,s){if(!e)throw new Error("name cannot be null.");this.name=e,this.setTimelines(t),this.duration=s}setTimelines(e){if(!e)throw new Error("timelines cannot be null.");this.timelines=e,this.timelineIds.clear();for(var t=0;t<e.length;t++)this.timelineIds.addAll(e[t].getPropertyIds())}hasTimeline(e){for(let t=0;t<e.length;t++)if(this.timelineIds.contains(e[t]))return!0;return!1}apply(e,t,s,i,n,a,o,r){if(!e)throw new Error("skeleton cannot be null.");i&&this.duration!=0&&(s%=this.duration,t>0&&(t%=this.duration));let h=this.timelines;for(let c=0,d=h.length;c<d;c++)h[c].apply(e,t,s,n,a,o,r)}}var K;(function(l){l[l.setup=0]="setup",l[l.first=1]="first",l[l.replace=2]="replace",l[l.add=3]="add"})(K||(K={}));var ot;(function(l){l[l.mixIn=0]="mixIn",l[l.mixOut=1]="mixOut"})(ot||(ot={}));const Me={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,inherit:7,rgb:8,alpha:9,rgb2:10,attachment:11,deform:12,event:13,drawOrder:14,ikConstraint:15,transformConstraint:16,pathConstraintPosition:17,pathConstraintSpacing:18,pathConstraintMix:19,physicsConstraintInertia:20,physicsConstraintStrength:21,physicsConstraintDamping:22,physicsConstraintMass:23,physicsConstraintWind:24,physicsConstraintGravity:25,physicsConstraintMix:26,physicsConstraintReset:27,sequence:28};class je{propertyIds;frames;constructor(e,t){this.propertyIds=t,this.frames=se.newFloatArray(e*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(e,t){let s=e.length;for(let i=1;i<s;i++)if(e[i]>t)return i-1;return s-1}static search(e,t,s){let i=e.length;for(let n=s;n<i;n+=s)if(e[n]>t)return n-s;return i-s}}class Zt extends je{curves;constructor(e,t,s){super(e,s),this.curves=se.newFloatArray(e+t*18),this.curves[e-1]=1}setLinear(e){this.curves[e]=0}setStepped(e){this.curves[e]=1}shrink(e){let t=this.getFrameCount()+e*18;if(this.curves.length>t){let s=se.newFloatArray(t);se.arrayCopy(this.curves,0,s,0,t),this.curves=s}}setBezier(e,t,s,i,n,a,o,r,h,c,d){let g=this.curves,u=this.getFrameCount()+e*18;s==0&&(g[t]=2+u);let m=(i-a*2+r)*.03,y=(n-o*2+h)*.03,b=((a-r)*3-i+c)*.006,E=((o-h)*3-n+d)*.006,v=m*2+b,S=y*2+E,x=(a-i)*.3+m+b*.16666667,A=(o-n)*.3+y+E*.16666667,C=i+x,k=n+A;for(let _=u+18;u<_;u+=2)g[u]=C,g[u+1]=k,x+=v,A+=S,v+=b,S+=E,C+=x,k+=A}getBezierValue(e,t,s,i){let n=this.curves;if(n[i]>e){let h=this.frames[t],c=this.frames[t+s];return c+(e-h)/(n[i]-h)*(n[i+1]-c)}let a=i+18;for(i+=2;i<a;i+=2)if(n[i]>=e){let h=n[i-2],c=n[i-1];return c+(e-h)/(n[i]-h)*(n[i+1]-c)}t+=this.getFrameEntries();let o=n[a-2],r=n[a-1];return r+(e-o)/(this.frames[t]-o)*(this.frames[t+s]-r)}}class Bt extends Zt{constructor(e,t,s){super(e,t,[s])}getFrameEntries(){return 2}setFrame(e,t,s){e<<=1,this.frames[e]=t,this.frames[e+1]=s}getCurveValue(e){let t=this.frames,s=t.length-2;for(let n=2;n<=s;n+=2)if(t[n]>e){s=n-2;break}let i=this.curves[s>>1];switch(i){case 0:let n=t[s],a=t[s+1];return a+(e-n)/(t[s+2]-n)*(t[s+2+1]-a);case 1:return t[s+1]}return this.getBezierValue(e,s,1,i-2)}getRelativeValue(e,t,s,i,n){if(e<this.frames[0]){switch(s){case K.setup:return n;case K.first:return i+(n-i)*t}return i}let a=this.getCurveValue(e);switch(s){case K.setup:return n+a*t;case K.first:case K.replace:a+=n-i}return i+a*t}getAbsoluteValue(e,t,s,i,n){if(e<this.frames[0]){switch(s){case K.setup:return n;case K.first:return i+(n-i)*t}return i}let a=this.getCurveValue(e);return s==K.setup?n+(a-n)*t:i+(a-i)*t}getAbsoluteValue2(e,t,s,i,n,a){if(e<this.frames[0]){switch(s){case K.setup:return n;case K.first:return i+(n-i)*t}return i}return s==K.setup?n+(a-n)*t:i+(a-i)*t}getScaleValue(e,t,s,i,n,a){const o=this.frames;if(e<o[0]){switch(s){case K.setup:return a;case K.first:return n+(a-n)*t}return n}let r=this.getCurveValue(e)*a;if(t==1)return s==K.add?n+r-a:r;if(i==ot.mixOut)switch(s){case K.setup:return a+(Math.abs(r)*te.signum(a)-a)*t;case K.first:case K.replace:return n+(Math.abs(r)*te.signum(n)-n)*t}else{let h=0;switch(s){case K.setup:return h=Math.abs(a)*te.signum(r),h+(r-h)*t;case K.first:case K.replace:return h=Math.abs(n)*te.signum(r),h+(r-h)*t}}return n+(r-a)*t}}class or extends Zt{constructor(e,t,s,i){super(e,t,[s,i])}getFrameEntries(){return 3}setFrame(e,t,s,i){e*=3,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i}}class Hi extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.rotate+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.rotation=this.getRelativeValue(s,n,a,r.rotation,r.data.rotation))}}class oo extends or{boneIndex=0;constructor(e,t,s){super(e,t,Me.x+"|"+s,Me.y+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){switch(a){case K.setup:r.x=r.data.x,r.y=r.data.y;return;case K.first:r.x+=(r.data.x-r.x)*n,r.y+=(r.data.y-r.y)*n}return}let c=0,d=0,g=je.search(h,s,3),u=this.curves[g/3];switch(u){case 0:let m=h[g];c=h[g+1],d=h[g+2];let y=(s-m)/(h[g+3]-m);c+=(h[g+3+1]-c)*y,d+=(h[g+3+2]-d)*y;break;case 1:c=h[g+1],d=h[g+2];break;default:c=this.getBezierValue(s,g,1,u-2),d=this.getBezierValue(s,g,2,u+18-2)}switch(a){case K.setup:r.x=r.data.x+c*n,r.y=r.data.y+d*n;break;case K.first:case K.replace:r.x+=(r.data.x+c-r.x)*n,r.y+=(r.data.y+d-r.y)*n;break;case K.add:r.x+=c*n,r.y+=d*n}}}class lo extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.x+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.x=this.getRelativeValue(s,n,a,r.x,r.data.x))}}class ho extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.y+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.y=this.getRelativeValue(s,n,a,r.y,r.data.y))}}class co extends or{boneIndex=0;constructor(e,t,s){super(e,t,Me.scaleX+"|"+s,Me.scaleY+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){switch(a){case K.setup:r.scaleX=r.data.scaleX,r.scaleY=r.data.scaleY;return;case K.first:r.scaleX+=(r.data.scaleX-r.scaleX)*n,r.scaleY+=(r.data.scaleY-r.scaleY)*n}return}let c,d,g=je.search(h,s,3),u=this.curves[g/3];switch(u){case 0:let m=h[g];c=h[g+1],d=h[g+2];let y=(s-m)/(h[g+3]-m);c+=(h[g+3+1]-c)*y,d+=(h[g+3+2]-d)*y;break;case 1:c=h[g+1],d=h[g+2];break;default:c=this.getBezierValue(s,g,1,u-2),d=this.getBezierValue(s,g,2,u+18-2)}if(c*=r.data.scaleX,d*=r.data.scaleY,n==1)a==K.add?(r.scaleX+=c-r.data.scaleX,r.scaleY+=d-r.data.scaleY):(r.scaleX=c,r.scaleY=d);else{let m=0,y=0;if(o==ot.mixOut)switch(a){case K.setup:m=r.data.scaleX,y=r.data.scaleY,r.scaleX=m+(Math.abs(c)*te.signum(m)-m)*n,r.scaleY=y+(Math.abs(d)*te.signum(y)-y)*n;break;case K.first:case K.replace:m=r.scaleX,y=r.scaleY,r.scaleX=m+(Math.abs(c)*te.signum(m)-m)*n,r.scaleY=y+(Math.abs(d)*te.signum(y)-y)*n;break;case K.add:r.scaleX+=(c-r.data.scaleX)*n,r.scaleY+=(d-r.data.scaleY)*n}else switch(a){case K.setup:m=Math.abs(r.data.scaleX)*te.signum(c),y=Math.abs(r.data.scaleY)*te.signum(d),r.scaleX=m+(c-m)*n,r.scaleY=y+(d-y)*n;break;case K.first:case K.replace:m=Math.abs(r.scaleX)*te.signum(c),y=Math.abs(r.scaleY)*te.signum(d),r.scaleX=m+(c-m)*n,r.scaleY=y+(d-y)*n;break;case K.add:r.scaleX+=(c-r.data.scaleX)*n,r.scaleY+=(d-r.data.scaleY)*n}}}}class fo extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.scaleX+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.scaleX=this.getScaleValue(s,n,a,o,r.scaleX,r.data.scaleX))}}class uo extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.scaleY+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.scaleY=this.getScaleValue(s,n,a,o,r.scaleY,r.data.scaleY))}}class mo extends or{boneIndex=0;constructor(e,t,s){super(e,t,Me.shearX+"|"+s,Me.shearY+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){switch(a){case K.setup:r.shearX=r.data.shearX,r.shearY=r.data.shearY;return;case K.first:r.shearX+=(r.data.shearX-r.shearX)*n,r.shearY+=(r.data.shearY-r.shearY)*n}return}let c=0,d=0,g=je.search(h,s,3),u=this.curves[g/3];switch(u){case 0:let m=h[g];c=h[g+1],d=h[g+2];let y=(s-m)/(h[g+3]-m);c+=(h[g+3+1]-c)*y,d+=(h[g+3+2]-d)*y;break;case 1:c=h[g+1],d=h[g+2];break;default:c=this.getBezierValue(s,g,1,u-2),d=this.getBezierValue(s,g,2,u+18-2)}switch(a){case K.setup:r.shearX=r.data.shearX+c*n,r.shearY=r.data.shearY+d*n;break;case K.first:case K.replace:r.shearX+=(r.data.shearX+c-r.shearX)*n,r.shearY+=(r.data.shearY+d-r.shearY)*n;break;case K.add:r.shearX+=c*n,r.shearY+=d*n}}}class go extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.shearX+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.shearX=this.getRelativeValue(s,n,a,r.shearX,r.data.shearX))}}class po extends Bt{boneIndex=0;constructor(e,t,s){super(e,t,Me.shearY+"|"+s),this.boneIndex=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];r.active&&(r.shearY=this.getRelativeValue(s,n,a,r.shearY,r.data.shearY))}}class yo extends je{boneIndex=0;constructor(e,t){super(e,[Me.inherit+"|"+t]),this.boneIndex=t}getFrameEntries(){return 2}setFrame(e,t,s){e*=2,this.frames[e]=t,this.frames[e+1]=s}apply(e,t,s,i,n,a,o){let r=e.bones[this.boneIndex];if(!r.active)return;if(o==ot.mixOut){a==K.setup&&(r.inherit=r.data.inherit);return}let h=this.frames;if(s<h[0]){(a==K.setup||a==K.first)&&(r.inherit=r.data.inherit);return}r.inherit=this.frames[je.search(h,s,2)+1]}}class bo extends Zt{slotIndex=0;constructor(e,t,s){super(e,t,[Me.rgb+"|"+s,Me.alpha+"|"+s]),this.slotIndex=s}getFrameEntries(){return 5}setFrame(e,t,s,i,n,a){e*=5,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=n,this.frames[e+4]=a}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=this.frames,c=r.color;if(s<h[0]){let E=r.data.color;switch(a){case K.setup:c.setFromColor(E);return;case K.first:c.add((E.r-c.r)*n,(E.g-c.g)*n,(E.b-c.b)*n,(E.a-c.a)*n)}return}let d=0,g=0,u=0,m=0,y=je.search(h,s,5),b=this.curves[y/5];switch(b){case 0:let E=h[y];d=h[y+1],g=h[y+2],u=h[y+3],m=h[y+4];let v=(s-E)/(h[y+5]-E);d+=(h[y+5+1]-d)*v,g+=(h[y+5+2]-g)*v,u+=(h[y+5+3]-u)*v,m+=(h[y+5+4]-m)*v;break;case 1:d=h[y+1],g=h[y+2],u=h[y+3],m=h[y+4];break;default:d=this.getBezierValue(s,y,1,b-2),g=this.getBezierValue(s,y,2,b+18-2),u=this.getBezierValue(s,y,3,b+36-2),m=this.getBezierValue(s,y,4,b+54-2)}n==1?c.set(d,g,u,m):(a==K.setup&&c.setFromColor(r.data.color),c.add((d-c.r)*n,(g-c.g)*n,(u-c.b)*n,(m-c.a)*n))}}class wo extends Zt{slotIndex=0;constructor(e,t,s){super(e,t,[Me.rgb+"|"+s]),this.slotIndex=s}getFrameEntries(){return 4}setFrame(e,t,s,i,n){e<<=2,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=n}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=this.frames,c=r.color;if(s<h[0]){let b=r.data.color;switch(a){case K.setup:c.r=b.r,c.g=b.g,c.b=b.b;return;case K.first:c.r+=(b.r-c.r)*n,c.g+=(b.g-c.g)*n,c.b+=(b.b-c.b)*n}return}let d=0,g=0,u=0,m=je.search(h,s,4),y=this.curves[m>>2];switch(y){case 0:let b=h[m];d=h[m+1],g=h[m+2],u=h[m+3];let E=(s-b)/(h[m+4]-b);d+=(h[m+4+1]-d)*E,g+=(h[m+4+2]-g)*E,u+=(h[m+4+3]-u)*E;break;case 1:d=h[m+1],g=h[m+2],u=h[m+3];break;default:d=this.getBezierValue(s,m,1,y-2),g=this.getBezierValue(s,m,2,y+18-2),u=this.getBezierValue(s,m,3,y+36-2)}if(n==1)c.r=d,c.g=g,c.b=u;else{if(a==K.setup){let b=r.data.color;c.r=b.r,c.g=b.g,c.b=b.b}c.r+=(d-c.r)*n,c.g+=(g-c.g)*n,c.b+=(u-c.b)*n}}}class xo extends Bt{slotIndex=0;constructor(e,t,s){super(e,t,Me.alpha+"|"+s),this.slotIndex=s}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=r.color;if(s<this.frames[0]){let d=r.data.color;switch(a){case K.setup:h.a=d.a;return;case K.first:h.a+=(d.a-h.a)*n}return}let c=this.getCurveValue(s);n==1?h.a=c:(a==K.setup&&(h.a=r.data.color.a),h.a+=(c-h.a)*n)}}class So extends Zt{slotIndex=0;constructor(e,t,s){super(e,t,[Me.rgb+"|"+s,Me.alpha+"|"+s,Me.rgb2+"|"+s]),this.slotIndex=s}getFrameEntries(){return 8}setFrame(e,t,s,i,n,a,o,r,h){e<<=3,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=n,this.frames[e+4]=a,this.frames[e+5]=o,this.frames[e+6]=r,this.frames[e+7]=h}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=this.frames,c=r.color,d=r.darkColor;if(s<h[0]){let A=r.data.color,C=r.data.darkColor;switch(a){case K.setup:c.setFromColor(A),d.r=C.r,d.g=C.g,d.b=C.b;return;case K.first:c.add((A.r-c.r)*n,(A.g-c.g)*n,(A.b-c.b)*n,(A.a-c.a)*n),d.r+=(C.r-d.r)*n,d.g+=(C.g-d.g)*n,d.b+=(C.b-d.b)*n}return}let g=0,u=0,m=0,y=0,b=0,E=0,v=0,S=je.search(h,s,8),x=this.curves[S>>3];switch(x){case 0:let A=h[S];g=h[S+1],u=h[S+2],m=h[S+3],y=h[S+4],b=h[S+5],E=h[S+6],v=h[S+7];let C=(s-A)/(h[S+8]-A);g+=(h[S+8+1]-g)*C,u+=(h[S+8+2]-u)*C,m+=(h[S+8+3]-m)*C,y+=(h[S+8+4]-y)*C,b+=(h[S+8+5]-b)*C,E+=(h[S+8+6]-E)*C,v+=(h[S+8+7]-v)*C;break;case 1:g=h[S+1],u=h[S+2],m=h[S+3],y=h[S+4],b=h[S+5],E=h[S+6],v=h[S+7];break;default:g=this.getBezierValue(s,S,1,x-2),u=this.getBezierValue(s,S,2,x+18-2),m=this.getBezierValue(s,S,3,x+36-2),y=this.getBezierValue(s,S,4,x+54-2),b=this.getBezierValue(s,S,5,x+72-2),E=this.getBezierValue(s,S,6,x+90-2),v=this.getBezierValue(s,S,7,x+108-2)}if(n==1)c.set(g,u,m,y),d.r=b,d.g=E,d.b=v;else{if(a==K.setup){c.setFromColor(r.data.color);let A=r.data.darkColor;d.r=A.r,d.g=A.g,d.b=A.b}c.add((g-c.r)*n,(u-c.g)*n,(m-c.b)*n,(y-c.a)*n),d.r+=(b-d.r)*n,d.g+=(E-d.g)*n,d.b+=(v-d.b)*n}}}class vo extends Zt{slotIndex=0;constructor(e,t,s){super(e,t,[Me.rgb+"|"+s,Me.rgb2+"|"+s]),this.slotIndex=s}getFrameEntries(){return 7}setFrame(e,t,s,i,n,a,o,r){e*=7,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=n,this.frames[e+4]=a,this.frames[e+5]=o,this.frames[e+6]=r}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=this.frames,c=r.color,d=r.darkColor;if(s<h[0]){let x=r.data.color,A=r.data.darkColor;switch(a){case K.setup:c.r=x.r,c.g=x.g,c.b=x.b,d.r=A.r,d.g=A.g,d.b=A.b;return;case K.first:c.r+=(x.r-c.r)*n,c.g+=(x.g-c.g)*n,c.b+=(x.b-c.b)*n,d.r+=(A.r-d.r)*n,d.g+=(A.g-d.g)*n,d.b+=(A.b-d.b)*n}return}let g=0,u=0,m=0,y=0,b=0,E=0,v=je.search(h,s,7),S=this.curves[v/7];switch(S){case 0:let x=h[v];g=h[v+1],u=h[v+2],m=h[v+3],y=h[v+4],b=h[v+5],E=h[v+6];let A=(s-x)/(h[v+7]-x);g+=(h[v+7+1]-g)*A,u+=(h[v+7+2]-u)*A,m+=(h[v+7+3]-m)*A,y+=(h[v+7+4]-y)*A,b+=(h[v+7+5]-b)*A,E+=(h[v+7+6]-E)*A;break;case 1:g=h[v+1],u=h[v+2],m=h[v+3],y=h[v+4],b=h[v+5],E=h[v+6];break;default:g=this.getBezierValue(s,v,1,S-2),u=this.getBezierValue(s,v,2,S+18-2),m=this.getBezierValue(s,v,3,S+36-2),y=this.getBezierValue(s,v,4,S+54-2),b=this.getBezierValue(s,v,5,S+72-2),E=this.getBezierValue(s,v,6,S+90-2)}if(n==1)c.r=g,c.g=u,c.b=m,d.r=y,d.g=b,d.b=E;else{if(a==K.setup){let x=r.data.color,A=r.data.darkColor;c.r=x.r,c.g=x.g,c.b=x.b,d.r=A.r,d.g=A.g,d.b=A.b}c.r+=(g-c.r)*n,c.g+=(u-c.g)*n,c.b+=(m-c.b)*n,d.r+=(y-d.r)*n,d.g+=(b-d.g)*n,d.b+=(E-d.b)*n}}}class qs extends je{slotIndex=0;attachmentNames;constructor(e,t){super(e,[Me.attachment+"|"+t]),this.slotIndex=t,this.attachmentNames=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.attachmentNames[e]=s}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(r.bone.active){if(o==ot.mixOut){a==K.setup&&this.setAttachment(e,r,r.data.attachmentName);return}if(s<this.frames[0]){(a==K.setup||a==K.first)&&this.setAttachment(e,r,r.data.attachmentName);return}this.setAttachment(e,r,this.attachmentNames[je.search1(this.frames,s)])}}setAttachment(e,t,s){t.setAttachment(s?e.getAttachment(this.slotIndex,s):null)}}class Eo extends Zt{slotIndex=0;attachment;vertices;constructor(e,t,s,i){super(e,t,[Me.deform+"|"+s+"|"+i.id]),this.slotIndex=s,this.attachment=i,this.vertices=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.vertices[e]=s}setBezier(e,t,s,i,n,a,o,r,h,c,d){let g=this.curves,u=this.getFrameCount()+e*18;s==0&&(g[t]=2+u);let m=(i-a*2+r)*.03,y=h*.03-o*.06,b=((a-r)*3-i+c)*.006,E=(o-h+.33333333)*.018,v=m*2+b,S=y*2+E,x=(a-i)*.3+m+b*.16666667,A=o*.3+y+E*.16666667,C=i+x,k=A;for(let _=u+18;u<_;u+=2)g[u]=C,g[u+1]=k,x+=v,A+=S,v+=b,S+=E,C+=x,k+=A}getCurvePercent(e,t){let s=this.curves,i=s[t];switch(i){case 0:let r=this.frames[t];return(e-r)/(this.frames[t+this.getFrameEntries()]-r);case 1:return 0}if(i-=2,s[i]>e){let r=this.frames[t];return s[i+1]*(e-r)/(s[i]-r)}let n=i+18;for(i+=2;i<n;i+=2)if(s[i]>=e){let r=s[i-2],h=s[i-1];return h+(e-r)/(s[i]-r)*(s[i+1]-h)}let a=s[n-2],o=s[n-1];return o+(1-o)*(e-a)/(this.frames[t+this.getFrameEntries()]-a)}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=r.getAttachment();if(!h||!(h instanceof Ft)||h.timelineAttachment!=this.attachment)return;let c=r.deform;c.length==0&&(a=K.setup);let d=this.vertices,g=d[0].length,u=this.frames;if(s<u[0]){switch(a){case K.setup:c.length=0;return;case K.first:if(n==1){c.length=0;return}c.length=g;let S=h;if(S.bones){n=1-n;for(var m=0;m<g;m++)c[m]*=n}else{let x=S.vertices;for(var m=0;m<g;m++)c[m]+=(x[m]-c[m])*n}}return}if(c.length=g,s>=u[u.length-1]){let S=d[u.length-1];if(n==1)if(a==K.add){let x=h;if(x.bones)for(let A=0;A<g;A++)c[A]+=S[A];else{let A=x.vertices;for(let C=0;C<g;C++)c[C]+=S[C]-A[C]}}else se.arrayCopy(S,0,c,0,g);else switch(a){case K.setup:{let A=h;if(A.bones)for(let C=0;C<g;C++)c[C]=S[C]*n;else{let C=A.vertices;for(let k=0;k<g;k++){let _=C[k];c[k]=_+(S[k]-_)*n}}break}case K.first:case K.replace:for(let A=0;A<g;A++)c[A]+=(S[A]-c[A])*n;break;case K.add:let x=h;if(x.bones)for(let A=0;A<g;A++)c[A]+=S[A]*n;else{let A=x.vertices;for(let C=0;C<g;C++)c[C]+=(S[C]-A[C])*n}}return}let y=je.search1(u,s),b=this.getCurvePercent(s,y),E=d[y],v=d[y+1];if(n==1)if(a==K.add){let S=h;if(S.bones)for(let x=0;x<g;x++){let A=E[x];c[x]+=A+(v[x]-A)*b}else{let x=S.vertices;for(let A=0;A<g;A++){let C=E[A];c[A]+=C+(v[A]-C)*b-x[A]}}}else for(let S=0;S<g;S++){let x=E[S];c[S]=x+(v[S]-x)*b}else switch(a){case K.setup:{let x=h;if(x.bones)for(let A=0;A<g;A++){let C=E[A];c[A]=(C+(v[A]-C)*b)*n}else{let A=x.vertices;for(let C=0;C<g;C++){let k=E[C],_=A[C];c[C]=_+(k+(v[C]-k)*b-_)*n}}break}case K.first:case K.replace:for(let x=0;x<g;x++){let A=E[x];c[x]+=(A+(v[x]-A)*b-c[x])*n}break;case K.add:let S=h;if(S.bones)for(let x=0;x<g;x++){let A=E[x];c[x]+=(A+(v[x]-A)*b)*n}else{let x=S.vertices;for(let A=0;A<g;A++){let C=E[A];c[A]+=(C+(v[A]-C)*b-x[A])*n}}}}}class gi extends je{static propertyIds=[""+Me.event];events;constructor(e){super(e,gi.propertyIds),this.events=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t){this.frames[e]=t.time,this.events[e]=t}apply(e,t,s,i,n,a,o){if(!i)return;let r=this.frames,h=this.frames.length;if(t>s)this.apply(e,t,Number.MAX_VALUE,i,n,a,o),t=-1;else if(t>=r[h-1])return;if(s<r[0])return;let c=0;if(t<r[0])c=0;else{c=je.search1(r,t)+1;let d=r[c];for(;c>0&&r[c-1]==d;)c--}for(;c<h&&s>=r[c];c++)i.push(this.events[c])}}class Cs extends je{static propertyIds=[""+Me.drawOrder];drawOrders;constructor(e){super(e,Cs.propertyIds),this.drawOrders=new Array(e)}getFrameCount(){return this.frames.length}setFrame(e,t,s){this.frames[e]=t,this.drawOrders[e]=s}apply(e,t,s,i,n,a,o){if(o==ot.mixOut){a==K.setup&&se.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length);return}if(s<this.frames[0]){(a==K.setup||a==K.first)&&se.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length);return}let r=je.search1(this.frames,s),h=this.drawOrders[r];if(!h)se.arrayCopy(e.slots,0,e.drawOrder,0,e.slots.length);else{let c=e.drawOrder,d=e.slots;for(let g=0,u=h.length;g<u;g++)c[g]=d[h[g]]}}}class To extends Zt{constraintIndex=0;constructor(e,t,s){super(e,t,[Me.ikConstraint+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 6}setFrame(e,t,s,i,n,a,o){e*=6,this.frames[e]=t,this.frames[e+1]=s,this.frames[e+2]=i,this.frames[e+3]=n,this.frames[e+4]=a?1:0,this.frames[e+5]=o?1:0}apply(e,t,s,i,n,a,o){let r=e.ikConstraints[this.constraintIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){switch(a){case K.setup:r.mix=r.data.mix,r.softness=r.data.softness,r.bendDirection=r.data.bendDirection,r.compress=r.data.compress,r.stretch=r.data.stretch;return;case K.first:r.mix+=(r.data.mix-r.mix)*n,r.softness+=(r.data.softness-r.softness)*n,r.bendDirection=r.data.bendDirection,r.compress=r.data.compress,r.stretch=r.data.stretch}return}let c=0,d=0,g=je.search(h,s,6),u=this.curves[g/6];switch(u){case 0:let m=h[g];c=h[g+1],d=h[g+2];let y=(s-m)/(h[g+6]-m);c+=(h[g+6+1]-c)*y,d+=(h[g+6+2]-d)*y;break;case 1:c=h[g+1],d=h[g+2];break;default:c=this.getBezierValue(s,g,1,u-2),d=this.getBezierValue(s,g,2,u+18-2)}a==K.setup?(r.mix=r.data.mix+(c-r.data.mix)*n,r.softness=r.data.softness+(d-r.data.softness)*n,o==ot.mixOut?(r.bendDirection=r.data.bendDirection,r.compress=r.data.compress,r.stretch=r.data.stretch):(r.bendDirection=h[g+3],r.compress=h[g+4]!=0,r.stretch=h[g+5]!=0)):(r.mix+=(c-r.mix)*n,r.softness+=(d-r.softness)*n,o==ot.mixIn&&(r.bendDirection=h[g+3],r.compress=h[g+4]!=0,r.stretch=h[g+5]!=0))}}class Ao extends Zt{constraintIndex=0;constructor(e,t,s){super(e,t,[Me.transformConstraint+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 7}setFrame(e,t,s,i,n,a,o,r){let h=this.frames;e*=7,h[e]=t,h[e+1]=s,h[e+2]=i,h[e+3]=n,h[e+4]=a,h[e+5]=o,h[e+6]=r}apply(e,t,s,i,n,a,o){let r=e.transformConstraints[this.constraintIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){let v=r.data;switch(a){case K.setup:r.mixRotate=v.mixRotate,r.mixX=v.mixX,r.mixY=v.mixY,r.mixScaleX=v.mixScaleX,r.mixScaleY=v.mixScaleY,r.mixShearY=v.mixShearY;return;case K.first:r.mixRotate+=(v.mixRotate-r.mixRotate)*n,r.mixX+=(v.mixX-r.mixX)*n,r.mixY+=(v.mixY-r.mixY)*n,r.mixScaleX+=(v.mixScaleX-r.mixScaleX)*n,r.mixScaleY+=(v.mixScaleY-r.mixScaleY)*n,r.mixShearY+=(v.mixShearY-r.mixShearY)*n}return}let c,d,g,u,m,y,b=je.search(h,s,7),E=this.curves[b/7];switch(E){case 0:let v=h[b];c=h[b+1],d=h[b+2],g=h[b+3],u=h[b+4],m=h[b+5],y=h[b+6];let S=(s-v)/(h[b+7]-v);c+=(h[b+7+1]-c)*S,d+=(h[b+7+2]-d)*S,g+=(h[b+7+3]-g)*S,u+=(h[b+7+4]-u)*S,m+=(h[b+7+5]-m)*S,y+=(h[b+7+6]-y)*S;break;case 1:c=h[b+1],d=h[b+2],g=h[b+3],u=h[b+4],m=h[b+5],y=h[b+6];break;default:c=this.getBezierValue(s,b,1,E-2),d=this.getBezierValue(s,b,2,E+18-2),g=this.getBezierValue(s,b,3,E+36-2),u=this.getBezierValue(s,b,4,E+54-2),m=this.getBezierValue(s,b,5,E+72-2),y=this.getBezierValue(s,b,6,E+90-2)}if(a==K.setup){let v=r.data;r.mixRotate=v.mixRotate+(c-v.mixRotate)*n,r.mixX=v.mixX+(d-v.mixX)*n,r.mixY=v.mixY+(g-v.mixY)*n,r.mixScaleX=v.mixScaleX+(u-v.mixScaleX)*n,r.mixScaleY=v.mixScaleY+(m-v.mixScaleY)*n,r.mixShearY=v.mixShearY+(y-v.mixShearY)*n}else r.mixRotate+=(c-r.mixRotate)*n,r.mixX+=(d-r.mixX)*n,r.mixY+=(g-r.mixY)*n,r.mixScaleX+=(u-r.mixScaleX)*n,r.mixScaleY+=(m-r.mixScaleY)*n,r.mixShearY+=(y-r.mixShearY)*n}}class Co extends Bt{constraintIndex=0;constructor(e,t,s){super(e,t,Me.pathConstraintPosition+"|"+s),this.constraintIndex=s}apply(e,t,s,i,n,a,o){let r=e.pathConstraints[this.constraintIndex];r.active&&(r.position=this.getAbsoluteValue(s,n,a,r.position,r.data.position))}}class Io extends Bt{constraintIndex=0;constructor(e,t,s){super(e,t,Me.pathConstraintSpacing+"|"+s),this.constraintIndex=s}apply(e,t,s,i,n,a,o){let r=e.pathConstraints[this.constraintIndex];r.active&&(r.spacing=this.getAbsoluteValue(s,n,a,r.spacing,r.data.spacing))}}class Ro extends Zt{constraintIndex=0;constructor(e,t,s){super(e,t,[Me.pathConstraintMix+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 4}setFrame(e,t,s,i,n){let a=this.frames;e<<=2,a[e]=t,a[e+1]=s,a[e+2]=i,a[e+3]=n}apply(e,t,s,i,n,a,o){let r=e.pathConstraints[this.constraintIndex];if(!r.active)return;let h=this.frames;if(s<h[0]){switch(a){case K.setup:r.mixRotate=r.data.mixRotate,r.mixX=r.data.mixX,r.mixY=r.data.mixY;return;case K.first:r.mixRotate+=(r.data.mixRotate-r.mixRotate)*n,r.mixX+=(r.data.mixX-r.mixX)*n,r.mixY+=(r.data.mixY-r.mixY)*n}return}let c,d,g,u=je.search(h,s,4),m=this.curves[u>>2];switch(m){case 0:let y=h[u];c=h[u+1],d=h[u+2],g=h[u+3];let b=(s-y)/(h[u+4]-y);c+=(h[u+4+1]-c)*b,d+=(h[u+4+2]-d)*b,g+=(h[u+4+3]-g)*b;break;case 1:c=h[u+1],d=h[u+2],g=h[u+3];break;default:c=this.getBezierValue(s,u,1,m-2),d=this.getBezierValue(s,u,2,m+18-2),g=this.getBezierValue(s,u,3,m+36-2)}if(a==K.setup){let y=r.data;r.mixRotate=y.mixRotate+(c-y.mixRotate)*n,r.mixX=y.mixX+(d-y.mixX)*n,r.mixY=y.mixY+(g-y.mixY)*n}else r.mixRotate+=(c-r.mixRotate)*n,r.mixX+=(d-r.mixX)*n,r.mixY+=(g-r.mixY)*n}}class Ls extends Bt{constraintIndex=0;constructor(e,t,s,i){super(e,t,i+"|"+s),this.constraintIndex=s}apply(e,t,s,i,n,a,o){let r;if(this.constraintIndex==-1){const h=s>=this.frames[0]?this.getCurveValue(s):0;for(const c of e.physicsConstraints)c.active&&this.global(c.data)&&this.set(c,this.getAbsoluteValue2(s,n,a,this.get(c),this.setup(c),h))}else r=e.physicsConstraints[this.constraintIndex],r.active&&this.set(r,this.getAbsoluteValue(s,n,a,this.get(r),this.setup(r)))}}class Oo extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintInertia)}setup(e){return e.data.inertia}get(e){return e.inertia}set(e,t){e.inertia=t}global(e){return e.inertiaGlobal}}class ko extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintStrength)}setup(e){return e.data.strength}get(e){return e.strength}set(e,t){e.strength=t}global(e){return e.strengthGlobal}}class Po extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintDamping)}setup(e){return e.data.damping}get(e){return e.damping}set(e,t){e.damping=t}global(e){return e.dampingGlobal}}class _o extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintMass)}setup(e){return 1/e.data.massInverse}get(e){return 1/e.massInverse}set(e,t){e.massInverse=1/t}global(e){return e.massGlobal}}class Mo extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintWind)}setup(e){return e.data.wind}get(e){return e.wind}set(e,t){e.wind=t}global(e){return e.windGlobal}}class Lo extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintGravity)}setup(e){return e.data.gravity}get(e){return e.gravity}set(e,t){e.gravity=t}global(e){return e.gravityGlobal}}class Fo extends Ls{constructor(e,t,s){super(e,t,s,Me.physicsConstraintMix)}setup(e){return e.data.mix}get(e){return e.mix}set(e,t){e.mix=t}global(e){return e.mixGlobal}}class nn extends je{static propertyIds=[Me.physicsConstraintReset.toString()];constraintIndex;constructor(e,t){super(e,nn.propertyIds),this.constraintIndex=t}getFrameCount(){return this.frames.length}setFrame(e,t){this.frames[e]=t}apply(e,t,s,i,n,a,o){let r;if(this.constraintIndex!=-1&&(r=e.physicsConstraints[this.constraintIndex],!r.active))return;const h=this.frames;if(t>s)this.apply(e,t,Number.MAX_VALUE,[],n,a,o),t=-1;else if(t>=h[h.length-1])return;if(!(s<h[0])&&(t<h[0]||s>=h[je.search1(h,t)+1]))if(r!=null)r.reset();else for(const c of e.physicsConstraints)c.active&&c.reset()}}class $t extends je{static ENTRIES=3;static MODE=1;static DELAY=2;slotIndex;attachment;constructor(e,t,s){super(e,[Me.sequence+"|"+t+"|"+s.sequence.id]),this.slotIndex=t,this.attachment=s}getFrameEntries(){return $t.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(e,t,s,i,n){let a=this.frames;e*=$t.ENTRIES,a[e]=t,a[e+$t.MODE]=s|i<<4,a[e+$t.DELAY]=n}apply(e,t,s,i,n,a,o){let r=e.slots[this.slotIndex];if(!r.bone.active)return;let h=r.attachment,c=this.attachment;if(h!=c&&(!(h instanceof Ft)||h.timelineAttachment!=c))return;if(o==ot.mixOut){a==K.setup&&(r.sequenceIndex=-1);return}let d=this.frames;if(s<d[0]){(a==K.setup||a==K.first)&&(r.sequenceIndex=-1);return}let g=je.search(d,s,$t.ENTRIES),u=d[g],m=d[g+$t.MODE],y=d[g+$t.DELAY];if(!this.attachment.sequence)return;let b=m>>4,E=this.attachment.sequence.regions.length,v=ao[m&15];if(v!=rt.hold)switch(b+=(s-u)/y+1e-5|0,v){case rt.once:b=Math.min(E-1,b);break;case rt.loop:b%=E;break;case rt.pingpong:{let S=(E<<1)-2;b=S==0?0:b%S,b>=E&&(b=S-b);break}case rt.onceReverse:b=Math.max(E-1-b,0);break;case rt.loopReverse:b=E-1-b%E;break;case rt.pingpongReverse:{let S=(E<<1)-2;b=S==0?0:(b+E-1)%S,b>=E&&(b=S-b)}}r.sequenceIndex=b}}class ui{static _emptyAnimation=new ar("<empty>",[],0);static emptyAnimation(){return ui._emptyAnimation}data;tracks=new Array;timeScale=1;unkeyedState=0;events=new Array;listeners=new Array;queue=new Bh(this);propertyIDs=new no;animationsChanged=!1;trackEntryPool=new Gi(()=>new Dh);constructor(e){this.data=e}update(e){e*=this.timeScale;let t=this.tracks;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(!n)continue;n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;let a=e*n.timeScale;if(n.delay>0){if(n.delay-=a,n.delay>0)continue;a=-n.delay,n.delay=0}let o=n.next;if(o){let r=n.trackLast-o.delay;if(r>=0){for(o.delay=0,o.trackTime+=n.timeScale==0?0:(r/n.timeScale+e)*o.timeScale,n.trackTime+=a,this.setCurrent(s,o,!0);o.mixingFrom;)o.mixTime+=e,o=o.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&!n.mixingFrom){t[s]=null,this.queue.end(n),this.clearNext(n);continue}if(n.mixingFrom&&this.updateMixingFrom(n,e)){let r=n.mixingFrom;for(n.mixingFrom=null,r&&(r.mixingTo=null);r;)this.queue.end(r),r=r.mixingFrom}n.trackTime+=a}this.queue.drain()}updateMixingFrom(e,t){let s=e.mixingFrom;if(!s)return!0;let i=this.updateMixingFrom(s,t);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,e.nextTrackLast!=-1&&e.mixTime>=e.mixDuration?((s.totalAlpha==0||e.mixDuration==0)&&(e.mixingFrom=s.mixingFrom,s.mixingFrom!=null&&(s.mixingFrom.mixingTo=e),e.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=t*s.timeScale,e.mixTime+=t,!1)}apply(e){if(!e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let t=this.events,s=this.tracks,i=!1;for(let g=0,u=s.length;g<u;g++){let m=s[g];if(!m||m.delay>0)continue;i=!0;let y=g==0?K.first:m.mixBlend,b=m.alpha;m.mixingFrom?b*=this.applyMixingFrom(m,e,y):m.trackTime>=m.trackEnd&&!m.next&&(b=0);let E=b>=m.alphaAttachmentThreshold,v=m.animationLast,S=m.getAnimationTime(),x=S,A=t;m.reverse&&(x=m.animation.duration-x,A=null);let C=m.animation.timelines,k=C.length;if(g==0&&b==1||y==K.add){g==0&&(E=!0);for(let _=0;_<k;_++){var n=C[_];n instanceof qs?this.applyAttachmentTimeline(n,e,x,y,E):n.apply(e,v,x,A,b,y,ot.mixIn)}}else{let _=m.timelineMode,L=m.shortestRotation,N=!L&&m.timelinesRotation.length!=k<<1;N&&(m.timelinesRotation.length=k<<1);for(let V=0;V<k;V++){let W=C[V],O=_[V]==Tn?y:K.setup;!L&&W instanceof Hi?this.applyRotateTimeline(W,e,x,b,O,m.timelinesRotation,V<<1,N):W instanceof qs?this.applyAttachmentTimeline(W,e,x,y,E):W.apply(e,v,x,A,b,O,ot.mixIn)}}this.queueEvents(m,S),t.length=0,m.nextAnimationLast=S,m.nextTrackLast=m.trackTime}for(var a=this.unkeyedState+Gr,o=e.slots,r=0,h=e.slots.length;r<h;r++){var c=o[r];if(c.attachmentState==a){var d=c.data.attachmentName;c.setAttachment(d?e.getAttachment(c.data.index,d):null)}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(e,t,s){let i=e.mixingFrom;i.mixingFrom&&this.applyMixingFrom(i,t,s);let n=0;e.mixDuration==0?(n=1,s==K.first&&(s=K.setup)):(n=e.mixTime/e.mixDuration,n>1&&(n=1),s!=K.first&&(s=i.mixBlend));let a=n<i.mixAttachmentThreshold,o=n<i.mixDrawOrderThreshold,r=i.animation.timelines,h=r.length,c=i.alpha*e.interruptAlpha,d=c*(1-n),g=i.animationLast,u=i.getAnimationTime(),m=u,y=null;if(i.reverse?m=i.animation.duration-m:n<i.eventThreshold&&(y=this.events),s==K.add)for(let b=0;b<h;b++)r[b].apply(t,g,m,y,d,s,ot.mixOut);else{let b=i.timelineMode,E=i.timelineHoldMix,v=i.shortestRotation,S=!v&&i.timelinesRotation.length!=h<<1;S&&(i.timelinesRotation.length=h<<1),i.totalAlpha=0;for(let x=0;x<h;x++){let A=r[x],C=ot.mixOut,k,_=0;switch(b[x]){case Tn:if(!o&&A instanceof Cs)continue;k=s,_=d;break;case zr:k=K.setup,_=d;break;case jr:k=s,_=c;break;case An:k=K.setup,_=c;break;default:k=K.setup;let L=E[x];_=c*Math.max(0,1-L.mixTime/L.mixDuration);break}i.totalAlpha+=_,!v&&A instanceof Hi?this.applyRotateTimeline(A,t,m,_,k,i.timelinesRotation,x<<1,S):A instanceof qs?this.applyAttachmentTimeline(A,t,m,k,a&&_>=i.alphaAttachmentThreshold):(o&&A instanceof Cs&&k==K.setup&&(C=ot.mixIn),A.apply(t,g,m,y,_,k,C))}}return e.mixDuration>0&&this.queueEvents(i,u),this.events.length=0,i.nextAnimationLast=u,i.nextTrackLast=i.trackTime,n}applyAttachmentTimeline(e,t,s,i,n){var a=t.slots[e.slotIndex];a.bone.active&&(s<e.frames[0]?(i==K.setup||i==K.first)&&this.setAttachment(t,a,a.data.attachmentName,n):this.setAttachment(t,a,e.attachmentNames[je.search1(e.frames,s)],n),a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+Gr))}setAttachment(e,t,s,i){t.setAttachment(s?e.getAttachment(t.data.index,s):null),i&&(t.attachmentState=this.unkeyedState+Yh)}applyRotateTimeline(e,t,s,i,n,a,o,r){if(r&&(a[o]=0),i==1){e.apply(t,0,s,null,1,n,ot.mixIn);return}let h=t.bones[e.boneIndex];if(!h.active)return;let c=e.frames,d=0,g=0;if(s<c[0])switch(n){case K.setup:h.rotation=h.data.rotation;default:return;case K.first:d=h.rotation,g=h.data.rotation}else d=n==K.setup?h.data.rotation:h.rotation,g=h.data.rotation+e.getCurveValue(s);let u=0,m=g-d;if(m-=Math.ceil(m/360-.5)*360,m==0)u=a[o];else{let y=0,b=0;r?(y=0,b=m):(y=a[o],b=a[o+1]);let E=y-y%360;u=m+E;let v=m>=0,S=y>=0;Math.abs(b)<=90&&te.signum(b)!=te.signum(m)&&(Math.abs(y-E)>180?(u+=360*te.signum(y),S=v):E!=0?u-=360*te.signum(y):S=v),S!=v&&(u+=360*te.signum(y)),a[o]=u}a[o+1]=m,h.rotation=d+u*i}queueEvents(e,t){let s=e.animationStart,i=e.animationEnd,n=i-s,a=e.trackLast%n,o=this.events,r=0,h=o.length;for(;r<h;r++){let d=o[r];if(d.time<a)break;d.time>i||this.queue.event(e,d)}let c=!1;if(e.loop)if(n==0)c=!0;else{const d=Math.floor(e.trackTime/n);c=d>0&&d>Math.floor(e.trackLast/n)}else c=t>=i&&e.animationLast<i;for(c&&this.queue.complete(e);r<h;r++){let d=o[r];d.time<s||this.queue.event(e,d)}}clearTracks(){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,s=this.tracks.length;t<s;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=e,this.queue.drain()}clearTrack(e){if(e>=this.tracks.length)return;let t=this.tracks[e];if(!t)return;this.queue.end(t),this.clearNext(t);let s=t;for(;;){let i=s.mixingFrom;if(!i)break;this.queue.end(i),s.mixingFrom=null,s.mixingTo=null,s=i}this.tracks[t.trackIndex]=null,this.queue.drain()}setCurrent(e,t,s){let i=this.expandToIndex(e);this.tracks[e]=t,t.previous=null,i&&(s&&this.queue.interrupt(i),t.mixingFrom=i,i.mixingTo=t,t.mixTime=0,i.mixingFrom&&i.mixDuration>0&&(t.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(t)}setAnimation(e,t,s=!1){let i=this.data.skeletonData.findAnimation(t);if(!i)throw new Error("Animation not found: "+t);return this.setAnimationWith(e,i,s)}setAnimationWith(e,t,s=!1){if(!t)throw new Error("animation cannot be null.");let i=!0,n=this.expandToIndex(e);n&&(n.nextTrackLast==-1?(this.tracks[e]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.clearNext(n),n=n.mixingFrom,i=!1):this.clearNext(n));let a=this.trackEntry(e,t,s,n);return this.setCurrent(e,a,i),this.queue.drain(),a}addAnimation(e,t,s=!1,i=0){let n=this.data.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);return this.addAnimationWith(e,n,s,i)}addAnimationWith(e,t,s=!1,i=0){if(!t)throw new Error("animation cannot be null.");let n=this.expandToIndex(e);if(n)for(;n.next;)n=n.next;let a=this.trackEntry(e,t,s,n);return n?(n.next=a,a.previous=n,i<=0&&(i=Math.max(i+n.getTrackComplete()-a.mixDuration,0))):(this.setCurrent(e,a,!0),this.queue.drain(),i<0&&(i=0)),a.delay=i,a}setEmptyAnimation(e,t=0){let s=this.setAnimationWith(e,ui.emptyAnimation(),!1);return s.mixDuration=t,s.trackEnd=t,s}addEmptyAnimation(e,t=0,s=0){let i=this.addAnimationWith(e,ui.emptyAnimation(),!1,s);return s<=0&&(i.delay=Math.max(i.delay+i.mixDuration-t,0)),i.mixDuration=t,i.trackEnd=t,i}setEmptyAnimations(e=0){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let s=0,i=this.tracks.length;s<i;s++){let n=this.tracks[s];n&&this.setEmptyAnimation(n.trackIndex,e)}this.queue.drainDisabled=t,this.queue.drain()}expandToIndex(e){return e<this.tracks.length?this.tracks[e]:(se.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)}trackEntry(e,t,s,i){let n=this.trackEntryPool.obtain();return n.reset(),n.trackIndex=e,n.animation=t,n.loop=s,n.holdPrevious=!1,n.reverse=!1,n.shortestRotation=!1,n.eventThreshold=0,n.alphaAttachmentThreshold=0,n.mixAttachmentThreshold=0,n.mixDrawOrderThreshold=0,n.animationStart=0,n.animationEnd=t.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.mixTime=0,n.mixDuration=i?this.data.getMix(i.animation,t):0,n.interruptAlpha=1,n.totalAlpha=0,n.mixBlend=K.replace,n}clearNext(e){let t=e.next;for(;t;)this.queue.dispose(t),t=t.next;e.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let e=this.tracks;for(let t=0,s=e.length;t<s;t++){let i=e[t];if(i){for(;i.mixingFrom;)i=i.mixingFrom;do(!i.mixingTo||i.mixBlend!=K.add)&&this.computeHold(i),i=i.mixingTo;while(i)}}}computeHold(e){let t=e.mixingTo,s=e.animation.timelines,i=e.animation.timelines.length,n=e.timelineMode;n.length=i;let a=e.timelineHoldMix;a.length=0;let o=this.propertyIDs;if(t&&t.holdPrevious){for(let r=0;r<i;r++)n[r]=o.addAll(s[r].getPropertyIds())?An:jr;return}e:for(let r=0;r<i;r++){let h=s[r],c=h.getPropertyIds();if(!o.addAll(c))n[r]=Tn;else if(!t||h instanceof qs||h instanceof Cs||h instanceof gi||!t.animation.hasTimeline(c))n[r]=zr;else{for(let d=t.mixingTo;d;d=d.mixingTo)if(!d.animation.hasTimeline(c)){if(e.mixDuration>0){n[r]=Nh,a[r]=d;continue e}break}n[r]=An}}}getCurrent(e){return e>=this.tracks.length?null:this.tracks[e]}addListener(e){if(!e)throw new Error("listener cannot be null.");this.listeners.push(e)}removeListener(e){let t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class Dh{animation=null;previous=null;next=null;mixingFrom=null;mixingTo=null;listener=null;trackIndex=0;loop=!1;holdPrevious=!1;reverse=!1;shortestRotation=!1;eventThreshold=0;mixAttachmentThreshold=0;alphaAttachmentThreshold=0;mixDrawOrderThreshold=0;animationStart=0;animationEnd=0;animationLast=0;nextAnimationLast=0;delay=0;trackTime=0;trackLast=0;nextTrackLast=0;trackEnd=0;timeScale=0;alpha=0;mixTime=0;_mixDuration=0;interruptAlpha=0;totalAlpha=0;get mixDuration(){return this._mixDuration}set mixDuration(e){this._mixDuration=e}setMixDurationWithDelay(e,t){this._mixDuration=e,t<=0&&(this.previous!=null?t=Math.max(t+this.previous.getTrackComplete()-e,0):t=0),this.delay=t}mixBlend=K.replace;timelineMode=new Array;timelineHoldMix=new Array;timelinesRotation=new Array;reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let e=this.animationEnd-this.animationStart;return e==0?this.animationStart:this.trackTime%e+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(e){this.animationLast=e,this.nextAnimationLast=e}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let e=this.animationEnd-this.animationStart;if(e!=0){if(this.loop)return e*(1+(this.trackTime/e|0));if(this.trackTime<e)return e}return this.trackTime}wasApplied(){return this.nextTrackLast!=-1}isNextReady(){return this.next!=null&&this.nextTrackLast-this.next.delay>=0}}class Bh{objects=[];drainDisabled=!1;animState;constructor(e){this.animState=e}start(e){this.objects.push(yt.start),this.objects.push(e),this.animState.animationsChanged=!0}interrupt(e){this.objects.push(yt.interrupt),this.objects.push(e)}end(e){this.objects.push(yt.end),this.objects.push(e),this.animState.animationsChanged=!0}dispose(e){this.objects.push(yt.dispose),this.objects.push(e)}complete(e){this.objects.push(yt.complete),this.objects.push(e)}event(e,t){this.objects.push(yt.event),this.objects.push(e),this.objects.push(t)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let e=this.objects,t=this.animState.listeners;for(let s=0;s<e.length;s+=2){let i=e[s],n=e[s+1];switch(i){case yt.start:n.listener&&n.listener.start&&n.listener.start(n);for(let o=0;o<t.length;o++){let r=t[o];r.start&&r.start(n)}break;case yt.interrupt:n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let o=0;o<t.length;o++){let r=t[o];r.interrupt&&r.interrupt(n)}break;case yt.end:n.listener&&n.listener.end&&n.listener.end(n);for(let o=0;o<t.length;o++){let r=t[o];r.end&&r.end(n)}case yt.dispose:n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let o=0;o<t.length;o++){let r=t[o];r.dispose&&r.dispose(n)}this.animState.trackEntryPool.free(n);break;case yt.complete:n.listener&&n.listener.complete&&n.listener.complete(n);for(let o=0;o<t.length;o++){let r=t[o];r.complete&&r.complete(n)}break;case yt.event:let a=e[s+++2];n.listener&&n.listener.event&&n.listener.event(n,a);for(let o=0;o<t.length;o++){let r=t[o];r.event&&r.event(n,a)}break}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var yt;(function(l){l[l.start=0]="start",l[l.interrupt=1]="interrupt",l[l.end=2]="end",l[l.dispose=3]="dispose",l[l.complete=4]="complete",l[l.event=5]="event"})(yt||(yt={}));const Tn=0,zr=1,jr=2,An=3,Nh=4,Gr=1,Yh=2;class Xh{skeletonData;animationToMixTime={};defaultMix=0;constructor(e){if(!e)throw new Error("skeletonData cannot be null.");this.skeletonData=e}setMix(e,t,s){let i=this.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);let n=this.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);this.setMixWith(i,n,s)}setMixWith(e,t,s){if(!e)throw new Error("from cannot be null.");if(!t)throw new Error("to cannot be null.");let i=e.name+"."+t.name;this.animationToMixTime[i]=s}getMix(e,t){let s=e.name+"."+t.name,i=this.animationToMixTime[s];return i===void 0?this.defaultMix:i}}class rn extends Ft{color=new ue(1,1,1,1);constructor(e){super(e)}copy(){let e=new rn(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}}class ii extends Ft{endSlot=null;color=new ue(.2275,.2275,.8078,1);constructor(e){super(e)}copy(){let e=new ii(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}}class Do{_image;constructor(e){this._image=e}getImage(){return this._image}}var ut;(function(l){l[l.Nearest=9728]="Nearest",l[l.Linear=9729]="Linear",l[l.MipMap=9987]="MipMap",l[l.MipMapNearestNearest=9984]="MipMapNearestNearest",l[l.MipMapLinearNearest=9985]="MipMapLinearNearest",l[l.MipMapNearestLinear=9986]="MipMapNearestLinear",l[l.MipMapLinearLinear=9987]="MipMapLinearLinear"})(ut||(ut={}));var Qs;(function(l){l[l.MirroredRepeat=33648]="MirroredRepeat",l[l.ClampToEdge=33071]="ClampToEdge",l[l.Repeat=10497]="Repeat"})(Qs||(Qs={}));class Uh{texture;u=0;v=0;u2=0;v2=0;width=0;height=0;degrees=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0}class Vh{pages=new Array;regions=new Array;constructor(e){let t=new zh(e),s=new Array(4),i={};i.size=c=>{c.width=parseInt(s[1]),c.height=parseInt(s[2])},i.format=()=>{},i.filter=c=>{c.minFilter=se.enumValue(ut,s[1]),c.magFilter=se.enumValue(ut,s[2])},i.repeat=c=>{s[1].indexOf("x")!=-1&&(c.uWrap=Qs.Repeat),s[1].indexOf("y")!=-1&&(c.vWrap=Qs.Repeat)},i.pma=c=>{c.pma=s[1]=="true"};var n={};n.xy=c=>{c.x=parseInt(s[1]),c.y=parseInt(s[2])},n.size=c=>{c.width=parseInt(s[1]),c.height=parseInt(s[2])},n.bounds=c=>{c.x=parseInt(s[1]),c.y=parseInt(s[2]),c.width=parseInt(s[3]),c.height=parseInt(s[4])},n.offset=c=>{c.offsetX=parseInt(s[1]),c.offsetY=parseInt(s[2])},n.orig=c=>{c.originalWidth=parseInt(s[1]),c.originalHeight=parseInt(s[2])},n.offsets=c=>{c.offsetX=parseInt(s[1]),c.offsetY=parseInt(s[2]),c.originalWidth=parseInt(s[3]),c.originalHeight=parseInt(s[4])},n.rotate=c=>{let d=s[1];d=="true"?c.degrees=90:d!="false"&&(c.degrees=parseInt(d))},n.index=c=>{c.index=parseInt(s[1])};let a=t.readLine();for(;a&&a.trim().length==0;)a=t.readLine();for(;!(!a||a.trim().length==0||t.readEntry(s,a)==0);)a=t.readLine();let o=null,r=null,h=null;for(;a!==null;)if(a.trim().length==0)o=null,a=t.readLine();else if(o){let c=new Bo(o,a);for(;;){let d=t.readEntry(s,a=t.readLine());if(d==0)break;let g=n[s[0]];if(g)g(c);else{r||(r=[]),h||(h=[]),r.push(s[0]);let u=[];for(let m=0;m<d;m++)u.push(parseInt(s[m+1]));h.push(u)}}c.originalWidth==0&&c.originalHeight==0&&(c.originalWidth=c.width,c.originalHeight=c.height),r&&r.length>0&&h&&h.length>0&&(c.names=r,c.values=h,r=null,h=null),c.u=c.x/o.width,c.v=c.y/o.height,c.degrees==90?(c.u2=(c.x+c.height)/o.width,c.v2=(c.y+c.width)/o.height):(c.u2=(c.x+c.width)/o.width,c.v2=(c.y+c.height)/o.height),this.regions.push(c)}else{for(o=new jh(a.trim());t.readEntry(s,a=t.readLine())!=0;){let c=i[s[0]];c&&c(o)}this.pages.push(o)}}findRegion(e){for(let t=0;t<this.regions.length;t++)if(this.regions[t].name==e)return this.regions[t];return null}setTextures(e,t=""){for(let s of this.pages)s.setTexture(e.get(t+s.name))}dispose(){for(let e=0;e<this.pages.length;e++)this.pages[e].texture?.dispose()}}class zh{lines;index=0;constructor(e){this.lines=e.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(e,t){if(!t||(t=t.trim(),t.length==0))return 0;let s=t.indexOf(":");if(s==-1)return 0;e[0]=t.substr(0,s).trim();for(let i=1,n=s+1;;i++){let a=t.indexOf(",",n);if(a==-1)return e[i]=t.substr(n).trim(),i;if(e[i]=t.substr(n,a-n).trim(),n=a+1,i==4)return 4}}}class jh{name;minFilter=ut.Nearest;magFilter=ut.Nearest;uWrap=Qs.ClampToEdge;vWrap=Qs.ClampToEdge;texture=null;width=0;height=0;pma=!1;regions=new Array;constructor(e){this.name=e}setTexture(e){this.texture=e,e.setFilters(this.minFilter,this.magFilter),e.setWraps(this.uWrap,this.vWrap);for(let t of this.regions)t.texture=e}}class Bo extends Uh{page;name;x=0;y=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0;index=0;degrees=0;names=null;values=null;constructor(e,t){super(),this.page=e,this.name=t,e.regions.push(this)}}class os extends Ft{region=null;path;regionUVs=[];uvs=[];triangles=[];color=new ue(1,1,1,1);width=0;height=0;hullLength=0;edges=[];parentMesh=null;sequence=null;tempColor=new ue(0,0,0,0);constructor(e,t){super(e),this.path=t}updateRegion(){if(!this.region)throw new Error("Region not set.");let e=this.regionUVs;(!this.uvs||this.uvs.length!=e.length)&&(this.uvs=se.newFloatArray(e.length));let t=this.uvs,s=this.uvs.length,i=this.region.u,n=this.region.v,a=0,o=0;if(this.region instanceof Bo){let r=this.region,h=r.page,c=h.width,d=h.height;switch(r.degrees){case 90:i-=(r.originalHeight-r.offsetY-r.height)/c,n-=(r.originalWidth-r.offsetX-r.width)/d,a=r.originalHeight/c,o=r.originalWidth/d;for(let g=0;g<s;g+=2)t[g]=i+e[g+1]*a,t[g+1]=n+(1-e[g])*o;return;case 180:i-=(r.originalWidth-r.offsetX-r.width)/c,n-=r.offsetY/d,a=r.originalWidth/c,o=r.originalHeight/d;for(let g=0;g<s;g+=2)t[g]=i+(1-e[g])*a,t[g+1]=n+(1-e[g+1])*o;return;case 270:i-=r.offsetY/c,n-=r.offsetX/d,a=r.originalHeight/c,o=r.originalWidth/d;for(let g=0;g<s;g+=2)t[g]=i+(1-e[g+1])*a,t[g+1]=n+e[g]*o;return}i-=r.offsetX/c,n-=(r.originalHeight-r.offsetY-r.height)/d,a=r.originalWidth/c,o=r.originalHeight/d}else this.region?(a=this.region.u2-i,o=this.region.v2-n):(i=n=0,a=o=1);for(let r=0;r<s;r+=2)t[r]=i+e[r]*a,t[r+1]=n+e[r+1]*o}getParentMesh(){return this.parentMesh}setParentMesh(e){this.parentMesh=e,e&&(this.bones=e.bones,this.vertices=e.vertices,this.worldVerticesLength=e.worldVerticesLength,this.regionUVs=e.regionUVs,this.triangles=e.triangles,this.hullLength=e.hullLength,this.worldVerticesLength=e.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let e=new os(this.name,this.path);return e.region=this.region,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),se.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=this.uvs instanceof Float32Array?se.newFloatArray(this.uvs.length):new Array(this.uvs.length),se.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),se.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,e.sequence=this.sequence!=null?this.sequence.copy():null,this.edges&&(e.edges=new Array(this.edges.length),se.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}computeWorldVertices(e,t,s,i,n,a){this.sequence!=null&&this.sequence.apply(e,this),super.computeWorldVertices(e,t,s,i,n,a)}newLinkedMesh(){let e=new os(this.name,this.path);return e.region=this.region,e.color.setFromColor(this.color),e.timelineAttachment=this.timelineAttachment,e.setParentMesh(this.parentMesh?this.parentMesh:this),e.region!=null&&e.updateRegion(),e}}class Ps extends Ft{lengths=[];closed=!1;constantSpeed=!1;color=new ue(1,1,1,1);constructor(e){super(e)}copy(){let e=new Ps(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),se.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}}class lr extends Ft{x=0;y=0;rotation=0;color=new ue(.38,.94,0,1);constructor(e){super(e)}computeWorldPosition(e,t){return t.x=this.x*e.a+this.y*e.b+e.worldX,t.y=this.x*e.c+this.y*e.d+e.worldY,t}computeWorldRotation(e){const t=this.rotation*te.degRad,s=Math.cos(t),i=Math.sin(t),n=s*e.a+i*e.b,a=s*e.c+i*e.d;return te.atan2Deg(a,n)}copy(){let e=new lr(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}}class Xe extends ro{x=0;y=0;scaleX=1;scaleY=1;rotation=0;width=0;height=0;color=new ue(1,1,1,1);path;region=null;sequence=null;offset=se.newFloatArray(8);uvs=se.newFloatArray(8);tempColor=new ue(1,1,1,1);constructor(e,t){super(e),this.path=t}updateRegion(){if(!this.region)throw new Error("Region not set.");let e=this.region,t=this.uvs;if(e==null){t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=1,t[5]=1,t[6]=1,t[7]=0;return}let s=this.width/this.region.originalWidth*this.scaleX,i=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*s,a=-this.height/2*this.scaleY+this.region.offsetY*i,o=n+this.region.width*s,r=a+this.region.height*i,h=this.rotation*te.degRad,c=Math.cos(h),d=Math.sin(h),g=this.x,u=this.y,m=n*c+g,y=n*d,b=a*c+u,E=a*d,v=o*c+g,S=o*d,x=r*c+u,A=r*d,C=this.offset;C[0]=m-E,C[1]=b+y,C[2]=m-A,C[3]=x+y,C[4]=v-A,C[5]=x+S,C[6]=v-E,C[7]=b+S,e.degrees==90?(t[0]=e.u2,t[1]=e.v2,t[2]=e.u,t[3]=e.v2,t[4]=e.u,t[5]=e.v,t[6]=e.u2,t[7]=e.v):(t[0]=e.u,t[1]=e.v2,t[2]=e.u,t[3]=e.v,t[4]=e.u2,t[5]=e.v,t[6]=e.u2,t[7]=e.v2)}computeWorldVertices(e,t,s,i){this.sequence!=null&&this.sequence.apply(e,this);let n=e.bone,a=this.offset,o=n.worldX,r=n.worldY,h=n.a,c=n.b,d=n.c,g=n.d,u=0,m=0;u=a[0],m=a[1],t[s]=u*h+m*c+o,t[s+1]=u*d+m*g+r,s+=i,u=a[2],m=a[3],t[s]=u*h+m*c+o,t[s+1]=u*d+m*g+r,s+=i,u=a[4],m=a[5],t[s]=u*h+m*c+o,t[s+1]=u*d+m*g+r,s+=i,u=a[6],m=a[7],t[s]=u*h+m*c+o,t[s+1]=u*d+m*g+r}copy(){let e=new Xe(this.name,this.path);return e.region=this.region,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,se.arrayCopy(this.uvs,0,e.uvs,0,8),se.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e.sequence=this.sequence!=null?this.sequence.copy():null,e}static X1=0;static Y1=1;static C1R=2;static C1G=3;static C1B=4;static C1A=5;static U1=6;static V1=7;static X2=8;static Y2=9;static C2R=10;static C2G=11;static C2B=12;static C2A=13;static U2=14;static V2=15;static X3=16;static Y3=17;static C3R=18;static C3G=19;static C3B=20;static C3A=21;static U3=22;static V3=23;static X4=24;static Y4=25;static C4R=26;static C4G=27;static C4B=28;static C4A=29;static U4=30;static V4=31}class Hr{atlas;constructor(e){this.atlas=e}loadSequence(e,t,s){let i=s.regions;for(let n=0,a=i.length;n<a;n++){let o=s.getPath(t,n),r=this.atlas.findRegion(o);if(r==null)throw new Error("Region not found in atlas: "+o+" (sequence: "+e+")");i[n]=r}}newRegionAttachment(e,t,s,i){let n=new Xe(t,s);if(i!=null)this.loadSequence(t,s,i);else{let a=this.atlas.findRegion(s);if(!a)throw new Error("Region not found in atlas: "+s+" (region attachment: "+t+")");n.region=a}return n}newMeshAttachment(e,t,s,i){let n=new os(t,s);if(i!=null)this.loadSequence(t,s,i);else{let a=this.atlas.findRegion(s);if(!a)throw new Error("Region not found in atlas: "+s+" (mesh attachment: "+t+")");n.region=a}return n}newBoundingBoxAttachment(e,t){return new rn(t)}newPathAttachment(e,t){return new Ps(t)}newPointAttachment(e,t){return new lr(t)}newClippingAttachment(e,t){return new ii(t)}}class No{index=0;name;parent=null;length=0;x=0;y=0;rotation=0;scaleX=1;scaleY=1;shearX=0;shearY=0;inherit=$e.Normal;skinRequired=!1;color=new ue;icon;visible=!1;constructor(e,t,s){if(e<0)throw new Error("index must be >= 0.");if(!t)throw new Error("name cannot be null.");this.index=e,this.name=t,this.parent=s}}var $e;(function(l){l[l.Normal=0]="Normal",l[l.OnlyTranslation=1]="OnlyTranslation",l[l.NoRotationOrReflection=2]="NoRotationOrReflection",l[l.NoScale=3]="NoScale",l[l.NoScaleOrReflection=4]="NoScaleOrReflection"})($e||($e={}));class $r{data;skeleton;parent=null;children=new Array;x=0;y=0;rotation=0;scaleX=0;scaleY=0;shearX=0;shearY=0;ax=0;ay=0;arotation=0;ascaleX=0;ascaleY=0;ashearX=0;ashearY=0;a=0;b=0;c=0;d=0;worldY=0;worldX=0;inherit=$e.Normal;sorted=!1;active=!1;constructor(e,t,s){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.skeleton=t,this.parent=s,this.setToSetupPose()}isActive(){return this.active}update(e){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(e,t,s,i,n,a,o){this.ax=e,this.ay=t,this.arotation=s,this.ascaleX=i,this.ascaleY=n,this.ashearX=a,this.ashearY=o;let r=this.parent;if(!r){let u=this.skeleton;const m=u.scaleX,y=u.scaleY,b=(s+a)*te.degRad,E=(s+90+o)*te.degRad;this.a=Math.cos(b)*i*m,this.b=Math.cos(E)*n*m,this.c=Math.sin(b)*i*y,this.d=Math.sin(E)*n*y,this.worldX=e*m+u.x,this.worldY=t*y+u.y;return}let h=r.a,c=r.b,d=r.c,g=r.d;switch(this.worldX=h*e+c*t+r.worldX,this.worldY=d*e+g*t+r.worldY,this.inherit){case $e.Normal:{const u=(s+a)*te.degRad,m=(s+90+o)*te.degRad,y=Math.cos(u)*i,b=Math.cos(m)*n,E=Math.sin(u)*i,v=Math.sin(m)*n;this.a=h*y+c*E,this.b=h*b+c*v,this.c=d*y+g*E,this.d=d*b+g*v;return}case $e.OnlyTranslation:{const u=(s+a)*te.degRad,m=(s+90+o)*te.degRad;this.a=Math.cos(u)*i,this.b=Math.cos(m)*n,this.c=Math.sin(u)*i,this.d=Math.sin(m)*n;break}case $e.NoRotationOrReflection:{let u=1/this.skeleton.scaleX,m=1/this.skeleton.scaleY;h*=u,d*=m;let y=h*h+d*d,b=0;y>1e-4?(y=Math.abs(h*g*m-c*u*d)/y,c=d*y,g=h*y,b=Math.atan2(d,h)*te.radDeg):(h=0,d=0,b=90-Math.atan2(g,c)*te.radDeg);const E=(s+a-b)*te.degRad,v=(s+o-b+90)*te.degRad,S=Math.cos(E)*i,x=Math.cos(v)*n,A=Math.sin(E)*i,C=Math.sin(v)*n;this.a=h*S-c*A,this.b=h*x-c*C,this.c=d*S+g*A,this.d=d*x+g*C;break}case $e.NoScale:case $e.NoScaleOrReflection:{s*=te.degRad;const u=Math.cos(s),m=Math.sin(s);let y=(h*u+c*m)/this.skeleton.scaleX,b=(d*u+g*m)/this.skeleton.scaleY,E=Math.sqrt(y*y+b*b);E>1e-5&&(E=1/E),y*=E,b*=E,E=Math.sqrt(y*y+b*b),this.inherit==$e.NoScale&&h*g-c*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E),s=Math.PI/2+Math.atan2(b,y);const v=Math.cos(s)*E,S=Math.sin(s)*E;a*=te.degRad,o=(90+o)*te.degRad;const x=Math.cos(a)*i,A=Math.cos(o)*n,C=Math.sin(a)*i,k=Math.sin(o)*n;this.a=y*x+v*C,this.b=y*A+v*k,this.c=b*x+S*C,this.d=b*A+S*k;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.shearX=e.shearX,this.shearY=e.shearY,this.inherit=e.inherit}updateAppliedTransform(){let e=this.parent;if(!e){this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*te.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*te.radDeg;return}let t=e.a,s=e.b,i=e.c,n=e.d,a=1/(t*n-s*i),o=n*a,r=s*a,h=i*a,c=t*a,d=this.worldX-e.worldX,g=this.worldY-e.worldY;this.ax=d*o-g*r,this.ay=g*c-d*h;let u,m,y,b;if(this.inherit==$e.OnlyTranslation)u=this.a,m=this.b,y=this.c,b=this.d;else{switch(this.inherit){case $e.NoRotationOrReflection:{let A=Math.abs(t*n-s*i)/(t*t+i*i);s=-i*this.skeleton.scaleX*A/this.skeleton.scaleY,n=t*this.skeleton.scaleY*A/this.skeleton.scaleX,a=1/(t*n-s*i),o=n*a,r=s*a;break}case $e.NoScale:case $e.NoScaleOrReflection:let E=te.cosDeg(this.rotation),v=te.sinDeg(this.rotation);t=(t*E+s*v)/this.skeleton.scaleX,i=(i*E+n*v)/this.skeleton.scaleY;let S=Math.sqrt(t*t+i*i);S>1e-5&&(S=1/S),t*=S,i*=S,S=Math.sqrt(t*t+i*i),this.inherit==$e.NoScale&&a<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(S=-S);let x=te.PI/2+Math.atan2(i,t);s=Math.cos(x)*S,n=Math.sin(x)*S,a=1/(t*n-s*i),o=n*a,r=s*a,h=i*a,c=t*a}u=o*this.a-r*this.c,m=o*this.b-r*this.d,y=c*this.c-h*this.a,b=c*this.d-h*this.b}if(this.ashearX=0,this.ascaleX=Math.sqrt(u*u+y*y),this.ascaleX>1e-4){let E=u*b-m*y;this.ascaleY=E/this.ascaleX,this.ashearY=-Math.atan2(u*m+y*b,E)*te.radDeg,this.arotation=Math.atan2(y,u)*te.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(m*m+b*b),this.ashearY=0,this.arotation=90-Math.atan2(b,m)*te.radDeg}getWorldRotationX(){return Math.atan2(this.c,this.a)*te.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*te.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}worldToLocal(e){let t=1/(this.a*this.d-this.b*this.c),s=e.x-this.worldX,i=e.y-this.worldY;return e.x=s*this.d*t-i*this.b*t,e.y=i*this.a*t-s*this.c*t,e}localToWorld(e){let t=e.x,s=e.y;return e.x=t*this.a+s*this.b+this.worldX,e.y=t*this.c+s*this.d+this.worldY,e}worldToParent(e){if(e==null)throw new Error("world cannot be null.");return this.parent==null?e:this.parent.worldToLocal(e)}parentToWorld(e){if(e==null)throw new Error("world cannot be null.");return this.parent==null?e:this.parent.localToWorld(e)}worldToLocalRotation(e){let t=te.sinDeg(e),s=te.cosDeg(e);return Math.atan2(this.a*t-this.c*s,this.d*s-this.b*t)*te.radDeg+this.rotation-this.shearX}localToWorldRotation(e){e-=this.rotation-this.shearX;let t=te.sinDeg(e),s=te.cosDeg(e);return Math.atan2(s*this.c+t*this.d,s*this.a+t*this.b)*te.radDeg}rotateWorld(e){e*=te.degRad;const t=Math.sin(e),s=Math.cos(e),i=this.a,n=this.b;this.a=s*i-t*this.c,this.b=s*n-t*this.d,this.c=t*i+s*this.c,this.d=t*n+s*this.d}}class an{name;order;skinRequired;constructor(e,t,s){this.name=e,this.order=t,this.skinRequired=s}}class Yo{data;intValue=0;floatValue=0;stringValue=null;time=0;volume=0;balance=0;constructor(e,t){if(!t)throw new Error("data cannot be null.");this.time=e,this.data=t}}class Xo{name;intValue=0;floatValue=0;stringValue=null;audioPath=null;volume=0;balance=0;constructor(e){this.name=e}}class Gh{data;bones;target;bendDirection=0;compress=!1;stretch=!1;mix=1;softness=0;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(let i=0;i<e.bones.length;i++){let n=t.findBone(e.bones[i].name);if(!n)throw new Error(`Couldn't find bone ${e.bones[i].name}`);this.bones.push(n)}let s=t.findBone(e.target.name);if(!s)throw new Error(`Couldn't find bone ${e.target.name}`);this.target=s,this.mix=e.mix,this.softness=e.softness,this.bendDirection=e.bendDirection,this.compress=e.compress,this.stretch=e.stretch}isActive(){return this.active}setToSetupPose(){const e=this.data;this.mix=e.mix,this.softness=e.softness,this.bendDirection=e.bendDirection,this.compress=e.compress,this.stretch=e.stretch}update(e){if(this.mix==0)return;let t=this.target,s=this.bones;switch(s.length){case 1:this.apply1(s[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(s[0],s[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix);break}}apply1(e,t,s,i,n,a,o){let r=e.parent;if(!r)throw new Error("IK bone must have parent.");let h=r.a,c=r.b,d=r.c,g=r.d,u=-e.ashearX-e.arotation,m=0,y=0;switch(e.inherit){case $e.OnlyTranslation:m=(t-e.worldX)*te.signum(e.skeleton.scaleX),y=(s-e.worldY)*te.signum(e.skeleton.scaleY);break;case $e.NoRotationOrReflection:let v=Math.abs(h*g-c*d)/Math.max(1e-4,h*h+d*d),S=h/e.skeleton.scaleX,x=d/e.skeleton.scaleY;c=-x*v*e.skeleton.scaleX,g=S*v*e.skeleton.scaleY,u+=Math.atan2(x,S)*te.radDeg;default:let A=t-r.worldX,C=s-r.worldY,k=h*g-c*d;Math.abs(k)<=1e-4?(m=0,y=0):(m=(A*g-C*c)/k-e.ax,y=(C*h-A*d)/k-e.ay)}u+=Math.atan2(y,m)*te.radDeg,e.ascaleX<0&&(u+=180),u>180?u-=360:u<-180&&(u+=360);let b=e.ascaleX,E=e.ascaleY;if(i||n){switch(e.inherit){case $e.NoScale:case $e.NoScaleOrReflection:m=t-e.worldX,y=s-e.worldY}const v=e.data.length*b;if(v>1e-4){const S=m*m+y*y;if(i&&S<v*v||n&&S>v*v){const x=(Math.sqrt(S)/v-1)*o+1;b*=x,a&&(E*=x)}}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+u*o,b,E,e.ashearX,e.ashearY)}apply2(e,t,s,i,n,a,o,r,h){if(e.inherit!=$e.Normal||t.inherit!=$e.Normal)return;let c=e.ax,d=e.ay,g=e.ascaleX,u=e.ascaleY,m=g,y=u,b=t.ascaleX,E=0,v=0,S=0;g<0?(g=-g,E=180,S=-1):(E=0,S=1),u<0&&(u=-u,S=-S),b<0?(b=-b,v=180):v=0;let x=t.ax,A=0,C=0,k=0,_=e.a,L=e.b,N=e.c,V=e.d,W=Math.abs(g-u)<=1e-4;!W||a?(A=0,C=_*x+e.worldX,k=N*x+e.worldY):(A=t.ay,C=_*x+L*A+e.worldX,k=N*x+V*A+e.worldY);let O=e.parent;if(!O)throw new Error("IK parent must itself have a parent.");_=O.a,L=O.b,N=O.c,V=O.d;let R=_*V-L*N,M=C-O.worldX,F=k-O.worldY;R=Math.abs(R)<=1e-4?0:1/R;let H=(M*V-F*L)*R-c,Z=(F*_-M*N)*R-d,ee=Math.sqrt(H*H+Z*Z),re=t.data.length*b,le,ce;if(ee<1e-4){this.apply1(e,s,i,!1,a,!1,h),t.updateWorldTransformWith(x,A,0,t.ascaleX,t.ascaleY,t.ashearX,t.ashearY);return}M=s-O.worldX,F=i-O.worldY;let ae=(M*V-F*L)*R-c,Ie=(F*_-M*N)*R-d,Pe=ae*ae+Ie*Ie;if(r!=0){r*=g*(b+1)*.5;let Ye=Math.sqrt(Pe),We=Ye-ee-re*g+r;if(We>0){let Ge=Math.min(1,We/(r*2))-1;Ge=(We-r*(1-Ge*Ge))/Ye,ae-=Ge*ae,Ie-=Ge*Ie,Pe=ae*ae+Ie*Ie}}e:if(W){re*=g;let Ye=(Pe-ee*ee-re*re)/(2*ee*re);Ye<-1?(Ye=-1,ce=Math.PI*n):Ye>1?(Ye=1,ce=0,a&&(_=(Math.sqrt(Pe)/(ee+re)-1)*h+1,m*=_,o&&(y*=_))):ce=Math.acos(Ye)*n,_=ee+re*Ye,L=re*Math.sin(ce),le=Math.atan2(Ie*_-ae*L,ae*_+Ie*L)}else{_=g*re,L=u*re;let Ye=_*_,We=L*L,Ge=Math.atan2(Ie,ae);N=We*ee*ee+Ye*Pe-Ye*We;let Yt=-2*We*ee,xs=We-Ye;if(V=Yt*Yt-4*xs*N,V>=0){let Et=Math.sqrt(V);Yt<0&&(Et=-Et),Et=-(Yt+Et)*.5;let cs=Et/xs,oi=N/Et,vs=Math.abs(cs)<Math.abs(oi)?cs:oi;if(cs=Pe-vs*vs,cs>=0){F=Math.sqrt(cs)*n,le=Ge-Math.atan2(F,vs),ce=Math.atan2(F/u,(vs-ee)/g);break e}}let vi=te.PI,Fs=ee-_,Ds=Fs*Fs,ai=0,ls=0,Ss=ee+_,hs=Ss*Ss,pt=0;N=-_*ee/(Ye-We),N>=-1&&N<=1&&(N=Math.acos(N),M=_*Math.cos(N)+ee,F=L*Math.sin(N),V=M*M+F*F,V<Ds&&(vi=N,Ds=V,Fs=M,ai=F),V>hs&&(ls=N,hs=V,Ss=M,pt=F)),Pe<=(Ds+hs)*.5?(le=Ge-Math.atan2(ai*n,Fs),ce=vi*n):(le=Ge-Math.atan2(pt*n,Ss),ce=ls*n)}let gt=Math.atan2(A,x)*S,tt=e.arotation;le=(le-gt)*te.radDeg+E-tt,le>180?le-=360:le<-180&&(le+=360),e.updateWorldTransformWith(c,d,tt+le*h,m,y,0,0),tt=t.arotation,ce=((ce+gt)*te.radDeg-t.ashearX)*S+v-tt,ce>180?ce-=360:ce<-180&&(ce+=360),t.updateWorldTransformWith(x,A,tt+ce*h,t.ascaleX,t.ascaleY,t.ashearX,t.ashearY)}}class Uo extends an{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}bendDirection=0;compress=!1;stretch=!1;uniform=!1;mix=0;softness=0;constructor(e){super(e,0,!1)}}class Vo extends an{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}positionMode=Jt.Fixed;spacingMode=et.Fixed;rotateMode=Is.Chain;offsetRotation=0;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;constructor(e){super(e,0,!1)}}var Jt;(function(l){l[l.Fixed=0]="Fixed",l[l.Percent=1]="Percent"})(Jt||(Jt={}));var et;(function(l){l[l.Length=0]="Length",l[l.Fixed=1]="Fixed",l[l.Percent=2]="Percent",l[l.Proportional=3]="Proportional"})(et||(et={}));var Is;(function(l){l[l.Tangent=0]="Tangent",l[l.Chain=1]="Chain",l[l.ChainScale=2]="ChainScale"})(Is||(Is={}));class is{static NONE=-1;static BEFORE=-2;static AFTER=-3;static epsilon=1e-5;data;bones;target;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;spaces=new Array;positions=new Array;world=new Array;curves=new Array;lengths=new Array;segments=new Array;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(let i=0,n=e.bones.length;i<n;i++){let a=t.findBone(e.bones[i].name);if(!a)throw new Error(`Couldn't find bone ${e.bones[i].name}.`);this.bones.push(a)}let s=t.findSlot(e.target.name);if(!s)throw new Error(`Couldn't find target bone ${e.target.name}`);this.target=s,this.position=e.position,this.spacing=e.spacing,this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY}isActive(){return this.active}setToSetupPose(){const e=this.data;this.position=e.position,this.spacing=e.spacing,this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY}update(e){let t=this.target.getAttachment();if(!(t instanceof Ps))return;let s=this.mixRotate,i=this.mixX,n=this.mixY;if(s==0&&i==0&&n==0)return;let a=this.data,o=a.rotateMode==Is.Tangent,r=a.rotateMode==Is.ChainScale,h=this.bones,c=h.length,d=o?c:c+1,g=se.setArraySize(this.spaces,d),u=r?this.lengths=se.setArraySize(this.lengths,c):[],m=this.spacing;switch(a.spacingMode){case et.Percent:if(r)for(let C=0,k=d-1;C<k;C++){let _=h[C],L=_.data.length,N=L*_.a,V=L*_.c;u[C]=Math.sqrt(N*N+V*V)}se.arrayFill(g,1,d,m);break;case et.Proportional:let x=0;for(let C=0,k=d-1;C<k;){let _=h[C],L=_.data.length;if(L<is.epsilon)r&&(u[C]=0),g[++C]=m;else{let N=L*_.a,V=L*_.c,W=Math.sqrt(N*N+V*V);r&&(u[C]=W),g[++C]=W,x+=W}}if(x>0){x=d/x*m;for(let C=1;C<d;C++)g[C]*=x}break;default:let A=a.spacingMode==et.Length;for(let C=0,k=d-1;C<k;){let _=h[C],L=_.data.length;if(L<is.epsilon)r&&(u[C]=0),g[++C]=m;else{let N=L*_.a,V=L*_.c,W=Math.sqrt(N*N+V*V);r&&(u[C]=W),g[++C]=(A?L+m:m)*W/L}}}let y=this.computeWorldPositions(t,d,o),b=y[0],E=y[1],v=a.offsetRotation,S=!1;if(v==0)S=a.rotateMode==Is.Chain;else{S=!1;let x=this.target.bone;v*=x.a*x.d-x.b*x.c>0?te.degRad:-.01745329277777778}for(let x=0,A=3;x<c;x++,A+=3){let C=h[x];C.worldX+=(b-C.worldX)*i,C.worldY+=(E-C.worldY)*n;let k=y[A],_=y[A+1],L=k-b,N=_-E;if(r){let V=u[x];if(V!=0){let W=(Math.sqrt(L*L+N*N)/V-1)*s+1;C.a*=W,C.c*=W}}if(b=k,E=_,s>0){let V=C.a,W=C.b,O=C.c,R=C.d,M=0,F=0,H=0;if(o?M=y[A-1]:g[x+1]==0?M=y[A+2]:M=Math.atan2(N,L),M-=Math.atan2(O,V),S){F=Math.cos(M),H=Math.sin(M);let Z=C.data.length;b+=(Z*(F*V-H*O)-L)*s,E+=(Z*(H*V+F*O)-N)*s}else M+=v;M>te.PI?M-=te.PI2:M<-3.1415927&&(M+=te.PI2),M*=s,F=Math.cos(M),H=Math.sin(M),C.a=F*V-H*O,C.b=F*W-H*R,C.c=H*V+F*O,C.d=H*W+F*R}C.updateAppliedTransform()}}computeWorldPositions(e,t,s){let i=this.target,n=this.position,a=this.spaces,o=se.setArraySize(this.positions,t*3+2),r=this.world,h=e.closed,c=e.worldVerticesLength,d=c/6,g=is.NONE;if(!e.constantSpeed){let Z=e.lengths;d-=h?1:2;let ee=Z[d];this.data.positionMode==Jt.Percent&&(n*=ee);let re;switch(this.data.spacingMode){case et.Percent:re=ee;break;case et.Proportional:re=ee/t;break;default:re=1}r=se.setArraySize(this.world,8);for(let le=0,ce=0,ae=0;le<t;le++,ce+=3){let Ie=a[le]*re;n+=Ie;let Pe=n;if(h)Pe%=ee,Pe<0&&(Pe+=ee),ae=0;else if(Pe<0){g!=is.BEFORE&&(g=is.BEFORE,e.computeWorldVertices(i,2,4,r,0,2)),this.addBeforePosition(Pe,r,0,o,ce);continue}else if(Pe>ee){g!=is.AFTER&&(g=is.AFTER,e.computeWorldVertices(i,c-6,4,r,0,2)),this.addAfterPosition(Pe-ee,r,0,o,ce);continue}for(;;ae++){let gt=Z[ae];if(!(Pe>gt)){if(ae==0)Pe/=gt;else{let tt=Z[ae-1];Pe=(Pe-tt)/(gt-tt)}break}}ae!=g&&(g=ae,h&&ae==d?(e.computeWorldVertices(i,c-4,4,r,0,2),e.computeWorldVertices(i,0,4,r,4,2)):e.computeWorldVertices(i,ae*6+2,8,r,0,2)),this.addCurvePosition(Pe,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],o,ce,s||le>0&&Ie==0)}return o}h?(c+=2,r=se.setArraySize(this.world,c),e.computeWorldVertices(i,2,c-4,r,0,2),e.computeWorldVertices(i,0,2,r,c-4,2),r[c-2]=r[0],r[c-1]=r[1]):(d--,c-=4,r=se.setArraySize(this.world,c),e.computeWorldVertices(i,2,c,r,0,2));let u=se.setArraySize(this.curves,d),m=0,y=r[0],b=r[1],E=0,v=0,S=0,x=0,A=0,C=0,k=0,_=0,L=0,N=0,V=0,W=0,O=0,R=0;for(let Z=0,ee=2;Z<d;Z++,ee+=6)E=r[ee],v=r[ee+1],S=r[ee+2],x=r[ee+3],A=r[ee+4],C=r[ee+5],k=(y-E*2+S)*.1875,_=(b-v*2+x)*.1875,L=((E-S)*3-y+A)*.09375,N=((v-x)*3-b+C)*.09375,V=k*2+L,W=_*2+N,O=(E-y)*.75+k+L*.16666667,R=(v-b)*.75+_+N*.16666667,m+=Math.sqrt(O*O+R*R),O+=V,R+=W,V+=L,W+=N,m+=Math.sqrt(O*O+R*R),O+=V,R+=W,m+=Math.sqrt(O*O+R*R),O+=V+L,R+=W+N,m+=Math.sqrt(O*O+R*R),u[Z]=m,y=A,b=C;this.data.positionMode==Jt.Percent&&(n*=m);let M;switch(this.data.spacingMode){case et.Percent:M=m;break;case et.Proportional:M=m/t;break;default:M=1}let F=this.segments,H=0;for(let Z=0,ee=0,re=0,le=0;Z<t;Z++,ee+=3){let ce=a[Z]*M;n+=ce;let ae=n;if(h)ae%=m,ae<0&&(ae+=m),re=0;else if(ae<0){this.addBeforePosition(ae,r,0,o,ee);continue}else if(ae>m){this.addAfterPosition(ae-m,r,c-4,o,ee);continue}for(;;re++){let Ie=u[re];if(!(ae>Ie)){if(re==0)ae/=Ie;else{let Pe=u[re-1];ae=(ae-Pe)/(Ie-Pe)}break}}if(re!=g){g=re;let Ie=re*6;for(y=r[Ie],b=r[Ie+1],E=r[Ie+2],v=r[Ie+3],S=r[Ie+4],x=r[Ie+5],A=r[Ie+6],C=r[Ie+7],k=(y-E*2+S)*.03,_=(b-v*2+x)*.03,L=((E-S)*3-y+A)*.006,N=((v-x)*3-b+C)*.006,V=k*2+L,W=_*2+N,O=(E-y)*.3+k+L*.16666667,R=(v-b)*.3+_+N*.16666667,H=Math.sqrt(O*O+R*R),F[0]=H,Ie=1;Ie<8;Ie++)O+=V,R+=W,V+=L,W+=N,H+=Math.sqrt(O*O+R*R),F[Ie]=H;O+=V,R+=W,H+=Math.sqrt(O*O+R*R),F[8]=H,O+=V+L,R+=W+N,H+=Math.sqrt(O*O+R*R),F[9]=H,le=0}for(ae*=H;;le++){let Ie=F[le];if(!(ae>Ie)){if(le==0)ae/=Ie;else{let Pe=F[le-1];ae=le+(ae-Pe)/(Ie-Pe)}break}}this.addCurvePosition(ae*.1,y,b,E,v,S,x,A,C,o,ee,s||Z>0&&ce==0)}return o}addBeforePosition(e,t,s,i,n){let a=t[s],o=t[s+1],r=t[s+2]-a,h=t[s+3]-o,c=Math.atan2(h,r);i[n]=a+e*Math.cos(c),i[n+1]=o+e*Math.sin(c),i[n+2]=c}addAfterPosition(e,t,s,i,n){let a=t[s+2],o=t[s+3],r=a-t[s],h=o-t[s+1],c=Math.atan2(h,r);i[n]=a+e*Math.cos(c),i[n+1]=o+e*Math.sin(c),i[n+2]=c}addCurvePosition(e,t,s,i,n,a,o,r,h,c,d,g){if(e==0||isNaN(e)){c[d]=t,c[d+1]=s,c[d+2]=Math.atan2(n-s,i-t);return}let u=e*e,m=u*e,y=1-e,b=y*y,E=b*y,v=y*e,S=v*3,x=y*S,A=S*e,C=t*E+i*x+a*A+r*m,k=s*E+n*x+o*A+h*m;c[d]=C,c[d+1]=k,g&&(e<.001?c[d+2]=Math.atan2(n-s,i-t):c[d+2]=Math.atan2(k-(s*b+n*v*2+o*u),C-(t*b+i*v*2+a*u)))}}class Hh{data;_bone=null;set bone(e){this._bone=e}get bone(){if(this._bone)return this._bone;throw new Error("Bone not set.")}inertia=0;strength=0;damping=0;massInverse=0;wind=0;gravity=0;mix=0;_reset=!0;ux=0;uy=0;cx=0;cy=0;tx=0;ty=0;xOffset=0;xVelocity=0;yOffset=0;yVelocity=0;rotateOffset=0;rotateVelocity=0;scaleOffset=0;scaleVelocity=0;active=!1;skeleton;remaining=0;lastTime=0;constructor(e,t){this.data=e,this.skeleton=t,this.bone=t.bones[e.bone.index],this.inertia=e.inertia,this.strength=e.strength,this.damping=e.damping,this.massInverse=e.massInverse,this.wind=e.wind,this.gravity=e.gravity,this.mix=e.mix}reset(){this.remaining=0,this.lastTime=this.skeleton.time,this._reset=!0,this.xOffset=0,this.xVelocity=0,this.yOffset=0,this.yVelocity=0,this.rotateOffset=0,this.rotateVelocity=0,this.scaleOffset=0,this.scaleVelocity=0}setToSetupPose(){const e=this.data;this.inertia=e.inertia,this.strength=e.strength,this.damping=e.damping,this.massInverse=e.massInverse,this.wind=e.wind,this.gravity=e.gravity,this.mix=e.mix}isActive(){return this.active}update(e){const t=this.mix;if(t==0)return;const s=this.data.x>0,i=this.data.y>0,n=this.data.rotate>0||this.data.shearX>0,a=this.data.scaleX>0,o=this.bone,r=o.data.length;switch(e){case Lt.none:return;case Lt.reset:this.reset();case Lt.update:const h=this.skeleton,c=Math.max(this.skeleton.time-this.lastTime,0);this.remaining+=c,this.lastTime=h.time;const d=o.worldX,g=o.worldY;if(this._reset)this._reset=!1,this.ux=d,this.uy=g;else{let u=this.remaining,m=this.inertia,y=this.data.step,b=this.skeleton.data.referenceScale,E=-1,v=this.data.limit*c,S=v*Math.abs(h.scaleY);if(v*=Math.abs(h.scaleX),s||i){if(s){const x=(this.ux-d)*m;this.xOffset+=x>v?v:x<-v?-v:x,this.ux=d}if(i){const x=(this.uy-g)*m;this.yOffset+=x>S?S:x<-S?-S:x,this.uy=g}if(u>=y){E=Math.pow(this.damping,60*y);const x=this.massInverse*y,A=this.strength,C=this.wind*b*h.scaleX,k=this.gravity*b*h.scaleY;do s&&(this.xVelocity+=(C-this.xOffset*A)*x,this.xOffset+=this.xVelocity*y,this.xVelocity*=E),i&&(this.yVelocity-=(k+this.yOffset*A)*x,this.yOffset+=this.yVelocity*y,this.yVelocity*=E),u-=y;while(u>=y)}s&&(o.worldX+=this.xOffset*t*this.data.x),i&&(o.worldY+=this.yOffset*t*this.data.y)}if(n||a){let x=Math.atan2(o.c,o.a),A=0,C=0,k=0,_=this.cx-o.worldX,L=this.cy-o.worldY;if(_>v?_=v:_<-v&&(_=-v),L>S?L=S:L<-S&&(L=-S),n){k=(this.data.rotate+this.data.shearX)*t;let N=Math.atan2(L+this.ty,_+this.tx)-x-this.rotateOffset*k;this.rotateOffset+=(N-Math.ceil(N*te.invPI2-.5)*te.PI2)*m,N=this.rotateOffset*k+x,A=Math.cos(N),C=Math.sin(N),a&&(N=r*o.getWorldScaleX(),N>0&&(this.scaleOffset+=(_*A+L*C)*m/N))}else{A=Math.cos(x),C=Math.sin(x);const N=r*o.getWorldScaleX();N>0&&(this.scaleOffset+=(_*A+L*C)*m/N)}if(u=this.remaining,u>=y){E==-1&&(E=Math.pow(this.damping,60*y));const N=this.massInverse*y,V=this.strength,W=this.wind,O=_s.yDown?-this.gravity:this.gravity,R=r/b;for(;;)if(u-=y,a&&(this.scaleVelocity+=(W*A-O*C-this.scaleOffset*V)*N,this.scaleOffset+=this.scaleVelocity*y,this.scaleVelocity*=E),n){if(this.rotateVelocity-=((W*C+O*A)*R+this.rotateOffset*V)*N,this.rotateOffset+=this.rotateVelocity*y,this.rotateVelocity*=E,u<y)break;const M=this.rotateOffset*k+x;A=Math.cos(M),C=Math.sin(M)}else if(u<y)break}}this.remaining=u}this.cx=o.worldX,this.cy=o.worldY;break;case Lt.pose:s&&(o.worldX+=this.xOffset*t*this.data.x),i&&(o.worldY+=this.yOffset*t*this.data.y)}if(n){let h=this.rotateOffset*t,c=0,d=0,g=0;if(this.data.shearX>0){let u=0;this.data.rotate>0&&(u=h*this.data.rotate,c=Math.sin(u),d=Math.cos(u),g=o.b,o.b=d*g-c*o.d,o.d=c*g+d*o.d),u+=h*this.data.shearX,c=Math.sin(u),d=Math.cos(u),g=o.a,o.a=d*g-c*o.c,o.c=c*g+d*o.c}else h*=this.data.rotate,c=Math.sin(h),d=Math.cos(h),g=o.a,o.a=d*g-c*o.c,o.c=c*g+d*o.c,g=o.b,o.b=d*g-c*o.d,o.d=c*g+d*o.d}if(a){const h=1+this.scaleOffset*t*this.data.scaleX;o.a*=h,o.c*=h}e!=Lt.pose&&(this.tx=r*o.a,this.ty=r*o.c),o.updateAppliedTransform()}translate(e,t){this.ux-=e,this.uy-=t,this.cx-=e,this.cy-=t}rotate(e,t,s){const i=s*te.degRad,n=Math.cos(i),a=Math.sin(i),o=this.cx-e,r=this.cy-t;this.translate(o*n-r*a-o,o*a+r*n-r)}}class $h{data;bone;color;darkColor=null;attachment=null;attachmentState=0;sequenceIndex=-1;deform=new Array;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("bone cannot be null.");this.data=e,this.bone=t,this.color=new ue,this.darkColor=e.darkColor?new ue:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(e){this.attachment!=e&&((!(e instanceof Ft)||!(this.attachment instanceof Ft)||e.timelineAttachment!=this.attachment.timelineAttachment)&&(this.deform.length=0),this.attachment=e,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class Wh{data;bones;target;mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;temp=new Zs;active=!1;constructor(e,t){if(!e)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(let i=0;i<e.bones.length;i++){let n=t.findBone(e.bones[i].name);if(!n)throw new Error(`Couldn't find bone ${e.bones[i].name}.`);this.bones.push(n)}let s=t.findBone(e.target.name);if(!s)throw new Error(`Couldn't find target bone ${e.target.name}.`);this.target=s,this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY,this.mixScaleX=e.mixScaleX,this.mixScaleY=e.mixScaleY,this.mixShearY=e.mixShearY}isActive(){return this.active}setToSetupPose(){const e=this.data;this.mixRotate=e.mixRotate,this.mixX=e.mixX,this.mixY=e.mixY,this.mixScaleX=e.mixScaleX,this.mixScaleY=e.mixScaleY,this.mixShearY=e.mixShearY}update(e){this.mixRotate==0&&this.mixX==0&&this.mixY==0&&this.mixScaleX==0&&this.mixScaleY==0&&this.mixShearY==0||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=t!=0||s!=0,r=this.target,h=r.a,c=r.b,d=r.c,g=r.d,u=h*g-c*d>0?te.degRad:-.01745329277777778,m=this.data.offsetRotation*u,y=this.data.offsetShearY*u,b=this.bones;for(let E=0,v=b.length;E<v;E++){let S=b[E];if(e!=0){let x=S.a,A=S.b,C=S.c,k=S.d,_=Math.atan2(d,h)-Math.atan2(C,x)+m;_>te.PI?_-=te.PI2:_<-3.1415927&&(_+=te.PI2),_*=e;let L=Math.cos(_),N=Math.sin(_);S.a=L*x-N*C,S.b=L*A-N*k,S.c=N*x+L*C,S.d=N*A+L*k}if(o){let x=this.temp;r.localToWorld(x.set(this.data.offsetX,this.data.offsetY)),S.worldX+=(x.x-S.worldX)*t,S.worldY+=(x.y-S.worldY)*s}if(i!=0){let x=Math.sqrt(S.a*S.a+S.c*S.c);x!=0&&(x=(x+(Math.sqrt(h*h+d*d)-x+this.data.offsetScaleX)*i)/x),S.a*=x,S.c*=x}if(n!=0){let x=Math.sqrt(S.b*S.b+S.d*S.d);x!=0&&(x=(x+(Math.sqrt(c*c+g*g)-x+this.data.offsetScaleY)*n)/x),S.b*=x,S.d*=x}if(a>0){let x=S.b,A=S.d,C=Math.atan2(A,x),k=Math.atan2(g,c)-Math.atan2(d,h)-(C-Math.atan2(S.c,S.a));k>te.PI?k-=te.PI2:k<-3.1415927&&(k+=te.PI2),k=C+(k+y)*a;let _=Math.sqrt(x*x+A*A);S.b=Math.cos(k)*_,S.d=Math.sin(k)*_}S.updateAppliedTransform()}}applyRelativeWorld(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=t!=0||s!=0,r=this.target,h=r.a,c=r.b,d=r.c,g=r.d,u=h*g-c*d>0?te.degRad:-.01745329277777778,m=this.data.offsetRotation*u,y=this.data.offsetShearY*u,b=this.bones;for(let E=0,v=b.length;E<v;E++){let S=b[E];if(e!=0){let x=S.a,A=S.b,C=S.c,k=S.d,_=Math.atan2(d,h)+m;_>te.PI?_-=te.PI2:_<-3.1415927&&(_+=te.PI2),_*=e;let L=Math.cos(_),N=Math.sin(_);S.a=L*x-N*C,S.b=L*A-N*k,S.c=N*x+L*C,S.d=N*A+L*k}if(o){let x=this.temp;r.localToWorld(x.set(this.data.offsetX,this.data.offsetY)),S.worldX+=x.x*t,S.worldY+=x.y*s}if(i!=0){let x=(Math.sqrt(h*h+d*d)-1+this.data.offsetScaleX)*i+1;S.a*=x,S.c*=x}if(n!=0){let x=(Math.sqrt(c*c+g*g)-1+this.data.offsetScaleY)*n+1;S.b*=x,S.d*=x}if(a>0){let x=Math.atan2(g,c)-Math.atan2(d,h);x>te.PI?x-=te.PI2:x<-3.1415927&&(x+=te.PI2);let A=S.b,C=S.d;x=Math.atan2(C,A)+(x-te.PI/2+y)*a;let k=Math.sqrt(A*A+C*C);S.b=Math.cos(x)*k,S.d=Math.sin(x)*k}S.updateAppliedTransform()}}applyAbsoluteLocal(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=this.target,r=this.bones;for(let h=0,c=r.length;h<c;h++){let d=r[h],g=d.arotation;e!=0&&(g+=(o.arotation-g+this.data.offsetRotation)*e);let u=d.ax,m=d.ay;u+=(o.ax-u+this.data.offsetX)*t,m+=(o.ay-m+this.data.offsetY)*s;let y=d.ascaleX,b=d.ascaleY;i!=0&&y!=0&&(y=(y+(o.ascaleX-y+this.data.offsetScaleX)*i)/y),n!=0&&b!=0&&(b=(b+(o.ascaleY-b+this.data.offsetScaleY)*n)/b);let E=d.ashearY;a!=0&&(E+=(o.ashearY-E+this.data.offsetShearY)*a),d.updateWorldTransformWith(u,m,g,y,b,d.ashearX,E)}}applyRelativeLocal(){let e=this.mixRotate,t=this.mixX,s=this.mixY,i=this.mixScaleX,n=this.mixScaleY,a=this.mixShearY,o=this.target,r=this.bones;for(let h=0,c=r.length;h<c;h++){let d=r[h],g=d.arotation+(o.arotation+this.data.offsetRotation)*e,u=d.ax+(o.ax+this.data.offsetX)*t,m=d.ay+(o.ay+this.data.offsetY)*s,y=d.ascaleX*((o.ascaleX-1+this.data.offsetScaleX)*i+1),b=d.ascaleY*((o.ascaleY-1+this.data.offsetScaleY)*n+1),E=d.ashearY+(o.ashearY+this.data.offsetShearY)*a;d.updateWorldTransformWith(u,m,g,y,b,d.ashearX,E)}}}class _s{static quadTriangles=[0,1,2,2,3,0];static yDown=!1;data;bones;slots;drawOrder;ikConstraints;transformConstraints;pathConstraints;physicsConstraints;_updateCache=new Array;skin=null;color;scaleX=1;_scaleY=1;get scaleY(){return _s.yDown?-this._scaleY:this._scaleY}set scaleY(e){this._scaleY=e}x=0;y=0;time=0;constructor(e){if(!e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(let t=0;t<e.bones.length;t++){let s=e.bones[t],i;if(!s.parent)i=new $r(s,this,null);else{let n=this.bones[s.parent.index];i=new $r(s,this,n),n.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let t=0;t<e.slots.length;t++){let s=e.slots[t],i=this.bones[s.boneData.index],n=new $h(s,i);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let t=0;t<e.ikConstraints.length;t++){let s=e.ikConstraints[t];this.ikConstraints.push(new Gh(s,this))}this.transformConstraints=new Array;for(let t=0;t<e.transformConstraints.length;t++){let s=e.transformConstraints[t];this.transformConstraints.push(new Wh(s,this))}this.pathConstraints=new Array;for(let t=0;t<e.pathConstraints.length;t++){let s=e.pathConstraints[t];this.pathConstraints.push(new is(s,this))}this.physicsConstraints=new Array;for(let t=0;t<e.physicsConstraints.length;t++){let s=e.physicsConstraints[t];this.physicsConstraints.push(new Hh(s,this))}this.color=new ue(1,1,1,1),this.updateCache()}updateCache(){let e=this._updateCache;e.length=0;let t=this.bones;for(let g=0,u=t.length;g<u;g++){let m=t[g];m.sorted=m.data.skinRequired,m.active=!m.sorted}if(this.skin){let g=this.skin.bones;for(let u=0,m=this.skin.bones.length;u<m;u++){let y=this.bones[g[u].index];do y.sorted=!1,y.active=!0,y=y.parent;while(y)}}let s=this.ikConstraints,i=this.transformConstraints,n=this.pathConstraints,a=this.physicsConstraints,o=s.length,r=i.length,h=n.length,c=this.physicsConstraints.length,d=o+r+h+c;e:for(let g=0;g<d;g++){for(let u=0;u<o;u++){let m=s[u];if(m.data.order==g){this.sortIkConstraint(m);continue e}}for(let u=0;u<r;u++){let m=i[u];if(m.data.order==g){this.sortTransformConstraint(m);continue e}}for(let u=0;u<h;u++){let m=n[u];if(m.data.order==g){this.sortPathConstraint(m);continue e}}for(let u=0;u<c;u++){const m=a[u];if(m.data.order==g){this.sortPhysicsConstraint(m);continue e}}}for(let g=0,u=t.length;g<u;g++)this.sortBone(t[g])}sortIkConstraint(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||this.skin&&se.contains(this.skin.constraints,e.data,!0)),!e.active)return;let t=e.target;this.sortBone(t);let s=e.bones,i=s[0];if(this.sortBone(i),s.length==1)this._updateCache.push(e),this.sortReset(i.children);else{let n=s[s.length-1];this.sortBone(n),this._updateCache.push(e),this.sortReset(i.children),n.sorted=!0}}sortPathConstraint(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||this.skin&&se.contains(this.skin.constraints,e.data,!0)),!e.active)return;let t=e.target,s=t.data.index,i=t.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let r=0,h=this.data.skins.length;r<h;r++)this.sortPathConstraintAttachment(this.data.skins[r],s,i);let n=t.getAttachment();n instanceof Ps&&this.sortPathConstraintAttachmentWith(n,i);let a=e.bones,o=a.length;for(let r=0;r<o;r++)this.sortBone(a[r]);this._updateCache.push(e);for(let r=0;r<o;r++)this.sortReset(a[r].children);for(let r=0;r<o;r++)a[r].sorted=!0}sortTransformConstraint(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||this.skin&&se.contains(this.skin.constraints,e.data,!0)),!e.active)return;this.sortBone(e.target);let t=e.bones,s=t.length;if(e.data.local)for(let i=0;i<s;i++){let n=t[i];this.sortBone(n.parent),this.sortBone(n)}else for(let i=0;i<s;i++)this.sortBone(t[i]);this._updateCache.push(e);for(let i=0;i<s;i++)this.sortReset(t[i].children);for(let i=0;i<s;i++)t[i].sorted=!0}sortPathConstraintAttachment(e,t,s){let i=e.attachments[t];if(i)for(let n in i)this.sortPathConstraintAttachmentWith(i[n],s)}sortPathConstraintAttachmentWith(e,t){if(!(e instanceof Ps))return;let s=e.bones;if(!s)this.sortBone(t);else{let i=this.bones;for(let n=0,a=s.length;n<a;){let o=s[n++];for(o+=n;n<o;)this.sortBone(i[s[n++]])}}}sortPhysicsConstraint(e){const t=e.bone;e.active=t.active&&(!e.data.skinRequired||this.skin!=null&&se.contains(this.skin.constraints,e.data,!0)),e.active&&(this.sortBone(t),this._updateCache.push(e),this.sortReset(t.children),t.sorted=!0)}sortBone(e){if(!e||e.sorted)return;let t=e.parent;t&&this.sortBone(t),e.sorted=!0,this._updateCache.push(e)}sortReset(e){for(let t=0,s=e.length;t<s;t++){let i=e[t];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}}updateWorldTransform(e){if(e==null)throw new Error("physics is undefined");let t=this.bones;for(let i=0,n=t.length;i<n;i++){let a=t[i];a.ax=a.x,a.ay=a.y,a.arotation=a.rotation,a.ascaleX=a.scaleX,a.ascaleY=a.scaleY,a.ashearX=a.shearX,a.ashearY=a.shearY}let s=this._updateCache;for(let i=0,n=s.length;i<n;i++)s[i].update(e)}updateWorldTransformWith(e,t){if(!t)throw new Error("parent cannot be null.");let s=this.bones;for(let b=1,E=s.length;b<E;b++){let v=s[b];v.ax=v.x,v.ay=v.y,v.arotation=v.rotation,v.ascaleX=v.scaleX,v.ascaleY=v.scaleY,v.ashearX=v.shearX,v.ashearY=v.shearY}let i=this.getRootBone();if(!i)throw new Error("Root bone must not be null.");let n=t.a,a=t.b,o=t.c,r=t.d;i.worldX=n*this.x+a*this.y+t.worldX,i.worldY=o*this.x+r*this.y+t.worldY;const h=(i.rotation+i.shearX)*te.degRad,c=(i.rotation+90+i.shearY)*te.degRad,d=Math.cos(h)*i.scaleX,g=Math.cos(c)*i.scaleY,u=Math.sin(h)*i.scaleX,m=Math.sin(c)*i.scaleY;i.a=(n*d+a*u)*this.scaleX,i.b=(n*g+a*m)*this.scaleX,i.c=(o*d+r*u)*this.scaleY,i.d=(o*g+r*m)*this.scaleY;let y=this._updateCache;for(let b=0,E=y.length;b<E;b++){let v=y[b];v!=i&&v.update(e)}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){for(const e of this.bones)e.setToSetupPose();for(const e of this.ikConstraints)e.setToSetupPose();for(const e of this.transformConstraints)e.setToSetupPose();for(const e of this.pathConstraints)e.setToSetupPose();for(const e of this.physicsConstraints)e.setToSetupPose()}setSlotsToSetupPose(){let e=this.slots;se.arrayCopy(e,0,this.drawOrder,0,e.length);for(let t=0,s=e.length;t<s;t++)e[t].setToSetupPose()}getRootBone(){return this.bones.length==0?null:this.bones[0]}findBone(e){if(!e)throw new Error("boneName cannot be null.");let t=this.bones;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.data.name==e)return n}return null}findSlot(e){if(!e)throw new Error("slotName cannot be null.");let t=this.slots;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.data.name==e)return n}return null}setSkinByName(e){let t=this.data.findSkin(e);if(!t)throw new Error("Skin not found: "+e);this.setSkin(t)}setSkin(e){if(e!=this.skin){if(e)if(this.skin)e.attachAll(this,this.skin);else{let t=this.slots;for(let s=0,i=t.length;s<i;s++){let n=t[s],a=n.data.attachmentName;if(a){let o=e.getAttachment(s,a);o&&n.setAttachment(o)}}}this.skin=e,this.updateCache()}}getAttachmentByName(e,t){let s=this.data.findSlot(e);if(!s)throw new Error(`Can't find slot with name ${e}`);return this.getAttachment(s.index,t)}getAttachment(e,t){if(!t)throw new Error("attachmentName cannot be null.");if(this.skin){let s=this.skin.getAttachment(e,t);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null}setAttachment(e,t){if(!e)throw new Error("slotName cannot be null.");let s=this.slots;for(let i=0,n=s.length;i<n;i++){let a=s[i];if(a.data.name==e){let o=null;if(t&&(o=this.getAttachment(i,t),!o))throw new Error("Attachment not found: "+t+", for slot: "+e);a.setAttachment(o);return}}throw new Error("Slot not found: "+e)}findIkConstraint(e){if(!e)throw new Error("constraintName cannot be null.");return this.ikConstraints.find(t=>t.data.name==e)??null}findTransformConstraint(e){if(!e)throw new Error("constraintName cannot be null.");return this.transformConstraints.find(t=>t.data.name==e)??null}findPathConstraint(e){if(!e)throw new Error("constraintName cannot be null.");return this.pathConstraints.find(t=>t.data.name==e)??null}findPhysicsConstraint(e){if(e==null)throw new Error("constraintName cannot be null.");return this.physicsConstraints.find(t=>t.data.name==e)??null}getBoundsRect(e){let t=new Zs,s=new Zs;return this.getBounds(t,s,void 0,e),{x:t.x,y:t.y,width:s.x,height:s.y}}getBounds(e,t,s=new Array(2),i=null){if(!e)throw new Error("offset cannot be null.");if(!t)throw new Error("size cannot be null.");let n=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let c=0,d=n.length;c<d;c++){let g=n[c];if(!g.bone.active)continue;let u=0,m=null,y=null,b=g.getAttachment();if(b instanceof Xe)u=8,m=se.setArraySize(s,u,0),b.computeWorldVertices(g,m,0,2),y=_s.quadTriangles;else if(b instanceof os){let E=b;u=E.worldVerticesLength,m=se.setArraySize(s,u,0),E.computeWorldVertices(g,0,u,m,0,2),y=E.triangles}else if(b instanceof ii&&i!=null){i.clipStart(g,b);continue}if(m&&y){i!=null&&i.isClipping()&&(i.clipTriangles(m,y,y.length),m=i.clippedVertices,u=i.clippedVertices.length);for(let E=0,v=m.length;E<v;E+=2){let S=m[E],x=m[E+1];a=Math.min(a,S),o=Math.min(o,x),r=Math.max(r,S),h=Math.max(h,x)}}i?.clipEndWithSlot(g)}i?.clipEnd(),e.set(a,o),t.set(r-a,h-o)}update(e){this.time+=e}physicsTranslate(e,t){const s=this.physicsConstraints;for(let i=0,n=s.length;i<n;i++)s[i].translate(e,t)}physicsRotate(e,t,s){const i=this.physicsConstraints;for(let n=0,a=i.length;n<a;n++)i[n].rotate(e,t,s)}}var Lt;(function(l){l[l.none=0]="none",l[l.reset=1]="reset",l[l.update=2]="update",l[l.pose=3]="pose"})(Lt||(Lt={}));class zo extends an{_bone=null;set bone(e){this._bone=e}get bone(){if(this._bone)return this._bone;throw new Error("BoneData not set.")}x=0;y=0;rotate=0;scaleX=0;shearX=0;limit=0;step=0;inertia=0;strength=0;damping=0;massInverse=0;wind=0;gravity=0;mix=0;inertiaGlobal=!1;strengthGlobal=!1;dampingGlobal=!1;massGlobal=!1;windGlobal=!1;gravityGlobal=!1;mixGlobal=!1;constructor(e){super(e,0,!1)}}class jo{name=null;bones=new Array;slots=new Array;skins=new Array;defaultSkin=null;events=new Array;animations=new Array;ikConstraints=new Array;transformConstraints=new Array;pathConstraints=new Array;physicsConstraints=new Array;x=0;y=0;width=0;height=0;referenceScale=100;version=null;hash=null;fps=0;imagesPath=null;audioPath=null;findBone(e){if(!e)throw new Error("boneName cannot be null.");let t=this.bones;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.name==e)return n}return null}findSlot(e){if(!e)throw new Error("slotName cannot be null.");let t=this.slots;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.name==e)return n}return null}findSkin(e){if(!e)throw new Error("skinName cannot be null.");let t=this.skins;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.name==e)return n}return null}findEvent(e){if(!e)throw new Error("eventDataName cannot be null.");let t=this.events;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.name==e)return n}return null}findAnimation(e){if(!e)throw new Error("animationName cannot be null.");let t=this.animations;for(let s=0,i=t.length;s<i;s++){let n=t[s];if(n.name==e)return n}return null}findIkConstraint(e){if(!e)throw new Error("constraintName cannot be null.");const t=this.ikConstraints;for(let s=0,i=t.length;s<i;s++){const n=t[s];if(n.name==e)return n}return null}findTransformConstraint(e){if(!e)throw new Error("constraintName cannot be null.");const t=this.transformConstraints;for(let s=0,i=t.length;s<i;s++){const n=t[s];if(n.name==e)return n}return null}findPathConstraint(e){if(!e)throw new Error("constraintName cannot be null.");const t=this.pathConstraints;for(let s=0,i=t.length;s<i;s++){const n=t[s];if(n.name==e)return n}return null}findPhysicsConstraint(e){if(!e)throw new Error("constraintName cannot be null.");const t=this.physicsConstraints;for(let s=0,i=t.length;s<i;s++){const n=t[s];if(n.name==e)return n}return null}}class Wr{slotIndex;name;attachment;constructor(e=0,t,s){this.slotIndex=e,this.name=t,this.attachment=s}}class Hn{name;attachments=new Array;bones=Array();constraints=new Array;color=new ue(.99607843,.61960787,.30980393,1);constructor(e){if(!e)throw new Error("name cannot be null.");this.name=e}setAttachment(e,t,s){if(!s)throw new Error("attachment cannot be null.");let i=this.attachments;e>=i.length&&(i.length=e+1),i[e]||(i[e]={}),i[e][t]=s}addSkin(e){for(let i=0;i<e.bones.length;i++){let n=e.bones[i],a=!1;for(let o=0;o<this.bones.length;o++)if(this.bones[o]==n){a=!0;break}a||this.bones.push(n)}for(let i=0;i<e.constraints.length;i++){let n=e.constraints[i],a=!1;for(let o=0;o<this.constraints.length;o++)if(this.constraints[o]==n){a=!0;break}a||this.constraints.push(n)}let t=e.getAttachments();for(let i=0;i<t.length;i++){var s=t[i];this.setAttachment(s.slotIndex,s.name,s.attachment)}}copySkin(e){for(let i=0;i<e.bones.length;i++){let n=e.bones[i],a=!1;for(let o=0;o<this.bones.length;o++)if(this.bones[o]==n){a=!0;break}a||this.bones.push(n)}for(let i=0;i<e.constraints.length;i++){let n=e.constraints[i],a=!1;for(let o=0;o<this.constraints.length;o++)if(this.constraints[o]==n){a=!0;break}a||this.constraints.push(n)}let t=e.getAttachments();for(let i=0;i<t.length;i++){var s=t[i];s.attachment&&(s.attachment instanceof os?(s.attachment=s.attachment.newLinkedMesh(),this.setAttachment(s.slotIndex,s.name,s.attachment)):(s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment)))}}getAttachment(e,t){let s=this.attachments[e];return s?s[t]:null}removeAttachment(e,t){let s=this.attachments[e];s&&delete s[t]}getAttachments(){let e=new Array;for(var t=0;t<this.attachments.length;t++){let s=this.attachments[t];if(s)for(let i in s){let n=s[i];n&&e.push(new Wr(t,i,n))}}return e}getAttachmentsForSlot(e,t){let s=this.attachments[e];if(s)for(let i in s){let n=s[i];n&&t.push(new Wr(e,i,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(e,t){let s=0;for(let i=0;i<e.slots.length;i++){let n=e.slots[i],a=n.getAttachment();if(a&&s<t.attachments.length){let o=t.attachments[s];for(let r in o){let h=o[r];if(a==h){let c=this.getAttachment(s,r);c&&n.setAttachment(c);break}}}s++}}}class Go{index=0;name;boneData;color=new ue(1,1,1,1);darkColor=null;attachmentName=null;blendMode=$i.Normal;visible=!0;constructor(e,t,s){if(e<0)throw new Error("index must be >= 0.");if(!t)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=e,this.name=t,this.boneData=s}}var $i;(function(l){l[l.Normal=0]="Normal",l[l.Additive=1]="Additive",l[l.Multiply=2]="Multiply",l[l.Screen=3]="Screen"})($i||($i={}));class Ho extends an{bones=new Array;_target=null;set target(e){this._target=e}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;offsetRotation=0;offsetX=0;offsetY=0;offsetScaleX=0;offsetScaleY=0;offsetShearY=0;relative=!1;local=!1;constructor(e){super(e,0,!1)}}class qh{scale=1;attachmentLoader;linkedMeshes=new Array;constructor(e){this.attachmentLoader=e}readSkeletonData(e){let t=this.scale,s=new jo;s.name="";let i=new Jh(e),n=i.readInt32(),a=i.readInt32();s.hash=a==0&&n==0?null:a.toString(16)+n.toString(16),s.version=i.readString(),s.x=i.readFloat(),s.y=i.readFloat(),s.width=i.readFloat(),s.height=i.readFloat(),s.referenceScale=i.readFloat()*t;let o=i.readBoolean();o&&(s.fps=i.readFloat(),s.imagesPath=i.readString(),s.audioPath=i.readString());let r=0;r=i.readInt(!0);for(let c=0;c<r;c++){let d=i.readString();if(!d)throw new Error("String in string table must not be null.");i.strings.push(d)}r=i.readInt(!0);for(let c=0;c<r;c++){let d=i.readString();if(!d)throw new Error("Bone name must not be null.");let g=c==0?null:s.bones[i.readInt(!0)],u=new No(c,d,g);u.rotation=i.readFloat(),u.x=i.readFloat()*t,u.y=i.readFloat()*t,u.scaleX=i.readFloat(),u.scaleY=i.readFloat(),u.shearX=i.readFloat(),u.shearY=i.readFloat(),u.length=i.readFloat()*t,u.inherit=i.readByte(),u.skinRequired=i.readBoolean(),o&&(ue.rgba8888ToColor(u.color,i.readInt32()),u.icon=i.readString()??void 0,u.visible=i.readBoolean()),s.bones.push(u)}r=i.readInt(!0);for(let c=0;c<r;c++){let d=i.readString();if(!d)throw new Error("Slot name must not be null.");let g=s.bones[i.readInt(!0)],u=new Go(c,d,g);ue.rgba8888ToColor(u.color,i.readInt32());let m=i.readInt32();m!=-1&&ue.rgb888ToColor(u.darkColor=new ue,m),u.attachmentName=i.readStringRef(),u.blendMode=i.readInt(!0),o&&(u.visible=i.readBoolean()),s.slots.push(u)}r=i.readInt(!0);for(let c=0,d;c<r;c++){let g=i.readString();if(!g)throw new Error("IK constraint data name must not be null.");let u=new Uo(g);u.order=i.readInt(!0),d=i.readInt(!0);for(let y=0;y<d;y++)u.bones.push(s.bones[i.readInt(!0)]);u.target=s.bones[i.readInt(!0)];let m=i.readByte();u.skinRequired=(m&1)!=0,u.bendDirection=(m&2)!=0?1:-1,u.compress=(m&4)!=0,u.stretch=(m&8)!=0,u.uniform=(m&16)!=0,(m&32)!=0&&(u.mix=(m&64)!=0?i.readFloat():1),(m&128)!=0&&(u.softness=i.readFloat()*t),s.ikConstraints.push(u)}r=i.readInt(!0);for(let c=0,d;c<r;c++){let g=i.readString();if(!g)throw new Error("Transform constraint data name must not be null.");let u=new Ho(g);u.order=i.readInt(!0),d=i.readInt(!0);for(let y=0;y<d;y++)u.bones.push(s.bones[i.readInt(!0)]);u.target=s.bones[i.readInt(!0)];let m=i.readByte();u.skinRequired=(m&1)!=0,u.local=(m&2)!=0,u.relative=(m&4)!=0,(m&8)!=0&&(u.offsetRotation=i.readFloat()),(m&16)!=0&&(u.offsetX=i.readFloat()*t),(m&32)!=0&&(u.offsetY=i.readFloat()*t),(m&64)!=0&&(u.offsetScaleX=i.readFloat()),(m&128)!=0&&(u.offsetScaleY=i.readFloat()),m=i.readByte(),(m&1)!=0&&(u.offsetShearY=i.readFloat()),(m&2)!=0&&(u.mixRotate=i.readFloat()),(m&4)!=0&&(u.mixX=i.readFloat()),(m&8)!=0&&(u.mixY=i.readFloat()),(m&16)!=0&&(u.mixScaleX=i.readFloat()),(m&32)!=0&&(u.mixScaleY=i.readFloat()),(m&64)!=0&&(u.mixShearY=i.readFloat()),s.transformConstraints.push(u)}r=i.readInt(!0);for(let c=0,d;c<r;c++){let g=i.readString();if(!g)throw new Error("Path constraint data name must not be null.");let u=new Vo(g);u.order=i.readInt(!0),u.skinRequired=i.readBoolean(),d=i.readInt(!0);for(let y=0;y<d;y++)u.bones.push(s.bones[i.readInt(!0)]);u.target=s.slots[i.readInt(!0)];const m=i.readByte();u.positionMode=m&1,u.spacingMode=m>>1&3,u.rotateMode=m>>3&3,(m&128)!=0&&(u.offsetRotation=i.readFloat()),u.position=i.readFloat(),u.positionMode==Jt.Fixed&&(u.position*=t),u.spacing=i.readFloat(),(u.spacingMode==et.Length||u.spacingMode==et.Fixed)&&(u.spacing*=t),u.mixRotate=i.readFloat(),u.mixX=i.readFloat(),u.mixY=i.readFloat(),s.pathConstraints.push(u)}r=i.readInt(!0);for(let c=0,d;c<r;c++){const g=i.readString();if(!g)throw new Error("Physics constraint data name must not be null.");const u=new zo(g);u.order=i.readInt(!0),u.bone=s.bones[i.readInt(!0)];let m=i.readByte();u.skinRequired=(m&1)!=0,(m&2)!=0&&(u.x=i.readFloat()),(m&4)!=0&&(u.y=i.readFloat()),(m&8)!=0&&(u.rotate=i.readFloat()),(m&16)!=0&&(u.scaleX=i.readFloat()),(m&32)!=0&&(u.shearX=i.readFloat()),u.limit=((m&64)!=0?i.readFloat():5e3)*t,u.step=1/i.readUnsignedByte(),u.inertia=i.readFloat(),u.strength=i.readFloat(),u.damping=i.readFloat(),u.massInverse=(m&128)!=0?i.readFloat():1,u.wind=i.readFloat(),u.gravity=i.readFloat(),m=i.readByte(),(m&1)!=0&&(u.inertiaGlobal=!0),(m&2)!=0&&(u.strengthGlobal=!0),(m&4)!=0&&(u.dampingGlobal=!0),(m&8)!=0&&(u.massGlobal=!0),(m&16)!=0&&(u.windGlobal=!0),(m&32)!=0&&(u.gravityGlobal=!0),(m&64)!=0&&(u.mixGlobal=!0),u.mix=(m&128)!=0?i.readFloat():1,s.physicsConstraints.push(u)}let h=this.readSkin(i,s,!0,o);h&&(s.defaultSkin=h,s.skins.push(h));{let c=s.skins.length;for(se.setArraySize(s.skins,r=c+i.readInt(!0));c<r;c++){let d=this.readSkin(i,s,!1,o);if(!d)throw new Error("readSkin() should not have returned null.");s.skins[c]=d}}r=this.linkedMeshes.length;for(let c=0;c<r;c++){let d=this.linkedMeshes[c];const g=s.skins[d.skinIndex];if(!d.parent)throw new Error("Linked mesh parent must not be null");let u=g.getAttachment(d.slotIndex,d.parent);if(!u)throw new Error(`Parent mesh not found: ${d.parent}`);d.mesh.timelineAttachment=d.inheritTimeline?u:d.mesh,d.mesh.setParentMesh(u),d.mesh.region!=null&&d.mesh.updateRegion()}this.linkedMeshes.length=0,r=i.readInt(!0);for(let c=0;c<r;c++){let d=i.readString();if(!d)throw new Error("Event data name must not be null");let g=new Xo(d);g.intValue=i.readInt(!1),g.floatValue=i.readFloat(),g.stringValue=i.readString(),g.audioPath=i.readString(),g.audioPath&&(g.volume=i.readFloat(),g.balance=i.readFloat()),s.events.push(g)}r=i.readInt(!0);for(let c=0;c<r;c++){let d=i.readString();if(!d)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(i,d,s))}return s}readSkin(e,t,s,i){let n=null,a=0;if(s){if(a=e.readInt(!0),a==0)return null;n=new Hn("default")}else{let o=e.readString();if(!o)throw new Error("Skin name must not be null.");n=new Hn(o),i&&ue.rgba8888ToColor(n.color,e.readInt32()),n.bones.length=e.readInt(!0);for(let r=0,h=n.bones.length;r<h;r++)n.bones[r]=t.bones[e.readInt(!0)];for(let r=0,h=e.readInt(!0);r<h;r++)n.constraints.push(t.ikConstraints[e.readInt(!0)]);for(let r=0,h=e.readInt(!0);r<h;r++)n.constraints.push(t.transformConstraints[e.readInt(!0)]);for(let r=0,h=e.readInt(!0);r<h;r++)n.constraints.push(t.pathConstraints[e.readInt(!0)]);for(let r=0,h=e.readInt(!0);r<h;r++)n.constraints.push(t.physicsConstraints[e.readInt(!0)]);a=e.readInt(!0)}for(let o=0;o<a;o++){let r=e.readInt(!0);for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readStringRef();if(!d)throw new Error("Attachment name must not be null");let g=this.readAttachment(e,t,n,r,d,i);g&&n.setAttachment(r,d,g)}}return n}readAttachment(e,t,s,i,n,a){let o=this.scale,r=e.readByte();const h=(r&8)!=0?e.readStringRef():n;if(!h)throw new Error("Attachment name must not be null");switch(r&7){case ns.Region:{let c=(r&16)!=0?e.readStringRef():null;const d=(r&32)!=0?e.readInt32():4294967295,g=(r&64)!=0?this.readSequence(e):null;let u=(r&128)!=0?e.readFloat():0,m=e.readFloat(),y=e.readFloat(),b=e.readFloat(),E=e.readFloat(),v=e.readFloat(),S=e.readFloat();c||(c=h);let x=this.attachmentLoader.newRegionAttachment(s,h,c,g);return x?(x.path=c,x.x=m*o,x.y=y*o,x.scaleX=b,x.scaleY=E,x.rotation=u,x.width=v*o,x.height=S*o,ue.rgba8888ToColor(x.color,d),x.sequence=g,g==null&&x.updateRegion(),x):null}case ns.BoundingBox:{let c=this.readVertices(e,(r&16)!=0),d=a?e.readInt32():0,g=this.attachmentLoader.newBoundingBoxAttachment(s,h);return g?(g.worldVerticesLength=c.length,g.vertices=c.vertices,g.bones=c.bones,a&&ue.rgba8888ToColor(g.color,d),g):null}case ns.Mesh:{let c=(r&16)!=0?e.readStringRef():h;const d=(r&32)!=0?e.readInt32():4294967295,g=(r&64)!=0?this.readSequence(e):null,u=e.readInt(!0),m=this.readVertices(e,(r&128)!=0),y=this.readFloatArray(e,m.length,1),b=this.readShortArray(e,(m.length-u-2)*3);let E=[],v=0,S=0;a&&(E=this.readShortArray(e,e.readInt(!0)),v=e.readFloat(),S=e.readFloat()),c||(c=h);let x=this.attachmentLoader.newMeshAttachment(s,h,c,g);return x?(x.path=c,ue.rgba8888ToColor(x.color,d),x.bones=m.bones,x.vertices=m.vertices,x.worldVerticesLength=m.length,x.triangles=b,x.regionUVs=y,g==null&&x.updateRegion(),x.hullLength=u<<1,x.sequence=g,a&&(x.edges=E,x.width=v*o,x.height=S*o),x):null}case ns.LinkedMesh:{const c=(r&16)!=0?e.readStringRef():h;if(c==null)throw new Error("Path of linked mesh must not be null");const d=(r&32)!=0?e.readInt32():4294967295,g=(r&64)!=0?this.readSequence(e):null,u=(r&128)!=0,m=e.readInt(!0),y=e.readStringRef();let b=0,E=0;a&&(b=e.readFloat(),E=e.readFloat());let v=this.attachmentLoader.newMeshAttachment(s,h,c,g);return v?(v.path=c,ue.rgba8888ToColor(v.color,d),v.sequence=g,a&&(v.width=b*o,v.height=E*o),this.linkedMeshes.push(new Kh(v,m,i,y,u)),v):null}case ns.Path:{const c=(r&16)!=0,d=(r&32)!=0,g=this.readVertices(e,(r&64)!=0),u=se.newArray(g.length/6,0);for(let b=0,E=u.length;b<E;b++)u[b]=e.readFloat()*o;const m=a?e.readInt32():0,y=this.attachmentLoader.newPathAttachment(s,h);return y?(y.closed=c,y.constantSpeed=d,y.worldVerticesLength=g.length,y.vertices=g.vertices,y.bones=g.bones,y.lengths=u,a&&ue.rgba8888ToColor(y.color,m),y):null}case ns.Point:{const c=e.readFloat(),d=e.readFloat(),g=e.readFloat(),u=a?e.readInt32():0,m=this.attachmentLoader.newPointAttachment(s,h);return m?(m.x=d*o,m.y=g*o,m.rotation=c,a&&ue.rgba8888ToColor(m.color,u),m):null}case ns.Clipping:{const c=e.readInt(!0),d=this.readVertices(e,(r&16)!=0);let g=a?e.readInt32():0,u=this.attachmentLoader.newClippingAttachment(s,h);return u?(u.endSlot=t.slots[c],u.worldVerticesLength=d.length,u.vertices=d.vertices,u.bones=d.bones,a&&ue.rgba8888ToColor(u.color,g),u):null}}return null}readSequence(e){let t=new Js(e.readInt(!0));return t.start=e.readInt(!0),t.digits=e.readInt(!0),t.setupIndex=e.readInt(!0),t}readVertices(e,t){const s=this.scale,i=e.readInt(!0),n=new Zh;if(n.length=i<<1,!t)return n.vertices=this.readFloatArray(e,n.length,s),n;let a=new Array,o=new Array;for(let r=0;r<i;r++){let h=e.readInt(!0);o.push(h);for(let c=0;c<h;c++)o.push(e.readInt(!0)),a.push(e.readFloat()*s),a.push(e.readFloat()*s),a.push(e.readFloat())}return n.vertices=se.toFloatArray(a),n.bones=o,n}readFloatArray(e,t,s){let i=new Array(t);if(s==1)for(let n=0;n<t;n++)i[n]=e.readFloat();else for(let n=0;n<t;n++)i[n]=e.readFloat()*s;return i}readShortArray(e,t){let s=new Array(t);for(let i=0;i<t;i++)s[i]=e.readInt(!0);return s}readAnimation(e,t,s){e.readInt(!0);let i=new Array,n=this.scale;for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readInt(!0);for(let g=0,u=e.readInt(!0);g<u;g++){let m=e.readByte(),y=e.readInt(!0),b=y-1;switch(m){case dc:{let E=new qs(y,d);for(let v=0;v<y;v++)E.setFrame(v,e.readFloat(),e.readStringRef());i.push(E);break}case fc:{let E=e.readInt(!0),v=new bo(y,E,d),S=e.readFloat(),x=e.readUnsignedByte()/255,A=e.readUnsignedByte()/255,C=e.readUnsignedByte()/255,k=e.readUnsignedByte()/255;for(let _=0,L=0;v.setFrame(_,S,x,A,C,k),_!=b;_++){let N=e.readFloat(),V=e.readUnsignedByte()/255,W=e.readUnsignedByte()/255,O=e.readUnsignedByte()/255,R=e.readUnsignedByte()/255;switch(e.readByte()){case Gt:v.setStepped(_);break;case Ht:Fe(e,v,L++,_,0,S,N,x,V,1),Fe(e,v,L++,_,1,S,N,A,W,1),Fe(e,v,L++,_,2,S,N,C,O,1),Fe(e,v,L++,_,3,S,N,k,R,1)}S=N,x=V,A=W,C=O,k=R}i.push(v);break}case uc:{let E=e.readInt(!0),v=new wo(y,E,d),S=e.readFloat(),x=e.readUnsignedByte()/255,A=e.readUnsignedByte()/255,C=e.readUnsignedByte()/255;for(let k=0,_=0;v.setFrame(k,S,x,A,C),k!=b;k++){let L=e.readFloat(),N=e.readUnsignedByte()/255,V=e.readUnsignedByte()/255,W=e.readUnsignedByte()/255;switch(e.readByte()){case Gt:v.setStepped(k);break;case Ht:Fe(e,v,_++,k,0,S,L,x,N,1),Fe(e,v,_++,k,1,S,L,A,V,1),Fe(e,v,_++,k,2,S,L,C,W,1)}S=L,x=N,A=V,C=W}i.push(v);break}case mc:{let E=e.readInt(!0),v=new So(y,E,d),S=e.readFloat(),x=e.readUnsignedByte()/255,A=e.readUnsignedByte()/255,C=e.readUnsignedByte()/255,k=e.readUnsignedByte()/255,_=e.readUnsignedByte()/255,L=e.readUnsignedByte()/255,N=e.readUnsignedByte()/255;for(let V=0,W=0;v.setFrame(V,S,x,A,C,k,_,L,N),V!=b;V++){let O=e.readFloat(),R=e.readUnsignedByte()/255,M=e.readUnsignedByte()/255,F=e.readUnsignedByte()/255,H=e.readUnsignedByte()/255,Z=e.readUnsignedByte()/255,ee=e.readUnsignedByte()/255,re=e.readUnsignedByte()/255;switch(e.readByte()){case Gt:v.setStepped(V);break;case Ht:Fe(e,v,W++,V,0,S,O,x,R,1),Fe(e,v,W++,V,1,S,O,A,M,1),Fe(e,v,W++,V,2,S,O,C,F,1),Fe(e,v,W++,V,3,S,O,k,H,1),Fe(e,v,W++,V,4,S,O,_,Z,1),Fe(e,v,W++,V,5,S,O,L,ee,1),Fe(e,v,W++,V,6,S,O,N,re,1)}S=O,x=R,A=M,C=F,k=H,_=Z,L=ee,N=re}i.push(v);break}case gc:{let E=e.readInt(!0),v=new vo(y,E,d),S=e.readFloat(),x=e.readUnsignedByte()/255,A=e.readUnsignedByte()/255,C=e.readUnsignedByte()/255,k=e.readUnsignedByte()/255,_=e.readUnsignedByte()/255,L=e.readUnsignedByte()/255;for(let N=0,V=0;v.setFrame(N,S,x,A,C,k,_,L),N!=b;N++){let W=e.readFloat(),O=e.readUnsignedByte()/255,R=e.readUnsignedByte()/255,M=e.readUnsignedByte()/255,F=e.readUnsignedByte()/255,H=e.readUnsignedByte()/255,Z=e.readUnsignedByte()/255;switch(e.readByte()){case Gt:v.setStepped(N);break;case Ht:Fe(e,v,V++,N,0,S,W,x,O,1),Fe(e,v,V++,N,1,S,W,A,R,1),Fe(e,v,V++,N,2,S,W,C,M,1),Fe(e,v,V++,N,3,S,W,k,F,1),Fe(e,v,V++,N,4,S,W,_,H,1),Fe(e,v,V++,N,5,S,W,L,Z,1)}S=W,x=O,A=R,C=M,k=F,_=H,L=Z}i.push(v);break}case pc:{let E=new xo(y,e.readInt(!0),d),v=e.readFloat(),S=e.readUnsignedByte()/255;for(let x=0,A=0;E.setFrame(x,v,S),x!=b;x++){let C=e.readFloat(),k=e.readUnsignedByte()/255;switch(e.readByte()){case Gt:E.setStepped(x);break;case Ht:Fe(e,E,A++,x,0,v,C,S,k,1)}v=C,S=k}i.push(E)}}}}for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readInt(!0);for(let g=0,u=e.readInt(!0);g<u;g++){let m=e.readByte(),y=e.readInt(!0);if(m==hc){let E=new yo(y,d);for(let v=0;v<y;v++)E.setFrame(v,e.readFloat(),e.readByte());i.push(E);continue}let b=e.readInt(!0);switch(m){case Qh:i.push(at(e,new Hi(y,b,d),1));break;case ec:i.push(Cn(e,new oo(y,b,d),n));break;case tc:i.push(at(e,new lo(y,b,d),n));break;case sc:i.push(at(e,new ho(y,b,d),n));break;case ic:i.push(Cn(e,new co(y,b,d),1));break;case nc:i.push(at(e,new fo(y,b,d),1));break;case rc:i.push(at(e,new uo(y,b,d),1));break;case ac:i.push(Cn(e,new mo(y,b,d),1));break;case oc:i.push(at(e,new go(y,b,d),1));break;case lc:i.push(at(e,new po(y,b,d),1))}}}for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readInt(!0),g=e.readInt(!0),u=g-1,m=new To(g,e.readInt(!0),d),y=e.readByte(),b=e.readFloat(),E=(y&1)!=0?(y&2)!=0?e.readFloat():1:0,v=(y&4)!=0?e.readFloat()*n:0;for(let S=0,x=0;m.setFrame(S,b,E,v,(y&8)!=0?1:-1,(y&16)!=0,(y&32)!=0),S!=u;S++){y=e.readByte();const A=e.readFloat(),C=(y&1)!=0?(y&2)!=0?e.readFloat():1:0,k=(y&4)!=0?e.readFloat()*n:0;(y&64)!=0?m.setStepped(S):(y&128)!=0&&(Fe(e,m,x++,S,0,b,A,E,C,1),Fe(e,m,x++,S,1,b,A,v,k,n)),b=A,E=C,v=k}i.push(m)}for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readInt(!0),g=e.readInt(!0),u=g-1,m=new Ao(g,e.readInt(!0),d),y=e.readFloat(),b=e.readFloat(),E=e.readFloat(),v=e.readFloat(),S=e.readFloat(),x=e.readFloat(),A=e.readFloat();for(let C=0,k=0;m.setFrame(C,y,b,E,v,S,x,A),C!=u;C++){let _=e.readFloat(),L=e.readFloat(),N=e.readFloat(),V=e.readFloat(),W=e.readFloat(),O=e.readFloat(),R=e.readFloat();switch(e.readByte()){case Gt:m.setStepped(C);break;case Ht:Fe(e,m,k++,C,0,y,_,b,L,1),Fe(e,m,k++,C,1,y,_,E,N,1),Fe(e,m,k++,C,2,y,_,v,V,1),Fe(e,m,k++,C,3,y,_,S,W,1),Fe(e,m,k++,C,4,y,_,x,O,1),Fe(e,m,k++,C,5,y,_,A,R,1)}y=_,b=L,E=N,v=V,S=W,x=O,A=R}i.push(m)}for(let h=0,c=e.readInt(!0);h<c;h++){let d=e.readInt(!0),g=s.pathConstraints[d];for(let u=0,m=e.readInt(!0);u<m;u++){const y=e.readByte(),b=e.readInt(!0),E=e.readInt(!0);switch(y){case wc:i.push(at(e,new Co(b,E,d),g.positionMode==Jt.Fixed?n:1));break;case xc:i.push(at(e,new Io(b,E,d),g.spacingMode==et.Length||g.spacingMode==et.Fixed?n:1));break;case Sc:let v=new Ro(b,E,d),S=e.readFloat(),x=e.readFloat(),A=e.readFloat(),C=e.readFloat();for(let k=0,_=0,L=v.getFrameCount()-1;v.setFrame(k,S,x,A,C),k!=L;k++){let N=e.readFloat(),V=e.readFloat(),W=e.readFloat(),O=e.readFloat();switch(e.readByte()){case Gt:v.setStepped(k);break;case Ht:Fe(e,v,_++,k,0,S,N,x,V,1),Fe(e,v,_++,k,1,S,N,A,W,1),Fe(e,v,_++,k,2,S,N,C,O,1)}S=N,x=V,A=W,C=O}i.push(v)}}}for(let h=0,c=e.readInt(!0);h<c;h++){const d=e.readInt(!0)-1;for(let g=0,u=e.readInt(!0);g<u;g++){const m=e.readByte(),y=e.readInt(!0);if(m==Oc){const E=new nn(y,d);for(let v=0;v<y;v++)E.setFrame(v,e.readFloat());i.push(E);continue}const b=e.readInt(!0);switch(m){case vc:i.push(at(e,new Oo(y,b,d),1));break;case Ec:i.push(at(e,new ko(y,b,d),1));break;case Tc:i.push(at(e,new Po(y,b,d),1));break;case Ac:i.push(at(e,new _o(y,b,d),1));break;case Cc:i.push(at(e,new Mo(y,b,d),1));break;case Ic:i.push(at(e,new Lo(y,b,d),1));break;case Rc:i.push(at(e,new Fo(y,b,d),1))}}}for(let h=0,c=e.readInt(!0);h<c;h++){let d=s.skins[e.readInt(!0)];for(let g=0,u=e.readInt(!0);g<u;g++){let m=e.readInt(!0);for(let y=0,b=e.readInt(!0);y<b;y++){let E=e.readStringRef();if(!E)throw new Error("attachmentName must not be null.");let v=d.getAttachment(m,E),S=e.readByte(),x=e.readInt(!0),A=x-1;switch(S){case yc:{let C=v,k=C.bones,_=C.vertices,L=k?_.length/3*2:_.length,N=e.readInt(!0),V=new Eo(x,N,m,C),W=e.readFloat();for(let O=0,R=0;;O++){let M,F=e.readInt(!0);if(F==0)M=k?se.newFloatArray(L):_;else{M=se.newFloatArray(L);let Z=e.readInt(!0);if(F+=Z,n==1)for(let ee=Z;ee<F;ee++)M[ee]=e.readFloat();else for(let ee=Z;ee<F;ee++)M[ee]=e.readFloat()*n;if(!k)for(let ee=0,re=M.length;ee<re;ee++)M[ee]+=_[ee]}if(V.setFrame(O,W,M),O==A)break;let H=e.readFloat();switch(e.readByte()){case Gt:V.setStepped(O);break;case Ht:Fe(e,V,R++,O,0,W,H,0,1,1)}W=H}i.push(V);break}case bc:{let C=new $t(x,m,v);for(let k=0;k<x;k++){let _=e.readFloat(),L=e.readInt32();C.setFrame(k,_,ao[L&15],L>>4,e.readFloat())}i.push(C);break}}}}}let a=e.readInt(!0);if(a>0){let h=new Cs(a),c=s.slots.length;for(let d=0;d<a;d++){let g=e.readFloat(),u=e.readInt(!0),m=se.newArray(c,0);for(let v=c-1;v>=0;v--)m[v]=-1;let y=se.newArray(c-u,0),b=0,E=0;for(let v=0;v<u;v++){let S=e.readInt(!0);for(;b!=S;)y[E++]=b++;m[b+e.readInt(!0)]=b++}for(;b<c;)y[E++]=b++;for(let v=c-1;v>=0;v--)m[v]==-1&&(m[v]=y[--E]);h.setFrame(d,g,m)}i.push(h)}let o=e.readInt(!0);if(o>0){let h=new gi(o);for(let c=0;c<o;c++){let d=e.readFloat(),g=s.events[e.readInt(!0)],u=new Yo(d,g);u.intValue=e.readInt(!1),u.floatValue=e.readFloat(),u.stringValue=e.readString(),u.stringValue==null&&(u.stringValue=g.stringValue),u.data.audioPath&&(u.volume=e.readFloat(),u.balance=e.readFloat()),h.setFrame(c,u)}i.push(h)}let r=0;for(let h=0,c=i.length;h<c;h++)r=Math.max(r,i[h].getDuration());return new ar(t,i,r)}}class Jh{strings;index;buffer;constructor(e,t=new Array,s=0,i=new DataView(e instanceof ArrayBuffer?e:e.buffer)){this.strings=t,this.index=s,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let e=this.buffer.getInt16(this.index);return this.index+=2,e}readInt32(){let e=this.buffer.getInt32(this.index);return this.index+=4,e}readInt(e){let t=this.readByte(),s=t&127;return(t&128)!=0&&(t=this.readByte(),s|=(t&127)<<7,(t&128)!=0&&(t=this.readByte(),s|=(t&127)<<14,(t&128)!=0&&(t=this.readByte(),s|=(t&127)<<21,(t&128)!=0&&(t=this.readByte(),s|=(t&127)<<28)))),e?s:s>>>1^-(s&1)}readStringRef(){let e=this.readInt(!0);return e==0?null:this.strings[e-1]}readString(){let e=this.readInt(!0);switch(e){case 0:return null;case 1:return""}e--;let t="";for(let s=0;s<e;){let i=this.readUnsignedByte();switch(i>>4){case 12:case 13:t+=String.fromCharCode((i&31)<<6|this.readByte()&63),s+=2;break;case 14:t+=String.fromCharCode((i&15)<<12|(this.readByte()&63)<<6|this.readByte()&63),s+=3;break;default:t+=String.fromCharCode(i),s++}}return t}readFloat(){let e=this.buffer.getFloat32(this.index);return this.index+=4,e}readBoolean(){return this.readByte()!=0}}let Kh=class{parent;skinIndex;slotIndex;mesh;inheritTimeline;constructor(e,t,s,i,n){this.mesh=e,this.skinIndex=t,this.slotIndex=s,this.parent=i,this.inheritTimeline=n}};class Zh{bones;vertices;length;constructor(e=null,t=null,s=0){this.bones=e,this.vertices=t,this.length=s}}var ns;(function(l){l[l.Region=0]="Region",l[l.BoundingBox=1]="BoundingBox",l[l.Mesh=2]="Mesh",l[l.LinkedMesh=3]="LinkedMesh",l[l.Path=4]="Path",l[l.Point=5]="Point",l[l.Clipping=6]="Clipping"})(ns||(ns={}));function at(l,e,t){let s=l.readFloat(),i=l.readFloat()*t;for(let n=0,a=0,o=e.getFrameCount()-1;e.setFrame(n,s,i),n!=o;n++){let r=l.readFloat(),h=l.readFloat()*t;switch(l.readByte()){case Gt:e.setStepped(n);break;case Ht:Fe(l,e,a++,n,0,s,r,i,h,t)}s=r,i=h}return e}function Cn(l,e,t){let s=l.readFloat(),i=l.readFloat()*t,n=l.readFloat()*t;for(let a=0,o=0,r=e.getFrameCount()-1;e.setFrame(a,s,i,n),a!=r;a++){let h=l.readFloat(),c=l.readFloat()*t,d=l.readFloat()*t;switch(l.readByte()){case Gt:e.setStepped(a);break;case Ht:Fe(l,e,o++,a,0,s,h,i,c,t),Fe(l,e,o++,a,1,s,h,n,d,t)}s=h,i=c,n=d}return e}function Fe(l,e,t,s,i,n,a,o,r,h){e.setBezier(t,s,i,n,o,l.readFloat(),l.readFloat()*h,l.readFloat(),l.readFloat()*h,a,r)}const Qh=0,ec=1,tc=2,sc=3,ic=4,nc=5,rc=6,ac=7,oc=8,lc=9,hc=10,dc=0,fc=1,uc=2,mc=3,gc=4,pc=5,yc=0,bc=1,wc=0,xc=1,Sc=2,vc=0,Ec=1,Tc=2,Ac=4,Cc=5,Ic=6,Rc=7,Oc=8,Gt=1,Ht=2;class kc{minX=0;minY=0;maxX=0;maxY=0;boundingBoxes=new Array;polygons=new Array;polygonPool=new Gi(()=>se.newFloatArray(16));update(e,t){if(!e)throw new Error("skeleton cannot be null.");let s=this.boundingBoxes,i=this.polygons,n=this.polygonPool,a=e.slots,o=a.length;s.length=0,n.freeAll(i),i.length=0;for(let r=0;r<o;r++){let h=a[r];if(!h.bone.active)continue;let c=h.getAttachment();if(c instanceof rn){let d=c;s.push(d);let g=n.obtain();g.length!=d.worldVerticesLength&&(g=se.newFloatArray(d.worldVerticesLength)),i.push(g),d.computeWorldVertices(h,0,d.worldVerticesLength,g,0,2)}}t?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=this.polygons;for(let a=0,o=n.length;a<o;a++){let r=n[a],h=r;for(let c=0,d=r.length;c<d;c+=2){let g=h[c],u=h[c+1];e=Math.min(e,g),t=Math.min(t,u),s=Math.max(s,g),i=Math.max(i,u)}}this.minX=e,this.minY=t,this.maxX=s,this.maxY=i}aabbContainsPoint(e,t){return e>=this.minX&&e<=this.maxX&&t>=this.minY&&t<=this.maxY}aabbIntersectsSegment(e,t,s,i){let n=this.minX,a=this.minY,o=this.maxX,r=this.maxY;if(e<=n&&s<=n||t<=a&&i<=a||e>=o&&s>=o||t>=r&&i>=r)return!1;let h=(i-t)/(s-e),c=h*(n-e)+t;if(c>a&&c<r||(c=h*(o-e)+t,c>a&&c<r))return!0;let d=(a-t)/h+e;return d>n&&d<o||(d=(r-t)/h+e,d>n&&d<o)}aabbIntersectsSkeleton(e){return this.minX<e.maxX&&this.maxX>e.minX&&this.minY<e.maxY&&this.maxY>e.minY}containsPoint(e,t){let s=this.polygons;for(let i=0,n=s.length;i<n;i++)if(this.containsPointPolygon(s[i],e,t))return this.boundingBoxes[i];return null}containsPointPolygon(e,t,s){let i=e,n=e.length,a=n-2,o=!1;for(let r=0;r<n;r+=2){let h=i[r+1],c=i[a+1];if(h<s&&c>=s||c<s&&h>=s){let d=i[r];d+(s-h)/(c-h)*(i[a]-d)<t&&(o=!o)}a=r}return o}intersectsSegment(e,t,s,i){let n=this.polygons;for(let a=0,o=n.length;a<o;a++)if(this.intersectsSegmentPolygon(n[a],e,t,s,i))return this.boundingBoxes[a];return null}intersectsSegmentPolygon(e,t,s,i,n){let a=e,o=e.length,r=t-i,h=s-n,c=t*n-s*i,d=a[o-2],g=a[o-1];for(let u=0;u<o;u+=2){let m=a[u],y=a[u+1],b=d*y-g*m,E=d-m,v=g-y,S=r*v-h*E,x=(c*E-r*b)/S;if((x>=d&&x<=m||x>=m&&x<=d)&&(x>=t&&x<=i||x>=i&&x<=t)){let A=(c*v-h*b)/S;if((A>=g&&A<=y||A>=y&&A<=g)&&(A>=s&&A<=n||A>=n&&A<=s))return!0}d=m,g=y}return!1}getPolygon(e){if(!e)throw new Error("boundingBox cannot be null.");let t=this.boundingBoxes.indexOf(e);return t==-1?null:this.polygons[t]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class bt{convexPolygons=new Array;convexPolygonsIndices=new Array;indicesArray=new Array;isConcaveArray=new Array;triangles=new Array;polygonPool=new Gi(()=>new Array);polygonIndicesPool=new Gi(()=>new Array);triangulate(e){let t=e,s=e.length>>1,i=this.indicesArray;i.length=0;for(let o=0;o<s;o++)i[o]=o;let n=this.isConcaveArray;n.length=0;for(let o=0,r=s;o<r;++o)n[o]=bt.isConcave(o,s,t,i);let a=this.triangles;for(a.length=0;s>3;){let o=s-1,r=0,h=1;for(;;){e:if(!n[r]){let g=i[o]<<1,u=i[r]<<1,m=i[h]<<1,y=t[g],b=t[g+1],E=t[u],v=t[u+1],S=t[m],x=t[m+1];for(let A=(h+1)%s;A!=o;A=(A+1)%s){if(!n[A])continue;let C=i[A]<<1,k=t[C],_=t[C+1];if(bt.positiveArea(S,x,y,b,k,_)&&bt.positiveArea(y,b,E,v,k,_)&&bt.positiveArea(E,v,S,x,k,_))break e}break}if(h==0){do{if(!n[r])break;r--}while(r>0);break}o=r,r=h,h=(h+1)%s}a.push(i[(s+r-1)%s]),a.push(i[r]),a.push(i[(r+1)%s]),i.splice(r,1),n.splice(r,1),s--;let c=(s+r-1)%s,d=r==s?0:r;n[c]=bt.isConcave(c,s,t,i),n[d]=bt.isConcave(d,s,t,i)}return s==3&&(a.push(i[2]),a.push(i[0]),a.push(i[1])),a}decompose(e,t){let s=e,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;let n=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(n),n.length=0;let a=this.polygonIndicesPool.obtain();a.length=0;let o=this.polygonPool.obtain();o.length=0;let r=-1,h=0;for(let c=0,d=t.length;c<d;c+=3){let g=t[c]<<1,u=t[c+1]<<1,m=t[c+2]<<1,y=s[g],b=s[g+1],E=s[u],v=s[u+1],S=s[m],x=s[m+1],A=!1;if(r==g){let C=o.length-4,k=bt.winding(o[C],o[C+1],o[C+2],o[C+3],S,x),_=bt.winding(S,x,o[0],o[1],o[2],o[3]);k==h&&_==h&&(o.push(S),o.push(x),a.push(m),A=!0)}A||(o.length>0?(i.push(o),n.push(a)):(this.polygonPool.free(o),this.polygonIndicesPool.free(a)),o=this.polygonPool.obtain(),o.length=0,o.push(y),o.push(b),o.push(E),o.push(v),o.push(S),o.push(x),a=this.polygonIndicesPool.obtain(),a.length=0,a.push(g),a.push(u),a.push(m),h=bt.winding(y,b,E,v,S,x),r=g)}o.length>0&&(i.push(o),n.push(a));for(let c=0,d=i.length;c<d;c++){if(a=n[c],a.length==0)continue;let g=a[0],u=a[a.length-1];o=i[c];let m=o.length-4,y=o[m],b=o[m+1],E=o[m+2],v=o[m+3],S=o[0],x=o[1],A=o[2],C=o[3],k=bt.winding(y,b,E,v,S,x);for(let _=0;_<d;_++){if(_==c)continue;let L=n[_];if(L.length!=3)continue;let N=L[0],V=L[1],W=L[2],O=i[_],R=O[O.length-2],M=O[O.length-1];if(N!=g||V!=u)continue;let F=bt.winding(y,b,E,v,R,M),H=bt.winding(R,M,S,x,A,C);F==k&&H==k&&(O.length=0,L.length=0,o.push(R),o.push(M),a.push(W),y=E,b=v,E=R,v=M,_=0)}}for(let c=i.length-1;c>=0;c--)o=i[c],o.length==0&&(i.splice(c,1),this.polygonPool.free(o),a=n[c],n.splice(c,1),this.polygonIndicesPool.free(a));return i}static isConcave(e,t,s,i){let n=i[(t+e-1)%t]<<1,a=i[e]<<1,o=i[(e+1)%t]<<1;return!this.positiveArea(s[n],s[n+1],s[a],s[a+1],s[o],s[o+1])}static positiveArea(e,t,s,i,n,a){return e*(a-i)+s*(t-a)+n*(i-t)>=0}static winding(e,t,s,i,n,a){let o=s-e,r=i-t;return n*r-a*o+o*t-e*r>=0?1:-1}}class mi{triangulator=new bt;clippingPolygon=new Array;clipOutput=new Array;clippedVertices=new Array;clippedUVs=new Array;clippedTriangles=new Array;scratch=new Array;clipAttachment=null;clippingPolygons=null;clipStart(e,t){if(this.clipAttachment)return 0;this.clipAttachment=t;let s=t.worldVerticesLength,i=se.setArraySize(this.clippingPolygon,s);t.computeWorldVertices(e,0,s,i,0,2);let n=this.clippingPolygon;mi.makeClockwise(n);let a=this.clippingPolygons=this.triangulator.decompose(n,this.triangulator.triangulate(n));for(let o=0,r=a.length;o<r;o++){let h=a[o];mi.makeClockwise(h),h.push(h[0]),h.push(h[1])}return a.length}clipEndWithSlot(e){this.clipAttachment&&this.clipAttachment.endSlot==e.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return this.clipAttachment!=null}clipTriangles(e,t,s,i,n,a,o,r){let h,c,d,g,u,m;typeof t=="number"?(h=s,c=i,d=n,g=a,u=o,m=r):(h=t,c=s,d=i,g=n,u=a,m=o),d&&g&&u&&typeof m=="boolean"?this.clipTrianglesRender(e,h,c,d,g,u,m):this.clipTrianglesNoRender(e,h,c)}clipTrianglesNoRender(e,t,s){let i=this.clipOutput,n=this.clippedVertices,a=this.clippedTriangles,o=this.clippingPolygons,r=o.length,h=0;n.length=0,a.length=0;for(let c=0;c<s;c+=3){let d=t[c]<<1,g=e[d],u=e[d+1];d=t[c+1]<<1;let m=e[d],y=e[d+1];d=t[c+2]<<1;let b=e[d],E=e[d+1];for(let v=0;v<r;v++){let S=n.length;if(this.clip(g,u,m,y,b,E,o[v],i)){let x=i.length;if(x==0)continue;let A=x>>1,C=this.clipOutput,k=se.setArraySize(n,S+A*2);for(let L=0;L<x;L+=2,S+=2){let N=C[L],V=C[L+1];k[S]=N,k[S+1]=V}S=a.length;let _=se.setArraySize(a,S+3*(A-2));A--;for(let L=1;L<A;L++,S+=3)_[S]=h,_[S+1]=h+L,_[S+2]=h+L+1;h+=A+1}else{let x=se.setArraySize(n,S+6);x[S]=g,x[S+1]=u,x[S+2]=m,x[S+3]=y,x[S+4]=b,x[S+5]=E,S=a.length;let A=se.setArraySize(a,S+3);A[S]=h,A[S+1]=h+1,A[S+2]=h+2,h+=3;break}}}}clipTrianglesRender(e,t,s,i,n,a,o){let r=this.clipOutput,h=this.clippedVertices,c=this.clippedTriangles,d=this.clippingPolygons,g=d.length,u=o?12:8,m=0;h.length=0,c.length=0;for(let y=0;y<s;y+=3){let b=t[y]<<1,E=e[b],v=e[b+1],S=i[b],x=i[b+1];b=t[y+1]<<1;let A=e[b],C=e[b+1],k=i[b],_=i[b+1];b=t[y+2]<<1;let L=e[b],N=e[b+1],V=i[b],W=i[b+1];for(let O=0;O<g;O++){let R=h.length;if(this.clip(E,v,A,C,L,N,d[O],r)){let M=r.length;if(M==0)continue;let F=C-N,H=L-A,Z=E-L,ee=N-v,re=1/(F*Z+H*(v-N)),le=M>>1,ce=this.clipOutput,ae=se.setArraySize(h,R+le*u);for(let Pe=0;Pe<M;Pe+=2,R+=u){let gt=ce[Pe],tt=ce[Pe+1];ae[R]=gt,ae[R+1]=tt,ae[R+2]=n.r,ae[R+3]=n.g,ae[R+4]=n.b,ae[R+5]=n.a;let Ye=gt-L,We=tt-N,Ge=(F*Ye+H*We)*re,Yt=(ee*Ye+Z*We)*re,xs=1-Ge-Yt;ae[R+6]=S*Ge+k*Yt+V*xs,ae[R+7]=x*Ge+_*Yt+W*xs,o&&(ae[R+8]=a.r,ae[R+9]=a.g,ae[R+10]=a.b,ae[R+11]=a.a)}R=c.length;let Ie=se.setArraySize(c,R+3*(le-2));le--;for(let Pe=1;Pe<le;Pe++,R+=3)Ie[R]=m,Ie[R+1]=m+Pe,Ie[R+2]=m+Pe+1;m+=le+1}else{let M=se.setArraySize(h,R+3*u);M[R]=E,M[R+1]=v,M[R+2]=n.r,M[R+3]=n.g,M[R+4]=n.b,M[R+5]=n.a,o?(M[R+6]=S,M[R+7]=x,M[R+8]=a.r,M[R+9]=a.g,M[R+10]=a.b,M[R+11]=a.a,M[R+12]=A,M[R+13]=C,M[R+14]=n.r,M[R+15]=n.g,M[R+16]=n.b,M[R+17]=n.a,M[R+18]=k,M[R+19]=_,M[R+20]=a.r,M[R+21]=a.g,M[R+22]=a.b,M[R+23]=a.a,M[R+24]=L,M[R+25]=N,M[R+26]=n.r,M[R+27]=n.g,M[R+28]=n.b,M[R+29]=n.a,M[R+30]=V,M[R+31]=W,M[R+32]=a.r,M[R+33]=a.g,M[R+34]=a.b,M[R+35]=a.a):(M[R+6]=S,M[R+7]=x,M[R+8]=A,M[R+9]=C,M[R+10]=n.r,M[R+11]=n.g,M[R+12]=n.b,M[R+13]=n.a,M[R+14]=k,M[R+15]=_,M[R+16]=L,M[R+17]=N,M[R+18]=n.r,M[R+19]=n.g,M[R+20]=n.b,M[R+21]=n.a,M[R+22]=V,M[R+23]=W),R=c.length;let F=se.setArraySize(c,R+3);F[R]=m,F[R+1]=m+1,F[R+2]=m+2,m+=3;break}}}}clipTrianglesUnpacked(e,t,s,i){let n=this.clipOutput,a=this.clippedVertices,o=this.clippedUVs,r=this.clippedTriangles,h=this.clippingPolygons,c=h.length,d=0;a.length=0,o.length=0,r.length=0;for(let g=0;g<s;g+=3){let u=t[g]<<1,m=e[u],y=e[u+1],b=i[u],E=i[u+1];u=t[g+1]<<1;let v=e[u],S=e[u+1],x=i[u],A=i[u+1];u=t[g+2]<<1;let C=e[u],k=e[u+1],_=i[u],L=i[u+1];for(let N=0;N<c;N++){let V=a.length;if(this.clip(m,y,v,S,C,k,h[N],n)){let W=n.length;if(W==0)continue;let O=S-k,R=C-v,M=m-C,F=k-y,H=1/(O*M+R*(y-k)),Z=W>>1,ee=this.clipOutput,re=se.setArraySize(a,V+Z*2),le=se.setArraySize(o,V+Z*2);for(let ae=0;ae<W;ae+=2,V+=2){let Ie=ee[ae],Pe=ee[ae+1];re[V]=Ie,re[V+1]=Pe;let gt=Ie-C,tt=Pe-k,Ye=(O*gt+R*tt)*H,We=(F*gt+M*tt)*H,Ge=1-Ye-We;le[V]=b*Ye+x*We+_*Ge,le[V+1]=E*Ye+A*We+L*Ge}V=r.length;let ce=se.setArraySize(r,V+3*(Z-2));Z--;for(let ae=1;ae<Z;ae++,V+=3)ce[V]=d,ce[V+1]=d+ae,ce[V+2]=d+ae+1;d+=Z+1}else{let W=se.setArraySize(a,V+6);W[V]=m,W[V+1]=y,W[V+2]=v,W[V+3]=S,W[V+4]=C,W[V+5]=k;let O=se.setArraySize(o,V+6);O[V]=b,O[V+1]=E,O[V+2]=x,O[V+3]=A,O[V+4]=_,O[V+5]=L,V=r.length;let R=se.setArraySize(r,V+3);R[V]=d,R[V+1]=d+1,R[V+2]=d+2,d+=3;break}}}}clip(e,t,s,i,n,a,o,r){let h=r,c=!1,d;o.length%4>=2?(d=r,r=this.scratch):d=this.scratch,d.length=0,d.push(e),d.push(t),d.push(s),d.push(i),d.push(n),d.push(a),d.push(e),d.push(t),r.length=0;let g=o.length-4,u=o;for(let m=0;;m+=2){let y=u[m],b=u[m+1],E=y-u[m+2],v=b-u[m+3],S=r.length,x=d;for(let C=0,k=d.length-2;C<k;){let _=x[C],L=x[C+1];C+=2;let N=x[C],V=x[C+1],W=v*(y-N)>E*(b-V),O=v*(y-_)-E*(b-L);if(O>0){if(W){r.push(N),r.push(V);continue}let R=N-_,M=V-L,F=O/(R*v-M*E);if(F>=0&&F<=1)r.push(_+R*F),r.push(L+M*F);else{r.push(N),r.push(V);continue}}else if(W){let R=N-_,M=V-L,F=O/(R*v-M*E);if(F>=0&&F<=1)r.push(_+R*F),r.push(L+M*F),r.push(N),r.push(V);else{r.push(N),r.push(V);continue}}c=!0}if(S==r.length)return h.length=0,!0;if(r.push(r[0]),r.push(r[1]),m==g)break;let A=r;r=d,r.length=0,d=A}if(h!=r){h.length=0;for(let m=0,y=r.length-2;m<y;m++)h[m]=r[m]}else h.length=h.length-2;return c}static makeClockwise(e){let t=e,s=e.length,i=t[s-2]*t[1]-t[0]*t[s-1],n=0,a=0,o=0,r=0;for(let h=0,c=s-3;h<c;h+=2)n=t[h],a=t[h+1],o=t[h+2],r=t[h+3],i+=n*r-o*a;if(!(i<0))for(let h=0,c=s-2,d=s>>1;h<d;h+=2){let g=t[h],u=t[h+1],m=c-h;t[h]=t[m],t[h+1]=t[m+1],t[m]=g,t[m+1]=u}}}class Pc{attachmentLoader;scale=1;linkedMeshes=new Array;constructor(e){this.attachmentLoader=e}readSkeletonData(e){let t=this.scale,s=new jo,i=typeof e=="string"?JSON.parse(e):e,n=i.skeleton;if(n&&(s.hash=n.hash,s.version=n.spine,s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,s.referenceScale=B(n,"referenceScale",100)*t,s.fps=n.fps,s.imagesPath=n.images??null,s.audioPath=n.audio??null),i.bones)for(let a=0;a<i.bones.length;a++){let o=i.bones[a],r=null,h=B(o,"parent",null);h&&(r=s.findBone(h));let c=new No(s.bones.length,o.name,r);c.length=B(o,"length",0)*t,c.x=B(o,"x",0)*t,c.y=B(o,"y",0)*t,c.rotation=B(o,"rotation",0),c.scaleX=B(o,"scaleX",1),c.scaleY=B(o,"scaleY",1),c.shearX=B(o,"shearX",0),c.shearY=B(o,"shearY",0),c.inherit=se.enumValue($e,B(o,"inherit","Normal")),c.skinRequired=B(o,"skin",!1);let d=B(o,"color",null);d&&c.color.setFromString(d),s.bones.push(c)}if(i.slots)for(let a=0;a<i.slots.length;a++){let o=i.slots[a],r=o.name,h=s.findBone(o.bone);if(!h)throw new Error(`Couldn't find bone ${o.bone} for slot ${r}`);let c=new Go(s.slots.length,r,h),d=B(o,"color",null);d&&c.color.setFromString(d);let g=B(o,"dark",null);g&&(c.darkColor=ue.fromString(g)),c.attachmentName=B(o,"attachment",null),c.blendMode=se.enumValue($i,B(o,"blend","normal")),c.visible=B(o,"visible",!0),s.slots.push(c)}if(i.ik)for(let a=0;a<i.ik.length;a++){let o=i.ik[a],r=new Uo(o.name);r.order=B(o,"order",0),r.skinRequired=B(o,"skin",!1);for(let c=0;c<o.bones.length;c++){let d=s.findBone(o.bones[c]);if(!d)throw new Error(`Couldn't find bone ${o.bones[c]} for IK constraint ${o.name}.`);r.bones.push(d)}let h=s.findBone(o.target);if(!h)throw new Error(`Couldn't find target bone ${o.target} for IK constraint ${o.name}.`);r.target=h,r.mix=B(o,"mix",1),r.softness=B(o,"softness",0)*t,r.bendDirection=B(o,"bendPositive",!0)?1:-1,r.compress=B(o,"compress",!1),r.stretch=B(o,"stretch",!1),r.uniform=B(o,"uniform",!1),s.ikConstraints.push(r)}if(i.transform)for(let a=0;a<i.transform.length;a++){let o=i.transform[a],r=new Ho(o.name);r.order=B(o,"order",0),r.skinRequired=B(o,"skin",!1);for(let d=0;d<o.bones.length;d++){let g=o.bones[d],u=s.findBone(g);if(!u)throw new Error(`Couldn't find bone ${g} for transform constraint ${o.name}.`);r.bones.push(u)}let h=o.target,c=s.findBone(h);if(!c)throw new Error(`Couldn't find target bone ${h} for transform constraint ${o.name}.`);r.target=c,r.local=B(o,"local",!1),r.relative=B(o,"relative",!1),r.offsetRotation=B(o,"rotation",0),r.offsetX=B(o,"x",0)*t,r.offsetY=B(o,"y",0)*t,r.offsetScaleX=B(o,"scaleX",0),r.offsetScaleY=B(o,"scaleY",0),r.offsetShearY=B(o,"shearY",0),r.mixRotate=B(o,"mixRotate",1),r.mixX=B(o,"mixX",1),r.mixY=B(o,"mixY",r.mixX),r.mixScaleX=B(o,"mixScaleX",1),r.mixScaleY=B(o,"mixScaleY",r.mixScaleX),r.mixShearY=B(o,"mixShearY",1),s.transformConstraints.push(r)}if(i.path)for(let a=0;a<i.path.length;a++){let o=i.path[a],r=new Vo(o.name);r.order=B(o,"order",0),r.skinRequired=B(o,"skin",!1);for(let d=0;d<o.bones.length;d++){let g=o.bones[d],u=s.findBone(g);if(!u)throw new Error(`Couldn't find bone ${g} for path constraint ${o.name}.`);r.bones.push(u)}let h=o.target,c=s.findSlot(h);if(!c)throw new Error(`Couldn't find target slot ${h} for path constraint ${o.name}.`);r.target=c,r.positionMode=se.enumValue(Jt,B(o,"positionMode","Percent")),r.spacingMode=se.enumValue(et,B(o,"spacingMode","Length")),r.rotateMode=se.enumValue(Is,B(o,"rotateMode","Tangent")),r.offsetRotation=B(o,"rotation",0),r.position=B(o,"position",0),r.positionMode==Jt.Fixed&&(r.position*=t),r.spacing=B(o,"spacing",0),(r.spacingMode==et.Length||r.spacingMode==et.Fixed)&&(r.spacing*=t),r.mixRotate=B(o,"mixRotate",1),r.mixX=B(o,"mixX",1),r.mixY=B(o,"mixY",r.mixX),s.pathConstraints.push(r)}if(i.physics)for(let a=0;a<i.physics.length;a++){const o=i.physics[a],r=new zo(o.name);r.order=B(o,"order",0),r.skinRequired=B(o,"skin",!1);const h=o.bone,c=s.findBone(h);if(c==null)throw new Error("Physics bone not found: "+h);r.bone=c,r.x=B(o,"x",0),r.y=B(o,"y",0),r.rotate=B(o,"rotate",0),r.scaleX=B(o,"scaleX",0),r.shearX=B(o,"shearX",0),r.limit=B(o,"limit",5e3)*t,r.step=1/B(o,"fps",60),r.inertia=B(o,"inertia",1),r.strength=B(o,"strength",100),r.damping=B(o,"damping",1),r.massInverse=1/B(o,"mass",1),r.wind=B(o,"wind",0),r.gravity=B(o,"gravity",0),r.mix=B(o,"mix",1),r.inertiaGlobal=B(o,"inertiaGlobal",!1),r.strengthGlobal=B(o,"strengthGlobal",!1),r.dampingGlobal=B(o,"dampingGlobal",!1),r.massGlobal=B(o,"massGlobal",!1),r.windGlobal=B(o,"windGlobal",!1),r.gravityGlobal=B(o,"gravityGlobal",!1),r.mixGlobal=B(o,"mixGlobal",!1),s.physicsConstraints.push(r)}if(i.skins)for(let a=0;a<i.skins.length;a++){let o=i.skins[a],r=new Hn(o.name);if(o.bones)for(let h=0;h<o.bones.length;h++){let c=o.bones[h],d=s.findBone(c);if(!d)throw new Error(`Couldn't find bone ${c} for skin ${o.name}.`);r.bones.push(d)}if(o.ik)for(let h=0;h<o.ik.length;h++){let c=o.ik[h],d=s.findIkConstraint(c);if(!d)throw new Error(`Couldn't find IK constraint ${c} for skin ${o.name}.`);r.constraints.push(d)}if(o.transform)for(let h=0;h<o.transform.length;h++){let c=o.transform[h],d=s.findTransformConstraint(c);if(!d)throw new Error(`Couldn't find transform constraint ${c} for skin ${o.name}.`);r.constraints.push(d)}if(o.path)for(let h=0;h<o.path.length;h++){let c=o.path[h],d=s.findPathConstraint(c);if(!d)throw new Error(`Couldn't find path constraint ${c} for skin ${o.name}.`);r.constraints.push(d)}if(o.physics)for(let h=0;h<o.physics.length;h++){let c=o.physics[h],d=s.findPhysicsConstraint(c);if(!d)throw new Error(`Couldn't find physics constraint ${c} for skin ${o.name}.`);r.constraints.push(d)}for(let h in o.attachments){let c=s.findSlot(h);if(!c)throw new Error(`Couldn't find slot ${h} for skin ${o.name}.`);let d=o.attachments[h];for(let g in d){let u=this.readAttachment(d[g],r,c.index,g,s);u&&r.setAttachment(c.index,g,u)}}s.skins.push(r),r.name=="default"&&(s.defaultSkin=r)}for(let a=0,o=this.linkedMeshes.length;a<o;a++){let r=this.linkedMeshes[a],h=r.skin?s.findSkin(r.skin):s.defaultSkin;if(!h)throw new Error(`Skin not found: ${r.skin}`);let c=h.getAttachment(r.slotIndex,r.parent);if(!c)throw new Error(`Parent mesh not found: ${r.parent}`);r.mesh.timelineAttachment=r.inheritTimeline?c:r.mesh,r.mesh.setParentMesh(c),r.mesh.region!=null&&r.mesh.updateRegion()}if(this.linkedMeshes.length=0,i.events)for(let a in i.events){let o=i.events[a],r=new Xo(a);r.intValue=B(o,"int",0),r.floatValue=B(o,"float",0),r.stringValue=B(o,"string",""),r.audioPath=B(o,"audio",null),r.audioPath&&(r.volume=B(o,"volume",1),r.balance=B(o,"balance",0)),s.events.push(r)}if(i.animations)for(let a in i.animations){let o=i.animations[a];this.readAnimation(o,a,s)}return s}readAttachment(e,t,s,i,n){let a=this.scale;switch(i=B(e,"name",i),B(e,"type","region")){case"region":{let o=B(e,"path",i),r=this.readSequence(B(e,"sequence",null)),h=this.attachmentLoader.newRegionAttachment(t,i,o,r);if(!h)return null;h.path=o,h.x=B(e,"x",0)*a,h.y=B(e,"y",0)*a,h.scaleX=B(e,"scaleX",1),h.scaleY=B(e,"scaleY",1),h.rotation=B(e,"rotation",0),h.width=e.width*a,h.height=e.height*a,h.sequence=r;let c=B(e,"color",null);return c&&h.color.setFromString(c),h.region!=null&&h.updateRegion(),h}case"boundingbox":{let o=this.attachmentLoader.newBoundingBoxAttachment(t,i);if(!o)return null;this.readVertices(e,o,e.vertexCount<<1);let r=B(e,"color",null);return r&&o.color.setFromString(r),o}case"mesh":case"linkedmesh":{let o=B(e,"path",i),r=this.readSequence(B(e,"sequence",null)),h=this.attachmentLoader.newMeshAttachment(t,i,o,r);if(!h)return null;h.path=o;let c=B(e,"color",null);c&&h.color.setFromString(c),h.width=B(e,"width",0)*a,h.height=B(e,"height",0)*a,h.sequence=r;let d=B(e,"parent",null);if(d)return this.linkedMeshes.push(new _c(h,B(e,"skin",null),s,d,B(e,"timelines",!0))),h;let g=e.uvs;return this.readVertices(e,h,g.length),h.triangles=e.triangles,h.regionUVs=g,h.region!=null&&h.updateRegion(),h.edges=B(e,"edges",null),h.hullLength=B(e,"hull",0)*2,h}case"path":{let o=this.attachmentLoader.newPathAttachment(t,i);if(!o)return null;o.closed=B(e,"closed",!1),o.constantSpeed=B(e,"constantSpeed",!0);let r=e.vertexCount;this.readVertices(e,o,r<<1);let h=se.newArray(r/3,0);for(let d=0;d<e.lengths.length;d++)h[d]=e.lengths[d]*a;o.lengths=h;let c=B(e,"color",null);return c&&o.color.setFromString(c),o}case"point":{let o=this.attachmentLoader.newPointAttachment(t,i);if(!o)return null;o.x=B(e,"x",0)*a,o.y=B(e,"y",0)*a,o.rotation=B(e,"rotation",0);let r=B(e,"color",null);return r&&o.color.setFromString(r),o}case"clipping":{let o=this.attachmentLoader.newClippingAttachment(t,i);if(!o)return null;let r=B(e,"end",null);r&&(o.endSlot=n.findSlot(r));let h=e.vertexCount;this.readVertices(e,o,h<<1);let c=B(e,"color",null);return c&&o.color.setFromString(c),o}}return null}readSequence(e){if(e==null)return null;let t=new Js(B(e,"count",0));return t.start=B(e,"start",1),t.digits=B(e,"digits",0),t.setupIndex=B(e,"setup",0),t}readVertices(e,t,s){let i=this.scale;t.worldVerticesLength=s;let n=e.vertices;if(s==n.length){let r=se.toFloatArray(n);if(i!=1)for(let h=0,c=n.length;h<c;h++)r[h]*=i;t.vertices=r;return}let a=new Array,o=new Array;for(let r=0,h=n.length;r<h;){let c=n[r++];o.push(c);for(let d=r+c*4;r<d;r+=4)o.push(n[r]),a.push(n[r+1]*i),a.push(n[r+2]*i),a.push(n[r+3])}t.bones=o,t.vertices=se.toFloatArray(a)}readAnimation(e,t,s){let i=this.scale,n=new Array;if(e.slots)for(let o in e.slots){let r=e.slots[o],h=s.findSlot(o);if(!h)throw new Error("Slot not found: "+o);let c=h.index;for(let d in r){let g=r[d];if(!g)continue;let u=g.length;if(d=="attachment"){let m=new qs(u,c);for(let y=0;y<u;y++){let b=g[y];m.setFrame(y,B(b,"time",0),B(b,"name",null))}n.push(m)}else if(d=="rgba"){let m=new bo(u,u<<2,c),y=g[0],b=B(y,"time",0),E=ue.fromString(y.color);for(let v=0,S=0;;v++){m.setFrame(v,b,E.r,E.g,E.b,E.a);let x=g[v+1];if(!x){m.shrink(S);break}let A=B(x,"time",0),C=ue.fromString(x.color),k=y.curve;k&&(S=Be(k,m,S,v,0,b,A,E.r,C.r,1),S=Be(k,m,S,v,1,b,A,E.g,C.g,1),S=Be(k,m,S,v,2,b,A,E.b,C.b,1),S=Be(k,m,S,v,3,b,A,E.a,C.a,1)),b=A,E=C,y=x}n.push(m)}else if(d=="rgb"){let m=new wo(u,u*3,c),y=g[0],b=B(y,"time",0),E=ue.fromString(y.color);for(let v=0,S=0;;v++){m.setFrame(v,b,E.r,E.g,E.b);let x=g[v+1];if(!x){m.shrink(S);break}let A=B(x,"time",0),C=ue.fromString(x.color),k=y.curve;k&&(S=Be(k,m,S,v,0,b,A,E.r,C.r,1),S=Be(k,m,S,v,1,b,A,E.g,C.g,1),S=Be(k,m,S,v,2,b,A,E.b,C.b,1)),b=A,E=C,y=x}n.push(m)}else if(d=="alpha")n.push(_t(g,new xo(u,u,c),0,1));else if(d=="rgba2"){let m=new So(u,u*7,c),y=g[0],b=B(y,"time",0),E=ue.fromString(y.light),v=ue.fromString(y.dark);for(let S=0,x=0;;S++){m.setFrame(S,b,E.r,E.g,E.b,E.a,v.r,v.g,v.b);let A=g[S+1];if(!A){m.shrink(x);break}let C=B(A,"time",0),k=ue.fromString(A.light),_=ue.fromString(A.dark),L=y.curve;L&&(x=Be(L,m,x,S,0,b,C,E.r,k.r,1),x=Be(L,m,x,S,1,b,C,E.g,k.g,1),x=Be(L,m,x,S,2,b,C,E.b,k.b,1),x=Be(L,m,x,S,3,b,C,E.a,k.a,1),x=Be(L,m,x,S,4,b,C,v.r,_.r,1),x=Be(L,m,x,S,5,b,C,v.g,_.g,1),x=Be(L,m,x,S,6,b,C,v.b,_.b,1)),b=C,E=k,v=_,y=A}n.push(m)}else if(d=="rgb2"){let m=new vo(u,u*6,c),y=g[0],b=B(y,"time",0),E=ue.fromString(y.light),v=ue.fromString(y.dark);for(let S=0,x=0;;S++){m.setFrame(S,b,E.r,E.g,E.b,v.r,v.g,v.b);let A=g[S+1];if(!A){m.shrink(x);break}let C=B(A,"time",0),k=ue.fromString(A.light),_=ue.fromString(A.dark),L=y.curve;L&&(x=Be(L,m,x,S,0,b,C,E.r,k.r,1),x=Be(L,m,x,S,1,b,C,E.g,k.g,1),x=Be(L,m,x,S,2,b,C,E.b,k.b,1),x=Be(L,m,x,S,3,b,C,v.r,_.r,1),x=Be(L,m,x,S,4,b,C,v.g,_.g,1),x=Be(L,m,x,S,5,b,C,v.b,_.b,1)),b=C,E=k,v=_,y=A}n.push(m)}}}if(e.bones)for(let o in e.bones){let r=e.bones[o],h=s.findBone(o);if(!h)throw new Error("Bone not found: "+o);let c=h.index;for(let d in r){let g=r[d],u=g.length;if(u!=0){if(d==="rotate")n.push(_t(g,new Hi(u,u,c),0,1));else if(d==="translate"){let m=new oo(u,u<<1,c);n.push(In(g,m,"x","y",0,i))}else if(d==="translatex"){let m=new lo(u,u,c);n.push(_t(g,m,0,i))}else if(d==="translatey"){let m=new ho(u,u,c);n.push(_t(g,m,0,i))}else if(d==="scale"){let m=new co(u,u<<1,c);n.push(In(g,m,"x","y",1,1))}else if(d==="scalex"){let m=new fo(u,u,c);n.push(_t(g,m,1,1))}else if(d==="scaley"){let m=new uo(u,u,c);n.push(_t(g,m,1,1))}else if(d==="shear"){let m=new mo(u,u<<1,c);n.push(In(g,m,"x","y",0,1))}else if(d==="shearx"){let m=new go(u,u,c);n.push(_t(g,m,0,1))}else if(d==="sheary"){let m=new po(u,u,c);n.push(_t(g,m,0,1))}else if(d==="inherit"){let m=new yo(u,h.index);for(let y=0;y<g.length;y++){let b=g[y];m.setFrame(y,B(b,"time",0),se.enumValue($e,B(b,"inherit","Normal")))}n.push(m)}}}}if(e.ik)for(let o in e.ik){let r=e.ik[o],h=r[0];if(!h)continue;let c=s.findIkConstraint(o);if(!c)throw new Error("IK Constraint not found: "+o);let d=s.ikConstraints.indexOf(c),g=new To(r.length,r.length<<1,d),u=B(h,"time",0),m=B(h,"mix",1),y=B(h,"softness",0)*i;for(let b=0,E=0;;b++){g.setFrame(b,u,m,y,B(h,"bendPositive",!0)?1:-1,B(h,"compress",!1),B(h,"stretch",!1));let v=r[b+1];if(!v){g.shrink(E);break}let S=B(v,"time",0),x=B(v,"mix",1),A=B(v,"softness",0)*i,C=h.curve;C&&(E=Be(C,g,E,b,0,u,S,m,x,1),E=Be(C,g,E,b,1,u,S,y,A,i)),u=S,m=x,y=A,h=v}n.push(g)}if(e.transform)for(let o in e.transform){let r=e.transform[o],h=r[0];if(!h)continue;let c=s.findTransformConstraint(o);if(!c)throw new Error("Transform constraint not found: "+o);let d=s.transformConstraints.indexOf(c),g=new Ao(r.length,r.length*6,d),u=B(h,"time",0),m=B(h,"mixRotate",1),y=B(h,"mixX",1),b=B(h,"mixY",y),E=B(h,"mixScaleX",1),v=B(h,"mixScaleY",E),S=B(h,"mixShearY",1);for(let x=0,A=0;;x++){g.setFrame(x,u,m,y,b,E,v,S);let C=r[x+1];if(!C){g.shrink(A);break}let k=B(C,"time",0),_=B(C,"mixRotate",1),L=B(C,"mixX",1),N=B(C,"mixY",L),V=B(C,"mixScaleX",1),W=B(C,"mixScaleY",V),O=B(C,"mixShearY",1),R=h.curve;R&&(A=Be(R,g,A,x,0,u,k,m,_,1),A=Be(R,g,A,x,1,u,k,y,L,1),A=Be(R,g,A,x,2,u,k,b,N,1),A=Be(R,g,A,x,3,u,k,E,V,1),A=Be(R,g,A,x,4,u,k,v,W,1),A=Be(R,g,A,x,5,u,k,S,O,1)),u=k,m=_,y=L,b=N,E=V,v=W,E=V,h=C}n.push(g)}if(e.path)for(let o in e.path){let r=e.path[o],h=s.findPathConstraint(o);if(!h)throw new Error("Path constraint not found: "+o);let c=s.pathConstraints.indexOf(h);for(let d in r){let g=r[d],u=g[0];if(!u)continue;let m=g.length;if(d==="position"){let y=new Co(m,m,c);n.push(_t(g,y,0,h.positionMode==Jt.Fixed?i:1))}else if(d==="spacing"){let y=new Io(m,m,c);n.push(_t(g,y,0,h.spacingMode==et.Length||h.spacingMode==et.Fixed?i:1))}else if(d==="mix"){let y=new Ro(m,m*3,c),b=B(u,"time",0),E=B(u,"mixRotate",1),v=B(u,"mixX",1),S=B(u,"mixY",v);for(let x=0,A=0;;x++){y.setFrame(x,b,E,v,S);let C=g[x+1];if(!C){y.shrink(A);break}let k=B(C,"time",0),_=B(C,"mixRotate",1),L=B(C,"mixX",1),N=B(C,"mixY",L),V=u.curve;V&&(A=Be(V,y,A,x,0,b,k,E,_,1),A=Be(V,y,A,x,1,b,k,v,L,1),A=Be(V,y,A,x,2,b,k,S,N,1)),b=k,E=_,v=L,S=N,u=C}n.push(y)}}}if(e.physics)for(let o in e.physics){let r=e.physics[o],h=-1;if(o.length>0){let c=s.findPhysicsConstraint(o);if(!c)throw new Error("Physics constraint not found: "+o);h=s.physicsConstraints.indexOf(c)}for(let c in r){let d=r[c],g=d[0];if(!g)continue;let u=d.length;if(c=="reset"){const y=new nn(u,h);for(let b=0;g!=null;g=d[b+1],b++)y.setFrame(b,B(g,"time",0));n.push(y);continue}let m;if(c=="inertia")m=new Oo(u,u,h);else if(c=="strength")m=new ko(u,u,h);else if(c=="damping")m=new Po(u,u,h);else if(c=="mass")m=new _o(u,u,h);else if(c=="wind")m=new Mo(u,u,h);else if(c=="gravity")m=new Lo(u,u,h);else if(c=="mix")m=new Fo(u,u,h);else continue;n.push(_t(d,m,0,1))}}if(e.attachments)for(let o in e.attachments){let r=e.attachments[o],h=s.findSkin(o);if(!h)throw new Error("Skin not found: "+o);for(let c in r){let d=r[c],g=s.findSlot(c);if(!g)throw new Error("Slot not found: "+c);let u=g.index;for(let m in d){let y=d[m],b=h.getAttachment(u,m);for(let E in y){let v=y[E],S=v[0];if(S){if(E=="deform"){let x=b.bones,A=b.vertices,C=x?A.length/3*2:A.length,k=new Eo(v.length,v.length,u,b),_=B(S,"time",0);for(let L=0,N=0;;L++){let V,W=B(S,"vertices",null);if(!W)V=x?se.newFloatArray(C):A;else{V=se.newFloatArray(C);let F=B(S,"offset",0);if(se.arrayCopy(W,0,V,F,W.length),i!=1)for(let H=F,Z=H+W.length;H<Z;H++)V[H]*=i;if(!x)for(let H=0;H<C;H++)V[H]+=A[H]}k.setFrame(L,_,V);let O=v[L+1];if(!O){k.shrink(N);break}let R=B(O,"time",0),M=S.curve;M&&(N=Be(M,k,N,L,0,_,R,0,1,1)),_=R,S=O}n.push(k)}else if(E=="sequence"){let x=new $t(v.length,u,b),A=0;for(let C=0;C<v.length;C++){let k=B(S,"delay",A),_=B(S,"time",0),L=rt[B(S,"mode","hold")],N=B(S,"index",0);x.setFrame(C,_,L,N,k),A=k,S=v[C+1]}n.push(x)}}}}}}if(e.drawOrder){let o=new Cs(e.drawOrder.length),r=s.slots.length,h=0;for(let c=0;c<e.drawOrder.length;c++,h++){let d=e.drawOrder[c],g=null,u=B(d,"offsets",null);if(u){g=se.newArray(r,-1);let m=se.newArray(r-u.length,0),y=0,b=0;for(let E=0;E<u.length;E++){let v=u[E],S=s.findSlot(v.slot);if(!S)throw new Error("Slot not found: "+S);let x=S.index;for(;y!=x;)m[b++]=y++;g[y+v.offset]=y++}for(;y<r;)m[b++]=y++;for(let E=r-1;E>=0;E--)g[E]==-1&&(g[E]=m[--b])}o.setFrame(h,B(d,"time",0),g)}n.push(o)}if(e.events){let o=new gi(e.events.length),r=0;for(let h=0;h<e.events.length;h++,r++){let c=e.events[h],d=s.findEvent(c.name);if(!d)throw new Error("Event not found: "+c.name);let g=new Yo(se.toSinglePrecision(B(c,"time",0)),d);g.intValue=B(c,"int",d.intValue),g.floatValue=B(c,"float",d.floatValue),g.stringValue=B(c,"string",d.stringValue),g.data.audioPath&&(g.volume=B(c,"volume",1),g.balance=B(c,"balance",0)),o.setFrame(r,g)}n.push(o)}let a=0;for(let o=0,r=n.length;o<r;o++)a=Math.max(a,n[o].getDuration());s.animations.push(new ar(t,n,a))}}class _c{parent;skin;slotIndex;mesh;inheritTimeline;constructor(e,t,s,i,n){this.mesh=e,this.skin=t,this.slotIndex=s,this.parent=i,this.inheritTimeline=n}}function _t(l,e,t,s){let i=l[0],n=B(i,"time",0),a=B(i,"value",t)*s,o=0;for(let r=0;;r++){e.setFrame(r,n,a);let h=l[r+1];if(!h)return e.shrink(o),e;let c=B(h,"time",0),d=B(h,"value",t)*s;i.curve&&(o=Be(i.curve,e,o,r,0,n,c,a,d,s)),n=c,a=d,i=h}}function In(l,e,t,s,i,n){let a=l[0],o=B(a,"time",0),r=B(a,t,i)*n,h=B(a,s,i)*n,c=0;for(let d=0;;d++){e.setFrame(d,o,r,h);let g=l[d+1];if(!g)return e.shrink(c),e;let u=B(g,"time",0),m=B(g,t,i)*n,y=B(g,s,i)*n,b=a.curve;b&&(c=Be(b,e,c,d,0,o,u,r,m,n),c=Be(b,e,c,d,1,o,u,h,y,n)),o=u,r=m,h=y,a=g}}function Be(l,e,t,s,i,n,a,o,r,h){if(l=="stepped")return e.setStepped(s),t;let c=i<<2,d=l[c],g=l[c+1]*h,u=l[c+2],m=l[c+3]*h;return e.setBezier(t,s,i,n,o,d,g,u,m,a,r),t+1}function B(l,e,t){return l[e]!==void 0?l[e]:t}typeof Math.fround>"u"&&(Math.fround=(function(l){return function(e){return l[0]=e,l[0]}})(new Float32Array(1)));class Mc extends Do{constructor(e){super(e)}setFilters(e,t){}setWraps(e,t){}dispose(){}}const Lc=se.newFloatArray(8);let Fc=class Xi{static QUAD_TRIANGLES=[0,1,2,2,3,0];static VERTEX_SIZE=8;ctx;triangleRendering=!1;debugRendering=!1;vertices=se.newFloatArray(8*1024);tempColor=new ue;constructor(e){this.ctx=e}draw(e){this.triangleRendering?this.drawTriangles(e):this.drawImages(e)}drawImages(e){let t=this.ctx,s=this.tempColor,i=e.color,n=e.drawOrder;this.debugRendering&&(t.strokeStyle="green");for(let a=0,o=n.length;a<o;a++){let r=n[a],h=r.bone;if(!h.active)continue;let c=r.getAttachment();if(!(c instanceof Xe))continue;c.computeWorldVertices(r,Lc,0,2);let d=c.region,g=d.texture.getImage(),u=r.color,m=c.color;s.set(i.r*u.r*m.r,i.g*u.g*m.g,i.b*u.b*m.b,i.a*u.a*m.a),t.save(),t.transform(h.a,h.c,h.b,h.d,h.worldX,h.worldY),t.translate(c.offset[0],c.offset[1]),t.rotate(c.rotation*Math.PI/180);let y=c.width/d.originalWidth;t.scale(y*c.scaleX,y*c.scaleY);let b=d.width,E=d.height;if(t.translate(b/2,E/2),c.region.degrees==90){let v=b;b=E,E=v,t.rotate(-Math.PI/2)}t.scale(1,-1),t.translate(-b/2,-E/2),t.globalAlpha=s.a,t.drawImage(g,g.width*d.u,g.height*d.v,b,E,0,0,b,E),this.debugRendering&&t.strokeRect(0,0,b,E),t.restore()}}drawTriangles(e){let t=this.ctx,s=this.tempColor,i=e.color,n=e.drawOrder,a=null,o=this.vertices,r=null;for(let c=0,d=n.length;c<d;c++){let g=n[c],u=g.getAttachment(),m;if(u instanceof Xe){let y=u;o=this.computeRegionVertices(g,y,!1),r=Xi.QUAD_TRIANGLES,m=y.region.texture.getImage()}else if(u instanceof os){let y=u;o=this.computeMeshVertices(g,y,!1),r=y.triangles,m=y.region.texture.getImage()}else continue;if(m){g.data.blendMode!=a&&(a=g.data.blendMode);let y=g.color,b=u.color;s.set(i.r*y.r*b.r,i.g*y.g*b.g,i.b*y.b*b.b,i.a*y.a*b.a),t.globalAlpha=s.a;for(var h=0;h<r.length;h+=3){let E=r[h]*8,v=r[h+1]*8,S=r[h+2]*8,x=o[E],A=o[E+1],C=o[E+6],k=o[E+7],_=o[v],L=o[v+1],N=o[v+6],V=o[v+7],W=o[S],O=o[S+1],R=o[S+6],M=o[S+7];this.drawTriangle(m,x,A,C,k,_,L,N,V,W,O,R,M),this.debugRendering&&(t.strokeStyle="green",t.beginPath(),t.moveTo(x,A),t.lineTo(_,L),t.lineTo(W,O),t.lineTo(x,A),t.stroke())}}}this.ctx.globalAlpha=1}drawTriangle(e,t,s,i,n,a,o,r,h,c,d,g,u){let m=this.ctx;const y=e.width-1,b=e.height-1;i*=y,n*=b,r*=y,h*=b,g*=y,u*=b,m.beginPath(),m.moveTo(t,s),m.lineTo(a,o),m.lineTo(c,d),m.closePath(),a-=t,o-=s,c-=t,d-=s,r-=i,h-=n,g-=i,u-=n;let E=r*u-g*h;if(E==0)return;E=1/E;const v=(u*a-h*c)*E,S=(u*o-h*d)*E,x=(r*c-g*a)*E,A=(r*d-g*o)*E,C=t-v*i-x*n,k=s-S*i-A*n;m.save(),m.transform(v,S,x,A,C,k),m.clip(),m.drawImage(e,0,0),m.restore()}computeRegionVertices(e,t,s){let i=e.bone.skeleton.color,n=e.color,a=t.color,o=i.a*n.a*a.a,r=s?o:1,h=this.tempColor;h.set(i.r*n.r*a.r*r,i.g*n.g*a.g*r,i.b*n.b*a.b*r,o),t.computeWorldVertices(e,this.vertices,0,Xi.VERTEX_SIZE);let c=this.vertices,d=t.uvs;return c[Xe.C1R]=h.r,c[Xe.C1G]=h.g,c[Xe.C1B]=h.b,c[Xe.C1A]=h.a,c[Xe.U1]=d[0],c[Xe.V1]=d[1],c[Xe.C2R]=h.r,c[Xe.C2G]=h.g,c[Xe.C2B]=h.b,c[Xe.C2A]=h.a,c[Xe.U2]=d[2],c[Xe.V2]=d[3],c[Xe.C3R]=h.r,c[Xe.C3G]=h.g,c[Xe.C3B]=h.b,c[Xe.C3A]=h.a,c[Xe.U3]=d[4],c[Xe.V3]=d[5],c[Xe.C4R]=h.r,c[Xe.C4G]=h.g,c[Xe.C4B]=h.b,c[Xe.C4A]=h.a,c[Xe.U4]=d[6],c[Xe.V4]=d[7],c}computeMeshVertices(e,t,s){let i=e.bone.skeleton.color,n=e.color,a=t.color,o=i.a*n.a*a.a,r=s?o:1,h=this.tempColor;h.set(i.r*n.r*a.r*r,i.g*n.g*a.g*r,i.b*n.b*a.b*r,o);let c=t.worldVerticesLength/2,d=this.vertices;d.length<t.worldVerticesLength&&(this.vertices=d=se.newFloatArray(t.worldVerticesLength)),t.computeWorldVertices(e,0,t.worldVerticesLength,d,0,Xi.VERTEX_SIZE);let g=t.uvs;for(let u=0,m=0,y=2;u<c;u++)d[y++]=h.r,d[y++]=h.g,d[y++]=h.b,d[y++]=h.a,d[y++]=g[m++],d[y++]=g[m++],y+=2;return d}};class vt{canvas;gl;restorables=[];constructor(e,t={alpha:!0}){if(e instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext)this.gl=e,this.canvas=this.gl.canvas;else{const s=e;this.gl=s.getContext("webgl2",t)||s.getContext("webgl",t),this.canvas=s,s.addEventListener("webglcontextlost",this.contextLostHandler),s.addEventListener("webglcontextrestored",this.contextRestoredHandler)}}contextLostHandler=e=>{e&&e.preventDefault()};contextRestoredHandler=()=>{for(let e=0,t=this.restorables.length;e<t;e++)this.restorables[e].restore()};dispose(){this.canvas.removeEventListener("webglcontextlost",this.contextLostHandler),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredHandler)}addRestorable(e){this.restorables.push(e)}removeRestorable(e){const t=this.restorables.indexOf(e);t>-1&&this.restorables.splice(t,1)}}class Wi extends Do{context;texture=null;boundUnit=0;useMipMaps=!1;static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1;constructor(e,t,s=!1){super(t),this.context=e instanceof vt?e:new vt(e),this.useMipMaps=s,this.restore(),this.context.addRestorable(this)}setFilters(e,t){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,Wi.validateMagFilter(t)),this.useMipMaps=Wi.usesMipMaps(e),this.useMipMaps&&s.generateMipmap(s.TEXTURE_2D)}static validateMagFilter(e){switch(e){case ut.MipMapLinearLinear:case ut.MipMapLinearNearest:case ut.MipMapNearestLinear:case ut.MipMapNearestNearest:return ut.Linear;default:return e}}static usesMipMaps(e){switch(e){case ut.MipMapLinearLinear:case ut.MipMapLinearNearest:case ut.MipMapNearestLinear:case ut.MipMapNearestNearest:return!0;default:return!1}}setWraps(e,t){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t)}update(e){let t=this.context.gl;this.texture||(this.texture=this.context.gl.createTexture()),this.bind(),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&t.generateMipmap(t.TEXTURE_2D)}restore(){this.texture=null,this.update(this.useMipMaps)}bind(e=0){let t=this.context.gl;this.boundUnit=e,t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture)}unbind(){let e=this.context.gl;e.activeTexture(e.TEXTURE0+this.boundUnit),e.bindTexture(e.TEXTURE_2D,null)}dispose(){this.context.removeRestorable(this),this.context.gl.deleteTexture(this.texture)}}class Ks{x=0;y=0;z=0;constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}setFrom(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}set(e,t,s){return this.x=e,this.y=t,this.z=s,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}normalize(){let e=this.length();return e==0?this:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this)}cross(e){return this.set(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}multiply(e){let t=e.values;return this.set(this.x*t[me]+this.y*t[xe]+this.z*t[Se]+t[ge],this.x*t[ve]+this.y*t[pe]+this.z*t[Ee]+t[ye],this.x*t[Te]+this.y*t[Ae]+this.z*t[be]+t[we])}project(e){let t=e.values,s=1/(this.x*t[Re]+this.y*t[Oe]+this.z*t[ke]+t[Ce]);return this.set((this.x*t[me]+this.y*t[xe]+this.z*t[Se]+t[ge])*s,(this.x*t[ve]+this.y*t[pe]+this.z*t[Ee]+t[ye])*s,(this.x*t[Te]+this.y*t[Ae]+this.z*t[be]+t[we])*s)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}distance(e){let t=e.x-this.x,s=e.y-this.y,i=e.z-this.z;return Math.sqrt(t*t+s*s+i*i)}}const me=0,xe=4,Se=8,ge=12,ve=1,pe=5,Ee=9,ye=13,Te=2,Ae=6,be=10,we=14,Re=3,Oe=7,ke=11,Ce=15;class ft{temp=new Float32Array(16);values=new Float32Array(16);static xAxis=new Ks;static yAxis=new Ks;static zAxis=new Ks;static tmpMatrix=new ft;constructor(){let e=this.values;e[me]=1,e[pe]=1,e[be]=1,e[Ce]=1}set(e){return this.values.set(e),this}transpose(){let e=this.temp,t=this.values;return e[me]=t[me],e[xe]=t[ve],e[Se]=t[Te],e[ge]=t[Re],e[ve]=t[xe],e[pe]=t[pe],e[Ee]=t[Ae],e[ye]=t[Oe],e[Te]=t[Se],e[Ae]=t[Ee],e[be]=t[be],e[we]=t[ke],e[Re]=t[ge],e[Oe]=t[ye],e[ke]=t[we],e[Ce]=t[Ce],this.set(e)}identity(){let e=this.values;return e[me]=1,e[xe]=0,e[Se]=0,e[ge]=0,e[ve]=0,e[pe]=1,e[Ee]=0,e[ye]=0,e[Te]=0,e[Ae]=0,e[be]=1,e[we]=0,e[Re]=0,e[Oe]=0,e[ke]=0,e[Ce]=1,this}invert(){let e=this.values,t=this.temp,s=e[Re]*e[Ae]*e[Ee]*e[ge]-e[Te]*e[Oe]*e[Ee]*e[ge]-e[Re]*e[pe]*e[be]*e[ge]+e[ve]*e[Oe]*e[be]*e[ge]+e[Te]*e[pe]*e[ke]*e[ge]-e[ve]*e[Ae]*e[ke]*e[ge]-e[Re]*e[Ae]*e[Se]*e[ye]+e[Te]*e[Oe]*e[Se]*e[ye]+e[Re]*e[xe]*e[be]*e[ye]-e[me]*e[Oe]*e[be]*e[ye]-e[Te]*e[xe]*e[ke]*e[ye]+e[me]*e[Ae]*e[ke]*e[ye]+e[Re]*e[pe]*e[Se]*e[we]-e[ve]*e[Oe]*e[Se]*e[we]-e[Re]*e[xe]*e[Ee]*e[we]+e[me]*e[Oe]*e[Ee]*e[we]+e[ve]*e[xe]*e[ke]*e[we]-e[me]*e[pe]*e[ke]*e[we]-e[Te]*e[pe]*e[Se]*e[Ce]+e[ve]*e[Ae]*e[Se]*e[Ce]+e[Te]*e[xe]*e[Ee]*e[Ce]-e[me]*e[Ae]*e[Ee]*e[Ce]-e[ve]*e[xe]*e[be]*e[Ce]+e[me]*e[pe]*e[be]*e[Ce];if(s==0)throw new Error("non-invertible matrix");let i=1/s;return t[me]=e[Ee]*e[we]*e[Oe]-e[ye]*e[be]*e[Oe]+e[ye]*e[Ae]*e[ke]-e[pe]*e[we]*e[ke]-e[Ee]*e[Ae]*e[Ce]+e[pe]*e[be]*e[Ce],t[xe]=e[ge]*e[be]*e[Oe]-e[Se]*e[we]*e[Oe]-e[ge]*e[Ae]*e[ke]+e[xe]*e[we]*e[ke]+e[Se]*e[Ae]*e[Ce]-e[xe]*e[be]*e[Ce],t[Se]=e[Se]*e[ye]*e[Oe]-e[ge]*e[Ee]*e[Oe]+e[ge]*e[pe]*e[ke]-e[xe]*e[ye]*e[ke]-e[Se]*e[pe]*e[Ce]+e[xe]*e[Ee]*e[Ce],t[ge]=e[ge]*e[Ee]*e[Ae]-e[Se]*e[ye]*e[Ae]-e[ge]*e[pe]*e[be]+e[xe]*e[ye]*e[be]+e[Se]*e[pe]*e[we]-e[xe]*e[Ee]*e[we],t[ve]=e[ye]*e[be]*e[Re]-e[Ee]*e[we]*e[Re]-e[ye]*e[Te]*e[ke]+e[ve]*e[we]*e[ke]+e[Ee]*e[Te]*e[Ce]-e[ve]*e[be]*e[Ce],t[pe]=e[Se]*e[we]*e[Re]-e[ge]*e[be]*e[Re]+e[ge]*e[Te]*e[ke]-e[me]*e[we]*e[ke]-e[Se]*e[Te]*e[Ce]+e[me]*e[be]*e[Ce],t[Ee]=e[ge]*e[Ee]*e[Re]-e[Se]*e[ye]*e[Re]-e[ge]*e[ve]*e[ke]+e[me]*e[ye]*e[ke]+e[Se]*e[ve]*e[Ce]-e[me]*e[Ee]*e[Ce],t[ye]=e[Se]*e[ye]*e[Te]-e[ge]*e[Ee]*e[Te]+e[ge]*e[ve]*e[be]-e[me]*e[ye]*e[be]-e[Se]*e[ve]*e[we]+e[me]*e[Ee]*e[we],t[Te]=e[pe]*e[we]*e[Re]-e[ye]*e[Ae]*e[Re]+e[ye]*e[Te]*e[Oe]-e[ve]*e[we]*e[Oe]-e[pe]*e[Te]*e[Ce]+e[ve]*e[Ae]*e[Ce],t[Ae]=e[ge]*e[Ae]*e[Re]-e[xe]*e[we]*e[Re]-e[ge]*e[Te]*e[Oe]+e[me]*e[we]*e[Oe]+e[xe]*e[Te]*e[Ce]-e[me]*e[Ae]*e[Ce],t[be]=e[xe]*e[ye]*e[Re]-e[ge]*e[pe]*e[Re]+e[ge]*e[ve]*e[Oe]-e[me]*e[ye]*e[Oe]-e[xe]*e[ve]*e[Ce]+e[me]*e[pe]*e[Ce],t[we]=e[ge]*e[pe]*e[Te]-e[xe]*e[ye]*e[Te]-e[ge]*e[ve]*e[Ae]+e[me]*e[ye]*e[Ae]+e[xe]*e[ve]*e[we]-e[me]*e[pe]*e[we],t[Re]=e[Ee]*e[Ae]*e[Re]-e[pe]*e[be]*e[Re]-e[Ee]*e[Te]*e[Oe]+e[ve]*e[be]*e[Oe]+e[pe]*e[Te]*e[ke]-e[ve]*e[Ae]*e[ke],t[Oe]=e[xe]*e[be]*e[Re]-e[Se]*e[Ae]*e[Re]+e[Se]*e[Te]*e[Oe]-e[me]*e[be]*e[Oe]-e[xe]*e[Te]*e[ke]+e[me]*e[Ae]*e[ke],t[ke]=e[Se]*e[pe]*e[Re]-e[xe]*e[Ee]*e[Re]-e[Se]*e[ve]*e[Oe]+e[me]*e[Ee]*e[Oe]+e[xe]*e[ve]*e[ke]-e[me]*e[pe]*e[ke],t[Ce]=e[xe]*e[Ee]*e[Te]-e[Se]*e[pe]*e[Te]+e[Se]*e[ve]*e[Ae]-e[me]*e[Ee]*e[Ae]-e[xe]*e[ve]*e[be]+e[me]*e[pe]*e[be],e[me]=t[me]*i,e[xe]=t[xe]*i,e[Se]=t[Se]*i,e[ge]=t[ge]*i,e[ve]=t[ve]*i,e[pe]=t[pe]*i,e[Ee]=t[Ee]*i,e[ye]=t[ye]*i,e[Te]=t[Te]*i,e[Ae]=t[Ae]*i,e[be]=t[be]*i,e[we]=t[we]*i,e[Re]=t[Re]*i,e[Oe]=t[Oe]*i,e[ke]=t[ke]*i,e[Ce]=t[Ce]*i,this}determinant(){let e=this.values;return e[Re]*e[Ae]*e[Ee]*e[ge]-e[Te]*e[Oe]*e[Ee]*e[ge]-e[Re]*e[pe]*e[be]*e[ge]+e[ve]*e[Oe]*e[be]*e[ge]+e[Te]*e[pe]*e[ke]*e[ge]-e[ve]*e[Ae]*e[ke]*e[ge]-e[Re]*e[Ae]*e[Se]*e[ye]+e[Te]*e[Oe]*e[Se]*e[ye]+e[Re]*e[xe]*e[be]*e[ye]-e[me]*e[Oe]*e[be]*e[ye]-e[Te]*e[xe]*e[ke]*e[ye]+e[me]*e[Ae]*e[ke]*e[ye]+e[Re]*e[pe]*e[Se]*e[we]-e[ve]*e[Oe]*e[Se]*e[we]-e[Re]*e[xe]*e[Ee]*e[we]+e[me]*e[Oe]*e[Ee]*e[we]+e[ve]*e[xe]*e[ke]*e[we]-e[me]*e[pe]*e[ke]*e[we]-e[Te]*e[pe]*e[Se]*e[Ce]+e[ve]*e[Ae]*e[Se]*e[Ce]+e[Te]*e[xe]*e[Ee]*e[Ce]-e[me]*e[Ae]*e[Ee]*e[Ce]-e[ve]*e[xe]*e[be]*e[Ce]+e[me]*e[pe]*e[be]*e[Ce]}translate(e,t,s){let i=this.values;return i[ge]+=e,i[ye]+=t,i[we]+=s,this}copy(){return new ft().set(this.values)}projection(e,t,s,i){this.identity();let n=1/Math.tan(s*(Math.PI/180)/2),a=(t+e)/(e-t),o=2*t*e/(e-t),r=this.values;return r[me]=n/i,r[ve]=0,r[Te]=0,r[Re]=0,r[xe]=0,r[pe]=n,r[Ae]=0,r[Oe]=0,r[Se]=0,r[Ee]=0,r[be]=a,r[ke]=-1,r[ge]=0,r[ye]=0,r[we]=o,r[Ce]=0,this}ortho2d(e,t,s,i){return this.ortho(e,e+s,t,t+i,0,1)}ortho(e,t,s,i,n,a){this.identity();let o=2/(t-e),r=2/(i-s),h=-2/(a-n),c=-(t+e)/(t-e),d=-(i+s)/(i-s),g=-(a+n)/(a-n),u=this.values;return u[me]=o,u[ve]=0,u[Te]=0,u[Re]=0,u[xe]=0,u[pe]=r,u[Ae]=0,u[Oe]=0,u[Se]=0,u[Ee]=0,u[be]=h,u[ke]=0,u[ge]=c,u[ye]=d,u[we]=g,u[Ce]=1,this}multiply(e){let t=this.temp,s=this.values,i=e.values;return t[me]=s[me]*i[me]+s[xe]*i[ve]+s[Se]*i[Te]+s[ge]*i[Re],t[xe]=s[me]*i[xe]+s[xe]*i[pe]+s[Se]*i[Ae]+s[ge]*i[Oe],t[Se]=s[me]*i[Se]+s[xe]*i[Ee]+s[Se]*i[be]+s[ge]*i[ke],t[ge]=s[me]*i[ge]+s[xe]*i[ye]+s[Se]*i[we]+s[ge]*i[Ce],t[ve]=s[ve]*i[me]+s[pe]*i[ve]+s[Ee]*i[Te]+s[ye]*i[Re],t[pe]=s[ve]*i[xe]+s[pe]*i[pe]+s[Ee]*i[Ae]+s[ye]*i[Oe],t[Ee]=s[ve]*i[Se]+s[pe]*i[Ee]+s[Ee]*i[be]+s[ye]*i[ke],t[ye]=s[ve]*i[ge]+s[pe]*i[ye]+s[Ee]*i[we]+s[ye]*i[Ce],t[Te]=s[Te]*i[me]+s[Ae]*i[ve]+s[be]*i[Te]+s[we]*i[Re],t[Ae]=s[Te]*i[xe]+s[Ae]*i[pe]+s[be]*i[Ae]+s[we]*i[Oe],t[be]=s[Te]*i[Se]+s[Ae]*i[Ee]+s[be]*i[be]+s[we]*i[ke],t[we]=s[Te]*i[ge]+s[Ae]*i[ye]+s[be]*i[we]+s[we]*i[Ce],t[Re]=s[Re]*i[me]+s[Oe]*i[ve]+s[ke]*i[Te]+s[Ce]*i[Re],t[Oe]=s[Re]*i[xe]+s[Oe]*i[pe]+s[ke]*i[Ae]+s[Ce]*i[Oe],t[ke]=s[Re]*i[Se]+s[Oe]*i[Ee]+s[ke]*i[be]+s[Ce]*i[ke],t[Ce]=s[Re]*i[ge]+s[Oe]*i[ye]+s[ke]*i[we]+s[Ce]*i[Ce],this.set(this.temp)}multiplyLeft(e){let t=this.temp,s=this.values,i=e.values;return t[me]=i[me]*s[me]+i[xe]*s[ve]+i[Se]*s[Te]+i[ge]*s[Re],t[xe]=i[me]*s[xe]+i[xe]*s[pe]+i[Se]*s[Ae]+i[ge]*s[Oe],t[Se]=i[me]*s[Se]+i[xe]*s[Ee]+i[Se]*s[be]+i[ge]*s[ke],t[ge]=i[me]*s[ge]+i[xe]*s[ye]+i[Se]*s[we]+i[ge]*s[Ce],t[ve]=i[ve]*s[me]+i[pe]*s[ve]+i[Ee]*s[Te]+i[ye]*s[Re],t[pe]=i[ve]*s[xe]+i[pe]*s[pe]+i[Ee]*s[Ae]+i[ye]*s[Oe],t[Ee]=i[ve]*s[Se]+i[pe]*s[Ee]+i[Ee]*s[be]+i[ye]*s[ke],t[ye]=i[ve]*s[ge]+i[pe]*s[ye]+i[Ee]*s[we]+i[ye]*s[Ce],t[Te]=i[Te]*s[me]+i[Ae]*s[ve]+i[be]*s[Te]+i[we]*s[Re],t[Ae]=i[Te]*s[xe]+i[Ae]*s[pe]+i[be]*s[Ae]+i[we]*s[Oe],t[be]=i[Te]*s[Se]+i[Ae]*s[Ee]+i[be]*s[be]+i[we]*s[ke],t[we]=i[Te]*s[ge]+i[Ae]*s[ye]+i[be]*s[we]+i[we]*s[Ce],t[Re]=i[Re]*s[me]+i[Oe]*s[ve]+i[ke]*s[Te]+i[Ce]*s[Re],t[Oe]=i[Re]*s[xe]+i[Oe]*s[pe]+i[ke]*s[Ae]+i[Ce]*s[Oe],t[ke]=i[Re]*s[Se]+i[Oe]*s[Ee]+i[ke]*s[be]+i[Ce]*s[ke],t[Ce]=i[Re]*s[ge]+i[Oe]*s[ye]+i[ke]*s[we]+i[Ce]*s[Ce],this.set(this.temp)}lookAt(e,t,s){let i=ft.xAxis,n=ft.yAxis,a=ft.zAxis;a.setFrom(t).normalize(),i.setFrom(t).normalize(),i.cross(s).normalize(),n.setFrom(i).cross(a).normalize(),this.identity();let o=this.values;return o[me]=i.x,o[xe]=i.y,o[Se]=i.z,o[ve]=n.x,o[pe]=n.y,o[Ee]=n.z,o[Te]=-a.x,o[Ae]=-a.y,o[be]=-a.z,ft.tmpMatrix.identity(),ft.tmpMatrix.values[ge]=-e.x,ft.tmpMatrix.values[ye]=-e.y,ft.tmpMatrix.values[we]=-e.z,this.multiply(ft.tmpMatrix),this}}class Dc{position=new Ks(0,0,0);direction=new Ks(0,0,-1);up=new Ks(0,1,0);near=0;far=100;zoom=1;viewportWidth=0;viewportHeight=0;projectionView=new ft;inverseProjectionView=new ft;projection=new ft;view=new ft;constructor(e,t){this.viewportWidth=e,this.viewportHeight=t,this.update()}update(){let e=this.projection,t=this.view,s=this.projectionView,i=this.inverseProjectionView,n=this.zoom,a=this.viewportWidth,o=this.viewportHeight;e.ortho(n*(-a/2),n*(a/2),n*(-o/2),n*(o/2),this.near,this.far),t.lookAt(this.position,this.direction,this.up),s.set(e.values),s.multiply(t),i.set(s.values).invert()}screenToWorld(e,t,s){let i=e.x,n=s-e.y-1;return e.x=2*i/t-1,e.y=2*n/s-1,e.z=2*e.z-1,e.project(this.inverseProjectionView),e}worldToScreen(e,t,s){return e.project(this.projectionView),e.x=t*(e.x+1)/2,e.y=s*(e.y+1)/2,e.z=(e.z+1)/2,e}setViewport(e,t){this.viewportWidth=e,this.viewportHeight=t}}class Le{vertexShader;fragmentShader;static MVP_MATRIX="u_projTrans";static POSITION="a_position";static COLOR="a_color";static COLOR2="a_color2";static TEXCOORDS="a_texCoords";static SAMPLER="u_texture";context;vs=null;vsSource;fs=null;fsSource;program=null;tmp2x2=new Float32Array(4);tmp3x3=new Float32Array(9);tmp4x4=new Float32Array(16);getProgram(){return this.program}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}getVertexShaderSource(){return this.vsSource}getFragmentSource(){return this.fsSource}constructor(e,t,s){this.vertexShader=t,this.fragmentShader=s,this.vsSource=t,this.fsSource=s,this.context=e instanceof vt?e:new vt(e),this.context.addRestorable(this),this.compile()}compile(){let e=this.context.gl;try{if(this.vs=this.compileShader(e.VERTEX_SHADER,this.vertexShader),!this.vs)throw new Error("Couldn't compile vertex shader.");if(this.fs=this.compileShader(e.FRAGMENT_SHADER,this.fragmentShader),!this.fs)throw new Error("Couldn#t compile fragment shader.");this.program=this.compileProgram(this.vs,this.fs)}catch(t){throw this.dispose(),t}}compileShader(e,t){let s=this.context.gl,i=s.createShader(e);if(!i)throw new Error("Couldn't create shader.");if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){let n="Couldn't compile shader: "+s.getShaderInfoLog(i);if(s.deleteShader(i),!s.isContextLost())throw new Error(n)}return i}compileProgram(e,t){let s=this.context.gl,i=s.createProgram();if(!i)throw new Error("Couldn't compile program.");if(s.attachShader(i,e),s.attachShader(i,t),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS)){let n="Couldn't compile shader program: "+s.getProgramInfoLog(i);if(s.deleteProgram(i),!s.isContextLost())throw new Error(n)}return i}restore(){this.compile()}bind(){this.context.gl.useProgram(this.program)}unbind(){this.context.gl.useProgram(null)}setUniformi(e,t){this.context.gl.uniform1i(this.getUniformLocation(e),t)}setUniformf(e,t){this.context.gl.uniform1f(this.getUniformLocation(e),t)}setUniform2f(e,t,s){this.context.gl.uniform2f(this.getUniformLocation(e),t,s)}setUniform3f(e,t,s,i){this.context.gl.uniform3f(this.getUniformLocation(e),t,s,i)}setUniform4f(e,t,s,i,n){this.context.gl.uniform4f(this.getUniformLocation(e),t,s,i,n)}setUniform2x2f(e,t){let s=this.context.gl;this.tmp2x2.set(t),s.uniformMatrix2fv(this.getUniformLocation(e),!1,this.tmp2x2)}setUniform3x3f(e,t){let s=this.context.gl;this.tmp3x3.set(t),s.uniformMatrix3fv(this.getUniformLocation(e),!1,this.tmp3x3)}setUniform4x4f(e,t){let s=this.context.gl;this.tmp4x4.set(t),s.uniformMatrix4fv(this.getUniformLocation(e),!1,this.tmp4x4)}getUniformLocation(e){let t=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=t.getUniformLocation(this.program,e);if(!s&&!t.isContextLost())throw new Error(`Couldn't find location for uniform ${e}`);return s}getAttributeLocation(e){let t=this.context.gl;if(!this.program)throw new Error("Shader not compiled.");let s=t.getAttribLocation(this.program,e);if(s==-1&&!t.isContextLost())throw new Error(`Couldn't find location for attribute ${e}`);return s}dispose(){this.context.removeRestorable(this);let e=this.context.gl;this.vs&&(e.deleteShader(this.vs),this.vs=null),this.fs&&(e.deleteShader(this.fs),this.fs=null),this.program&&(e.deleteProgram(this.program),this.program=null)}static newColoredTextured(e){let t=`
attribute vec4 ${Le.POSITION};
attribute vec4 ${Le.COLOR};
attribute vec2 ${Le.TEXCOORDS};
uniform mat4 ${Le.MVP_MATRIX};
varying vec4 v_color;
varying vec2 v_texCoords;

void main () {
	v_color = ${Le.COLOR};
	v_texCoords = ${Le.TEXCOORDS};
	gl_Position = ${Le.MVP_MATRIX} * ${Le.POSITION};
}
`,s=`
#ifdef GL_ES
	#define LOWP lowp
	precision mediump float;
#else
	#define LOWP
#endif
varying LOWP vec4 v_color;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main () {
	gl_FragColor = v_color * texture2D(u_texture, v_texCoords);
}
`;return new Le(e,t,s)}static newTwoColoredTextured(e){let t=`
attribute vec4 ${Le.POSITION};
attribute vec4 ${Le.COLOR};
attribute vec4 ${Le.COLOR2};
attribute vec2 ${Le.TEXCOORDS};
uniform mat4 ${Le.MVP_MATRIX};
varying vec4 v_light;
varying vec4 v_dark;
varying vec2 v_texCoords;

void main () {
	v_light = ${Le.COLOR};
	v_dark = ${Le.COLOR2};
	v_texCoords = ${Le.TEXCOORDS};
	gl_Position = ${Le.MVP_MATRIX} * ${Le.POSITION};
}
`,s=`
#ifdef GL_ES
	#define LOWP lowp
	precision mediump float;
#else
	#define LOWP
#endif
varying LOWP vec4 v_light;
varying LOWP vec4 v_dark;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main () {
	vec4 texColor = texture2D(u_texture, v_texCoords);
	gl_FragColor.a = texColor.a * v_light.a;
	gl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;
}
`;return new Le(e,t,s)}static newColored(e){let t=`
attribute vec4 ${Le.POSITION};
attribute vec4 ${Le.COLOR};
uniform mat4 ${Le.MVP_MATRIX};
varying vec4 v_color;

void main () {
	v_color = ${Le.COLOR};
	gl_Position = ${Le.MVP_MATRIX} * ${Le.POSITION};
}
`,s=`
#ifdef GL_ES
	#define LOWP lowp
	precision mediump float;
#else
	#define LOWP
#endif
varying LOWP vec4 v_color;

void main () {
	gl_FragColor = v_color;
}
`;return new Le(e,t,s)}}class $o{attributes;context;vertices;verticesBuffer=null;verticesLength=0;dirtyVertices=!1;indices;indicesBuffer=null;indicesLength=0;dirtyIndices=!1;elementsPerVertex=0;getAttributes(){return this.attributes}maxVertices(){return this.vertices.length/this.elementsPerVertex}numVertices(){return this.verticesLength/this.elementsPerVertex}setVerticesLength(e){this.dirtyVertices=!0,this.verticesLength=e}getVertices(){return this.vertices}maxIndices(){return this.indices.length}numIndices(){return this.indicesLength}setIndicesLength(e){this.dirtyIndices=!0,this.indicesLength=e}getIndices(){return this.indices}getVertexSizeInFloats(){let e=0;for(var t=0;t<this.attributes.length;t++){let s=this.attributes[t];e+=s.numElements}return e}constructor(e,t,s,i){this.attributes=t,this.context=e instanceof vt?e:new vt(e),this.elementsPerVertex=0;for(let n=0;n<t.length;n++)this.elementsPerVertex+=t[n].numElements;this.vertices=new Float32Array(s*this.elementsPerVertex),this.indices=new Uint16Array(i),this.context.addRestorable(this)}setVertices(e){if(this.dirtyVertices=!0,e.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(e,0),this.verticesLength=e.length}setIndices(e){if(this.dirtyIndices=!0,e.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(e,0),this.indicesLength=e.length}draw(e,t){this.drawWithOffset(e,t,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}drawWithOffset(e,t,s,i){let n=this.context.gl;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(e),this.indicesLength>0?n.drawElements(t,i,n.UNSIGNED_SHORT,s*2):n.drawArrays(t,s,i),this.unbind(e)}bind(e){let t=this.context.gl;t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer);let s=0;for(let i=0;i<this.attributes.length;i++){let n=this.attributes[i],a=e.getAttributeLocation(n.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,n.numElements,t.FLOAT,!1,this.elementsPerVertex*4,s*4),s+=n.numElements}this.indicesLength>0&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}unbind(e){let t=this.context.gl;for(let s=0;s<this.attributes.length;s++){let i=this.attributes[s],n=e.getAttributeLocation(i.name);t.disableVertexAttribArray(n)}t.bindBuffer(t.ARRAY_BUFFER,null),this.indicesLength>0&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}update(){let e=this.context.gl;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),e.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),e.DYNAMIC_DRAW),this.dirtyIndices=!1)}restore(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}dispose(){this.context.removeRestorable(this);let e=this.context.gl;e.deleteBuffer(this.verticesBuffer),e.deleteBuffer(this.indicesBuffer)}}class on{name;type;numElements;constructor(e,t,s){this.name=e,this.type=t,this.numElements=s}}class $n extends on{constructor(){super(Le.POSITION,ei.Float,2)}}class qr extends on{constructor(e=0){super(Le.TEXCOORDS+(e==0?"":e),ei.Float,2)}}class Wn extends on{constructor(){super(Le.COLOR,ei.Float,4)}}class Bc extends on{constructor(){super(Le.COLOR2,ei.Float,4)}}var ei;(function(l){l[l.Float=0]="Float"})(ei||(ei={}));const ss=1,Nc=769,Jr=770,Kr=771,Zr=774;class Ts{static disableCulling=!1;context;drawCalls=0;static globalDrawCalls=0;isDrawing=!1;mesh;shader=null;lastTexture=null;verticesLength=0;indicesLength=0;srcColorBlend;srcAlphaBlend;dstBlend;cullWasEnabled=!1;constructor(e,t=!0,s=10920){if(s>10920)throw new Error("Can't have more than 10920 triangles per batch: "+s);this.context=e instanceof vt?e:new vt(e);let i=t?[new $n,new Wn,new qr,new Bc]:[new $n,new Wn,new qr];this.mesh=new $o(e,i,s,s*3);let n=this.context.gl;this.srcColorBlend=n.SRC_ALPHA,this.srcAlphaBlend=n.ONE,this.dstBlend=n.ONE_MINUS_SRC_ALPHA}begin(e){if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0,this.shader=e,this.lastTexture=null,this.isDrawing=!0;let t=this.context.gl;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}static blendModesGL=[{srcRgb:Jr,srcRgbPma:ss,dstRgb:Kr,srcAlpha:ss},{srcRgb:Jr,srcRgbPma:ss,dstRgb:ss,srcAlpha:ss},{srcRgb:Zr,srcRgbPma:Zr,dstRgb:Kr,srcAlpha:ss},{srcRgb:ss,srcRgbPma:ss,dstRgb:Nc,srcAlpha:ss}];setBlendMode(e,t){const s=Ts.blendModesGL[e],i=t?s.srcRgbPma:s.srcRgb,n=s.srcAlpha,a=s.dstRgb;if(this.srcColorBlend==i&&this.srcAlphaBlend==n&&this.dstBlend==a)return;this.srcColorBlend=i,this.srcAlphaBlend=n,this.dstBlend=a,this.isDrawing&&this.flush(),this.context.gl.blendFuncSeparate(i,a,n,a)}draw(e,t,s){e!=this.lastTexture?(this.flush(),this.lastTexture=e):(this.verticesLength+t.length>this.mesh.getVertices().length||this.indicesLength+s.length>this.mesh.getIndices().length)&&this.flush();let i=this.mesh.numVertices();this.mesh.getVertices().set(t,this.verticesLength),this.verticesLength+=t.length,this.mesh.setVerticesLength(this.verticesLength);let n=this.mesh.getIndices();for(let a=this.indicesLength,o=0;o<s.length;a++,o++)n[a]=s[o]+i;this.indicesLength+=s.length,this.mesh.setIndicesLength(this.indicesLength)}flush(){if(this.verticesLength!=0){if(!this.lastTexture)throw new Error("No texture set.");if(!this.shader)throw new Error("No shader set.");this.lastTexture.bind(),this.mesh.draw(this.shader,this.context.gl.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++,Ts.globalDrawCalls++}}end(){if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader=null,this.lastTexture=null,this.isDrawing=!1;let e=this.context.gl;e.disable(e.BLEND)}getDrawCalls(){return this.drawCalls}static getAndResetGlobalDrawCalls(){let e=Ts.globalDrawCalls;return Ts.globalDrawCalls=0,e}dispose(){this.mesh.dispose()}}class Qr{context;isDrawing=!1;mesh;shapeType=dt.Filled;color=new ue(1,1,1,1);shader=null;vertexIndex=0;tmp=new Zs;srcColorBlend;srcAlphaBlend;dstBlend;constructor(e,t=10920){if(t>10920)throw new Error("Can't have more than 10920 triangles per batch: "+t);this.context=e instanceof vt?e:new vt(e),this.mesh=new $o(e,[new $n,new Wn],t,0);let s=this.context.gl;this.srcColorBlend=s.SRC_ALPHA,this.srcAlphaBlend=s.ONE,this.dstBlend=s.ONE_MINUS_SRC_ALPHA}begin(e){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.shader=e,this.vertexIndex=0,this.isDrawing=!0;let t=this.context.gl;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}setBlendMode(e,t,s){this.srcColorBlend=e,this.srcAlphaBlend=t,this.dstBlend=s,this.isDrawing&&(this.flush(),this.context.gl.blendFuncSeparate(e,s,t,s))}setColor(e){this.color.setFromColor(e)}setColorWith(e,t,s,i){this.color.set(e,t,s,i)}point(e,t,s){this.check(dt.Point,1),s||(s=this.color),this.vertex(e,t,s)}line(e,t,s,i,n){this.check(dt.Line,2),this.mesh.getVertices(),this.vertexIndex,n||(n=this.color),this.vertex(e,t,n),this.vertex(s,i,n)}triangle(e,t,s,i,n,a,o,r,h,c){this.check(e?dt.Filled:dt.Line,3),this.mesh.getVertices(),this.vertexIndex,r||(r=this.color),h||(h=this.color),c||(c=this.color),e?(this.vertex(t,s,r),this.vertex(i,n,h),this.vertex(a,o,c)):(this.vertex(t,s,r),this.vertex(i,n,h),this.vertex(i,n,r),this.vertex(a,o,h),this.vertex(a,o,r),this.vertex(t,s,h))}quad(e,t,s,i,n,a,o,r,h,c,d,g,u){this.check(e?dt.Filled:dt.Line,3),this.mesh.getVertices(),this.vertexIndex,c||(c=this.color),d||(d=this.color),g||(g=this.color),u||(u=this.color),e?(this.vertex(t,s,c),this.vertex(i,n,d),this.vertex(a,o,g),this.vertex(a,o,g),this.vertex(r,h,u),this.vertex(t,s,c)):(this.vertex(t,s,c),this.vertex(i,n,d),this.vertex(i,n,d),this.vertex(a,o,g),this.vertex(a,o,g),this.vertex(r,h,u),this.vertex(r,h,u),this.vertex(t,s,c))}rect(e,t,s,i,n,a){this.quad(e,t,s,t+i,s,t+i,s+n,t,s+n,a,a,a,a)}rectLine(e,t,s,i,n,a,o){this.check(e?dt.Filled:dt.Line,8),o||(o=this.color);let r=this.tmp.set(n-s,t-i);r.normalize(),a*=.5;let h=r.x*a,c=r.y*a;e?(this.vertex(t+h,s+c,o),this.vertex(t-h,s-c,o),this.vertex(i+h,n+c,o),this.vertex(i-h,n-c,o),this.vertex(i+h,n+c,o),this.vertex(t-h,s-c,o)):(this.vertex(t+h,s+c,o),this.vertex(t-h,s-c,o),this.vertex(i+h,n+c,o),this.vertex(i-h,n-c,o),this.vertex(i+h,n+c,o),this.vertex(t+h,s+c,o),this.vertex(i-h,n-c,o),this.vertex(t-h,s-c,o))}x(e,t,s){this.line(e-s,t-s,e+s,t+s),this.line(e-s,t+s,e+s,t-s)}polygon(e,t,s,i){if(s<3)throw new Error("Polygon must contain at least 3 vertices");this.check(dt.Line,s*2),i||(i=this.color),this.mesh.getVertices(),this.vertexIndex,t<<=1,s<<=1;let n=e[t],a=e[t+1],o=t+s;for(let r=t,h=t+s-2;r<h;r+=2){let c=e[r],d=e[r+1],g=0,u=0;r+2>=o?(g=n,u=a):(g=e[r+2],u=e[r+3]),this.vertex(c,d,i),this.vertex(g,u,i)}}circle(e,t,s,i,n,a=0){if(a==0&&(a=Math.max(1,6*te.cbrt(i)|0)),a<=0)throw new Error("segments must be > 0.");n||(n=this.color);let o=2*te.PI/a,r=Math.cos(o),h=Math.sin(o),c=i,d=0;if(e){this.check(dt.Filled,a*3+3),a--;for(let g=0;g<a;g++){this.vertex(t,s,n),this.vertex(t+c,s+d,n);let u=c;c=r*c-h*d,d=h*u+r*d,this.vertex(t+c,s+d,n)}this.vertex(t,s,n),this.vertex(t+c,s+d,n)}else{this.check(dt.Line,a*2+2);for(let g=0;g<a;g++){this.vertex(t+c,s+d,n);let u=c;c=r*c-h*d,d=h*u+r*d,this.vertex(t+c,s+d,n)}this.vertex(t+c,s+d,n)}c=i,d=0,this.vertex(t+c,s+d,n)}curve(e,t,s,i,n,a,o,r,h,c){this.check(dt.Line,h*2+2),c||(c=this.color);let d=1/h,g=d*d,u=d*d*d,m=3*d,y=3*g,b=6*g,E=6*u,v=e-s*2+n,S=t-i*2+a,x=(s-n)*3-e+o,A=(i-a)*3-t+r,C=e,k=t,_=(s-e)*m+v*y+x*u,L=(i-t)*m+S*y+A*u,N=v*b+x*E,V=S*b+A*E,W=x*E,O=A*E;for(;h-- >0;)this.vertex(C,k,c),C+=_,k+=L,_+=N,L+=V,N+=W,V+=O,this.vertex(C,k,c);this.vertex(C,k,c),this.vertex(o,r,c)}vertex(e,t,s){let i=this.vertexIndex,n=this.mesh.getVertices();n[i++]=e,n[i++]=t,n[i++]=s.r,n[i++]=s.g,n[i++]=s.b,n[i++]=s.a,this.vertexIndex=i}end(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();let e=this.context.gl;e.disable(e.BLEND),this.isDrawing=!1}flush(){if(this.vertexIndex!=0){if(!this.shader)throw new Error("No shader set.");this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0}}check(e,t){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType==e)if(this.mesh.maxVertices()-this.mesh.numVertices()<t)this.flush();else return;else this.flush(),this.shapeType=e}dispose(){this.mesh.dispose()}}var dt;(function(l){l[l.Point=0]="Point",l[l.Line=1]="Line",l[l.Filled=4]="Filled"})(dt||(dt={}));class qi{boneLineColor=new ue(1,0,0,1);boneOriginColor=new ue(0,1,0,1);attachmentLineColor=new ue(0,0,1,.5);triangleLineColor=new ue(1,.64,0,.5);pathColor=new ue().setFromString("FF7F00");clipColor=new ue(.8,0,0,2);aabbColor=new ue(0,1,0,.5);drawBones=!0;drawRegionAttachments=!0;drawBoundingBoxes=!0;drawMeshHull=!0;drawMeshTriangles=!0;drawPaths=!0;drawSkeletonXY=!1;drawClipping=!0;premultipliedAlpha=!1;scale=1;boneWidth=2;context;bounds=new kc;temp=new Array;vertices=se.newFloatArray(2*1024);static LIGHT_GRAY=new ue(192/255,192/255,192/255,1);static GREEN=new ue(0,1,0,1);constructor(e){this.context=e instanceof vt?e:new vt(e)}draw(e,t,s){let i=t.x,n=t.y,a=this.context.gl,o=this.premultipliedAlpha?a.ONE:a.SRC_ALPHA;e.setBlendMode(o,a.ONE,a.ONE_MINUS_SRC_ALPHA);let r=t.bones;if(this.drawBones){e.setColor(this.boneLineColor);for(let h=0,c=r.length;h<c;h++){let d=r[h];if(s&&s.indexOf(d.data.name)>-1||!d.parent)continue;let g=d.data.length*d.a+d.worldX,u=d.data.length*d.c+d.worldY;e.rectLine(!0,d.worldX,d.worldY,g,u,this.boneWidth*this.scale)}this.drawSkeletonXY&&e.x(i,n,4*this.scale)}if(this.drawRegionAttachments){e.setColor(this.attachmentLineColor);let h=t.slots;for(let c=0,d=h.length;c<d;c++){let g=h[c],u=g.getAttachment();if(u instanceof Xe){let m=u,y=this.vertices;m.computeWorldVertices(g,y,0,2),e.line(y[0],y[1],y[2],y[3]),e.line(y[2],y[3],y[4],y[5]),e.line(y[4],y[5],y[6],y[7]),e.line(y[6],y[7],y[0],y[1])}}}if(this.drawMeshHull||this.drawMeshTriangles){let h=t.slots;for(let c=0,d=h.length;c<d;c++){let g=h[c];if(!g.bone.active)continue;let u=g.getAttachment();if(!(u instanceof os))continue;let m=u,y=this.vertices;m.computeWorldVertices(g,0,m.worldVerticesLength,y,0,2);let b=m.triangles,E=m.hullLength;if(this.drawMeshTriangles){e.setColor(this.triangleLineColor);for(let v=0,S=b.length;v<S;v+=3){let x=b[v]*2,A=b[v+1]*2,C=b[v+2]*2;e.triangle(!1,y[x],y[x+1],y[A],y[A+1],y[C],y[C+1])}}if(this.drawMeshHull&&E>0){e.setColor(this.attachmentLineColor),E=(E>>1)*2;let v=y[E-2],S=y[E-1];for(let x=0,A=E;x<A;x+=2){let C=y[x],k=y[x+1];e.line(C,k,v,S),v=C,S=k}}}}if(this.drawBoundingBoxes){let h=this.bounds;h.update(t,!0),e.setColor(this.aabbColor),e.rect(!1,h.minX,h.minY,h.getWidth(),h.getHeight());let c=h.polygons,d=h.boundingBoxes;for(let g=0,u=c.length;g<u;g++){let m=c[g];e.setColor(d[g].color),e.polygon(m,0,m.length)}}if(this.drawPaths){let h=t.slots;for(let c=0,d=h.length;c<d;c++){let g=h[c];if(!g.bone.active)continue;let u=g.getAttachment();if(!(u instanceof Ps))continue;let m=u,y=m.worldVerticesLength,b=this.temp=se.setArraySize(this.temp,y,0);m.computeWorldVertices(g,0,y,b,0,2);let E=this.pathColor,v=b[2],S=b[3],x=0,A=0;if(m.closed){e.setColor(E);let C=b[0],k=b[1],_=b[y-2],L=b[y-1];x=b[y-4],A=b[y-3],e.curve(v,S,C,k,_,L,x,A,32),e.setColor(qi.LIGHT_GRAY),e.line(v,S,C,k),e.line(x,A,_,L)}y-=4;for(let C=4;C<y;C+=6){let k=b[C],_=b[C+1],L=b[C+2],N=b[C+3];x=b[C+4],A=b[C+5],e.setColor(E),e.curve(v,S,k,_,L,N,x,A,32),e.setColor(qi.LIGHT_GRAY),e.line(v,S,k,_),e.line(x,A,L,N),v=x,S=A}}}if(this.drawBones){e.setColor(this.boneOriginColor);for(let h=0,c=r.length;h<c;h++){let d=r[h];s&&s.indexOf(d.data.name)>-1||e.circle(!0,d.worldX,d.worldY,3*this.scale,this.boneOriginColor,8)}}if(this.drawClipping){let h=t.slots;e.setColor(this.clipColor);for(let c=0,d=h.length;c<d;c++){let g=h[c];if(!g.bone.active)continue;let u=g.getAttachment();if(!(u instanceof ii))continue;let m=u,y=m.worldVerticesLength,b=this.temp=se.setArraySize(this.temp,y,0);m.computeWorldVertices(g,0,y,b,0,2);for(let E=0,v=b.length;E<v;E+=2){let S=b[E],x=b[E+1],A=b[(E+2)%b.length],C=b[(E+3)%b.length];e.line(S,x,A,C)}}}}dispose(){}}class Yc{vertices;numVertices;numFloats;constructor(e,t,s){this.vertices=e,this.numVertices=t,this.numFloats=s}}class hr{static QUAD_TRIANGLES=[0,1,2,2,3,0];premultipliedAlpha=!1;tempColor=new ue;tempColor2=new ue;vertices;vertexSize=8;twoColorTint=!1;renderable=new Yc([],0,0);clipper=new mi;temp=new Zs;temp2=new Zs;temp3=new ue;temp4=new ue;constructor(e,t=!0){this.twoColorTint=t,t&&(this.vertexSize+=4),this.vertices=se.newFloatArray(this.vertexSize*1024)}draw(e,t,s=-1,i=-1,n=null){let a=this.clipper,o=this.premultipliedAlpha,r=this.twoColorTint,h=null,c=this.renderable,d,g,u=t.drawOrder,m,y=t.color,b=r?12:8,E=!1;s==-1&&(E=!0);for(let v=0,S=u.length;v<S;v++){let x=a.isClipping()?2:b,A=u[v];if(!A.bone.active){a.clipEndWithSlot(A);continue}if(s>=0&&s==A.data.index&&(E=!0),!E){a.clipEndWithSlot(A);continue}i>=0&&i==A.data.index&&(E=!1);let C=A.getAttachment(),k;if(C instanceof Xe){let _=C;c.vertices=this.vertices,c.numVertices=4,c.numFloats=x<<2,_.computeWorldVertices(A,c.vertices,0,x),g=hr.QUAD_TRIANGLES,d=_.uvs,k=_.region.texture,m=_.color}else if(C instanceof os){let _=C;c.vertices=this.vertices,c.numVertices=_.worldVerticesLength>>1,c.numFloats=c.numVertices*x,c.numFloats>c.vertices.length&&(c.vertices=this.vertices=se.newFloatArray(c.numFloats)),_.computeWorldVertices(A,0,_.worldVerticesLength,c.vertices,0,x),g=_.triangles,k=_.region.texture,d=_.uvs,m=_.color}else if(C instanceof ii){let _=C;a.clipStart(A,_);continue}else{a.clipEndWithSlot(A);continue}if(k){let _=A.color,L=this.tempColor;L.r=y.r*_.r*m.r,L.g=y.g*_.g*m.g,L.b=y.b*_.b*m.b,L.a=y.a*_.a*m.a,o&&(L.r*=L.a,L.g*=L.a,L.b*=L.a);let N=this.tempColor2;A.darkColor?(o?(N.r=A.darkColor.r*L.a,N.g=A.darkColor.g*L.a,N.b=A.darkColor.b*L.a):N.setFromColor(A.darkColor),N.a=o?1:0):N.set(0,0,0,1);let V=A.data.blendMode;if(V!=h&&(h=V,e.setBlendMode(h,o)),a.isClipping()){a.clipTriangles(c.vertices,g,g.length,d,L,N,r);let W=new Float32Array(a.clippedVertices),O=a.clippedTriangles;n&&n(W,W.length,b),e.draw(k,W,O)}else{let W=c.vertices;if(r)for(let R=2,M=0,F=c.numFloats;R<F;R+=b,M+=2)W[R]=L.r,W[R+1]=L.g,W[R+2]=L.b,W[R+3]=L.a,W[R+4]=d[M],W[R+5]=d[M+1],W[R+6]=N.r,W[R+7]=N.g,W[R+8]=N.b,W[R+9]=N.a;else for(let R=2,M=0,F=c.numFloats;R<F;R+=b,M+=2)W[R]=L.r,W[R+1]=L.g,W[R+2]=L.b,W[R+3]=L.a,W[R+4]=d[M],W[R+5]=d[M+1];let O=c.vertices.subarray(0,c.numFloats);n&&n(c.vertices,c.numFloats,b),e.draw(k,O,g)}}a.clipEndWithSlot(A)}a.clipEnd()}getSkeletonClipping(){return this.clipper}}const D=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0],ki=[0,1,2,2,3,0],Pi=new ue(1,1,1,1);class Xc{context;canvas;camera;batcher;twoColorTint=!1;batcherShader;shapes;shapesShader;activeRenderer=null;skeletonRenderer;skeletonDebugRenderer;constructor(e,t,s=!0){this.canvas=e,this.context=t instanceof vt?t:new vt(t),this.twoColorTint=s,this.camera=new Dc(e.width,e.height),this.batcherShader=s?Le.newTwoColoredTextured(this.context):Le.newColoredTextured(this.context),this.batcher=new Ts(this.context,s),this.shapesShader=Le.newColored(this.context),this.shapes=new Qr(this.context),this.skeletonRenderer=new hr(this.context,s),this.skeletonDebugRenderer=new qi(this.context)}dispose(){this.batcher.dispose(),this.batcherShader.dispose(),this.shapes.dispose(),this.shapesShader.dispose(),this.skeletonDebugRenderer.dispose()}begin(){this.camera.update(),this.enableRenderer(this.batcher)}drawSkeleton(e,t=!1,s=-1,i=-1,n=null){this.enableRenderer(this.batcher),this.skeletonRenderer.premultipliedAlpha=t,this.skeletonRenderer.draw(this.batcher,e,s,i,n)}drawSkeletonDebug(e,t=!1,s){this.enableRenderer(this.shapes),this.skeletonDebugRenderer.premultipliedAlpha=t,this.skeletonDebugRenderer.draw(this.shapes,e,s)}drawTexture(e,t,s,i,n,a){this.enableRenderer(this.batcher),a||(a=Pi);var o=0;D[o++]=t,D[o++]=s,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=0,D[o++]=1,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t+i,D[o++]=s,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=1,D[o++]=1,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t+i,D[o++]=s+n,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=1,D[o++]=0,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t,D[o++]=s+n,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=0,D[o++]=0,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o]=0),this.batcher.draw(e,D,ki)}drawTextureUV(e,t,s,i,n,a,o,r,h,c){this.enableRenderer(this.batcher),c||(c=Pi);var d=0;D[d++]=t,D[d++]=s,D[d++]=c.r,D[d++]=c.g,D[d++]=c.b,D[d++]=c.a,D[d++]=a,D[d++]=o,this.twoColorTint&&(D[d++]=0,D[d++]=0,D[d++]=0,D[d++]=0),D[d++]=t+i,D[d++]=s,D[d++]=c.r,D[d++]=c.g,D[d++]=c.b,D[d++]=c.a,D[d++]=r,D[d++]=o,this.twoColorTint&&(D[d++]=0,D[d++]=0,D[d++]=0,D[d++]=0),D[d++]=t+i,D[d++]=s+n,D[d++]=c.r,D[d++]=c.g,D[d++]=c.b,D[d++]=c.a,D[d++]=r,D[d++]=h,this.twoColorTint&&(D[d++]=0,D[d++]=0,D[d++]=0,D[d++]=0),D[d++]=t,D[d++]=s+n,D[d++]=c.r,D[d++]=c.g,D[d++]=c.b,D[d++]=c.a,D[d++]=a,D[d++]=h,this.twoColorTint&&(D[d++]=0,D[d++]=0,D[d++]=0,D[d]=0),this.batcher.draw(e,D,ki)}drawTextureRotated(e,t,s,i,n,a,o,r,h){this.enableRenderer(this.batcher),h||(h=Pi);let c=t+a,d=s+o,g=-a,u=-o,m=i-a,y=n-o,b=g,E=u,v=g,S=y,x=m,A=y,C=m,k=u,_=0,L=0,N=0,V=0,W=0,O=0,R=0,M=0;if(r!=0){let H=te.cosDeg(r),Z=te.sinDeg(r);_=H*b-Z*E,L=Z*b+H*E,R=H*v-Z*S,M=Z*v+H*S,W=H*x-Z*A,O=Z*x+H*A,N=W+(_-R),V=O+(L-M)}else _=b,L=E,R=v,M=S,W=x,O=A,N=C,V=k;_+=c,L+=d,N+=c,V+=d,W+=c,O+=d,R+=c,M+=d;var F=0;D[F++]=_,D[F++]=L,D[F++]=h.r,D[F++]=h.g,D[F++]=h.b,D[F++]=h.a,D[F++]=0,D[F++]=1,this.twoColorTint&&(D[F++]=0,D[F++]=0,D[F++]=0,D[F++]=0),D[F++]=N,D[F++]=V,D[F++]=h.r,D[F++]=h.g,D[F++]=h.b,D[F++]=h.a,D[F++]=1,D[F++]=1,this.twoColorTint&&(D[F++]=0,D[F++]=0,D[F++]=0,D[F++]=0),D[F++]=W,D[F++]=O,D[F++]=h.r,D[F++]=h.g,D[F++]=h.b,D[F++]=h.a,D[F++]=1,D[F++]=0,this.twoColorTint&&(D[F++]=0,D[F++]=0,D[F++]=0,D[F++]=0),D[F++]=R,D[F++]=M,D[F++]=h.r,D[F++]=h.g,D[F++]=h.b,D[F++]=h.a,D[F++]=0,D[F++]=0,this.twoColorTint&&(D[F++]=0,D[F++]=0,D[F++]=0,D[F]=0),this.batcher.draw(e,D,ki)}drawRegion(e,t,s,i,n,a){this.enableRenderer(this.batcher),a||(a=Pi);var o=0;D[o++]=t,D[o++]=s,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=e.u,D[o++]=e.v2,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t+i,D[o++]=s,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=e.u2,D[o++]=e.v2,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t+i,D[o++]=s+n,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=e.u2,D[o++]=e.v,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o++]=0),D[o++]=t,D[o++]=s+n,D[o++]=a.r,D[o++]=a.g,D[o++]=a.b,D[o++]=a.a,D[o++]=e.u,D[o++]=e.v,this.twoColorTint&&(D[o++]=0,D[o++]=0,D[o++]=0,D[o]=0),this.batcher.draw(e.page.texture,D,ki)}line(e,t,s,i,n,a){this.enableRenderer(this.shapes),this.shapes.line(e,t,s,i,n)}triangle(e,t,s,i,n,a,o,r,h,c){this.enableRenderer(this.shapes),this.shapes.triangle(e,t,s,i,n,a,o,r,h,c)}quad(e,t,s,i,n,a,o,r,h,c,d,g,u){this.enableRenderer(this.shapes),this.shapes.quad(e,t,s,i,n,a,o,r,h,c,d,g,u)}rect(e,t,s,i,n,a){this.enableRenderer(this.shapes),this.shapes.rect(e,t,s,i,n,a)}rectLine(e,t,s,i,n,a,o){this.enableRenderer(this.shapes),this.shapes.rectLine(e,t,s,i,n,a,o)}polygon(e,t,s,i){this.enableRenderer(this.shapes),this.shapes.polygon(e,t,s,i)}circle(e,t,s,i,n,a=0){this.enableRenderer(this.shapes),this.shapes.circle(e,t,s,i,n,a)}curve(e,t,s,i,n,a,o,r,h,c){this.enableRenderer(this.shapes),this.shapes.curve(e,t,s,i,n,a,o,r,h,c)}end(){this.activeRenderer===this.batcher?this.batcher.end():this.activeRenderer===this.shapes&&this.shapes.end(),this.activeRenderer=null}resize(e){let t=this.canvas;var s=window.devicePixelRatio||1,i=Math.round(t.clientWidth*s),n=Math.round(t.clientHeight*s);if((t.width!=i||t.height!=n)&&(t.width=i,t.height=n),this.context.gl.viewport(0,0,t.width,t.height),e===Ji.Expand)this.camera.setViewport(i,n);else if(e===Ji.Fit){let a=t.width,o=t.height,r=this.camera.viewportWidth,h=this.camera.viewportHeight,c=h/r,d=o/a,g=c<d?r/a:h/o;this.camera.setViewport(a*g,o*g)}this.camera.update()}enableRenderer(e){this.activeRenderer!==e&&(this.end(),e instanceof Ts?(this.batcherShader.bind(),this.batcherShader.setUniform4x4f(Le.MVP_MATRIX,this.camera.projectionView.values),this.batcherShader.setUniformi("u_texture",0),this.batcher.begin(this.batcherShader),this.activeRenderer=this.batcher):e instanceof Qr?(this.shapesShader.bind(),this.shapesShader.setUniform4x4f(Le.MVP_MATRIX,this.camera.projectionView.values),this.shapes.begin(this.shapesShader),this.activeRenderer=this.shapes):this.activeRenderer=this.skeletonDebugRenderer)}}var Ji;(function(l){l[l.Stretch=0]="Stretch",l[l.Expand=1]="Expand",l[l.Fit=2]="Fit"})(Ji||(Ji={}));const Uc="esotericsoftware.spine.skeletonFile.cache",Vc="esotericsoftware.spine.atlas.cache",zc="spineSkeletonData",jc="spineAtlasData",qn="spine";let bs=Phaser.GameObjects.Components;const Gc=bs.ComputedSize,Hc=bs.Depth,$c=bs.Flip,Wc=bs.ScrollFactor,qc=bs.Transform,Jc=bs.Visible,Kc=bs.Origin,Zc=bs.Alpha;function ws(...l){return e=>(Phaser.Class.mixin(e,l),e)}const Qc=ws(Gc),ed=ws(Hc),td=ws($c),sd=ws(Wc),id=ws(qc),nd=ws(Jc),rd=ws(Kc),ad=ws(Zc);class od extends Phaser.GameObjects.GameObject{constructor(e,t){super(e,t)}}class ld{clipping;constructor(e=!1){this.clipping=e}calculateBounds(e){if(!e.skeleton)return{x:0,y:0,width:0,height:0};const t=new _s(e.skeleton.data);t.setToSetupPose(),t.updateWorldTransform(Lt.update);const s=t.getBoundsRect(this.clipping?new mi:void 0);return s.width==Number.NEGATIVE_INFINITY?{x:0,y:0,width:0,height:0}:s}}class ea extends ed(rd(Qc(td(sd(id(nd(ad(od)))))))){plugin;boundsProvider;blendMode=-1;skeleton;animationStateData;animationState;beforeUpdateWorldTransforms=()=>{};afterUpdateWorldTransforms=()=>{};premultipliedAlpha=!1;offsetX=0;offsetY=0;constructor(e,t,s,i,n,a,o=new ld){super(e,window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:qn),this.plugin=t,this.boundsProvider=o,this.setPosition(s,i),this.premultipliedAlpha=this.plugin.isAtlasPremultiplied(a),this.skeleton=this.plugin.createSkeleton(n,a),this.animationStateData=new Xh(this.skeleton.data),this.animationState=new ui(this.animationStateData),this.skeleton.updateWorldTransform(Lt.update),this.updateSize()}updateSize(){if(!this.skeleton)return;let e=this.boundsProvider.calculateBounds(this);this.width=e.width,this.height=e.height,this.setDisplayOrigin(-e.x,-e.y),this.offsetX=-e.x,this.offsetY=-e.y}skeletonToPhaserWorldCoordinates(e){let t=this.getWorldTransformMatrix(),s=t.a,i=t.b,n=t.c,a=t.d,o=t.tx,r=t.ty,h=e.x,c=e.y;e.x=h*s+c*n+o,e.y=h*i+c*a+r}phaserWorldCoordinatesToSkeleton(e){let t=this.getWorldTransformMatrix();t=t.invert();let s=t.a,i=t.b,n=t.c,a=t.d,o=t.tx,r=t.ty,h=e.x,c=e.y;e.x=h*s+c*n+o,e.y=h*i+c*a+r}phaserWorldCoordinatesToBone(e,t){this.phaserWorldCoordinatesToSkeleton(e),t.parent?t.parent.worldToLocal(e):t.worldToLocal(e)}updatePose(e){this.animationState.update(e/1e3),this.animationState.apply(this.skeleton),this.beforeUpdateWorldTransforms(this),this.skeleton.update(e/1e3),this.skeleton.updateWorldTransform(Lt.update),this.afterUpdateWorldTransforms(this)}preUpdate(e,t){!this.skeleton||!this.animationState||this.updatePose(t)}preDestroy(){}willRender(e){var t=15,s=!this.skeleton||!(t!==this.renderFlags||this.cameraFilter!==0&&this.cameraFilter&e.id);if(this.visible||(s=!1),!s&&this.parentContainer&&this.plugin.webGLRenderer){var i=this.plugin.webGLRenderer;this.plugin.gl&&this.plugin.phaserRenderer instanceof Phaser.Renderer.WebGL.WebGLRenderer&&i.batcher.isDrawing&&(i.end(),this.plugin.phaserRenderer.pipelines.rebind())}return s}renderWebGL(e,t,s,i){if(!this.skeleton||!this.animationState||!this.plugin.webGLRenderer)return;let n=this.plugin.webGLRenderer;e.newType&&(e.pipelines.clear(),n.begin()),s.addToRenderList(t);let a=Phaser.GameObjects.GetCalcMatrix(t,s,i).calc,o=a.a,r=a.b,h=a.c,c=a.d,d=a.tx,g=a.ty,u=t.offsetX-t.displayOriginX,m=t.offsetY-t.displayOriginY;n.drawSkeleton(t.skeleton,t.premultipliedAlpha,-1,-1,(y,b,E)=>{for(let v=0;v<b;v+=E){let S=y[v]+u,x=y[v+1]+m;y[v]=S*o+x*h+d,y[v+1]=S*r+x*c+g}}),e.nextTypeMatch||(n.end(),e.pipelines.rebind())}renderCanvas(e,t,s,i){if(!this.skeleton||!this.animationState||!this.plugin.canvasRenderer)return;let n=e.currentContext,a=this.plugin.canvasRenderer;a.ctx=n,s.addToRenderList(t);let o=Phaser.GameObjects.GetCalcMatrix(t,s,i).calc,r=this.skeleton;r.x=o.tx,r.y=o.ty,r.scaleX=o.scaleX,r.scaleY=o.scaleY;let h=r.getRootBone();h.rotation=-57.29577866666166*o.rotationNormalized,this.skeleton.updateWorldTransform(Lt.update),n.save(),a.draw(r),n.restore()}}_s.yDown=!0;class Rs extends mt.Plugins.ScenePlugin{game;isWebGL;gl;static gameWebGLRenderer=null;get webGLRenderer(){return Rs.gameWebGLRenderer}canvasRenderer;phaserRenderer;skeletonDataCache;atlasCache;constructor(e,t,s){super(e,t,s),this.game=t.game,this.isWebGL=this.game.config.renderType===2,this.gl=this.isWebGL?this.game.renderer.gl:null,this.phaserRenderer=this.game.renderer,this.canvasRenderer=null,this.skeletonDataCache=this.game.cache.addCustom(Uc),this.atlasCache=this.game.cache.addCustom(Vc);let i=function(h,c,d){let g=new ta(this,h,c,Os.json,d);return this.addFile(g.files),this};t.registerFileType("spineJson",i,e);let n=function(h,c,d){let g=new ta(this,h,c,Os.binary,d);return this.addFile(g.files),this};t.registerFileType("spineBinary",n,e);let a=function(h,c,d,g){let u=new hd(this,h,c,d,g);return this.addFile(u.files),this};t.registerFileType("spineAtlas",a,e);let o=function(h,c,d,g,u){this.scene.sys.renderer instanceof mt.Renderer.WebGL.WebGLRenderer&&this.scene.sys.renderer.pipelines.clear();const m=this.scene.sys[s];let y=new ea(this.scene,m,h,c,d,g,u);return this.displayList.add(y),this.updateList.add(y),this.scene.sys.renderer instanceof mt.Renderer.WebGL.WebGLRenderer&&this.scene.sys.renderer.pipelines.rebind(),y},r=function(h,c=!1){this.scene.sys.renderer instanceof mt.Renderer.WebGL.WebGLRenderer&&this.scene.sys.renderer.pipelines.clear();let d=h.x?h.x:0,g=h.y?h.y:0,u=h.boundsProvider?h.boundsProvider:void 0;const m=this.scene.sys[s];let y=new ea(this.scene,m,d,g,h.dataKey,h.atlasKey,u);return c!==void 0&&(h.add=c),this.scene.sys.renderer instanceof mt.Renderer.WebGL.WebGLRenderer&&this.scene.sys.renderer.pipelines.rebind(),mt.GameObjects.BuildGameObject(this.scene,y,h)};t.registerGameObject(window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:qn,o,r)}static rendererId=0;boot(){this.isWebGL&&this.gl?Rs.gameWebGLRenderer||=new Xc(this.game.renderer.canvas,this.gl,!0):this.scene&&(this.canvasRenderer||=new Fc(this.scene.sys.context)),this.onResize(),this.systems&&(this.systems.events.once("destroy",this.destroy,this),this.systems.events.on("start",this.onStart,this),this.systems.events.on("shutdown",this.shutdown,this)),this.game.events.once("destroy",this.gameDestroy,this)}onResize(){const e=this.game.renderer,t=this.webGLRenderer;if(e&&t){const s=e.width,i=e.height;t.camera.position.x=s/2,t.camera.position.y=i/2,t.camera.up.y=-1,t.camera.direction.z=1,t.camera.setViewport(s,i)}}onStart(){this.game.scale.on(mt.Scale.Events.RESIZE,this.onResize,this)}shutdown(){this.isWebGL&&this.game.scale.off(mt.Scale.Events.RESIZE,this.onResize,this)}destroy(){this.shutdown(),this.systems?.events.off("start",this.onStart,this),this.systems?.events.off("shutdown",this.shutdown,this)}gameDestroy(){this.pluginManager.removeGameObject(window.SPINE_GAME_OBJECT_TYPE?window.SPINE_GAME_OBJECT_TYPE:qn,!0,!0),this.webGLRenderer&&this.webGLRenderer.dispose(),Rs.gameWebGLRenderer=null}getAtlas(e){let t;if(this.atlasCache.exists(e))t=this.atlasCache.get(e);else{let s=this.game.cache.text.get(e);if(t=new Vh(s.data),this.isWebGL){let i=this.gl;const n=i.getParameter(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL);n&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);for(let a of t.pages)a.setTexture(new Wi(i,this.game.textures.get(e+"!"+a.name).getSourceImage(),!1));n&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)}else for(let i of t.pages)i.setTexture(new Mc(this.game.textures.get(e+"!"+i.name).getSourceImage()));this.atlasCache.add(e,t)}return t}isAtlasPremultiplied(e){let t=this.game.cache.text.get(e);return t?t.premultipliedAlpha:!1}getSkeletonData(e,t){const s=this.getAtlas(t),i=e+t;let n;if(this.skeletonDataCache.exists(i))n=this.skeletonDataCache.get(i);else{if(this.game.cache.json.exists(e)){let a=this.game.cache.json.get(e);n=new Pc(new Hr(s)).readSkeletonData(a)}else{let a=this.game.cache.binary.get(e);n=new qh(new Hr(s)).readSkeletonData(new Uint8Array(a))}this.skeletonDataCache.add(i,n)}return n}createSkeleton(e,t){return new _s(this.getSkeletonData(e,t))}}var Os;(function(l){l[l.json=0]="json",l[l.binary=1]="binary"})(Os||(Os={}));class ta extends mt.Loader.MultiFile{fileType;constructor(e,t,s,i,n){if(typeof t!="string"){const r=t;t=r.key,s=r.url,i=r.type==="spineJson"?Os.json:Os.binary,n=r.xhrSettings}let a=null;i==Os.json?a=new mt.Loader.FileTypes.JSONFile(e,{key:t,url:s,extension:"json",xhrSettings:n}):a=new mt.Loader.FileTypes.BinaryFile(e,{key:t,url:s,extension:"skel",xhrSettings:n}),super(e,zc,t,[a]),this.fileType=i}onFileComplete(e){this.pending--}addToCache(){this.isReadyToProcess()&&this.files[0].addToCache()}}class hd extends mt.Loader.MultiFile{premultipliedAlpha;constructor(e,t,s,i,n){if(typeof t!="string"){const a=t;t=a.key,s=a.url,i=a.premultipliedAlpha,n=a.xhrSettings}super(e,jc,t,[new mt.Loader.FileTypes.TextFile(e,{key:t,url:s,xhrSettings:n,extension:"atlas"})]),this.premultipliedAlpha=i}onFileComplete(e){if(this.files.indexOf(e)!=-1&&(this.pending--,e.type=="text")){var t=e.data.split(/\r\n|\r|\n/);let h=[];h.push(t[0]);for(var s=1;s<t.length;s++){var i=t[s];i.trim()===""&&s<t.length-1&&(i=t[s+1],h.push(i))}let c=e.url;typeof c=="object"&&(c=e.src);let d=(c.match(/^.*\//)??"").toString();this.loader.path&&this.loader.path.length>0&&d.startsWith(this.loader.path)&&(d=d.slice(this.loader.path.length));for(var n=0;n<h.length;n++){var a=d+h[n],o=e.key+"!"+h[n],r=new mt.Loader.FileTypes.ImageFile(this.loader,o,a);this.loader.keyExists(r)||(this.addToMultiFile(r),this.loader.addFile(r))}}}addToCache(){if(this.isReadyToProcess()){let e=this.loader.textureManager;for(let t of this.files)t.type=="image"?e.exists(t.key)||e.addImage(t.key,t.data):(this.premultipliedAlpha=this.premultipliedAlpha??(t.data.indexOf("pma: true")>=0||t.data.indexOf("pma:true")>=0),t.data={data:t.data,premultipliedAlpha:this.premultipliedAlpha},t.addToCache())}}}window.spine={SpinePlugin:Rs};window["spine.SpinePlugin"]=Rs;function Wo(l,e){return function(){return l.apply(e,arguments)}}const{toString:cd}=Object.prototype,{getPrototypeOf:cr}=Object,{iterator:ln,toStringTag:qo}=Symbol,hn=(l=>e=>{const t=cd.call(e);return l[t]||(l[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Nt=l=>(l=l.toLowerCase(),e=>hn(e)===l),cn=l=>e=>typeof e===l,{isArray:ni}=Array,ti=cn("undefined");function pi(l){return l!==null&&!ti(l)&&l.constructor!==null&&!ti(l.constructor)&&xt(l.constructor.isBuffer)&&l.constructor.isBuffer(l)}const Jo=Nt("ArrayBuffer");function dd(l){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(l):e=l&&l.buffer&&Jo(l.buffer),e}const fd=cn("string"),xt=cn("function"),Ko=cn("number"),yi=l=>l!==null&&typeof l=="object",ud=l=>l===!0||l===!1,Ui=l=>{if(hn(l)!=="object")return!1;const e=cr(l);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(qo in l)&&!(ln in l)},md=l=>{if(!yi(l)||pi(l))return!1;try{return Object.keys(l).length===0&&Object.getPrototypeOf(l)===Object.prototype}catch{return!1}},gd=Nt("Date"),pd=Nt("File"),yd=Nt("Blob"),bd=Nt("FileList"),wd=l=>yi(l)&&xt(l.pipe),xd=l=>{let e;return l&&(typeof FormData=="function"&&l instanceof FormData||xt(l.append)&&((e=hn(l))==="formdata"||e==="object"&&xt(l.toString)&&l.toString()==="[object FormData]"))},Sd=Nt("URLSearchParams"),[vd,Ed,Td,Ad]=["ReadableStream","Request","Response","Headers"].map(Nt),Cd=l=>l.trim?l.trim():l.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function bi(l,e,{allOwnKeys:t=!1}={}){if(l===null||typeof l>"u")return;let s,i;if(typeof l!="object"&&(l=[l]),ni(l))for(s=0,i=l.length;s<i;s++)e.call(null,l[s],s,l);else{if(pi(l))return;const n=t?Object.getOwnPropertyNames(l):Object.keys(l),a=n.length;let o;for(s=0;s<a;s++)o=n[s],e.call(null,l[o],o,l)}}function Zo(l,e){if(pi(l))return null;e=e.toLowerCase();const t=Object.keys(l);let s=t.length,i;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const As=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Qo=l=>!ti(l)&&l!==As;function Jn(){const{caseless:l,skipUndefined:e}=Qo(this)&&this||{},t={},s=(i,n)=>{const a=l&&Zo(t,n)||n;Ui(t[a])&&Ui(i)?t[a]=Jn(t[a],i):Ui(i)?t[a]=Jn({},i):ni(i)?t[a]=i.slice():(!e||!ti(i))&&(t[a]=i)};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&bi(arguments[i],s);return t}const Id=(l,e,t,{allOwnKeys:s}={})=>(bi(e,(i,n)=>{t&&xt(i)?l[n]=Wo(i,t):l[n]=i},{allOwnKeys:s}),l),Rd=l=>(l.charCodeAt(0)===65279&&(l=l.slice(1)),l),Od=(l,e,t,s)=>{l.prototype=Object.create(e.prototype,s),l.prototype.constructor=l,Object.defineProperty(l,"super",{value:e.prototype}),t&&Object.assign(l.prototype,t)},kd=(l,e,t,s)=>{let i,n,a;const o={};if(e=e||{},l==null)return e;do{for(i=Object.getOwnPropertyNames(l),n=i.length;n-- >0;)a=i[n],(!s||s(a,l,e))&&!o[a]&&(e[a]=l[a],o[a]=!0);l=t!==!1&&cr(l)}while(l&&(!t||t(l,e))&&l!==Object.prototype);return e},Pd=(l,e,t)=>{l=String(l),(t===void 0||t>l.length)&&(t=l.length),t-=e.length;const s=l.indexOf(e,t);return s!==-1&&s===t},_d=l=>{if(!l)return null;if(ni(l))return l;let e=l.length;if(!Ko(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=l[e];return t},Md=(l=>e=>l&&e instanceof l)(typeof Uint8Array<"u"&&cr(Uint8Array)),Ld=(l,e)=>{const s=(l&&l[ln]).call(l);let i;for(;(i=s.next())&&!i.done;){const n=i.value;e.call(l,n[0],n[1])}},Fd=(l,e)=>{let t;const s=[];for(;(t=l.exec(e))!==null;)s.push(t);return s},Dd=Nt("HTMLFormElement"),Bd=l=>l.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,i){return s.toUpperCase()+i}),sa=(({hasOwnProperty:l})=>(e,t)=>l.call(e,t))(Object.prototype),Nd=Nt("RegExp"),el=(l,e)=>{const t=Object.getOwnPropertyDescriptors(l),s={};bi(t,(i,n)=>{let a;(a=e(i,n,l))!==!1&&(s[n]=a||i)}),Object.defineProperties(l,s)},Yd=l=>{el(l,(e,t)=>{if(xt(l)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=l[t];if(xt(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Xd=(l,e)=>{const t={},s=i=>{i.forEach(n=>{t[n]=!0})};return ni(l)?s(l):s(String(l).split(e)),t},Ud=()=>{},Vd=(l,e)=>l!=null&&Number.isFinite(l=+l)?l:e;function zd(l){return!!(l&&xt(l.append)&&l[qo]==="FormData"&&l[ln])}const jd=l=>{const e=new Array(10),t=(s,i)=>{if(yi(s)){if(e.indexOf(s)>=0)return;if(pi(s))return s;if(!("toJSON"in s)){e[i]=s;const n=ni(s)?[]:{};return bi(s,(a,o)=>{const r=t(a,i+1);!ti(r)&&(n[o]=r)}),e[i]=void 0,n}}return s};return t(l,0)},Gd=Nt("AsyncFunction"),Hd=l=>l&&(yi(l)||xt(l))&&xt(l.then)&&xt(l.catch),tl=((l,e)=>l?setImmediate:e?((t,s)=>(As.addEventListener("message",({source:i,data:n})=>{i===As&&n===t&&s.length&&s.shift()()},!1),i=>{s.push(i),As.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",xt(As.postMessage)),$d=typeof queueMicrotask<"u"?queueMicrotask.bind(As):typeof process<"u"&&process.nextTick||tl,Wd=l=>l!=null&&xt(l[ln]),$={isArray:ni,isArrayBuffer:Jo,isBuffer:pi,isFormData:xd,isArrayBufferView:dd,isString:fd,isNumber:Ko,isBoolean:ud,isObject:yi,isPlainObject:Ui,isEmptyObject:md,isReadableStream:vd,isRequest:Ed,isResponse:Td,isHeaders:Ad,isUndefined:ti,isDate:gd,isFile:pd,isBlob:yd,isRegExp:Nd,isFunction:xt,isStream:wd,isURLSearchParams:Sd,isTypedArray:Md,isFileList:bd,forEach:bi,merge:Jn,extend:Id,trim:Cd,stripBOM:Rd,inherits:Od,toFlatObject:kd,kindOf:hn,kindOfTest:Nt,endsWith:Pd,toArray:_d,forEachEntry:Ld,matchAll:Fd,isHTMLForm:Dd,hasOwnProperty:sa,hasOwnProp:sa,reduceDescriptors:el,freezeMethods:Yd,toObjectSet:Xd,toCamelCase:Bd,noop:Ud,toFiniteNumber:Vd,findKey:Zo,global:As,isContextDefined:Qo,isSpecCompliantForm:zd,toJSONObject:jd,isAsyncFn:Gd,isThenable:Hd,setImmediate:tl,asap:$d,isIterable:Wd};function _e(l,e,t,s,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=l,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),i&&(this.response=i,this.status=i.status?i.status:null)}$.inherits(_e,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$.toJSONObject(this.config),code:this.code,status:this.status}}});const sl=_e.prototype,il={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(l=>{il[l]={value:l}});Object.defineProperties(_e,il);Object.defineProperty(sl,"isAxiosError",{value:!0});_e.from=(l,e,t,s,i,n)=>{const a=Object.create(sl);$.toFlatObject(l,a,function(c){return c!==Error.prototype},h=>h!=="isAxiosError");const o=l&&l.message?l.message:"Error",r=e==null&&l?l.code:e;return _e.call(a,o,r,t,s,i),l&&a.cause==null&&Object.defineProperty(a,"cause",{value:l,configurable:!0}),a.name=l&&l.name||"Error",n&&Object.assign(a,n),a};const qd=null;function Kn(l){return $.isPlainObject(l)||$.isArray(l)}function nl(l){return $.endsWith(l,"[]")?l.slice(0,-2):l}function ia(l,e,t){return l?l.concat(e).map(function(i,n){return i=nl(i),!t&&n?"["+i+"]":i}).join(t?".":""):e}function Jd(l){return $.isArray(l)&&!l.some(Kn)}const Kd=$.toFlatObject($,{},null,function(e){return/^is[A-Z]/.test(e)});function dn(l,e,t){if(!$.isObject(l))throw new TypeError("target must be an object");e=e||new FormData,t=$.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,b){return!$.isUndefined(b[y])});const s=t.metaTokens,i=t.visitor||c,n=t.dots,a=t.indexes,r=(t.Blob||typeof Blob<"u"&&Blob)&&$.isSpecCompliantForm(e);if(!$.isFunction(i))throw new TypeError("visitor must be a function");function h(m){if(m===null)return"";if($.isDate(m))return m.toISOString();if($.isBoolean(m))return m.toString();if(!r&&$.isBlob(m))throw new _e("Blob is not supported. Use a Buffer instead.");return $.isArrayBuffer(m)||$.isTypedArray(m)?r&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,y,b){let E=m;if(m&&!b&&typeof m=="object"){if($.endsWith(y,"{}"))y=s?y:y.slice(0,-2),m=JSON.stringify(m);else if($.isArray(m)&&Jd(m)||($.isFileList(m)||$.endsWith(y,"[]"))&&(E=$.toArray(m)))return y=nl(y),E.forEach(function(S,x){!($.isUndefined(S)||S===null)&&e.append(a===!0?ia([y],x,n):a===null?y:y+"[]",h(S))}),!1}return Kn(m)?!0:(e.append(ia(b,y,n),h(m)),!1)}const d=[],g=Object.assign(Kd,{defaultVisitor:c,convertValue:h,isVisitable:Kn});function u(m,y){if(!$.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(m),$.forEach(m,function(E,v){(!($.isUndefined(E)||E===null)&&i.call(e,E,$.isString(v)?v.trim():v,y,g))===!0&&u(E,y?y.concat(v):[v])}),d.pop()}}if(!$.isObject(l))throw new TypeError("data must be an object");return u(l),e}function na(l){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(l).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function dr(l,e){this._pairs=[],l&&dn(l,this,e)}const rl=dr.prototype;rl.append=function(e,t){this._pairs.push([e,t])};rl.toString=function(e){const t=e?function(s){return e.call(this,s,na)}:na;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Zd(l){return encodeURIComponent(l).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function al(l,e,t){if(!e)return l;const s=t&&t.encode||Zd;$.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let n;if(i?n=i(e,t):n=$.isURLSearchParams(e)?e.toString():new dr(e,t).toString(s),n){const a=l.indexOf("#");a!==-1&&(l=l.slice(0,a)),l+=(l.indexOf("?")===-1?"?":"&")+n}return l}class ra{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$.forEach(this.handlers,function(s){s!==null&&e(s)})}}const ol={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qd=typeof URLSearchParams<"u"?URLSearchParams:dr,ef=typeof FormData<"u"?FormData:null,tf=typeof Blob<"u"?Blob:null,sf={isBrowser:!0,classes:{URLSearchParams:Qd,FormData:ef,Blob:tf},protocols:["http","https","file","blob","url","data"]},fr=typeof window<"u"&&typeof document<"u",Zn=typeof navigator=="object"&&navigator||void 0,nf=fr&&(!Zn||["ReactNative","NativeScript","NS"].indexOf(Zn.product)<0),rf=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",af=fr&&window.location.href||"http://localhost",of=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:fr,hasStandardBrowserEnv:nf,hasStandardBrowserWebWorkerEnv:rf,navigator:Zn,origin:af},Symbol.toStringTag,{value:"Module"})),lt={...of,...sf};function lf(l,e){return dn(l,new lt.classes.URLSearchParams,{visitor:function(t,s,i,n){return lt.isNode&&$.isBuffer(t)?(this.append(s,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)},...e})}function hf(l){return $.matchAll(/\w+|\[(\w*)]/g,l).map(e=>e[0]==="[]"?"":e[1]||e[0])}function cf(l){const e={},t=Object.keys(l);let s;const i=t.length;let n;for(s=0;s<i;s++)n=t[s],e[n]=l[n];return e}function ll(l){function e(t,s,i,n){let a=t[n++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),r=n>=t.length;return a=!a&&$.isArray(i)?i.length:a,r?($.hasOwnProp(i,a)?i[a]=[i[a],s]:i[a]=s,!o):((!i[a]||!$.isObject(i[a]))&&(i[a]=[]),e(t,s,i[a],n)&&$.isArray(i[a])&&(i[a]=cf(i[a])),!o)}if($.isFormData(l)&&$.isFunction(l.entries)){const t={};return $.forEachEntry(l,(s,i)=>{e(hf(s),i,t,0)}),t}return null}function df(l,e,t){if($.isString(l))try{return(e||JSON.parse)(l),$.trim(l)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(l)}const wi={transitional:ol,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",i=s.indexOf("application/json")>-1,n=$.isObject(e);if(n&&$.isHTMLForm(e)&&(e=new FormData(e)),$.isFormData(e))return i?JSON.stringify(ll(e)):e;if($.isArrayBuffer(e)||$.isBuffer(e)||$.isStream(e)||$.isFile(e)||$.isBlob(e)||$.isReadableStream(e))return e;if($.isArrayBufferView(e))return e.buffer;if($.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return lf(e,this.formSerializer).toString();if((o=$.isFileList(e))||s.indexOf("multipart/form-data")>-1){const r=this.env&&this.env.FormData;return dn(o?{"files[]":e}:e,r&&new r,this.formSerializer)}}return n||i?(t.setContentType("application/json",!1),df(e)):e}],transformResponse:[function(e){const t=this.transitional||wi.transitional,s=t&&t.forcedJSONParsing,i=this.responseType==="json";if($.isResponse(e)||$.isReadableStream(e))return e;if(e&&$.isString(e)&&(s&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(o){if(a)throw o.name==="SyntaxError"?_e.from(o,_e.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:lt.classes.FormData,Blob:lt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$.forEach(["delete","get","head","post","put","patch"],l=>{wi.headers[l]={}});const ff=$.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),uf=l=>{const e={};let t,s,i;return l&&l.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),s=a.substring(i+1).trim(),!(!t||e[t]&&ff[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},aa=Symbol("internals");function li(l){return l&&String(l).trim().toLowerCase()}function Vi(l){return l===!1||l==null?l:$.isArray(l)?l.map(Vi):String(l)}function mf(l){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(l);)e[s[1]]=s[2];return e}const gf=l=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(l.trim());function Rn(l,e,t,s,i){if($.isFunction(s))return s.call(this,e,t);if(i&&(e=t),!!$.isString(e)){if($.isString(s))return e.indexOf(s)!==-1;if($.isRegExp(s))return s.test(e)}}function pf(l){return l.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function yf(l,e){const t=$.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(l,s+t,{value:function(i,n,a){return this[s].call(this,e,i,n,a)},configurable:!0})})}let St=class{constructor(e){e&&this.set(e)}set(e,t,s){const i=this;function n(o,r,h){const c=li(r);if(!c)throw new Error("header name must be a non-empty string");const d=$.findKey(i,c);(!d||i[d]===void 0||h===!0||h===void 0&&i[d]!==!1)&&(i[d||r]=Vi(o))}const a=(o,r)=>$.forEach(o,(h,c)=>n(h,c,r));if($.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if($.isString(e)&&(e=e.trim())&&!gf(e))a(uf(e),t);else if($.isObject(e)&&$.isIterable(e)){let o={},r,h;for(const c of e){if(!$.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[h=c[0]]=(r=o[h])?$.isArray(r)?[...r,c[1]]:[r,c[1]]:c[1]}a(o,t)}else e!=null&&n(t,e,s);return this}get(e,t){if(e=li(e),e){const s=$.findKey(this,e);if(s){const i=this[s];if(!t)return i;if(t===!0)return mf(i);if($.isFunction(t))return t.call(this,i,s);if($.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=li(e),e){const s=$.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Rn(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let i=!1;function n(a){if(a=li(a),a){const o=$.findKey(s,a);o&&(!t||Rn(s,s[o],o,t))&&(delete s[o],i=!0)}}return $.isArray(e)?e.forEach(n):n(e),i}clear(e){const t=Object.keys(this);let s=t.length,i=!1;for(;s--;){const n=t[s];(!e||Rn(this,this[n],n,e,!0))&&(delete this[n],i=!0)}return i}normalize(e){const t=this,s={};return $.forEach(this,(i,n)=>{const a=$.findKey(s,n);if(a){t[a]=Vi(i),delete t[n];return}const o=e?pf(n):String(n).trim();o!==n&&delete t[n],t[o]=Vi(i),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return $.forEach(this,(s,i)=>{s!=null&&s!==!1&&(t[i]=e&&$.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(i=>s.set(i)),s}static accessor(e){const s=(this[aa]=this[aa]={accessors:{}}).accessors,i=this.prototype;function n(a){const o=li(a);s[o]||(yf(i,a),s[o]=!0)}return $.isArray(e)?e.forEach(n):n(e),this}};St.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);$.reduceDescriptors(St.prototype,({value:l},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>l,set(s){this[t]=s}}});$.freezeMethods(St);function On(l,e){const t=this||wi,s=e||t,i=St.from(s.headers);let n=s.data;return $.forEach(l,function(o){n=o.call(t,n,i.normalize(),e?e.status:void 0)}),i.normalize(),n}function hl(l){return!!(l&&l.__CANCEL__)}function ri(l,e,t){_e.call(this,l??"canceled",_e.ERR_CANCELED,e,t),this.name="CanceledError"}$.inherits(ri,_e,{__CANCEL__:!0});function cl(l,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?l(t):e(new _e("Request failed with status code "+t.status,[_e.ERR_BAD_REQUEST,_e.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function bf(l){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(l);return e&&e[1]||""}function wf(l,e){l=l||10;const t=new Array(l),s=new Array(l);let i=0,n=0,a;return e=e!==void 0?e:1e3,function(r){const h=Date.now(),c=s[n];a||(a=h),t[i]=r,s[i]=h;let d=n,g=0;for(;d!==i;)g+=t[d++],d=d%l;if(i=(i+1)%l,i===n&&(n=(n+1)%l),h-a<e)return;const u=c&&h-c;return u?Math.round(g*1e3/u):void 0}}function xf(l,e){let t=0,s=1e3/e,i,n;const a=(h,c=Date.now())=>{t=c,i=null,n&&(clearTimeout(n),n=null),l(...h)};return[(...h)=>{const c=Date.now(),d=c-t;d>=s?a(h,c):(i=h,n||(n=setTimeout(()=>{n=null,a(i)},s-d)))},()=>i&&a(i)]}const Ki=(l,e,t=3)=>{let s=0;const i=wf(50,250);return xf(n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,r=a-s,h=i(r),c=a<=o;s=a;const d={loaded:a,total:o,progress:o?a/o:void 0,bytes:r,rate:h||void 0,estimated:h&&o&&c?(o-a)/h:void 0,event:n,lengthComputable:o!=null,[e?"download":"upload"]:!0};l(d)},t)},oa=(l,e)=>{const t=l!=null;return[s=>e[0]({lengthComputable:t,total:l,loaded:s}),e[1]]},la=l=>(...e)=>$.asap(()=>l(...e)),Sf=lt.hasStandardBrowserEnv?((l,e)=>t=>(t=new URL(t,lt.origin),l.protocol===t.protocol&&l.host===t.host&&(e||l.port===t.port)))(new URL(lt.origin),lt.navigator&&/(msie|trident)/i.test(lt.navigator.userAgent)):()=>!0,vf=lt.hasStandardBrowserEnv?{write(l,e,t,s,i,n,a){if(typeof document>"u")return;const o=[`${l}=${encodeURIComponent(e)}`];$.isNumber(t)&&o.push(`expires=${new Date(t).toUTCString()}`),$.isString(s)&&o.push(`path=${s}`),$.isString(i)&&o.push(`domain=${i}`),n===!0&&o.push("secure"),$.isString(a)&&o.push(`SameSite=${a}`),document.cookie=o.join("; ")},read(l){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+l+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(l){this.write(l,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Ef(l){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(l)}function Tf(l,e){return e?l.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):l}function dl(l,e,t){let s=!Ef(e);return l&&(s||t==!1)?Tf(l,e):e}const ha=l=>l instanceof St?{...l}:l;function Ms(l,e){e=e||{};const t={};function s(h,c,d,g){return $.isPlainObject(h)&&$.isPlainObject(c)?$.merge.call({caseless:g},h,c):$.isPlainObject(c)?$.merge({},c):$.isArray(c)?c.slice():c}function i(h,c,d,g){if($.isUndefined(c)){if(!$.isUndefined(h))return s(void 0,h,d,g)}else return s(h,c,d,g)}function n(h,c){if(!$.isUndefined(c))return s(void 0,c)}function a(h,c){if($.isUndefined(c)){if(!$.isUndefined(h))return s(void 0,h)}else return s(void 0,c)}function o(h,c,d){if(d in e)return s(h,c);if(d in l)return s(void 0,h)}const r={url:n,method:n,data:n,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(h,c,d)=>i(ha(h),ha(c),d,!0)};return $.forEach(Object.keys({...l,...e}),function(c){const d=r[c]||i,g=d(l[c],e[c],c);$.isUndefined(g)&&d!==o||(t[c]=g)}),t}const fl=l=>{const e=Ms({},l);let{data:t,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:n,headers:a,auth:o}=e;if(e.headers=a=St.from(a),e.url=al(dl(e.baseURL,e.url,e.allowAbsoluteUrls),l.params,l.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),$.isFormData(t)){if(lt.hasStandardBrowserEnv||lt.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if($.isFunction(t.getHeaders)){const r=t.getHeaders(),h=["content-type","content-length"];Object.entries(r).forEach(([c,d])=>{h.includes(c.toLowerCase())&&a.set(c,d)})}}if(lt.hasStandardBrowserEnv&&(s&&$.isFunction(s)&&(s=s(e)),s||s!==!1&&Sf(e.url))){const r=i&&n&&vf.read(n);r&&a.set(i,r)}return e},Af=typeof XMLHttpRequest<"u",Cf=Af&&function(l){return new Promise(function(t,s){const i=fl(l);let n=i.data;const a=St.from(i.headers).normalize();let{responseType:o,onUploadProgress:r,onDownloadProgress:h}=i,c,d,g,u,m;function y(){u&&u(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let b=new XMLHttpRequest;b.open(i.method.toUpperCase(),i.url,!0),b.timeout=i.timeout;function E(){if(!b)return;const S=St.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),A={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:S,config:l,request:b};cl(function(k){t(k),y()},function(k){s(k),y()},A),b=null}"onloadend"in b?b.onloadend=E:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(E)},b.onabort=function(){b&&(s(new _e("Request aborted",_e.ECONNABORTED,l,b)),b=null)},b.onerror=function(x){const A=x&&x.message?x.message:"Network Error",C=new _e(A,_e.ERR_NETWORK,l,b);C.event=x||null,s(C),b=null},b.ontimeout=function(){let x=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const A=i.transitional||ol;i.timeoutErrorMessage&&(x=i.timeoutErrorMessage),s(new _e(x,A.clarifyTimeoutError?_e.ETIMEDOUT:_e.ECONNABORTED,l,b)),b=null},n===void 0&&a.setContentType(null),"setRequestHeader"in b&&$.forEach(a.toJSON(),function(x,A){b.setRequestHeader(A,x)}),$.isUndefined(i.withCredentials)||(b.withCredentials=!!i.withCredentials),o&&o!=="json"&&(b.responseType=i.responseType),h&&([g,m]=Ki(h,!0),b.addEventListener("progress",g)),r&&b.upload&&([d,u]=Ki(r),b.upload.addEventListener("progress",d),b.upload.addEventListener("loadend",u)),(i.cancelToken||i.signal)&&(c=S=>{b&&(s(!S||S.type?new ri(null,l,b):S),b.abort(),b=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const v=bf(i.url);if(v&&lt.protocols.indexOf(v)===-1){s(new _e("Unsupported protocol "+v+":",_e.ERR_BAD_REQUEST,l));return}b.send(n||null)})},If=(l,e)=>{const{length:t}=l=l?l.filter(Boolean):[];if(e||t){let s=new AbortController,i;const n=function(h){if(!i){i=!0,o();const c=h instanceof Error?h:this.reason;s.abort(c instanceof _e?c:new ri(c instanceof Error?c.message:c))}};let a=e&&setTimeout(()=>{a=null,n(new _e(`timeout ${e} of ms exceeded`,_e.ETIMEDOUT))},e);const o=()=>{l&&(a&&clearTimeout(a),a=null,l.forEach(h=>{h.unsubscribe?h.unsubscribe(n):h.removeEventListener("abort",n)}),l=null)};l.forEach(h=>h.addEventListener("abort",n));const{signal:r}=s;return r.unsubscribe=()=>$.asap(o),r}},Rf=function*(l,e){let t=l.byteLength;if(t<e){yield l;return}let s=0,i;for(;s<t;)i=s+e,yield l.slice(s,i),s=i},Of=async function*(l,e){for await(const t of kf(l))yield*Rf(t,e)},kf=async function*(l){if(l[Symbol.asyncIterator]){yield*l;return}const e=l.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},ca=(l,e,t,s)=>{const i=Of(l,e);let n=0,a,o=r=>{a||(a=!0,s&&s(r))};return new ReadableStream({async pull(r){try{const{done:h,value:c}=await i.next();if(h){o(),r.close();return}let d=c.byteLength;if(t){let g=n+=d;t(g)}r.enqueue(new Uint8Array(c))}catch(h){throw o(h),h}},cancel(r){return o(r),i.return()}},{highWaterMark:2})},da=64*1024,{isFunction:_i}=$,Pf=(({Request:l,Response:e})=>({Request:l,Response:e}))($.global),{ReadableStream:fa,TextEncoder:ua}=$.global,ma=(l,...e)=>{try{return!!l(...e)}catch{return!1}},_f=l=>{l=$.merge.call({skipUndefined:!0},Pf,l);const{fetch:e,Request:t,Response:s}=l,i=e?_i(e):typeof fetch=="function",n=_i(t),a=_i(s);if(!i)return!1;const o=i&&_i(fa),r=i&&(typeof ua=="function"?(m=>y=>m.encode(y))(new ua):async m=>new Uint8Array(await new t(m).arrayBuffer())),h=n&&o&&ma(()=>{let m=!1;const y=new t(lt.origin,{body:new fa,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!y}),c=a&&o&&ma(()=>$.isReadableStream(new s("").body)),d={stream:c&&(m=>m.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(y,b)=>{let E=y&&y[m];if(E)return E.call(y);throw new _e(`Response type '${m}' is not supported`,_e.ERR_NOT_SUPPORT,b)})});const g=async m=>{if(m==null)return 0;if($.isBlob(m))return m.size;if($.isSpecCompliantForm(m))return(await new t(lt.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if($.isArrayBufferView(m)||$.isArrayBuffer(m))return m.byteLength;if($.isURLSearchParams(m)&&(m=m+""),$.isString(m))return(await r(m)).byteLength},u=async(m,y)=>{const b=$.toFiniteNumber(m.getContentLength());return b??g(y)};return async m=>{let{url:y,method:b,data:E,signal:v,cancelToken:S,timeout:x,onDownloadProgress:A,onUploadProgress:C,responseType:k,headers:_,withCredentials:L="same-origin",fetchOptions:N}=fl(m),V=e||fetch;k=k?(k+"").toLowerCase():"text";let W=If([v,S&&S.toAbortSignal()],x),O=null;const R=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let M;try{if(C&&h&&b!=="get"&&b!=="head"&&(M=await u(_,E))!==0){let le=new t(y,{method:"POST",body:E,duplex:"half"}),ce;if($.isFormData(E)&&(ce=le.headers.get("content-type"))&&_.setContentType(ce),le.body){const[ae,Ie]=oa(M,Ki(la(C)));E=ca(le.body,da,ae,Ie)}}$.isString(L)||(L=L?"include":"omit");const F=n&&"credentials"in t.prototype,H={...N,signal:W,method:b.toUpperCase(),headers:_.normalize().toJSON(),body:E,duplex:"half",credentials:F?L:void 0};O=n&&new t(y,H);let Z=await(n?V(O,N):V(y,H));const ee=c&&(k==="stream"||k==="response");if(c&&(A||ee&&R)){const le={};["status","statusText","headers"].forEach(Pe=>{le[Pe]=Z[Pe]});const ce=$.toFiniteNumber(Z.headers.get("content-length")),[ae,Ie]=A&&oa(ce,Ki(la(A),!0))||[];Z=new s(ca(Z.body,da,ae,()=>{Ie&&Ie(),R&&R()}),le)}k=k||"text";let re=await d[$.findKey(d,k)||"text"](Z,m);return!ee&&R&&R(),await new Promise((le,ce)=>{cl(le,ce,{data:re,headers:St.from(Z.headers),status:Z.status,statusText:Z.statusText,config:m,request:O})})}catch(F){throw R&&R(),F&&F.name==="TypeError"&&/Load failed|fetch/i.test(F.message)?Object.assign(new _e("Network Error",_e.ERR_NETWORK,m,O),{cause:F.cause||F}):_e.from(F,F&&F.code,m,O)}}},Mf=new Map,ul=l=>{let e=l&&l.env||{};const{fetch:t,Request:s,Response:i}=e,n=[s,i,t];let a=n.length,o=a,r,h,c=Mf;for(;o--;)r=n[o],h=c.get(r),h===void 0&&c.set(r,h=o?new Map:_f(e)),c=h;return h};ul();const ur={http:qd,xhr:Cf,fetch:{get:ul}};$.forEach(ur,(l,e)=>{if(l){try{Object.defineProperty(l,"name",{value:e})}catch{}Object.defineProperty(l,"adapterName",{value:e})}});const ga=l=>`- ${l}`,Lf=l=>$.isFunction(l)||l===null||l===!1;function Ff(l,e){l=$.isArray(l)?l:[l];const{length:t}=l;let s,i;const n={};for(let a=0;a<t;a++){s=l[a];let o;if(i=s,!Lf(s)&&(i=ur[(o=String(s)).toLowerCase()],i===void 0))throw new _e(`Unknown adapter '${o}'`);if(i&&($.isFunction(i)||(i=i.get(e))))break;n[o||"#"+a]=i}if(!i){const a=Object.entries(n).map(([r,h])=>`adapter ${r} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=t?a.length>1?`since :
`+a.map(ga).join(`
`):" "+ga(a[0]):"as no adapter specified";throw new _e("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i}const ml={getAdapter:Ff,adapters:ur};function kn(l){if(l.cancelToken&&l.cancelToken.throwIfRequested(),l.signal&&l.signal.aborted)throw new ri(null,l)}function pa(l){return kn(l),l.headers=St.from(l.headers),l.data=On.call(l,l.transformRequest),["post","put","patch"].indexOf(l.method)!==-1&&l.headers.setContentType("application/x-www-form-urlencoded",!1),ml.getAdapter(l.adapter||wi.adapter,l)(l).then(function(s){return kn(l),s.data=On.call(l,l.transformResponse,s),s.headers=St.from(s.headers),s},function(s){return hl(s)||(kn(l),s&&s.response&&(s.response.data=On.call(l,l.transformResponse,s.response),s.response.headers=St.from(s.response.headers))),Promise.reject(s)})}const gl="1.13.2",fn={};["object","boolean","number","function","string","symbol"].forEach((l,e)=>{fn[l]=function(s){return typeof s===l||"a"+(e<1?"n ":" ")+l}});const ya={};fn.transitional=function(e,t,s){function i(n,a){return"[Axios v"+gl+"] Transitional option '"+n+"'"+a+(s?". "+s:"")}return(n,a,o)=>{if(e===!1)throw new _e(i(a," has been removed"+(t?" in "+t:"")),_e.ERR_DEPRECATED);return t&&!ya[a]&&(ya[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(n,a,o):!0}};fn.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Df(l,e,t){if(typeof l!="object")throw new _e("options must be an object",_e.ERR_BAD_OPTION_VALUE);const s=Object.keys(l);let i=s.length;for(;i-- >0;){const n=s[i],a=e[n];if(a){const o=l[n],r=o===void 0||a(o,n,l);if(r!==!0)throw new _e("option "+n+" must be "+r,_e.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new _e("Unknown option "+n,_e.ERR_BAD_OPTION)}}const zi={assertOptions:Df,validators:fn},zt=zi.validators;let ks=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ra,response:new ra}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const n=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?n&&!String(s.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+n):s.stack=n}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ms(this.defaults,t);const{transitional:s,paramsSerializer:i,headers:n}=t;s!==void 0&&zi.assertOptions(s,{silentJSONParsing:zt.transitional(zt.boolean),forcedJSONParsing:zt.transitional(zt.boolean),clarifyTimeoutError:zt.transitional(zt.boolean)},!1),i!=null&&($.isFunction(i)?t.paramsSerializer={serialize:i}:zi.assertOptions(i,{encode:zt.function,serialize:zt.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),zi.assertOptions(t,{baseUrl:zt.spelling("baseURL"),withXsrfToken:zt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=n&&$.merge(n.common,n[t.method]);n&&$.forEach(["delete","get","head","post","put","patch","common"],m=>{delete n[m]}),t.headers=St.concat(a,n);const o=[];let r=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(r=r&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const h=[];this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let c,d=0,g;if(!r){const m=[pa.bind(this),void 0];for(m.unshift(...o),m.push(...h),g=m.length,c=Promise.resolve(t);d<g;)c=c.then(m[d++],m[d++]);return c}g=o.length;let u=t;for(;d<g;){const m=o[d++],y=o[d++];try{u=m(u)}catch(b){y.call(this,b);break}}try{c=pa.call(this,u)}catch(m){return Promise.reject(m)}for(d=0,g=h.length;d<g;)c=c.then(h[d++],h[d++]);return c}getUri(e){e=Ms(this.defaults,e);const t=dl(e.baseURL,e.url,e.allowAbsoluteUrls);return al(t,e.params,e.paramsSerializer)}};$.forEach(["delete","get","head","options"],function(e){ks.prototype[e]=function(t,s){return this.request(Ms(s||{},{method:e,url:t,data:(s||{}).data}))}});$.forEach(["post","put","patch"],function(e){function t(s){return function(n,a,o){return this.request(Ms(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:n,data:a}))}}ks.prototype[e]=t(),ks.prototype[e+"Form"]=t(!0)});let Bf=class pl{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(n){t=n});const s=this;this.promise.then(i=>{if(!s._listeners)return;let n=s._listeners.length;for(;n-- >0;)s._listeners[n](i);s._listeners=null}),this.promise.then=i=>{let n;const a=new Promise(o=>{s.subscribe(o),n=o}).then(i);return a.cancel=function(){s.unsubscribe(n)},a},e(function(n,a,o){s.reason||(s.reason=new ri(n,a,o),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new pl(function(i){e=i}),cancel:e}}};function Nf(l){return function(t){return l.apply(null,t)}}function Yf(l){return $.isObject(l)&&l.isAxiosError===!0}const Qn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Qn).forEach(([l,e])=>{Qn[e]=l});function yl(l){const e=new ks(l),t=Wo(ks.prototype.request,e);return $.extend(t,ks.prototype,e,{allOwnKeys:!0}),$.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return yl(Ms(l,i))},t}const Ze=yl(wi);Ze.Axios=ks;Ze.CanceledError=ri;Ze.CancelToken=Bf;Ze.isCancel=hl;Ze.VERSION=gl;Ze.toFormData=dn;Ze.AxiosError=_e;Ze.Cancel=Ze.CanceledError;Ze.all=function(e){return Promise.all(e)};Ze.spread=Nf;Ze.isAxiosError=Yf;Ze.mergeConfig=Ms;Ze.AxiosHeaders=St;Ze.formToJSON=l=>ll($.isHTMLForm(l)?new FormData(l):l);Ze.getAdapter=ml.getAdapter;Ze.HttpStatusCode=Qn;Ze.default=Ze;const{Axios:xm,AxiosError:Sm,CanceledError:vm,isCancel:Em,CancelToken:Tm,VERSION:Am,all:Cm,Cancel:Im,isAxiosError:Rm,spread:Om,toFormData:km,AxiosHeaders:Pm,HttpStatusCode:_m,formToJSON:Mm,getAdapter:Lm,mergeConfig:Fm}=Ze;class Xf{static apiBaseUrl="https://waypoint-api.skymavis.one";static async getUserInfo(e){let s=null;for(let i=1;i<=3;i++)try{return(await Ze.post(`${this.apiBaseUrl}/v1/rpc/ronin-arcade/get-user-info`,{gameID:"de5a8c64-9c93-46de-b64b-12da3b1b3ad5"},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},timeout:5e3})).data}catch(n){s=n;const a=n;console.error(`[ARCADE] Get user info failed (attempt ${i}/3):`,a.response?.data||a.message),i<3&&await new Promise(o=>setTimeout(o,Math.pow(2,i)*1e3))}return console.error("[ARCADE] Get user info failed after all retries:",s?.message),null}}class Uf extends wt.Scene{progressBar;progressBox;loadingText;percentText;userInfoPromise=null;constructor(){super({key:"PreloadScene"})}preload(){this.createLoadingBar(),this.loadAssets(),this.setupLoadingEvents(),this.fetchUserInfo()}fetchUserInfo(){const e=window.arcadeToken;e&&(this.userInfoPromise=Xf.getUserInfo(e))}createLoadingBar(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY;this.add.text(0,0,"",{fontFamily:"LilitaOne"}).setVisible(!1),this.loadingText=this.add.text(e,t-50,"Loading...",{fontSize:"20px",color:"#ffffff"}).setOrigin(.5),this.percentText=this.add.text(e,t,"0%",{fontSize:"18px",color:"#ffffff"}).setOrigin(.5);const s=320,i=30,n=this.add.graphics();n.fillStyle(2236962,.8),n.fillRect(e-s/2,t+30,s,i),this.progressBox=n,this.progressBar=this.add.graphics()}loadAssets(){this.load.image("BG","assets/BG.png"),this.load.image("logo","assets/logo.png"),this.load.image("button-play","assets/button_play.png"),this.load.image("button-retry","assets/button_retry.png"),this.load.image("gameover-container","assets/gameover_container.png"),this.load.image("score-container","assets/score_container.png"),this.load.image("frame-score","assets/frame_score.png"),this.load.image("frame-currency","assets/frame_currency.png"),this.load.image("plus","assets/plus.png"),this.load.image("cannon","assets/cannon.png"),this.load.image("bullet","assets/bullet.png"),this.load.image("bullet-gun","assets/Bullet_Gun.png"),this.load.image("bullet-shuriken","assets/bullet_shuriken.png"),this.load.image("block-small","assets/blocks/small.png"),this.load.image("block-medium","assets/blocks/medium.png"),this.load.image("block-large","assets/blocks/large.png"),this.load.image("block-mystery","assets/blocks/mystery.png"),this.load.image("powerup-damage","assets/powerups/damage.png"),this.load.image("powerup-speed","assets/powerups/speed.png"),this.load.image("powerup-multi","assets/powerups/multi.png"),this.load.image("powerup-freeze","assets/powerups/freeze.png"),this.load.image("powerup-slowdown","assets/powerups/slowdown.png"),this.load.image("powerup-laser","assets/powerups/laser.png"),this.load.image("crystal","assets/crystal.png"),this.load.image("energy","assets/energy.png"),this.load.image("leaderboard-rank","assets/leaderboard_rank.png"),this.load.image("leaderboard-player-rank","assets/leaderboard_player_rank.png"),this.load.image("laser-gun-bottom","assets/laser_gun_bottom.png"),this.load.image("laser-gun-middle","assets/laser_gun_middle.png"),this.load.image("laser-gun-top","assets/laser_gun_top.png"),this.load.spineJson("boss-data","assets/animation/boss.json"),this.load.spineAtlas("boss-atlas","assets/animation/boss.atlas.txt"),this.load.spineJson("ronke-data","assets/animation/ronke.json"),this.load.spineAtlas("ronke-atlas","assets/animation/ronke.atlas.txt"),this.load.spineJson("kataro-data","assets/animation/kataro.json"),this.load.spineAtlas("kataro-atlas","assets/animation/kataro.atlas.txt"),this.load.audio("bgm","assets/audio/bgm.mp3"),this.load.audio("sfx-fire","assets/audio/fire.mp3"),this.load.audio("sfx-ball-appear","assets/audio/ball_appear.mp3"),this.load.audio("sfx-explode-small","assets/audio/explode_small.mp3"),this.load.audio("sfx-explode-medium","assets/audio/explode_medium.mp3"),this.load.audio("sfx-explode-large","assets/audio/explode_large.mp3"),this.load.audio("sfx-explode-boss","assets/audio/explode_boss.mp3"),this.load.audio("sfx-bounce-small","assets/audio/bounce_small.mp3"),this.load.audio("sfx-bounce-medium","assets/audio/bounce_medium.mp3"),this.load.audio("sfx-bounce-large","assets/audio/bounce_large.mp3"),this.load.audio("sfx-bounce-boss","assets/audio/bounce_boss.mp3")}setupLoadingEvents(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY,s=320,i=30;this.load.on("progress",n=>{this.progressBar?.clear(),this.progressBar?.fillStyle(16777215,1),this.progressBar?.fillRect(e-s/2+5,t+35,(s-10)*n,i-10);const a=Math.floor(n*100);this.percentText?.setText(`${a}%`)}),this.load.on("complete",async()=>{if(this.userInfoPromise){const n=await this.userInfoPromise;n&&(this.registry.set("userInfo",n),this.registry.set("arcadeUserId",n.userID))}this.progressBar?.destroy(),this.progressBox?.destroy(),this.loadingText?.destroy(),this.percentText?.destroy(),this.scene.start("TitleScene")})}showTokenError(){this.progressBar?.destroy(),this.progressBox?.destroy();const e=this.cameras.main.centerY;this.loadingText?.setText("Authentication Required"),this.loadingText?.setStyle({fontSize:"24px",color:"#ff6b6b"}),this.percentText?.setText("Please access through arcade portal"),this.percentText?.setStyle({fontSize:"16px",color:"#ffffff"}),this.percentText?.setY(e+30)}}class Zi extends wt.GameObjects.Container{buttonImage;buttonText;onClick;baseScale=1;constructor(e,t,s,i,n,a,o){if(super(e,t,s),this.onClick=o,this.buttonImage=e.add.image(0,0,i),this.buttonImage.setScale(this.baseScale),this.add(this.buttonImage),n){const c=e.add.text(0,0,n,a);c.setOrigin(.5,.5),this.add(c),this.applyGradient(c),this.buttonText=c}const r=this.buttonImage.width*this.baseScale,h=this.buttonImage.height*this.baseScale;this.setSize(r,h),this.setInteractive(),this.on("pointerdown",this.handlePointerDown,this),this.on("pointerup",this.handlePointerUp,this),this.on("pointerout",this.handlePointerOut,this)}handlePointerDown(){this.scaleVisuals(.95)}handlePointerUp(){this.scaleVisuals(1),this.onClick&&this.onClick()}handlePointerOut(){this.scaleVisuals(1)}applyGradient(e){const t=e.context,s=e.getBounds(),i=t.createLinearGradient(0,0,0,s.height);i.addColorStop(0,"#ffffff"),i.addColorStop(1,"#dbdbb1ff"),e.setFill(i)}scaleVisuals(e){const t=this.baseScale*e;this.buttonImage.setScale(t)}setEnabled(e){this.setInteractive(e)}setText(e){this.buttonText&&this.buttonText.setText(e)}destroy(e){this.off("pointerdown",this.handlePointerDown,this),this.off("pointerup",this.handlePointerUp,this),this.off("pointerout",this.handlePointerOut,this),super.destroy(e)}}var Pn={},ba={},wa;function Vf(){return wa||(wa=1,ArrayBuffer.isView||(ArrayBuffer.isView=l=>l!==null&&typeof l=="object"&&l.buffer instanceof ArrayBuffer),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window),typeof FormData>"u"&&(globalThis.FormData=class{})),ba}var Mi={},er=function(l,e){return er=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])},er(l,e)};function bl(l,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");er(l,e);function t(){this.constructor=l}l.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Qi=function(){return Qi=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Qi.apply(this,arguments)};function wl(l,e){var t={};for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&e.indexOf(s)<0&&(t[s]=l[s]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(l);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(l,s[i])&&(t[s[i]]=l[s[i]]);return t}function xl(l,e,t,s){var i=arguments.length,n=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(l,e,t,s);else for(var o=l.length-1;o>=0;o--)(a=l[o])&&(n=(i<3?a(n):i>3?a(e,t,n):a(e,t))||n);return i>3&&n&&Object.defineProperty(e,t,n),n}function Sl(l,e){return function(t,s){e(t,s,l)}}function vl(l,e,t,s,i,n){function a(E){if(E!==void 0&&typeof E!="function")throw new TypeError("Function expected");return E}for(var o=s.kind,r=o==="getter"?"get":o==="setter"?"set":"value",h=!e&&l?s.static?l:l.prototype:null,c=e||(h?Object.getOwnPropertyDescriptor(h,s.name):{}),d,g=!1,u=t.length-1;u>=0;u--){var m={};for(var y in s)m[y]=y==="access"?{}:s[y];for(var y in s.access)m.access[y]=s.access[y];m.addInitializer=function(E){if(g)throw new TypeError("Cannot add initializers after decoration has completed");n.push(a(E||null))};var b=(0,t[u])(o==="accessor"?{get:c.get,set:c.set}:c[r],m);if(o==="accessor"){if(b===void 0)continue;if(b===null||typeof b!="object")throw new TypeError("Object expected");(d=a(b.get))&&(c.get=d),(d=a(b.set))&&(c.set=d),(d=a(b.init))&&i.unshift(d)}else(d=a(b))&&(o==="field"?i.unshift(d):c[r]=d)}h&&Object.defineProperty(h,s.name,c),g=!0}function El(l,e,t){for(var s=arguments.length>2,i=0;i<e.length;i++)t=s?e[i].call(l,t):e[i].call(l);return s?t:void 0}function Tl(l){return typeof l=="symbol"?l:"".concat(l)}function Al(l,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(l,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Cl(l,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,e)}function Il(l,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(c){try{h(s.next(c))}catch(d){a(d)}}function r(c){try{h(s.throw(c))}catch(d){a(d)}}function h(c){c.done?n(c.value):i(c.value).then(o,r)}h((s=s.apply(l,e||[])).next())})}function Rl(l,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,i,n,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(h){return function(c){return r([h,c])}}function r(h){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,h[0]&&(t=0)),t;)try{if(s=1,i&&(n=h[0]&2?i.return:h[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,h[1])).done)return n;switch(i=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){t.label=h[1];break}if(h[0]===6&&t.label<n[1]){t.label=n[1],n=h;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(h);break}n[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(l,t)}catch(c){h=[6,c],i=0}finally{s=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var un=Object.create?(function(l,e,t,s){s===void 0&&(s=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(l,s,i)}):(function(l,e,t,s){s===void 0&&(s=t),l[s]=e[t]});function Ol(l,e){for(var t in l)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&un(e,l,t)}function en(l){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&l[e],s=0;if(t)return t.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&s>=l.length&&(l=void 0),{value:l&&l[s++],done:!l}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function mr(l,e){var t=typeof Symbol=="function"&&l[Symbol.iterator];if(!t)return l;var s=t.call(l),i,n=[],a;try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)n.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(a)throw a.error}}return n}function kl(){for(var l=[],e=0;e<arguments.length;e++)l=l.concat(mr(arguments[e]));return l}function Pl(){for(var l=0,e=0,t=arguments.length;e<t;e++)l+=arguments[e].length;for(var s=Array(l),i=0,e=0;e<t;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,i++)s[i]=n[a];return s}function _l(l,e,t){if(t||arguments.length===2)for(var s=0,i=e.length,n;s<i;s++)(n||!(s in e))&&(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return l.concat(n||Array.prototype.slice.call(e))}function si(l){return this instanceof si?(this.v=l,this):new si(l)}function Ml(l,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(l,e||[]),i,n=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(u){return function(m){return Promise.resolve(m).then(u,d)}}function o(u,m){s[u]&&(i[u]=function(y){return new Promise(function(b,E){n.push([u,y,b,E])>1||r(u,y)})},m&&(i[u]=m(i[u])))}function r(u,m){try{h(s[u](m))}catch(y){g(n[0][3],y)}}function h(u){u.value instanceof si?Promise.resolve(u.value.v).then(c,d):g(n[0][2],u)}function c(u){r("next",u)}function d(u){r("throw",u)}function g(u,m){u(m),n.shift(),n.length&&r(n[0][0],n[0][1])}}function Ll(l){var e,t;return e={},s("next"),s("throw",function(i){throw i}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(i,n){e[i]=l[i]?function(a){return(t=!t)?{value:si(l[i](a)),done:!1}:n?n(a):a}:n}}function Fl(l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=l[Symbol.asyncIterator],t;return e?e.call(l):(l=typeof en=="function"?en(l):l[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=l[n]&&function(a){return new Promise(function(o,r){a=l[n](a),i(o,r,a.done,a.value)})}}function i(n,a,o,r){Promise.resolve(r).then(function(h){n({value:h,done:o})},a)}}function Dl(l,e){return Object.defineProperty?Object.defineProperty(l,"raw",{value:e}):l.raw=e,l}var zf=Object.create?(function(l,e){Object.defineProperty(l,"default",{enumerable:!0,value:e})}):function(l,e){l.default=e},tr=function(l){return tr=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},tr(l)};function Bl(l){if(l&&l.__esModule)return l;var e={};if(l!=null)for(var t=tr(l),s=0;s<t.length;s++)t[s]!=="default"&&un(e,l,t[s]);return zf(e,l),e}function Nl(l){return l&&l.__esModule?l:{default:l}}function Yl(l,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?l!==e||!s:!e.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(l):s?s.value:e.get(l)}function Xl(l,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?l!==e||!i:!e.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(l,t):i?i.value=t:e.set(l,t),t}function Ul(l,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof l=="function"?e===l:l.has(e)}function Vl(l,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(i=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");i&&(s=function(){try{i.call(this)}catch(n){return Promise.reject(n)}}),l.stack.push({value:e,dispose:s,async:t})}else t&&l.stack.push({async:!0});return e}var jf=typeof SuppressedError=="function"?SuppressedError:function(l,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=l,s.suppressed=e,s};function zl(l){function e(n){l.error=l.hasError?new jf(n,l.error,"An error was suppressed during disposal."):n,l.hasError=!0}var t,s=0;function i(){for(;t=l.stack.pop();)try{if(!t.async&&s===1)return s=0,l.stack.push(t),Promise.resolve().then(i);if(t.dispose){var n=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(n).then(i,function(a){return e(a),i()})}else s|=1}catch(a){e(a)}if(s===1)return l.hasError?Promise.reject(l.error):Promise.resolve();if(l.hasError)throw l.error}return i()}function jl(l,e){return typeof l=="string"&&/^\.\.?\//.test(l)?l.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,i,n,a){return s?e?".jsx":".js":i&&(!n||!a)?t:i+n+"."+a.toLowerCase()+"js"}):l}const Gf={__extends:bl,__assign:Qi,__rest:wl,__decorate:xl,__param:Sl,__esDecorate:vl,__runInitializers:El,__propKey:Tl,__setFunctionName:Al,__metadata:Cl,__awaiter:Il,__generator:Rl,__createBinding:un,__exportStar:Ol,__values:en,__read:mr,__spread:kl,__spreadArrays:Pl,__spreadArray:_l,__await:si,__asyncGenerator:Ml,__asyncDelegator:Ll,__asyncValues:Fl,__makeTemplateObject:Dl,__importStar:Bl,__importDefault:Nl,__classPrivateFieldGet:Yl,__classPrivateFieldSet:Xl,__classPrivateFieldIn:Ul,__addDisposableResource:Vl,__disposeResources:zl,__rewriteRelativeImportExtension:jl},Hf=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Vl,get __assign(){return Qi},__asyncDelegator:Ll,__asyncGenerator:Ml,__asyncValues:Fl,__await:si,__awaiter:Il,__classPrivateFieldGet:Yl,__classPrivateFieldIn:Ul,__classPrivateFieldSet:Xl,__createBinding:un,__decorate:xl,__disposeResources:zl,__esDecorate:vl,__exportStar:Ol,__extends:bl,__generator:Rl,__importDefault:Nl,__importStar:Bl,__makeTemplateObject:Dl,__metadata:Cl,__param:Sl,__propKey:Tl,__read:mr,__rest:wl,__rewriteRelativeImportExtension:jl,__runInitializers:El,__setFunctionName:Al,__spread:kl,__spreadArray:_l,__spreadArrays:Pl,__values:en,default:Gf},Symbol.toStringTag,{value:"Module"})),mn=rr(Hf);var _n={},xa;function gn(){return xa||(xa=1,(function(l){l.CloseCode=void 0,(function(s){s[s.CONSENTED=4e3]="CONSENTED",s[s.DEVMODE_RESTART=4010]="DEVMODE_RESTART"})(l.CloseCode||(l.CloseCode={}));class e extends Error{constructor(i,n){super(n),this.name="ServerError",this.code=i}}class t extends Error{constructor(i){super(i),this.name="AbortError"}}l.AbortError=t,l.ServerError=e})(_n)),_n}var Mn={},Ln={},Fn={},fi={exports:{}},$f=fi.exports,Sa;function gr(){return Sa||(Sa=1,(function(l,e){(function(t,s){s(e)})($f,(function(t){t.OPERATION=void 0,(function(I){I[I.ADD=128]="ADD",I[I.REPLACE=0]="REPLACE",I[I.DELETE=64]="DELETE",I[I.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",I[I.MOVE_AND_ADD=160]="MOVE_AND_ADD",I[I.DELETE_AND_ADD=192]="DELETE_AND_ADD",I[I.CLEAR=10]="CLEAR",I[I.REVERSE=15]="REVERSE",I[I.MOVE=32]="MOVE",I[I.DELETE_BY_REFID=33]="DELETE_BY_REFID",I[I.ADD_BY_REFID=129]="ADD_BY_REFID"})(t.OPERATION||(t.OPERATION={})),Symbol.metadata??=Symbol.for("Symbol.metadata");const n="~track",a="~encoder",o="~decoder",r="~filter",h="~getByIndex",c="~deleteByIndex",d="~changes",g="~childType",u="~onEncodeEnd",m="~onDecodeEnd",y="~descriptors",b="~__numFields",E="~__refTypeFieldIndexes",v="~__viewFieldIndexes",S="$__fieldIndexesByViewTag";let x;try{x=new TextEncoder}catch{}const A=new ArrayBuffer(8),C=new Int32Array(A),k=new Float32Array(A),_=new Float64Array(A),L=new BigInt64Array(A),V=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(I,f){for(var p=0,w=0,T=0,P=I.length;T<P;T++)p=I.charCodeAt(T),p<128?w+=1:p<2048?w+=2:p<55296||p>=57344?w+=3:(T++,w+=4);return w};function W(I,f,p){for(var w=0,T=0,P=f.length;T<P;T++)w=f.charCodeAt(T),w<128?I[p.offset++]=w:w<2048?(I[p.offset]=192|w>>6,I[p.offset+1]=128|w&63,p.offset+=2):w<55296||w>=57344?(I[p.offset]=224|w>>12,I[p.offset+1]=128|w>>6&63,I[p.offset+2]=128|w&63,p.offset+=3):(T++,w=65536+((w&1023)<<10|f.charCodeAt(T)&1023),I[p.offset]=240|w>>18,I[p.offset+1]=128|w>>12&63,I[p.offset+2]=128|w>>6&63,I[p.offset+3]=128|w&63,p.offset+=4)}function O(I,f,p){I[p.offset++]=f&255}function R(I,f,p){I[p.offset++]=f&255}function M(I,f,p){I[p.offset++]=f&255,I[p.offset++]=f>>8&255}function F(I,f,p){I[p.offset++]=f&255,I[p.offset++]=f>>8&255}function H(I,f,p){I[p.offset++]=f&255,I[p.offset++]=f>>8&255,I[p.offset++]=f>>16&255,I[p.offset++]=f>>24&255}function Z(I,f,p){const w=f>>24,T=f>>16,P=f>>8,X=f;I[p.offset++]=X&255,I[p.offset++]=P&255,I[p.offset++]=T&255,I[p.offset++]=w&255}function ee(I,f,p){const w=Math.floor(f/Math.pow(2,32)),T=f>>>0;Z(I,T,p),Z(I,w,p)}function re(I,f,p){const w=f/Math.pow(2,32)>>0,T=f>>>0;Z(I,T,p),Z(I,w,p)}function le(I,f,p){L[0]=BigInt.asIntN(64,f),H(I,C[0],p),H(I,C[1],p)}function ce(I,f,p){L[0]=BigInt.asIntN(64,f),H(I,C[0],p),H(I,C[1],p)}function ae(I,f,p){k[0]=f,H(I,C[0],p)}function Ie(I,f,p){_[0]=f,H(I,C[0],p),H(I,C[1],p)}function Pe(I,f,p){I[p.offset++]=f?1:0}function gt(I,f,p){f||(f="");let w=V(f,"utf8"),T=0;if(w<32)I[p.offset++]=w|160,T=1;else if(w<256)I[p.offset++]=217,I[p.offset++]=w%255,T=2;else if(w<65536)I[p.offset++]=218,F(I,w,p),T=3;else if(w<4294967296)I[p.offset++]=219,Z(I,w,p),T=5;else throw new Error("String too long");return W(I,f,p),T+w}function tt(I,f,p){if(isNaN(f))return tt(I,0,p);if(isFinite(f)){if(f!==(f|0))return Math.abs(f)<=34028235e31&&(k[0]=f,Math.abs(Math.abs(k[0])-Math.abs(f))<1e-4)?(I[p.offset++]=202,ae(I,f,p),5):(I[p.offset++]=203,Ie(I,f,p),9)}else return tt(I,f>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,p);return f>=0?f<128?(I[p.offset++]=f&255,1):f<256?(I[p.offset++]=204,I[p.offset++]=f&255,2):f<65536?(I[p.offset++]=205,F(I,f,p),3):f<4294967296?(I[p.offset++]=206,Z(I,f,p),5):(I[p.offset++]=207,re(I,f,p),9):f>=-32?(I[p.offset++]=224|f+32,1):f>=-128?(I[p.offset++]=208,O(I,f,p),2):f>=-32768?(I[p.offset++]=209,M(I,f,p),3):f>=-2147483648?(I[p.offset++]=210,H(I,f,p),5):(I[p.offset++]=211,ee(I,f,p),9)}const Ye={int8:O,uint8:R,int16:M,uint16:F,int32:H,uint32:Z,int64:ee,uint64:re,bigint64:le,biguint64:ce,float32:ae,float64:Ie,boolean:Pe,string:gt,number:tt,utf8Write:W,utf8Length:V},We=new ArrayBuffer(8),Ge=new Int32Array(We),Yt=new Float32Array(We),xs=new Float64Array(We),vi=new BigUint64Array(We),Fs=new BigInt64Array(We);function Ds(I,f,p){p>I.length-f.offset&&(p=I.length-f.offset);for(var w="",T=0,P=f.offset,X=f.offset+p;P<X;P++){var J=I[P];if((J&128)===0){w+=String.fromCharCode(J);continue}if((J&224)===192){w+=String.fromCharCode((J&31)<<6|I[++P]&63);continue}if((J&240)===224){w+=String.fromCharCode((J&15)<<12|(I[++P]&63)<<6|(I[++P]&63)<<0);continue}if((J&248)===240){T=(J&7)<<18|(I[++P]&63)<<12|(I[++P]&63)<<6|(I[++P]&63)<<0,T>=65536?(T-=65536,w+=String.fromCharCode((T>>>10)+55296,(T&1023)+56320)):w+=String.fromCharCode(T);continue}console.error("decode.utf8Read(): Invalid byte "+J+" at offset "+P+". Skip to end of string: "+(f.offset+p));break}return f.offset+=p,w}function ai(I,f){return ls(I,f)<<24>>24}function ls(I,f){return I[f.offset++]}function Ss(I,f){return hs(I,f)<<16>>16}function hs(I,f){return I[f.offset++]|I[f.offset++]<<8}function pt(I,f){return I[f.offset++]|I[f.offset++]<<8|I[f.offset++]<<16|I[f.offset++]<<24}function Et(I,f){return pt(I,f)>>>0}function cs(I,f){return Ge[0]=pt(I,f),Yt[0]}function oi(I,f){return Ge[0]=pt(I,f),Ge[1]=pt(I,f),xs[0]}function vs(I,f){const p=Et(I,f);return pt(I,f)*Math.pow(2,32)+p}function Sr(I,f){const p=Et(I,f);return Et(I,f)*Math.pow(2,32)+p}function uh(I,f){return Ge[0]=pt(I,f),Ge[1]=pt(I,f),Fs[0]}function mh(I,f){return Ge[0]=pt(I,f),Ge[1]=pt(I,f),vi[0]}function gh(I,f){return ls(I,f)>0}function ph(I,f){const p=I[f.offset++];let w;return p<192?w=p&31:p===217?w=ls(I,f):p===218?w=hs(I,f):p===219&&(w=Et(I,f)),Ds(I,f,w)}function yh(I,f){const p=I[f.offset++];if(p<128)return p;if(p===202)return cs(I,f);if(p===203)return oi(I,f);if(p===204)return ls(I,f);if(p===205)return hs(I,f);if(p===206)return Et(I,f);if(p===207)return Sr(I,f);if(p===208)return ai(I,f);if(p===209)return Ss(I,f);if(p===210)return pt(I,f);if(p===211)return vs(I,f);if(p>223)return(255-p+1)*-1}function bh(I,f){const p=I[f.offset];return p<192&&p>160||p===217||p===218||p===219}const Tt={utf8Read:Ds,int8:ai,uint8:ls,int16:Ss,uint16:hs,int32:pt,uint32:Et,float32:cs,float64:oi,int64:vs,uint64:Sr,bigint64:uh,biguint64:mh,boolean:gh,string:ph,number:yh,stringCheck:bh},wn={},wh=new Map;function Xt(I,f){f.constructor&&(wh.set(f.constructor,I),wn[I]=f),f.encode&&(Ye[I]=f.encode),f.decode&&(Tt[I]=f.decode)}function xn(I){return wn[I]}function xh(I){for(const f in I)Xt(f,I[f]);return f=>kt(f)}const Vt=class Vt{static register(f){const p=Object.getPrototypeOf(f);if(p!==qe){let w=Vt.inheritedTypes.get(p);w||(w=new Set,Vt.inheritedTypes.set(p,w)),w.add(f)}}static cache(f){let p=Vt.cachedContexts.get(f);return p||(p=new Vt(f),Vt.cachedContexts.set(f,p)),p}constructor(f){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},f&&this.discoverTypes(f)}has(f){return this.schemas.has(f)}get(f){return this.types[f]}add(f,p=this.schemas.size){return this.schemas.has(f)?!1:(this.types[p]=f,f[Symbol.metadata]===void 0&&nt.initialize(f),this.schemas.set(f,p),!0)}getTypeId(f){return this.schemas.get(f)}discoverTypes(f,p,w,T){if(T&&this.registerFilteredByParent(f,p,w),!this.add(f))return;Vt.inheritedTypes.get(f)?.forEach(J=>{this.discoverTypes(J,p,w,T)});let P=f;for(;(P=Object.getPrototypeOf(P))&&P!==qe&&P!==Function.prototype;)this.discoverTypes(P);const X=f[Symbol.metadata]??={};X[v]&&(this.hasFilters=!0);for(const J in X){const z=J,j=X[z].type,q=X[z].tag!==void 0;if(typeof j!="string")if(typeof j=="function")this.discoverTypes(j,f,z,T||q);else{const Q=Object.values(j)[0];if(typeof Q=="string")continue;this.discoverTypes(Q,f,z,T||q)}}}registerFilteredByParent(f,p,w){let P=`${this.schemas.get(f)??this.schemas.size}`;p&&(P+=`-${this.schemas.get(p)}`),P+=`-${w}`,this.parentFiltered[P]=!0}debug(){let f="";for(const p in this.parentFiltered){const w=p.split("-").map(Number),T=w.pop();f+=`
		`,f+=`${p}: ${w.reverse().map((P,X)=>{const J=this.types[P],z=J[Symbol.metadata];let j=J.name;return X===0&&(j+=`[${z[T].name}]`),`${j}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${f}`}};Vt.inheritedTypes=new Map,Vt.cachedContexts=new Map;let Ut=Vt;function ds(I){if(Array.isArray(I))return{array:ds(I[0])};if(typeof I.type<"u")return I.type;if(Sh(I))return Object.keys(I).every(f=>typeof I[f]=="string")?"string":"number";if(typeof I=="object"&&I!==null){const f=Object.keys(I).find(p=>wn[p]!==void 0);if(f)return I[f]=ds(I[f]),I}return I}function Sh(I){if(typeof I=="function"&&I[Symbol.metadata])return!1;const f=Object.keys(I),p=f.filter(w=>/\d+/.test(w));return!!(p.length>0&&p.length===f.length/2&&I[I[p[0]]]==p[0]||f.length>0&&f.every(w=>typeof I[w]=="string"&&I[w]===w))}const nt={addField(I,f,p,w,T){if(f>64)throw new Error(`Can't define field '${p}'.
Schema instances may only have up to 64 fields.`);I[f]=Object.assign(I[f]||{},{type:ds(w),index:f,name:p}),Object.defineProperty(I,y,{value:I[y]||{},enumerable:!1,configurable:!0}),T?(I[y][p]=T,I[y][`_${p}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):I[y][p]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(I,b,{value:f,enumerable:!1,configurable:!0}),Object.defineProperty(I,p,{value:f,enumerable:!1,configurable:!0}),typeof I[f].type!="string"&&(I[E]===void 0&&Object.defineProperty(I,E,{value:[],enumerable:!1,configurable:!0}),I[E].push(f))},setTag(I,f,p){const w=I[f],T=I[w];T.tag=p,I[v]||(Object.defineProperty(I,v,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(I,S,{value:{},enumerable:!1,configurable:!0})),I[v].push(w),I[S][p]||(I[S][p]=[]),I[S][p].push(w)},setFields(I,f){const p=I.prototype.constructor;Ut.register(p);const w=Object.getPrototypeOf(p),T=w&&w[Symbol.metadata],P=nt.initialize(p);p[n]||(p[n]=qe[n]),p[a]||(p[a]=qe[a]),p[o]||(p[o]=qe[o]),p.prototype.toJSON||(p.prototype.toJSON=qe.prototype.toJSON);let X=P[b]??(T&&T[b])??-1;X++;for(const J in f){const z=ds(f[J]),j=typeof Object.keys(z)[0]=="string"&&xn(Object.keys(z)[0]),q=j?Object.values(z)[0]:z;nt.addField(P,X,J,z,Br(`_${J}`,X,q,j)),X++}return I},isDeprecated(I,f){return I[f].deprecated===!0},init(I){const f={};I[Symbol.metadata]=f,Object.defineProperty(f,b,{value:0,enumerable:!1,configurable:!0})},initialize(I){const f=Object.getPrototypeOf(I),p=f[Symbol.metadata];let w=I[Symbol.metadata]??Object.create(null);return f!==qe&&w===p&&(w=Object.create(null),p&&(Object.setPrototypeOf(w,p),Object.defineProperty(w,b,{value:p[b],enumerable:!1,configurable:!0,writable:!0}),p[v]!==void 0&&(Object.defineProperty(w,v,{value:[...p[v]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(w,S,{value:{...p[S]},enumerable:!1,configurable:!0,writable:!0})),p[E]!==void 0&&Object.defineProperty(w,E,{value:[...p[E]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(w,y,{value:{...p[y]},enumerable:!1,configurable:!0,writable:!0}))),I[Symbol.metadata]=w,w},isValidInstance(I){return I.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(I.constructor[Symbol.metadata],b)},getFields(I){const f=I[Symbol.metadata],p={};for(let w=0;w<=f[b];w++)p[f[w].name]=f[w].type;return p},hasViewTagAtIndex(I,f){return I?.[v]?.includes(f)}};function Qt(I){return{indexes:{},operations:[],queueRootNode:I}}function Bs(){return{next:void 0,tail:void 0}}function At(I,f){const p=I.indexes[f];p===void 0?I.indexes[f]=I.operations.push(f)-1:I.operations[p]=f}function vr(I,f){let p=I.indexes[f];p===void 0&&(p=Object.values(I.indexes).at(-1),f=Object.entries(I.indexes).find(([w,T])=>T===p)?.[0]),I.operations[p]=void 0,delete I.indexes[f]}class Ns{constructor(f){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=f,this.metadata=f.constructor[Symbol.metadata],this.metadata?.[v]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(f){this.root=f;const p=this.root.add(this);this.checkIsFiltered(this.parent,this.parentIndex,p),p&&this.forEachChild((w,T)=>{w.root!==f?w.setRoot(f):f.add(w)})}setParent(f,p,w){if(this.addParent(f,w),!p)return;const T=p.add(this);p!==this.root&&(this.root=p,this.checkIsFiltered(f,w,T)),T&&this.forEachChild((P,X)=>{if(P.root===p){p.add(P),p.moveNextToParent(P);return}P.setParent(this.ref,p,X)})}forEachChild(f){if(this.ref[g]){if(typeof this.ref[g]!="string")for(const[p,w]of this.ref.entries())w&&f(w[d],this.indexes?.[p]??p)}else for(const p of this.metadata?.[E]??[]){const w=this.metadata[p],T=this.ref[w.name];T&&f(T[d],p)}}operation(f){this.filteredChanges!==void 0?(this.filteredChanges.operations.push(-f),this.root?.enqueueChangeTree(this,"filteredChanges")):(this.changes.operations.push(-f),this.root?.enqueueChangeTree(this,"changes"))}change(f,p=t.OPERATION.ADD){const w=this.isFiltered||this.metadata?.[f]?.tag!==void 0,T=w?this.filteredChanges:this.changes,P=this.indexedOperations[f];if(!P||P===t.OPERATION.DELETE){const X=P&&P===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:p;this.indexedOperations[f]=X}At(T,f),w?(At(this.allFilteredChanges,f),this.root&&(this.root.enqueueChangeTree(this,"filteredChanges"),this.root.enqueueChangeTree(this,"allFilteredChanges"))):(At(this.allChanges,f),this.root?.enqueueChangeTree(this,"changes"))}shiftChangeIndexes(f){const p=this.isFiltered?this.filteredChanges:this.changes,w={},T={};for(const P in this.indexedOperations)w[Number(P)+f]=this.indexedOperations[P],T[Number(P)+f]=p.indexes[P];this.indexedOperations=w,p.indexes=T,p.operations=p.operations.map(P=>P+f)}shiftAllChangeIndexes(f,p=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(f,p,this.allFilteredChanges),this._shiftAllChangeIndexes(f,p,this.allChanges)):this._shiftAllChangeIndexes(f,p,this.allChanges)}_shiftAllChangeIndexes(f,p=0,w){const T={};let P=0;for(const X in w.indexes)T[P++]=w.indexes[X];w.indexes=T;for(let X=0;X<w.operations.length;X++){const J=w.operations[X];J>p&&(w.operations[X]=J+f)}}indexedOperation(f,p,w=f){this.indexedOperations[f]=p,this.filteredChanges!==void 0?(At(this.allFilteredChanges,w),At(this.filteredChanges,f),this.root?.enqueueChangeTree(this,"filteredChanges")):(At(this.allChanges,w),At(this.changes,f),this.root?.enqueueChangeTree(this,"changes"))}getType(f){return this.ref[g]||this.metadata[f].type}getChange(f){return this.indexedOperations[f]}getValue(f,p=!1){return this.ref[h](f,p)}delete(f,p,w=f){if(f===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${f}'`)}catch(X){console.warn(X)}return}const T=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[f]=p??t.OPERATION.DELETE,At(T,f),vr(this.allChanges,w);const P=this.getValue(f);return P&&P[d]&&this.root?.remove(P[d]),this.filteredChanges!==void 0?(vr(this.allFilteredChanges,w),this.root?.enqueueChangeTree(this,"filteredChanges")):this.root?.enqueueChangeTree(this,"changes"),P}endEncode(f){this.indexedOperations={},this[f]=Qt(),this.ref[u]?.(),this.isNew=!1}discard(f=!1){this.ref[u]?.(),this.indexedOperations={},this.changes=Qt(this.changes.queueRootNode),this.filteredChanges!==void 0&&(this.filteredChanges=Qt(this.filteredChanges.queueRootNode)),f&&(this.allChanges=Qt(this.allChanges.queueRootNode),this.allFilteredChanges!==void 0&&(this.allFilteredChanges=Qt(this.allFilteredChanges.queueRootNode)))}discardAll(){const f=Object.keys(this.indexedOperations);for(let p=0,w=f.length;p<w;p++){const T=this.getValue(Number(f[p]));T&&T[d]&&T[d].discardAll()}this.discard()}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(f,p,w){this.root.types.hasFilters&&(this._checkFilteredByParent(f,p),this.filteredChanges!==void 0&&(this.root?.enqueueChangeTree(this,"filteredChanges"),w&&this.root?.enqueueChangeTree(this,"allFilteredChanges"))),this.isFiltered||(this.root?.enqueueChangeTree(this,"changes"),w&&this.root?.enqueueChangeTree(this,"allChanges"))}_checkFilteredByParent(f,p){if(!f)return;const w=nt.isValidInstance(this.ref)?this.ref.constructor:this.ref[g];let T,P=!nt.isValidInstance(f);P?(T=f[d],f=T.parent,p=T.parentIndex):T=f[d];const X=f.constructor;let J=`${this.root.types.getTypeId(w)}`;X&&(J+=`-${this.root.types.schemas.get(X)}`),J+=`-${p}`;const z=nt.hasViewTagAtIndex(X?.[Symbol.metadata],p);this.isFiltered=f[d].isFiltered||this.root.types.parentFiltered[J]||z,this.isFiltered&&(this.isVisibilitySharedWithParent=T.isFiltered&&typeof w!="string"&&!z&&P,this.filteredChanges||(this.filteredChanges=Qt(),this.allFilteredChanges=Qt()),this.changes.operations.length>0&&(this.changes.operations.forEach(j=>At(this.filteredChanges,j)),this.allChanges.operations.forEach(j=>At(this.allFilteredChanges,j)),this.changes=Qt(),this.allChanges=Qt()))}get parent(){return this.parentChain?.ref}get parentIndex(){return this.parentChain?.index}addParent(f,p){if(this.hasParent((w,T)=>w[d]===f[d])){this.parentChain.index=p;return}this.parentChain={ref:f,index:p,next:this.parentChain}}removeParent(f=this.parent){let p=this.parentChain,w=null;for(;p;){if(p.ref[d]===f[d])return w?w.next=p.next:this.parentChain=p.next,!0;w=p,p=p.next}return this.parentChain===void 0}findParent(f){let p=this.parentChain;for(;p;){if(f(p.ref,p.index))return p;p=p.next}}hasParent(f){return this.findParent(f)!==void 0}getAllParents(){const f=[];let p=this.parentChain;for(;p;)f.push({ref:p.ref,index:p.index}),p=p.next;return f}}function Sn(I,f,p,w,T,P){typeof p=="string"?Ye[p]?.(f,w,P):p[Symbol.metadata]!==void 0?(Ye.number(f,w[d].refId,P),(T&t.OPERATION.ADD)===t.OPERATION.ADD&&I.tryEncodeTypeId(f,p,w.constructor,P)):Ye.number(f,w[d].refId,P)}const Er=function(I,f,p,w,T,P,X,J,z){if(f[P.offset++]=(w|T)&255,T===t.OPERATION.DELETE)return;const j=p.ref,q=z[w];Sn(I,f,z[w].type,j[q.name],T,P)},Ei=function(I,f,p,w,T,P){if(f[P.offset++]=T&255,Ye.number(f,w,P),T===t.OPERATION.DELETE)return;const X=p.ref;if((T&t.OPERATION.ADD)===t.OPERATION.ADD&&typeof X.set=="function"){const j=p.ref.$indexes.get(w);Ye.string(f,j,P)}const J=X[g],z=X[h](w);Sn(I,f,J,z,T,P)},Tr=function(I,f,p,w,T,P,X,J){const z=p.ref,j=J&&p.isFiltered&&typeof p.getType(w)!="string";let q;if(j){const he=z.tmpItems[w];if(!he)return;q=he[d].refId,T===t.OPERATION.DELETE?T=t.OPERATION.DELETE_BY_REFID:T===t.OPERATION.ADD&&(T=t.OPERATION.ADD_BY_REFID)}else q=w;if(f[P.offset++]=T&255,Ye.number(f,q,P),T===t.OPERATION.DELETE||T===t.OPERATION.DELETE_BY_REFID)return;const Q=p.getType(w),fe=p.getValue(w,X);Sn(I,f,Q,fe,T,P)},Ar=-1;function vn(I,f,p,w,T,P,X,J){const z=I.root,j=p[h](w);let q;if((f&t.OPERATION.DELETE)===t.OPERATION.DELETE){const Q=z.refIds.get(j);Q!==void 0&&z.removeRef(Q),f!==t.OPERATION.DELETE_AND_ADD&&p[c](w),q=void 0}if(f!==t.OPERATION.DELETE)if(qe.is(T)){const Q=Tt.number(P,X);if(q=z.refs.get(Q),(f&t.OPERATION.ADD)===t.OPERATION.ADD){const fe=I.getInstanceType(P,X,T);q||(q=I.createInstanceOfType(fe)),z.addRef(Q,q,q!==j||f===t.OPERATION.DELETE_AND_ADD&&q===j)}}else if(typeof T=="string")q=Tt[T](P,X);else{const Q=xn(Object.keys(T)[0]),fe=Tt.number(P,X),he=z.refs.has(fe)?j||z.refs.get(fe):new Q.constructor;if(q=he.clone(!0),q[g]=Object.values(T)[0],j){let ne=z.refIds.get(j);if(ne!==void 0&&fe!==ne){const ie=j.entries();let de;for(;(de=ie.next())&&!de.done;){const[Je,Ke]=de.value;typeof Ke=="object"&&(ne=z.refIds.get(Ke),z.removeRef(ne)),J.push({ref:j,refId:ne,op:t.OPERATION.DELETE,field:Je,value:void 0,previousValue:Ke})}}}z.addRef(fe,q,he!==j||f===t.OPERATION.DELETE_AND_ADD&&he===j)}return{value:q,previousValue:j}}const Cr=function(I,f,p,w,T){const P=f[p.offset++],X=w.constructor[Symbol.metadata],J=P>>6<<6,z=P%(J||255),j=X[z];if(j===void 0)return console.warn("@colyseus/schema: field not defined at",{index:z,ref:w.constructor.name,metadata:X}),Ar;const{value:q,previousValue:Q}=vn(I,J,w,z,j.type,f,p,T);q!=null&&(w[j.name]=q),Q!==q&&T.push({ref:w,refId:I.currentRefId,op:J,field:j.name,value:q,previousValue:Q})},Ti=function(I,f,p,w,T){const P=f[p.offset++];if(P===t.OPERATION.CLEAR){I.removeChildRefs(w,T),w.clear();return}const X=Tt.number(f,p),J=w[g];let z;(P&t.OPERATION.ADD)===t.OPERATION.ADD?typeof w.set=="function"?(z=Tt.string(f,p),w.setIndex(X,z)):z=X:z=w.getIndex(X);const{value:j,previousValue:q}=vn(I,P,w,X,J,f,p,T);if(j!=null){if(typeof w.set=="function")w.$items.set(z,j);else if(typeof w.$setAt=="function")w.$setAt(X,j,P);else if(typeof w.add=="function"){const Q=w.add(j);typeof Q=="number"&&w.setIndex(Q,Q)}}q!==j&&T.push({ref:w,refId:I.currentRefId,op:P,field:"",dynamicIndex:z,value:j,previousValue:q})},vh=function(I,f,p,w,T){let P=f[p.offset++],X;if(P===t.OPERATION.CLEAR){I.removeChildRefs(w,T),w.clear();return}else if(P===t.OPERATION.REVERSE){w.reverse();return}else if(P===t.OPERATION.DELETE_BY_REFID){const Q=Tt.number(f,p),fe=I.root.refs.get(Q);X=w.findIndex(he=>he===fe),w[c](X),T.push({ref:w,refId:I.currentRefId,op:t.OPERATION.DELETE,field:"",dynamicIndex:X,value:void 0,previousValue:fe});return}else if(P===t.OPERATION.ADD_BY_REFID){const Q=Tt.number(f,p),fe=I.root.refs.get(Q);fe&&(X=w.findIndex(he=>he===fe)),(X===-1||X===void 0)&&(X=w.length)}else X=Tt.number(f,p);const J=w[g];let z=X;const{value:j,previousValue:q}=vn(I,P,w,X,J,f,p,T);j!=null&&j!==q&&w.$setAt(X,j,P),q!==j&&T.push({ref:w,refId:I.currentRefId,op:P,field:"",dynamicIndex:z,value:j,previousValue:q})};class Ir extends Error{}function Eh(I,f,p,w){let T,P=!1;switch(f){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":T="number",isNaN(I)&&console.log(`trying to encode "NaN" in ${p.constructor.name}#${w}`);break;case"bigint64":case"biguint64":T="bigint";break;case"string":T="string",P=!0;break;case"boolean":return;default:return}if(typeof I!==T&&(!P||P&&I!==null)){let X=`'${JSON.stringify(I)}'${I&&I.constructor&&` (${I.constructor.name})`||""}`;throw new Ir(`a '${T}' was expected, but ${X} was provided in ${p.constructor.name}#${w}`)}}function Ai(I,f,p,w){if(!(I instanceof f))throw new Ir(`a '${f.name}' was expected, but '${I&&I.constructor.name}' was provided in ${p.constructor.name}#${w}`)}var Rr,Or;const Th=(I,f)=>{const p=I.toString(),w=f.toString();return p<w?-1:p>w?1:0},Pt=class Pt{static[(Rr=a,Or=o,r)](f,p,w){return!w||typeof f[g]=="string"||w.isChangeTreeVisible(f.tmpItems[p]?.[d])}static is(f){return Array.isArray(f)||f.array!==void 0}static from(f){return new Pt(...Array.from(f))}constructor(...f){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const p=new Proxy(this,{get:(w,T)=>typeof T!="symbol"&&!isNaN(T)?this.items[T]:Reflect.get(w,T),set:(w,T,P)=>{if(typeof T!="symbol"&&!isNaN(T)){if(P==null)w.$deleteAt(T);else{if(P[d]){Ai(P,w[g],w,T);const X=w.items[T];w.isMovingItems?(X!==void 0?P[d].isNew?w[d].indexedOperation(Number(T),t.OPERATION.MOVE_AND_ADD):(w[d].getChange(Number(T))&t.OPERATION.DELETE)===t.OPERATION.DELETE?w[d].indexedOperation(Number(T),t.OPERATION.DELETE_AND_MOVE):w[d].indexedOperation(Number(T),t.OPERATION.MOVE):P[d].isNew&&w[d].indexedOperation(Number(T),t.OPERATION.ADD),P[d].setParent(this,w[d].root,T)):w.$changeAt(Number(T),P),X!==void 0&&X[d].root?.remove(X[d])}else w.$changeAt(Number(T),P);w.items[T]=P,w.tmpItems[T]=P}return!0}else return Reflect.set(w,T,P)},deleteProperty:(w,T)=>(typeof T=="number"?w.$deleteAt(T):delete w[T],!0),has:(w,T)=>typeof T!="symbol"&&!isNaN(Number(T))?Reflect.has(this.items,T):Reflect.has(w,T)});return Object.defineProperty(this,d,{value:new Ns(p),enumerable:!1,writable:!0}),f.length>0&&this.push(...f),p}set length(f){f===0?this.clear():f<this.items.length?this.splice(f,this.length-f):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...f){let p=this.tmpItems.length;const w=this[d];for(let T=0,P=f.length;T<P;T++,p++){const X=f[T];if(X==null)return;typeof X=="object"&&this[g]&&Ai(X,this[g],this,T),w.indexedOperation(p,t.OPERATION.ADD,this.items.length),this.items.push(X),this.tmpItems.push(X),X[d]?.setParent(this,w.root,p)}return p}pop(){let f=-1;for(let p=this.tmpItems.length-1;p>=0;p--)if(this.deletedIndexes[p]!==!0){f=p;break}if(!(f<0))return this[d].delete(f,void 0,this.items.length-1),this.deletedIndexes[f]=!0,this.items.pop()}at(f){return f<0&&(f+=this.length),this.items[f]}$changeAt(f,p){if(p==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[f]===p)return;const w=this.items[f]!==void 0?typeof p=="object"?t.OPERATION.DELETE_AND_ADD:t.OPERATION.REPLACE:t.OPERATION.ADD,T=this[d];T.change(f,w),p[d]?.setParent(this,T.root,f)}$deleteAt(f,p){this[d].delete(f,p)}$setAt(f,p,w){f===0&&w===t.OPERATION.ADD&&this.items[f]!==void 0?this.items.unshift(p):w===t.OPERATION.DELETE_AND_MOVE?(this.items.splice(f,1),this.items[f]=p):this.items[f]=p}clear(){if(this.items.length===0)return;const f=this[d];f.forEachChild((p,w)=>{f.root?.remove(p)}),f.discard(!0),f.operation(t.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...f){return new Pt(...this.items.concat(...f))}join(f){return this.items.join(f)}reverse(){return this[d].operation(t.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const f=this[d],p=this.tmpItems.findIndex(T=>T===this.items[0]),w=this.items.findIndex(T=>T===this.items[0]);return f.delete(p,t.OPERATION.DELETE,w),f.shiftAllChangeIndexes(-1,w),this.deletedIndexes[p]=!0,this.items.shift()}slice(f,p){const w=new Pt;return w.push(...this.items.slice(f,p)),w}sort(f=Th){this.isMovingItems=!0;const p=this[d];return this.items.sort(f).forEach((T,P)=>p.change(P,t.OPERATION.REPLACE)),this.tmpItems.sort(f),this.isMovingItems=!1,this}splice(f,p,...w){const T=this[d],P=this.items.length,X=this.tmpItems.length,J=w.length,z=[];for(let j=0;j<X;j++)this.deletedIndexes[j]!==!0&&z.push(j);if(P>f){p===void 0&&(p=P-f);for(let j=f;j<f+p;j++){const q=z[j];T.delete(q,t.OPERATION.DELETE),this.deletedIndexes[q]=!0}}else p=0;if(J>0){if(J>p)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let j=0;j<J;j++){const q=(z[f]??P)+j;T.indexedOperation(q,this.deletedIndexes[q]?t.OPERATION.DELETE_AND_ADD:t.OPERATION.ADD),w[j][d]?.setParent(this,T.root,q)}}return p>J&&T.shiftAllChangeIndexes(-(p-J),z[f+J]),T.filteredChanges!==void 0?T.root?.enqueueChangeTree(T,"filteredChanges"):T.root?.enqueueChangeTree(T,"changes"),this.items.splice(f,p,...w)}unshift(...f){const p=this[d];return p.shiftChangeIndexes(f.length),p.isFiltered?At(p.filteredChanges,this.items.length):At(p.allChanges,this.items.length),f.forEach((w,T)=>{p.change(T,t.OPERATION.ADD)}),this.tmpItems.unshift(...f),this.items.unshift(...f)}indexOf(f,p){return this.items.indexOf(f,p)}lastIndexOf(f,p=this.length-1){return this.items.lastIndexOf(f,p)}every(f,p){return this.items.every(f,p)}some(f,p){return this.items.some(f,p)}forEach(f,p){return this.items.forEach(f,p)}map(f,p){return this.items.map(f,p)}filter(f,p){return this.items.filter(f,p)}reduce(f,p){return this.items.reduce(f,p)}reduceRight(f,p){return this.items.reduceRight(f,p)}find(f,p){return this.items.find(f,p)}findIndex(f,p){return this.items.findIndex(f,p)}fill(f,p,w){throw new Error("ArraySchema#fill() not implemented")}copyWithin(f,p,w){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return Pt}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(f,p){return this.items.includes(f,p)}flatMap(f,p){throw new Error("ArraySchema#flatMap() is not supported.")}flat(f){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...f){return this.items.findLastIndex.apply(this.items,arguments)}with(f,p){const w=this.items.slice();return f<0&&(f+=this.length),w[f]=p,new Pt(...w)}toReversed(){return this.items.slice().reverse()}toSorted(f){return this.items.slice().sort(f)}toSpliced(f,p,...w){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move(f=>{let p=this.items.length;for(;p!=0;){let w=Math.floor(Math.random()*p);p--,[this[p],this[w]]=[this[w],this[p]]}})}move(f){return this.isMovingItems=!0,f(this),this.isMovingItems=!1,this}[h](f,p=!1){return p?this.items[f]:this.deletedIndexes[f]?this.items[f]:this.tmpItems[f]||this.items[f]}[c](f){this.items[f]=void 0,this.tmpItems[f]=void 0}[u](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[m](){this.items=this.items.filter(f=>f!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(f=>typeof f.toJSON=="function"?f.toJSON():f)}clone(f){let p;return f?(p=new Pt,p.push(...this.items)):p=new Pt(...this.map(w=>w[d]?w.clone():w)),p}};Pt[Rr]=Tr,Pt[Or]=vh;let Ot=Pt;Xt("array",{constructor:Ot});var kr,Pr;const us=class us{static[(kr=a,Pr=o,r)](f,p,w){return!w||typeof f[g]=="string"||w.isChangeTreeVisible((f[h](p)??f.deletedItems[p])[d])}static is(f){return f.map!==void 0}constructor(f){this.$items=new Map,this.$indexes=new Map,this.deletedItems={};const p=new Ns(this);if(p.indexes={},Object.defineProperty(this,d,{value:p,enumerable:!1,writable:!0}),f)if(f instanceof Map||f instanceof us)f.forEach((w,T)=>this.set(T,w));else for(const w in f)this.set(w,f[w]);Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return us}set(f,p){if(p==null)throw new Error(`MapSchema#set('${f}', ${p}): trying to set ${p} value on '${f}'.`);typeof p=="object"&&this[g]&&Ai(p,this[g],this,f),f=f.toString();const w=this[d],T=p[d]!==void 0;let P,X;if(typeof w.indexes[f]<"u"){P=w.indexes[f],X=t.OPERATION.REPLACE;const J=this.$items.get(f);if(J===p)return;T&&(X=t.OPERATION.DELETE_AND_ADD,J!==void 0&&J[d].root?.remove(J[d])),this.deletedItems[P]&&delete this.deletedItems[P]}else P=w.indexes[b]??0,X=t.OPERATION.ADD,this.$indexes.set(P,f),w.indexes[f]=P,w.indexes[b]=P+1;return this.$items.set(f,p),w.change(P,X),T&&p[d].setParent(this,w.root,P),this}get(f){return this.$items.get(f)}delete(f){if(!this.$items.has(f))return!1;const p=this[d].indexes[f];return this.deletedItems[p]=this[d].delete(p),this.$items.delete(f)}clear(){const f=this[d];f.discard(!0),f.indexes={},f.forEachChild((p,w)=>{f.root?.remove(p)}),this.$indexes.clear(),this.$items.clear(),f.operation(t.OPERATION.CLEAR)}has(f){return this.$items.has(f)}forEach(f){this.$items.forEach(f)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(f,p){this.$indexes.set(f,p)}getIndex(f){return this.$indexes.get(f)}[h](f){return this.$items.get(this.$indexes.get(f))}[c](f){const p=this.$indexes.get(f);this.$items.delete(p),this.$indexes.delete(f)}[u](){const f=this[d];for(const p in this.deletedItems){const w=parseInt(p),T=this.$indexes.get(w);delete f.indexes[T],this.$indexes.delete(w)}this.deletedItems={}}toJSON(){const f={};return this.forEach((p,w)=>{f[w]=typeof p.toJSON=="function"?p.toJSON():p}),f}clone(f){let p;return f?p=Object.assign(new us,this):(p=new us,this.forEach((w,T)=>{w[d]?p.set(T,w.clone()):p.set(T,w)})),p}};us[kr]=Ei,us[Pr]=Ti;let es=us;Xt("map",{constructor:es});var _r,Mr;const js=class js{static[(_r=a,Mr=o,r)](f,p,w){return!w||typeof f[g]=="string"||w.isChangeTreeVisible((f[h](p)??f.deletedItems[p])[d])}static is(f){return f.collection!==void 0}constructor(f){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new Ns(this),this[d].indexes={},f&&f.forEach(p=>this.add(p)),Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(f){const p=this.$refId++;return f[d]!==void 0&&f[d].setParent(this,this[d].root,p),this[d].indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,f),this[d].change(p),p}at(f){const p=Array.from(this.$items.keys())[f];return this.$items.get(p)}entries(){return this.$items.entries()}delete(f){const p=this.$items.entries();let w,T;for(;(T=p.next())&&!T.done;)if(f===T.value[1]){w=T.value[0];break}return w===void 0?!1:(this.deletedItems[w]=this[d].delete(w),this.$indexes.delete(w),this.$items.delete(w))}clear(){const f=this[d];f.discard(!0),f.indexes={},f.forEachChild((p,w)=>{f.root?.remove(p)}),this.$indexes.clear(),this.$items.clear(),f.operation(t.OPERATION.CLEAR)}has(f){return Array.from(this.$items.values()).some(p=>p===f)}forEach(f){this.$items.forEach((p,w,T)=>f(p,w,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(f,p){this.$indexes.set(f,p)}getIndex(f){return this.$indexes.get(f)}[h](f){return this.$items.get(this.$indexes.get(f))}[c](f){const p=this.$indexes.get(f);this.$items.delete(p),this.$indexes.delete(f)}[u](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const f=[];return this.forEach((p,w)=>{f.push(typeof p.toJSON=="function"?p.toJSON():p)}),f}clone(f){let p;return f?p=Object.assign(new js,this):(p=new js,this.forEach(w=>{w[d]?p.add(w.clone()):p.add(w)})),p}};js[_r]=Ei,js[Mr]=Ti;let Ys=js;Xt("collection",{constructor:Ys});var Lr,Fr;const Gs=class Gs{static[(Lr=a,Fr=o,r)](f,p,w){return!w||typeof f[g]=="string"||w.visible.has((f[h](p)??f.deletedItems[p])[d])}static is(f){return f.set!==void 0}constructor(f){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[d]=new Ns(this),this[d].indexes={},f&&f.forEach(p=>this.add(p)),Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(f){if(this.has(f))return!1;const p=this.$refId++;f[d]!==void 0&&f[d].setParent(this,this[d].root,p);const w=this[d].indexes[p]?.op??t.OPERATION.ADD;return this[d].indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,f),this[d].change(p,w),p}entries(){return this.$items.entries()}delete(f){const p=this.$items.entries();let w,T;for(;(T=p.next())&&!T.done;)if(f===T.value[1]){w=T.value[0];break}return w===void 0?!1:(this.deletedItems[w]=this[d].delete(w),this.$indexes.delete(w),this.$items.delete(w))}clear(){const f=this[d];f.discard(!0),f.indexes={},this.$indexes.clear(),this.$items.clear(),f.operation(t.OPERATION.CLEAR)}has(f){const p=this.$items.values();let w=!1,T;for(;(T=p.next())&&!T.done;)if(f===T.value){w=!0;break}return w}forEach(f){this.$items.forEach((p,w,T)=>f(p,w,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(f,p){this.$indexes.set(f,p)}getIndex(f){return this.$indexes.get(f)}[h](f){return this.$items.get(this.$indexes.get(f))}[c](f){const p=this.$indexes.get(f);this.$items.delete(p),this.$indexes.delete(f)}[u](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const f=[];return this.forEach((p,w)=>{f.push(typeof p.toJSON=="function"?p.toJSON():p)}),f}clone(f){let p;return f?p=Object.assign(new Gs,this):(p=new Gs,this.forEach(w=>{w[d]?p.add(w.clone()):p.add(w)})),p}};Gs[Lr]=Ei,Gs[Fr]=Ti;let Xs=Gs;Xt("set",{constructor:Xs});const ts=-1;function Ah(I){return Ut.register(I),I}function Dr(I=ts){return function(f,p){const w=f.constructor,P=Object.getPrototypeOf(w)[Symbol.metadata],X=w[Symbol.metadata]??=Object.assign({},w[Symbol.metadata],P??Object.create(null));nt.setTag(X,p,I)}}function kt(I,f){return function(p,w){const T=p.constructor;if(!I)throw new Error(`${T.name}: @type() reference provided for "${w}" is undefined. Make sure you don't have any circular dependencies.`);I=ds(I),Ut.register(T);const X=Object.getPrototypeOf(T)[Symbol.metadata],J=nt.initialize(T);let z=J[w];if(J[z]!==void 0){if(J[z].deprecated)return;if(J[z].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${w}' definition on '${T.name}'.
Check @type() annotation`)}catch(j){const q=j.stack.split(`
`)[4].trim();throw new Error(`${j.message} ${q}`)}}else z=J[b]??(X&&X[b])??-1,z++;if(f&&f.manual)nt.addField(J,z,w,I,{enumerable:!0,configurable:!0,writable:!0});else{const j=typeof Object.keys(I)[0]=="string"&&xn(Object.keys(I)[0]),q=j?Object.values(I)[0]:I;nt.addField(J,z,w,I,Br(`_${w}`,z,q,j))}}}function Br(I,f,p,w){return{get:function(){return this[I]},set:function(T){const P=this[I]??void 0;if(T!==P){if(T!=null){w?(w.constructor===Ot&&!(T instanceof Ot)&&(T=new Ot(...T)),w.constructor===es&&!(T instanceof es)&&(T=new es(T)),T[g]=p):typeof p!="string"?Ai(T,p,this,I.substring(1)):Eh(T,p,this,I.substring(1));const X=this[d];P!==void 0&&P[d]?(X.root?.remove(P[d]),this.constructor[n](X,f,t.OPERATION.DELETE_AND_ADD)):this.constructor[n](X,f,t.OPERATION.ADD),T[d]?.setParent(this,X.root,f)}else P!==void 0&&this[d].delete(f);this[I]=T}},enumerable:!0,configurable:!0}}function Ch(I=!0){return function(f,p){const w=f.constructor,P=Object.getPrototypeOf(w)[Symbol.metadata],X=w[Symbol.metadata]??=Object.assign({},w[Symbol.metadata],P??Object.create(null)),J=X[p];X[J].deprecated=!0,I&&(X[y]??={},X[y][p]={get:function(){throw new Error(`${p} is deprecated.`)},set:function(z){},enumerable:!1,configurable:!0}),Object.defineProperty(X,J,{value:X[J],enumerable:!1,configurable:!0})}}function Ih(I,f,p){for(let w in f)kt(f[w],p)(I.prototype,w);return I}function Nr(I,f,p=qe){const w={},T={},P={},X={};for(let j in I){const q=I[j];typeof q=="object"?(q.view!==void 0&&(X[j]=typeof q.view=="boolean"?ts:q.view),w[j]=ds(q),Object.prototype.hasOwnProperty.call(q,"default")?P[j]=q.default:Array.isArray(q)||q.array!==void 0?P[j]=new Ot:q.map!==void 0?P[j]=new es:q.collection!==void 0?P[j]=new Ys:q.set!==void 0?P[j]=new Xs:q.type!==void 0&&qe.is(q.type)&&(P[j]=new q.type)):typeof q=="function"?qe.is(q)?(P[j]=new q,w[j]=ds(q)):T[j]=q:w[j]=ds(q)}const J=()=>{const j={};for(const q in P){const Q=P[q];Q&&typeof Q.clone=="function"?j[q]=Q.clone():j[q]=Q}return j},z=nt.setFields(class extends p{constructor(...j){super(Object.assign({},J(),j[0]||{})),T.initialize&&typeof T.initialize=="function"&&T.initialize.apply(this,j)}},w);z._getDefaultValues=J,Object.assign(z.prototype,T);for(let j in X)Dr(X[j])(z.prototype,j);return f&&Object.defineProperty(z,"name",{value:f}),z.extends=(j,q)=>Nr(j,q,z),z}function Ci(I){return new Array(I).fill(0).map((f,p)=>p===I-1?" ":"   ").join("")}function Rh(I){const f=I[d].root,p={ops:{},refs:[]};let w=f.changes.next;for(;w;){const T=w.changeTree;if(T===void 0){w=w.next;continue}const P=T.indexedOperations;p.refs.push(`refId#${T.refId}`);for(const X in P){const J=P[X],z=t.OPERATION[J];p.ops[z]||(p.ops[z]=0),p.ops[t.OPERATION[J]]++}w=w.next}return p}var Yr,Xr;const Hs=class Hs{static initialize(f){Object.defineProperty(f,d,{value:new Ns(f),enumerable:!1,writable:!0}),Object.defineProperties(f,f.constructor[Symbol.metadata]?.[y]||{})}static is(f){return typeof f[Symbol.metadata]=="object"}static[(Yr=a,Xr=o,n)](f,p,w=t.OPERATION.ADD){f.change(p,w)}static[r](f,p,w){const P=f.constructor[Symbol.metadata][p]?.tag;if(w===void 0)return P===void 0;if(P===void 0)return!0;if(P===ts)return w.isChangeTreeVisible(f[d]);{const X=w.tags?.get(f[d]);return X&&X.has(P)}}constructor(f){Hs.initialize(this),f&&Object.assign(this,f)}assign(f){return Object.assign(this,f),this}setDirty(f,p){const w=this.constructor[Symbol.metadata];this[d].change(w[w[f]].index,p)}clone(){const f=Object.create(this.constructor.prototype);Hs.initialize(f);const p=this.constructor[Symbol.metadata];for(const w in p){const T=p[w].name;typeof this[T]=="object"&&typeof this[T]?.clone=="function"?f[T]=this[T].clone():f[T]=this[T]}return f}toJSON(){const f={},p=this.constructor[Symbol.metadata];for(const w in p){const T=p[w],P=T.name;!T.deprecated&&this[P]!==null&&typeof this[P]<"u"&&(f[P]=typeof this[P].toJSON=="function"?this[P].toJSON():this[P])}return f}discardAllChanges(){this[d].discardAll()}[h](f){const p=this.constructor[Symbol.metadata];return this[p[f].name]}[c](f){const p=this.constructor[Symbol.metadata];this[p[f].name]=void 0}static debugRefIds(f,p=!1,w=0,T,P=""){const X=p?` - ${JSON.stringify(f.toJSON())}`:"",J=f[d],z=T?T.root.refIds.get(f):J.refId,j=T?T.root:J.root,q=j?.refCount?.[z]>1?` [${j.refCount[z]}]`:"";let Q=`${Ci(w)}${P}${f.constructor.name} (refId: ${z})${q}${X}
`;return J.forEachChild((fe,he)=>{let ne=he;typeof he=="number"&&f.$indexes&&(ne=f.$indexes.get(he)??he);const ie=f.forEach!==void 0&&ne!==void 0?`["${ne}"]: `:"";Q+=this.debugRefIds(fe.ref,p,w+1,T,ie)}),Q}static debugRefIdEncodingOrder(f,p="allChanges"){let w=[],T=f[d].root[p].next;for(;T;)T.changeTree&&w.push(T.changeTree.refId),T=T.next;return w}static debugRefIdsFromDecoder(f){return this.debugRefIds(f.state,!1,0,f)}static debugChanges(f,p=!1){const w=f[d],T=p?w.allChanges:w.changes,P=p?"allChanges":"changes";let X=`${f.constructor.name} (${w.refId}) -> .${P}:
`;function J(z){z.operations.filter(j=>j).forEach(j=>{const q=w.indexedOperations[j];X+=`- [${j}]: ${t.OPERATION[q]} (${JSON.stringify(w.getValue(Number(j),p))})
`})}return J(T),!p&&w.filteredChanges&&w.filteredChanges.operations.filter(z=>z).length>0&&(X+=`${f.constructor.name} (${w.refId}) -> .filteredChanges:
`,J(w.filteredChanges)),p&&w.allFilteredChanges&&w.allFilteredChanges.operations.filter(z=>z).length>0&&(X+=`${f.constructor.name} (${w.refId}) -> .allFilteredChanges:
`,J(w.allFilteredChanges)),X}static debugChangesDeep(f,p="changes"){let w="";const T=f[d],P=T.root,X=new Map,J=[];let z=0;for(const[q,Q]of Object.entries(P[p])){const fe=P.changeTrees[q];if(!fe)continue;let he=!1,ne=[],ie=fe.parent?.[d];if(fe===T)he=!0;else for(;ie!==void 0;){if(ne.push(ie),ie.ref===f){he=!0;break}ie=ie.parent?.[d]}he&&(J.push(fe.refId),z+=Object.keys(Q).length,X.set(fe,ne.reverse()))}w+=`---
`,w+=`root refId: ${T.refId}
`,w+=`Total instances: ${J.length} (refIds: ${J.join(", ")})
`,w+=`Total changes: ${z}
`,w+=`---
`;const j=new WeakSet;for(const[q,Q]of X.entries()){Q.forEach((de,Je)=>{j.has(de)||(w+=`${Ci(Je)}${de.ref.constructor.name} (refId: ${de.refId})
`,j.add(de))});const fe=q.indexedOperations,he=Q.length,ne=Ci(he),ie=he>0?`(${q.parentIndex}) `:"";w+=`${ne}${ie}${q.ref.constructor.name} (refId: ${q.refId}) - changes: ${Object.keys(fe).length}
`;for(const de in fe){const Je=fe[de];w+=`${Ci(he+1)}${t.OPERATION[Je]}: ${de}
`}}return`${w}`}};Hs[Yr]=Er,Hs[Xr]=Cr;let qe=Hs;function fs(I,f,p,w){var T=arguments.length,P=T<3?f:w,X;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(I,f,p,w);else for(var J=I.length-1;J>=0;J--)(X=I[J])&&(P=(T<3?X(P):T>3?X(f,p,P):X(f,p))||P);return T>3&&P&&Object.defineProperty(f,p,P),P}typeof SuppressedError=="function"&&SuppressedError;class Oh{constructor(f){this.types=f,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=Bs(),this.allFilteredChanges=Bs(),this.changes=Bs(),this.filteredChanges=Bs()}getNextUniqueId(){return this.nextUniqueId++}add(f){f.refId===void 0&&(f.refId=this.getNextUniqueId());const p=this.changeTrees[f.refId]===void 0;p&&(this.changeTrees[f.refId]=f);const w=this.refCount[f.refId];if(w===0){const T=f.allChanges.operations;let P=T.length;for(;P--;)f.indexedOperations[T[P]]=t.OPERATION.ADD,At(f.changes,P)}return this.refCount[f.refId]=(w||0)+1,p}remove(f){const p=this.refCount[f.refId]-1;return p<=0?(f.root=void 0,delete this.changeTrees[f.refId],this.removeChangeFromChangeSet("allChanges",f),this.removeChangeFromChangeSet("changes",f),f.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",f),this.removeChangeFromChangeSet("filteredChanges",f)),this.refCount[f.refId]=0,f.forEachChild((w,T)=>{w.removeParent(f.ref)&&(w.parentChain===void 0||w.parentChain&&this.refCount[w.refId]>0?this.remove(w):w.parentChain&&this.moveNextToParent(w))})):(this.refCount[f.refId]=p,this.recursivelyMoveNextToParent(f)),p}recursivelyMoveNextToParent(f){this.moveNextToParent(f),f.forEachChild((p,w)=>this.recursivelyMoveNextToParent(p))}moveNextToParent(f){f.filteredChanges?(this.moveNextToParentInChangeTreeList("filteredChanges",f),this.moveNextToParentInChangeTreeList("allFilteredChanges",f)):(this.moveNextToParentInChangeTreeList("changes",f),this.moveNextToParentInChangeTreeList("allChanges",f))}moveNextToParentInChangeTreeList(f,p){const w=this[f],T=p[f].queueRootNode;if(!T)return;const P=p.parent;if(!P||!P[d])return;const X=P[d][f]?.queueRootNode;if(!X||X===T)return;const J=X.position;T.position>J||(T.prev?T.prev.next=T.next:w.next=T.next,T.next?T.next.prev=T.prev:w.tail=T.prev,T.prev=X,T.next=X.next,X.next?X.next.prev=T:w.tail=T,X.next=T,this.updatePositionsAfterMove(w,T,J+1))}enqueueChangeTree(f,p,w=f[p].queueRootNode){w||(f[p].queueRootNode=this.addToChangeTreeList(this[p],f))}addToChangeTreeList(f,p){const w={changeTree:p,next:void 0,prev:void 0,position:f.tail?f.tail.position+1:0};return f.next?(w.prev=f.tail,f.tail.next=w,f.tail=w):(f.next=w,f.tail=w),w}updatePositionsAfterRemoval(f,p){let w=f.next,T=0;for(;w;)T>=p&&(w.position=T),w=w.next,T++}updatePositionsAfterMove(f,p,w){let T=f.next,P=0;for(;T;)T.position=P,T=T.next,P++}removeChangeFromChangeSet(f,p){const w=this[f],T=p[f].queueRootNode;if(T&&T.changeTree===p){const P=T.position;return T.prev?T.prev.next=T.next:w.next=T.next,T.next?T.next.prev=T.prev:w.tail=T.prev,this.updatePositionsAfterRemoval(w,P),p[f].queueRootNode=void 0,!0}return!1}}const Ri=class Ri{constructor(f){this.sharedBuffer=Buffer.allocUnsafe(Ri.BUFFER_SIZE),this.context=Ut.cache(f.constructor),this.root=new Oh(this.context),this.setState(f)}setState(f){this.state=f,this.state[d].setRoot(this.root)}encode(f={offset:0},p,w=this.sharedBuffer,T="changes",P=T==="allChanges",X=f.offset){const J=p!==void 0,z=this.state[d];let j=this.root[T];for(;j=j.next;){const q=j.changeTree;if(J){if(!p.isChangeTreeVisible(q)){p.invisible.add(q);continue}p.invisible.delete(q)}const Q=q[T],fe=q.ref,he=Q.operations.length;if(he===0)continue;const ne=fe.constructor,ie=ne[a],de=ne[r],Je=ne[Symbol.metadata];(J||f.offset>X||q!==z)&&(w[f.offset++]=255,Ye.number(w,q.refId,f));for(let Ke=0;Ke<he;Ke++){const Ct=Q.operations[Ke];if(Ct<0){w[f.offset++]=Math.abs(Ct)&255;continue}const It=P?t.OPERATION.ADD:q.indexedOperations[Ct];Ct===void 0||It===void 0||de&&!de(fe,Ct,p)||ie(this,w,q,Ct,It,f,P,J,Je)}}if(f.offset>w.byteLength){const q=Math.ceil(f.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(q/1024)} * 1024; // ${Math.round(q/1024)} KB
`),w=Buffer.alloc(q,w),w===this.sharedBuffer&&(this.sharedBuffer=w),this.encode({offset:X},p,w,T,P)}else return w.subarray(0,f.offset)}encodeAll(f={offset:0},p=this.sharedBuffer){return this.encode(f,void 0,p,"allChanges",!0)}encodeAllView(f,p,w,T=this.sharedBuffer){const P=w.offset;return this.encode(w,f,T,"allFilteredChanges",!0,P),Buffer.concat([T.subarray(0,p),T.subarray(P,w.offset)])}encodeView(f,p,w,T=this.sharedBuffer){const P=w.offset;for(const[X,J]of f.changes){const z=this.root.changeTrees[X];if(z===void 0){f.changes.delete(X);continue}const j=Object.keys(J);if(j.length===0)continue;const Q=z.ref.constructor,fe=Q[a],he=Q[Symbol.metadata];T[w.offset++]=255,Ye.number(T,z.refId,w);for(let ne=0,ie=j.length;ne<ie;ne++){const de=Number(j[ne]),Ke=z.ref[h](de)!==void 0&&J[de]||t.OPERATION.DELETE;fe(this,T,z,de,Ke,w,!1,!0,he)}}return f.changes.clear(),this.encode(w,f,T,"filteredChanges",!1,P),Buffer.concat([T.subarray(0,p),T.subarray(P,w.offset)])}discardChanges(){let f=this.root.changes.next;for(;f;)f.changeTree.endEncode("changes"),f=f.next;for(this.root.changes=Bs(),f=this.root.filteredChanges.next;f;)f.changeTree.endEncode("filteredChanges"),f=f.next;this.root.filteredChanges=Bs()}tryEncodeTypeId(f,p,w,T){const P=this.context.getTypeId(p),X=this.context.getTypeId(w);if(X===void 0){console.warn(`@colyseus/schema WARNING: Class "${w.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}P!==X&&(f[T.offset++]=213,Ye.number(f,X,T))}get hasChanges(){return this.root.changes.next!==void 0||this.root.filteredChanges.next!==void 0}};Ri.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Ii=Ri;function Ur(I,f){if(f===-1||f>=I.length)return!1;const p=I.length-1;for(let w=f;w<p;w++)I[w]=I[w+1];return I.length=p,!0}class Vr extends Error{constructor(f){super(f),this.name="DecodingWarning"}}class kh{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCount={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(f,p,w=!0){this.refs.set(f,p),this.refIds.set(p,f),w&&(this.refCount[f]=(this.refCount[f]||0)+1),this.deletedRefs.has(f)&&this.deletedRefs.delete(f)}removeRef(f){const p=this.refCount[f];if(p===void 0){try{throw new Vr("trying to remove refId that doesn't exist: "+f)}catch(w){console.warn(w)}return}if(p===0){try{const w=this.refs.get(f);throw new Vr(`trying to remove refId '${f}' with 0 refCount (${w.constructor.name}: ${JSON.stringify(w)})`)}catch(w){console.warn(w)}return}(this.refCount[f]=p-1)<=0&&this.deletedRefs.add(f)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCount={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(f=>{if(this.refCount[f]>0)return;const p=this.refs.get(f);if(p.constructor[Symbol.metadata]!==void 0){const w=p.constructor[Symbol.metadata];for(const T in w){const P=w[T].name,X=typeof p[P]=="object"&&this.refIds.get(p[P]);X&&!this.deletedRefs.has(X)&&this.removeRef(X)}}else typeof p[g]=="function"&&Array.from(p.values()).forEach(w=>{const T=this.refIds.get(w);this.deletedRefs.has(T)||this.removeRef(T)});this.refs.delete(f),delete this.refCount[f],delete this.callbacks[f]}),this.deletedRefs.clear()}addCallback(f,p,w){if(f===void 0){const T=typeof p=="number"?t.OPERATION[p]:p;throw new Error(`Can't addCallback on '${T}' (refId is undefined)`)}return this.callbacks[f]||(this.callbacks[f]={}),this.callbacks[f][p]||(this.callbacks[f][p]=[]),this.callbacks[f][p].push(w),()=>this.removeCallback(f,p,w)}removeCallback(f,p,w){const T=this.callbacks?.[f]?.[p]?.indexOf(w);T!==void 0&&T!==-1&&Ur(this.callbacks[f][p],T)}}class En{constructor(f,p){this.currentRefId=0,this.setState(f),this.context=p||new Ut(f.constructor)}setState(f){this.state=f,this.root=new kh,this.root.addRef(0,f)}decode(f,p={offset:0},w=this.state){const T=[],P=this.root,X=f.byteLength;let J=w.constructor[o];for(this.currentRefId=0;p.offset<X;){if(f[p.offset]==255){p.offset++,w[m]?.();const j=Tt.number(f,p),q=P.refs.get(j);q?(w=q,J=w.constructor[o],this.currentRefId=j):(console.error(`"refId" not found: ${j}`,{previousRef:w,previousRefId:this.currentRefId}),console.warn("Please report this issue to the developers."),this.skipCurrentStructure(f,p,X));continue}if(J(this,f,p,w,T)===Ar){console.warn("@colyseus/schema: definition mismatch"),this.skipCurrentStructure(f,p,X);continue}}return w[m]?.(),this.triggerChanges?.(T),P.garbageCollectDeletedRefs(),T}skipCurrentStructure(f,p,w){const T={offset:p.offset};for(;p.offset<w&&!(f[p.offset]===255&&(T.offset=p.offset+1,this.root.refs.has(Tt.number(f,T))));)p.offset++}getInstanceType(f,p,w){let T;if(f[p.offset]===213){p.offset++;const P=Tt.number(f,p);T=this.context.get(P)}return T||w}createInstanceOfType(f){return new f}removeChildRefs(f,p){const w=typeof f[g]!="string",T=this.root.refIds.get(f);f.forEach((P,X)=>{p.push({ref:f,refId:T,op:t.OPERATION.DELETE,field:X,value:void 0,previousValue:P}),w&&this.root.removeRef(this.root.refIds.get(P))})}}class Us extends qe{}fs([kt("string")],Us.prototype,"name",void 0),fs([kt("string")],Us.prototype,"type",void 0),fs([kt("number")],Us.prototype,"referencedType",void 0);class Vs extends qe{constructor(){super(...arguments),this.fields=new Ot}}fs([kt("number")],Vs.prototype,"id",void 0),fs([kt("number")],Vs.prototype,"extendsId",void 0),fs([kt([Us])],Vs.prototype,"fields",void 0);class zs extends qe{constructor(){super(...arguments),this.types=new Ot}static encode(f,p={offset:0}){const w=f.context,T=new zs,P=new Ii(T),X=w.schemas.get(f.state.constructor);X>0&&(T.rootType=X);const J=new Set,z={},j=Q=>{if(Q.extendsId===void 0||J.has(Q.extendsId)){J.add(Q.id),T.types.push(Q);const fe=z[Q.id];fe!==void 0&&(delete z[Q.id],fe.forEach(he=>j(he)))}else z[Q.extendsId]===void 0&&(z[Q.extendsId]=[]),z[Q.extendsId].push(Q)};w.schemas.forEach((Q,fe)=>{const he=new Vs;he.id=Number(Q);const ne=Object.getPrototypeOf(fe);ne!==qe&&(he.extendsId=w.schemas.get(ne));const ie=fe[Symbol.metadata];if(ie!==ne[Symbol.metadata])for(const de in ie){const Je=Number(de),Ke=ie[Je].name;if(!Object.prototype.hasOwnProperty.call(ie,Ke))continue;const Ct=new Us;Ct.name=Ke;let It;const ms=ie[Je];if(typeof ms.type=="string")It=ms.type;else{let Oi;qe.is(ms.type)?(It="ref",Oi=ms.type):(It=Object.keys(ms.type)[0],typeof ms.type[It]=="string"?It+=":"+ms.type[It]:Oi=ms.type[It]),Ct.referencedType=Oi?w.getTypeId(Oi):-1}Ct.type=It,he.fields.push(Ct)}j(he)});for(const Q in z)z[Q].forEach(fe=>T.types.push(fe));return P.encodeAll(p).slice(0,p.offset)}static decode(f,p){const w=new zs;new En(w).decode(f,p);const P=new Ut;w.types.forEach(z=>{const j=P.get(z.extendsId)??qe,q=class extends j{};Ut.register(q),P.add(q,z.id)},{});const X=(z,j,q)=>{j.fields.forEach((Q,fe)=>{const he=q+fe;if(Q.referencedType!==void 0){let ne=Q.type,ie=P.get(Q.referencedType);if(!ie){const de=Q.type.split(":");ne=de[0],ie=de[1]}ne==="ref"?nt.addField(z,he,Q.name,ie):nt.addField(z,he,Q.name,{[ne]:ie})}else nt.addField(z,he,Q.name,Q.type)})};w.types.forEach(z=>{const j=P.get(z.id),q=nt.initialize(j),Q=[];let fe=z;do Q.push(fe),fe=w.types.find(ne=>ne.id===fe.extendsId);while(fe);let he=0;Q.reverse().forEach(ne=>{X(q,ne,he),he+=ne.fields.length})});const J=new(P.get(w.rootType||0));return new En(J,P)}}fs([kt([Vs])],zs.prototype,"types",void 0),fs([kt("number")],zs.prototype,"rootType",void 0);function Ph(I){const f=I.root,p=f.callbacks,w=new WeakMap;let T;I.triggerChanges=function(J){const z=new Set;for(let j=0,q=J.length;j<q;j++){const Q=J[j],fe=Q.refId,he=Q.ref,ne=p[fe];if(ne){if((Q.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&Q.previousValue instanceof qe){const ie=p[f.refIds.get(Q.previousValue)]?.[t.OPERATION.DELETE];for(let de=ie?.length-1;de>=0;de--)ie[de]()}if(he instanceof qe){if(!z.has(fe)){const ie=ne?.[t.OPERATION.REPLACE];for(let de=ie?.length-1;de>=0;de--)ie[de]()}if(ne.hasOwnProperty(Q.field)){const ie=ne[Q.field];for(let de=ie?.length-1;de>=0;de--)ie[de](Q.value,Q.previousValue)}}else{if((Q.op&t.OPERATION.DELETE)===t.OPERATION.DELETE){if(Q.previousValue!==void 0){const ie=ne[t.OPERATION.DELETE];for(let de=ie?.length-1;de>=0;de--)ie[de](Q.previousValue,Q.dynamicIndex??Q.field)}if((Q.op&t.OPERATION.ADD)===t.OPERATION.ADD){const ie=ne[t.OPERATION.ADD];for(let de=ie?.length-1;de>=0;de--)ie[de](Q.value,Q.dynamicIndex??Q.field)}}else if((Q.op&t.OPERATION.ADD)===t.OPERATION.ADD&&Q.previousValue!==Q.value){const ie=ne[t.OPERATION.ADD];for(let de=ie?.length-1;de>=0;de--)ie[de](Q.value,Q.dynamicIndex??Q.field)}if(Q.value!==Q.previousValue&&(Q.value!==void 0||Q.previousValue!==void 0)){const ie=ne[t.OPERATION.REPLACE];for(let de=ie?.length-1;de>=0;de--)ie[de](Q.value,Q.dynamicIndex??Q.field)}}z.add(fe)}}};function P(J,z){let j=z.instance?.constructor[Symbol.metadata]||J,q=z.instance&&typeof z.instance.forEach=="function"||J&&typeof J[Symbol.metadata]>"u";if(j&&!q){const Q=function(fe,he,ne,ie){return ie&&z.instance[he]!==void 0&&!w.has(T)&&ne(z.instance[he],void 0),f.addCallback(f.refIds.get(fe),he,ne)};return new Proxy({listen:function(he,ne,ie=!0){if(z.instance)return Q(z.instance,he,ne,ie);{let de=()=>{};return z.onInstanceAvailable((Je,Ke)=>{de=Q(Je,he,ne,ie&&Ke&&!w.has(T))}),()=>de()}},onChange:function(he){return f.addCallback(f.refIds.get(z.instance),t.OPERATION.REPLACE,he)},bindTo:function(he,ne){return ne||(ne=Object.keys(j).map(ie=>j[ie].name)),f.addCallback(f.refIds.get(z.instance),t.OPERATION.REPLACE,()=>{ne.forEach(ie=>he[ie]=z.instance[ie])})}},{get(fe,he){const ne=j[j[he]];if(ne){const ie=z.instance?.[he],de=(Je=>{const Ke=X(z.instance).listen(he,(Ct,It)=>{Je(Ct,!1),Ke?.()},!1);f.refIds.get(ie)!==void 0&&Je(ie,!0)});return P(ne.type,{instance:f.refIds.get(ie)&&ie,parentInstance:z.instance,onInstanceAvailable:de})}else return fe[he]},has(fe,he){return j[he]!==void 0},set(fe,he,ne){throw new Error("not allowed")},deleteProperty(fe,he){throw new Error("not allowed")}})}else{const Q=function(ne,ie,de){return de&&ne.forEach((Je,Ke)=>ie(Je,Ke)),f.addCallback(f.refIds.get(ne),t.OPERATION.ADD,(Je,Ke)=>{w.set(ie,!0),T=ie,ie(Je,Ke),w.delete(ie),T=void 0})},fe=function(ne,ie){return f.addCallback(f.refIds.get(ne),t.OPERATION.DELETE,ie)},he=function(ne,ie){return f.addCallback(f.refIds.get(ne),t.OPERATION.REPLACE,ie)};return new Proxy({onAdd:function(ne,ie=!0){if(z.instance)return Q(z.instance,ne,ie&&!w.has(T));if(z.onInstanceAvailable){let de=()=>{};return z.onInstanceAvailable((Je,Ke)=>{de=Q(Je,ne,ie&&Ke&&!w.has(T))}),()=>de()}},onRemove:function(ne){if(z.instance)return fe(z.instance,ne);if(z.onInstanceAvailable){let ie=()=>{};return z.onInstanceAvailable(de=>{ie=fe(de,ne)}),()=>ie()}},onChange:function(ne){if(z.instance)return he(z.instance,ne);if(z.onInstanceAvailable){let ie=()=>{};return z.onInstanceAvailable(de=>{ie=he(de,ne)}),()=>ie()}}},{get(ne,ie){if(!ne[ie])throw new Error(`Can't access '${ie}' through callback proxy. access the instance directly.`);return ne[ie]},has(ne,ie){return ne[ie]!==void 0},set(ne,ie,de){throw new Error("not allowed")},deleteProperty(ne,ie){throw new Error("not allowed")}})}}function X(J){return P(void 0,{instance:J})}return X}function _h(I,f){I.triggerChanges=f}class Mh{constructor(f=!1){this.iterable=f,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,f&&(this.items=[])}add(f,p=ts,w=!0){const T=f?.[d],P=T.parent;if(T){if(!P&&T.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${T.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",f),!1;const X=f.constructor[Symbol.metadata];this.visible.add(T),this.iterable&&w&&this.items.push(f),w&&P&&this.addParentOf(T,p);let J=this.changes.get(T.refId);J===void 0&&(J={},this.changes.set(T.refId,J));let z=!1;if(T.forEachChild((j,q)=>{X&&X[q].tag!==void 0&&X[q].tag!==p||this.add(j.ref,p,!1)&&(z=!0)}),p!==ts){this.tags||(this.tags=new WeakMap);let j;this.tags.has(T)?j=this.tags.get(T):(j=new Set,this.tags.set(T,j)),j.add(p),X?.[S]?.[p]?.forEach(q=>{T.getChange(q)!==t.OPERATION.DELETE&&(J[q]=t.OPERATION.ADD)})}else if(!T.isNew||z){const j=T.filteredChanges!==void 0?T.allFilteredChanges:T.allChanges,q=this.invisible.has(T);for(let Q=0,fe=j.operations.length;Q<fe;Q++){const he=j.operations[Q];if(he===void 0)continue;const ne=T.indexedOperations[he]??t.OPERATION.ADD,ie=X?.[he].tag;ne!==t.OPERATION.DELETE&&(q||ie===void 0||ie===p)&&(J[he]=ne,z=!0)}}return z}addParentOf(f,p){const w=f.parent[d],T=f.parentIndex;if(!this.visible.has(w)){this.visible.add(w);const P=w.parent?.[d];P&&P.filteredChanges!==void 0&&this.addParentOf(w,p)}if(w.getChange(T)!==t.OPERATION.DELETE){let P=this.changes.get(w.refId);P===void 0&&(P={},this.changes.set(w.refId,P)),this.tags||(this.tags=new WeakMap);let X;this.tags.has(w)?X=this.tags.get(w):(X=new Set,this.tags.set(w,X)),X.add(p),P[T]=t.OPERATION.ADD}}remove(f,p=ts,w=!1){const T=f[d];if(!T)return console.warn("StateView#remove(), invalid object:",f),this;this.visible.delete(T),this.iterable&&!w&&Ur(this.items,this.items.indexOf(f));const X=T.ref.constructor[Symbol.metadata];let J=this.changes.get(T.refId);if(J===void 0&&(J={},this.changes.set(T.refId,J)),p===ts){const z=T.parent;if(z&&!nt.isValidInstance(z)&&T.isFiltered){const j=z[d];let q=this.changes.get(j.refId);q===void 0?(q={},this.changes.set(j.refId,q)):q[T.parentIndex]===t.OPERATION.ADD&&this.changes.delete(T.refId),q[T.parentIndex]=t.OPERATION.DELETE,this._recursiveDeleteVisibleChangeTree(T)}else X?.[v]?.forEach(j=>J[j]=t.OPERATION.DELETE)}else X?.[S][p].forEach(z=>J[z]=t.OPERATION.DELETE);if(this.tags&&this.tags.has(T)){const z=this.tags.get(T);p===void 0?this.tags.delete(T):(z.delete(p),z.size===0&&this.tags.delete(T))}return this}has(f){return this.visible.has(f[d])}hasTag(f,p=ts){return this.tags?.get(f[d])?.has(p)??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let f=0,p=this.items.length;f<p;f++)this.remove(this.items[f],ts,!0);this.items.length=0}isChangeTreeVisible(f){let p=this.visible.has(f);return!p&&f.isVisibilitySharedWithParent&&this.visible.has(f.parent[d])&&(this.visible.add(f),p=!0),p}_recursiveDeleteVisibleChangeTree(f){f.forEachChild(p=>{this.visible.delete(p),this._recursiveDeleteVisibleChangeTree(p)})}}Xt("map",{constructor:es}),Xt("array",{constructor:Ot}),Xt("set",{constructor:Xs}),Xt("collection",{constructor:Ys}),t.$changes=d,t.$childType=g,t.$decoder=o,t.$deleteByIndex=c,t.$encoder=a,t.$filter=r,t.$getByIndex=h,t.$track=n,t.ArraySchema=Ot,t.ChangeTree=Ns,t.CollectionSchema=Ys,t.Decoder=En,t.Encoder=Ii,t.MapSchema=es,t.Metadata=nt,t.Reflection=zs,t.ReflectionField=Us,t.ReflectionType=Vs,t.Schema=qe,t.SetSchema=Xs,t.StateView=Mh,t.TypeContext=Ut,t.decode=Tt,t.decodeKeyValueOperation=Ti,t.decodeSchemaOperation=Cr,t.defineCustomTypes=xh,t.defineTypes=Ih,t.deprecated=Ch,t.dumpChanges=Rh,t.encode=Ye,t.encodeArray=Tr,t.encodeKeyValueOperation=Ei,t.encodeSchemaOperation=Er,t.entity=Ah,t.getDecoderStateCallbacks=Ph,t.getRawChangesCallback=_h,t.registerType=Xt,t.schema=Nr,t.type=kt,t.view=Dr}))})(fi,fi.exports)),fi.exports}var va;function Wf(){if(va)return Fn;va=1;var l=mn,e=gr();class t{constructor(i){this.events=i,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(i,n={}){const a=n.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(n.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(i,a),this.wt.ready.then(o=>{console.log("WebTransport ready!",o),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(h=>{this.reader=h.value.readable.getReader(),this.writer=h.value.writable.getWriter(),this.sendSeatReservation(n.room.roomId,n.sessionId,n.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(h=>{console.error("failed to read incoming stream",h),console.error("TODO: close the connection")})}).catch(o=>{console.log("WebTransport not ready!",o),this._close()}),this.wt.closed.then(o=>{console.log("WebTransport closed w/ success",o),this.events.onclose({code:o.closeCode,reason:o.reason})}).catch(o=>{console.log("WebTransport closed w/ error",o),this.events.onerror(o),this.events.onclose({code:o.closeCode,reason:o.reason})}).finally(()=>{this._close()})}send(i){const n=e.encode.number(this.lengthPrefixBuffer,i.length,{offset:0}),a=new Uint8Array(n+i.length);a.set(this.lengthPrefixBuffer.subarray(0,n),0),a.set(i,n),this.writer.write(a)}sendUnreliable(i){const n=e.encode.number(this.lengthPrefixBuffer,i.length,{offset:0}),a=new Uint8Array(n+i.length);a.set(this.lengthPrefixBuffer.subarray(0,n),0),a.set(i,n),this.unreliableWriter.write(a)}close(i,n){try{this.wt.close({closeCode:i,reason:n})}catch(a){console.error(a)}}readIncomingData(){return l.__awaiter(this,void 0,void 0,function*(){let i;for(;this.isOpen;){try{i=yield this.reader.read();const n=i.value,a={offset:0};do{const o=e.decode.number(n,a);this.events.onmessage({data:n.subarray(a.offset,a.offset+o)}),a.offset+=o}while(a.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(i.done)break}})}readIncomingUnreliableData(){return l.__awaiter(this,void 0,void 0,function*(){let i;for(;this.isOpen;){try{i=yield this.unreliableReader.read();const n=i.value,a={offset:0};do{const o=e.decode.number(n,a);this.events.onmessage({data:n.subarray(a.offset,a.offset+o)}),a.offset+=o}while(a.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(i.done)break}})}sendSeatReservation(i,n,a){const o={offset:0},r=[];e.encode.string(r,i,o),e.encode.string(r,n,o),a&&e.encode.string(r,a,o),this.writer.write(new Uint8Array(r).buffer)}_close(){this.isOpen=!1}}return Fn.H3TransportTransport=t,Fn}var Dn={},Bn,Ea;function qf(){return Ea||(Ea=1,Bn=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Bn}var Ta;function Jf(){if(Ta)return Dn;Ta=1;var l=qf();const e=globalThis.WebSocket||l;let t=class{constructor(i){this.events=i}send(i){this.ws.send(i)}sendUnreliable(i){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(i,n){try{this.ws=new e(i,{headers:n,protocols:this.protocols})}catch{this.ws=new e(i,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(i,n){this.ws.close(i,n)}get isOpen(){return this.ws.readyState===e.OPEN}};return Dn.WebSocketTransport=t,Dn}var Aa;function Kf(){if(Aa)return Ln;Aa=1;var l=Wf(),e=Jf();let t=class{constructor(i){switch(this.events={},i){case"h3":this.transport=new l.H3TransportTransport(this.events);break;default:this.transport=new e.WebSocketTransport(this.events);break}}connect(i,n){this.transport.connect.call(this.transport,i,n)}send(i){this.transport.send(i)}sendUnreliable(i){this.transport.sendUnreliable(i)}close(i,n){this.transport.close(i,n)}get isOpen(){return this.transport.isOpen}};return Ln.Connection=t,Ln}var Nn={},Ca;function Gl(){return Ca||(Ca=1,(function(l){l.Protocol=void 0,(function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"})(l.Protocol||(l.Protocol={})),l.ErrorCode=void 0,(function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"})(l.ErrorCode||(l.ErrorCode={}))})(Nn)),Nn}var Li={},Ia;function Hl(){if(Ia)return Li;Ia=1;const l={};function e(s,i){l[s]=i}function t(s){const i=l[s];if(!i)throw new Error("missing serializer: "+s);return i}return Li.getSerializer=t,Li.registerSerializer=e,Li}var Yn={},Ra;function $l(){if(Ra)return Yn;Ra=1;const l=()=>({emit(e,...t){let s=this.events[e]||[];for(let i=0,n=s.length;i<n;i++)s[i](...t)},events:{},on(e,t){var s;return!((s=this.events[e])===null||s===void 0)&&s.push(t)||(this.events[e]=[t]),()=>{var i;this.events[e]=(i=this.events[e])===null||i===void 0?void 0:i.filter(n=>t!==n)}}});return Yn.createNanoEvents=l,Yn}var Fi={},Oa;function Zf(){if(Oa)return Fi;Oa=1;class l{constructor(){this.handlers=[]}register(s,i=!1){return this.handlers.push(s),this}invoke(...s){this.handlers.forEach(i=>i.apply(this,s))}invokeAsync(...s){return Promise.all(this.handlers.map(i=>i.apply(this,s)))}remove(s){const i=this.handlers.indexOf(s);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function e(){const t=new l;function s(i){return t.register(i,this===null)}return s.once=i=>{const n=function(...a){i.apply(this,a),t.remove(n)};t.register(n)},s.remove=i=>t.remove(i),s.invoke=(...i)=>t.invoke(...i),s.invokeAsync=(...i)=>t.invokeAsync(...i),s.clear=()=>t.clear(),s}return Fi.EventEmitter=l,Fi.createSignal=e,Fi}var Di={},ka;function Wl(){if(ka)return Di;ka=1;var l=gr();function e(s){try{return l.getDecoderStateCallbacks(s.serializer.decoder)}catch{return}}let t=class{setState(i,n){this.decoder.decode(i,n)}getState(){return this.state}patch(i,n){return this.decoder.decode(i,n)}teardown(){this.decoder.root.clearRefs()}handshake(i,n){this.state?(l.Reflection.decode(i,n),this.decoder=new l.Decoder(this.state)):(this.decoder=l.Reflection.decode(i,n),this.state=this.decoder.state)}};return Di.SchemaSerializer=t,Di.getStateCallbacks=e,Di}var sr;try{sr=new TextDecoder}catch{}var oe,Kt,Y=0,ze={},Ne,gs,Rt=0,Wt=0,it,as,ht=[],De,Pa={useRecords:!1,mapsAsObjects:!0};class ql{}const pr=new ql;pr.name="MessagePack 0xC1";var ps=!1,Jl=2,Qf;try{new Function("")}catch{Jl=1/0}class ys{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(oe)return sh(()=>(tn(),this?this.unpack(e,t):ys.prototype.unpack.call(Pa,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(Kt=t.end||e.length,Y=t.start||0):(Y=0,Kt=t>-1?t:e.length),Wt=0,gs=null,it=null,oe=e;try{De=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(s){throw oe=null,e instanceof Uint8Array?s:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ys){if(ze=this,this.structures)return Ne=this.structures,Bi(t);(!Ne||Ne.length>0)&&(Ne=[])}else ze=Pa,(!Ne||Ne.length>0)&&(Ne=[]);return Bi(t)}unpackMultiple(e,t){let s,i=0;try{ps=!0;let n=e.length,a=this?this.unpack(e,n):yn.unpack(e,n);if(t){if(t(a,i,Y)===!1)return;for(;Y<n;)if(i=Y,t(Bi(),i,Y)===!1)return}else{for(s=[a];Y<n;)i=Y,s.push(Bi());return s}}catch(n){throw n.lastPosition=i,n.values=s,n}finally{ps=!1,tn()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(s=>s.slice(0)));for(let s=0,i=e.length;s<i;s++){let n=e[s];n&&(n.isShared=!0,s>=32&&(n.highByte=s-32>>5))}e.sharedLength=e.length;for(let s in t||[])if(s>=0){let i=e[s],n=t[s];n&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[s]=i),e[s]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function Bi(l){try{if(!ze.trusted&&!ps){let t=Ne.sharedLength||0;t<Ne.length&&(Ne.length=t)}let e;if(ze.randomAccessStructure&&oe[Y]<64&&oe[Y]>=32&&Qf||(e=Qe()),it&&(Y=it.postBundlePosition,it=null),ps&&(Ne.restoreStructures=null),Y==Kt)Ne&&Ne.restoreStructures&&_a(),Ne=null,oe=null,as&&(as=null);else{if(Y>Kt)throw new Error("Unexpected end of MessagePack data");if(!ps){let t;try{t=JSON.stringify(e,(s,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(s){t="(JSON view not available "+s+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw Ne&&Ne.restoreStructures&&_a(),tn(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Y>Kt)&&(e.incomplete=!0),e}}function _a(){for(let l in Ne.restoreStructures)Ne[l]=Ne.restoreStructures[l];Ne.restoreStructures=null}function Qe(){let l=oe[Y++];if(l<160)if(l<128){if(l<64)return l;{let e=Ne[l&63]||ze.getStructures&&Kl()[l&63];return e?(e.read||(e.read=yr(e,l&63)),e.read()):l}}else if(l<144)if(l-=128,ze.mapsAsObjects){let e={};for(let t=0;t<l;t++){let s=Ql();s==="__proto__"&&(s="__proto_"),e[s]=Qe()}return e}else{let e=new Map;for(let t=0;t<l;t++)e.set(Qe(),Qe());return e}else{l-=144;let e=new Array(l);for(let t=0;t<l;t++)e[t]=Qe();return ze.freezeData?Object.freeze(e):e}else if(l<192){let e=l-160;if(Wt>=Y)return gs.slice(Y-Rt,(Y+=e)-Rt);if(Wt==0&&Kt<140){let t=e<16?br(e):Zl(e);if(t!=null)return t}return ir(e)}else{let e;switch(l){case 192:return null;case 193:return it?(e=Qe(),e>0?it[1].slice(it.position1,it.position1+=e):it[0].slice(it.position0,it.position0-=e)):pr;case 194:return!1;case 195:return!0;case 196:if(e=oe[Y++],e===void 0)throw new Error("Unexpected end of buffer");return Xn(e);case 197:return e=De.getUint16(Y),Y+=2,Xn(e);case 198:return e=De.getUint32(Y),Y+=4,Xn(e);case 199:return Es(oe[Y++]);case 200:return e=De.getUint16(Y),Y+=2,Es(e);case 201:return e=De.getUint32(Y),Y+=4,Es(e);case 202:if(e=De.getFloat32(Y),ze.useFloat32>2){let t=pn[(oe[Y]&127)<<1|oe[Y+1]>>7];return Y+=4,(t*e+(e>0?.5:-.5)>>0)/t}return Y+=4,e;case 203:return e=De.getFloat64(Y),Y+=8,e;case 204:return oe[Y++];case 205:return e=De.getUint16(Y),Y+=2,e;case 206:return e=De.getUint32(Y),Y+=4,e;case 207:return ze.int64AsType==="number"?(e=De.getUint32(Y)*4294967296,e+=De.getUint32(Y+4)):ze.int64AsType==="string"?e=De.getBigUint64(Y).toString():ze.int64AsType==="auto"?(e=De.getBigUint64(Y),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=De.getBigUint64(Y),Y+=8,e;case 208:return De.getInt8(Y++);case 209:return e=De.getInt16(Y),Y+=2,e;case 210:return e=De.getInt32(Y),Y+=4,e;case 211:return ze.int64AsType==="number"?(e=De.getInt32(Y)*4294967296,e+=De.getUint32(Y+4)):ze.int64AsType==="string"?e=De.getBigInt64(Y).toString():ze.int64AsType==="auto"?(e=De.getBigInt64(Y),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=De.getBigInt64(Y),Y+=8,e;case 212:if(e=oe[Y++],e==114)return Na(oe[Y++]&63);{let t=ht[e];if(t)return t.read?(Y++,t.read(Qe())):t.noBuffer?(Y++,t()):t(oe.subarray(Y,++Y));throw new Error("Unknown extension "+e)}case 213:return e=oe[Y],e==114?(Y++,Na(oe[Y++]&63,oe[Y++])):Es(2);case 214:return Es(4);case 215:return Es(8);case 216:return Es(16);case 217:return e=oe[Y++],Wt>=Y?gs.slice(Y-Rt,(Y+=e)-Rt):tu(e);case 218:return e=De.getUint16(Y),Y+=2,Wt>=Y?gs.slice(Y-Rt,(Y+=e)-Rt):su(e);case 219:return e=De.getUint32(Y),Y+=4,Wt>=Y?gs.slice(Y-Rt,(Y+=e)-Rt):iu(e);case 220:return e=De.getUint16(Y),Y+=2,La(e);case 221:return e=De.getUint32(Y),Y+=4,La(e);case 222:return e=De.getUint16(Y),Y+=2,Fa(e);case 223:return e=De.getUint32(Y),Y+=4,Fa(e);default:if(l>=224)return l-256;if(l===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+l)}}}const eu=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function yr(l,e){function t(){if(t.count++>Jl){let i=l.read=new Function("r","return function(){return "+(ze.freezeData?"Object.freeze":"")+"({"+l.map(n=>n==="__proto__"?"__proto_:r()":eu.test(n)?n+":r()":"["+JSON.stringify(n)+"]:r()").join(",")+"})}")(Qe);return l.highByte===0&&(l.read=Ma(e,l.read)),i()}let s={};for(let i=0,n=l.length;i<n;i++){let a=l[i];a==="__proto__"&&(a="__proto_"),s[a]=Qe()}return ze.freezeData?Object.freeze(s):s}return t.count=0,l.highByte===0?Ma(e,t):t}const Ma=(l,e)=>function(){let t=oe[Y++];if(t===0)return e();let s=l<32?-(l+(t<<5)):l+(t<<5),i=Ne[s]||Kl()[s];if(!i)throw new Error("Record id is not defined for "+s);return i.read||(i.read=yr(i,l)),i.read()};function Kl(){let l=sh(()=>(oe=null,ze.getStructures()));return Ne=ze._mergeStructures(l,Ne)}var ir=xi,tu=xi,su=xi,iu=xi;let nu=!1;function xi(l){let e;if(l<16&&(e=br(l)))return e;if(l>64&&sr)return sr.decode(oe.subarray(Y,Y+=l));const t=Y+l,s=[];for(e="";Y<t;){const i=oe[Y++];if((i&128)===0)s.push(i);else if((i&224)===192){const n=oe[Y++]&63;s.push((i&31)<<6|n)}else if((i&240)===224){const n=oe[Y++]&63,a=oe[Y++]&63;s.push((i&31)<<12|n<<6|a)}else if((i&248)===240){const n=oe[Y++]&63,a=oe[Y++]&63,o=oe[Y++]&63;let r=(i&7)<<18|n<<12|a<<6|o;r>65535&&(r-=65536,s.push(r>>>10&1023|55296),r=56320|r&1023),s.push(r)}else s.push(i);s.length>=4096&&(e+=st.apply(String,s),s.length=0)}return s.length>0&&(e+=st.apply(String,s)),e}function La(l){let e=new Array(l);for(let t=0;t<l;t++)e[t]=Qe();return ze.freezeData?Object.freeze(e):e}function Fa(l){if(ze.mapsAsObjects){let e={};for(let t=0;t<l;t++){let s=Ql();s==="__proto__"&&(s="__proto_"),e[s]=Qe()}return e}else{let e=new Map;for(let t=0;t<l;t++)e.set(Qe(),Qe());return e}}var st=String.fromCharCode;function Zl(l){let e=Y,t=new Array(l);for(let s=0;s<l;s++){const i=oe[Y++];if((i&128)>0){Y=e;return}t[s]=i}return st.apply(String,t)}function br(l){if(l<4)if(l<2){if(l===0)return"";{let e=oe[Y++];if((e&128)>1){Y-=1;return}return st(e)}}else{let e=oe[Y++],t=oe[Y++];if((e&128)>0||(t&128)>0){Y-=2;return}if(l<3)return st(e,t);let s=oe[Y++];if((s&128)>0){Y-=3;return}return st(e,t,s)}else{let e=oe[Y++],t=oe[Y++],s=oe[Y++],i=oe[Y++];if((e&128)>0||(t&128)>0||(s&128)>0||(i&128)>0){Y-=4;return}if(l<6){if(l===4)return st(e,t,s,i);{let n=oe[Y++];if((n&128)>0){Y-=5;return}return st(e,t,s,i,n)}}else if(l<8){let n=oe[Y++],a=oe[Y++];if((n&128)>0||(a&128)>0){Y-=6;return}if(l<7)return st(e,t,s,i,n,a);let o=oe[Y++];if((o&128)>0){Y-=7;return}return st(e,t,s,i,n,a,o)}else{let n=oe[Y++],a=oe[Y++],o=oe[Y++],r=oe[Y++];if((n&128)>0||(a&128)>0||(o&128)>0||(r&128)>0){Y-=8;return}if(l<10){if(l===8)return st(e,t,s,i,n,a,o,r);{let h=oe[Y++];if((h&128)>0){Y-=9;return}return st(e,t,s,i,n,a,o,r,h)}}else if(l<12){let h=oe[Y++],c=oe[Y++];if((h&128)>0||(c&128)>0){Y-=10;return}if(l<11)return st(e,t,s,i,n,a,o,r,h,c);let d=oe[Y++];if((d&128)>0){Y-=11;return}return st(e,t,s,i,n,a,o,r,h,c,d)}else{let h=oe[Y++],c=oe[Y++],d=oe[Y++],g=oe[Y++];if((h&128)>0||(c&128)>0||(d&128)>0||(g&128)>0){Y-=12;return}if(l<14){if(l===12)return st(e,t,s,i,n,a,o,r,h,c,d,g);{let u=oe[Y++];if((u&128)>0){Y-=13;return}return st(e,t,s,i,n,a,o,r,h,c,d,g,u)}}else{let u=oe[Y++],m=oe[Y++];if((u&128)>0||(m&128)>0){Y-=14;return}if(l<15)return st(e,t,s,i,n,a,o,r,h,c,d,g,u,m);let y=oe[Y++];if((y&128)>0){Y-=15;return}return st(e,t,s,i,n,a,o,r,h,c,d,g,u,m,y)}}}}}function Da(){let l=oe[Y++],e;if(l<192)e=l-160;else switch(l){case 217:e=oe[Y++];break;case 218:e=De.getUint16(Y),Y+=2;break;case 219:e=De.getUint32(Y),Y+=4;break;default:throw new Error("Expected string")}return xi(e)}function Xn(l){return ze.copyBuffers?Uint8Array.prototype.slice.call(oe,Y,Y+=l):oe.subarray(Y,Y+=l)}function Es(l){let e=oe[Y++];if(ht[e]){let t;return ht[e](oe.subarray(Y,t=Y+=l),s=>{Y=s;try{return Qe()}finally{Y=t}})}else throw new Error("Unknown extension type "+e)}var Ba=new Array(4096);function Ql(){let l=oe[Y++];if(l>=160&&l<192){if(l=l-160,Wt>=Y)return gs.slice(Y-Rt,(Y+=l)-Rt);if(!(Wt==0&&Kt<180))return ir(l)}else return Y--,eh(Qe());let e=(l<<5^(l>1?De.getUint16(Y):l>0?oe[Y]:0))&4095,t=Ba[e],s=Y,i=Y+l-3,n,a=0;if(t&&t.bytes==l){for(;s<i;){if(n=De.getUint32(s),n!=t[a++]){s=1879048192;break}s+=4}for(i+=3;s<i;)if(n=oe[s++],n!=t[a++]){s=1879048192;break}if(s===i)return Y=s,t.string;i-=3,s=Y}for(t=[],Ba[e]=t,t.bytes=l;s<i;)n=De.getUint32(s),t.push(n),s+=4;for(i+=3;s<i;)n=oe[s++],t.push(n);let o=l<16?br(l):Zl(l);return o!=null?t.string=o:t.string=ir(l)}function eh(l){if(typeof l=="string")return l;if(typeof l=="number"||typeof l=="boolean"||typeof l=="bigint")return l.toString();if(l==null)return l+"";if(ze.allowArraysInMapKeys&&Array.isArray(l)&&l.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return l.flat().toString();throw new Error(`Invalid property type for record: ${typeof l}`)}const Na=(l,e)=>{let t=Qe().map(eh),s=l;e!==void 0&&(l=l<32?-((e<<5)+l):(e<<5)+l,t.highByte=e);let i=Ne[l];return i&&(i.isShared||ps)&&((Ne.restoreStructures||(Ne.restoreStructures=[]))[l]=i),Ne[l]=t,t.read=yr(t,s),t.read()};ht[0]=()=>{};ht[0].noBuffer=!0;ht[66]=l=>{let e=l.length,t=BigInt(l[0]&128?l[0]-256:l[0]);for(let s=1;s<e;s++)t<<=BigInt(8),t+=BigInt(l[s]);return t};let ru={Error,TypeError,ReferenceError};ht[101]=()=>{let l=Qe();return(ru[l[0]]||Error)(l[1],{cause:l[2]})};ht[105]=l=>{if(ze.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=De.getUint32(Y-4);as||(as=new Map);let t=oe[Y],s;t>=144&&t<160||t==220||t==221?s=[]:s={};let i={target:s};as.set(e,i);let n=Qe();return i.used?Object.assign(s,n):(i.target=n,n)};ht[112]=l=>{if(ze.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=De.getUint32(Y-4),t=as.get(e);return t.used=!0,t.target};ht[115]=()=>new Set(Qe());const th=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(l=>l+"Array");let au=typeof globalThis=="object"?globalThis:window;ht[116]=l=>{let e=l[0],t=th[e];if(!t){if(e===16){let s=new ArrayBuffer(l.length-1);return new Uint8Array(s).set(l.subarray(1)),s}throw new Error("Could not find typed array for code "+e)}return new au[t](Uint8Array.prototype.slice.call(l,1).buffer)};ht[120]=()=>{let l=Qe();return new RegExp(l[0],l[1])};const ou=[];ht[98]=l=>{let e=(l[0]<<24)+(l[1]<<16)+(l[2]<<8)+l[3],t=Y;return Y+=e-l.length,it=ou,it=[Da(),Da()],it.position0=0,it.position1=0,it.postBundlePosition=Y,Y=t,Qe()};ht[255]=l=>l.length==4?new Date((l[0]*16777216+(l[1]<<16)+(l[2]<<8)+l[3])*1e3):l.length==8?new Date(((l[0]<<22)+(l[1]<<14)+(l[2]<<6)+(l[3]>>2))/1e6+((l[3]&3)*4294967296+l[4]*16777216+(l[5]<<16)+(l[6]<<8)+l[7])*1e3):l.length==12?new Date(((l[0]<<24)+(l[1]<<16)+(l[2]<<8)+l[3])/1e6+((l[4]&128?-281474976710656:0)+l[6]*1099511627776+l[7]*4294967296+l[8]*16777216+(l[9]<<16)+(l[10]<<8)+l[11])*1e3):new Date("invalid");function sh(l){let e=Kt,t=Y,s=Rt,i=Wt,n=gs,a=as,o=it,r=new Uint8Array(oe.slice(0,Kt)),h=Ne,c=Ne.slice(0,Ne.length),d=ze,g=ps,u=l();return Kt=e,Y=t,Rt=s,Wt=i,gs=n,as=a,it=o,oe=r,ps=g,Ne=h,Ne.splice(0,Ne.length,...c),ze=d,De=new DataView(oe.buffer,oe.byteOffset,oe.byteLength),u}function tn(){oe=null,as=null,Ne=null}function lu(l){l.unpack?ht[l.type]=l.unpack:ht[l.type]=l}const pn=new Array(147);for(let l=0;l<256;l++)pn[l]=+("1e"+Math.floor(45.15-l*.30103));const hu=ys;var yn=new ys({useRecords:!1});const cu=yn.unpack,du=yn.unpackMultiple,fu=yn.unpack,ih={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let nh=new Float32Array(1),Ya=new Uint8Array(nh.buffer,0,4);function uu(l){nh[0]=l;let e=pn[(Ya[3]&127)<<1|Ya[2]>>7];return(e*l+(l>0?.5:-.5)>>0)/e}let ji;try{ji=new TextEncoder}catch{}let sn,wr;const bn=typeof Buffer<"u",Ni=bn?function(l){return Buffer.allocUnsafeSlow(l)}:Uint8Array,rh=bn?Buffer:Uint8Array,Xa=bn?4294967296:2144337920;let G,hi,Ve,U=0,ct,He=null,mu;const gu=21760,pu=/[\u0080-\uFFFF]/,$s=Symbol("record-id");class Si extends ys{constructor(e){super(e),this.offset=0;let t,s,i,n,a=rh.prototype.utf8Write?function(O,R){return G.utf8Write(O,R,G.byteLength-R)}:ji&&ji.encodeInto?function(O,R){return ji.encodeInto(O,G.subarray(R)).written}:!1,o=this;e||(e={});let r=e&&e.sequential,h=e.structures||e.saveStructures,c=e.maxSharedStructures;if(c==null&&(c=h?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=h?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let g=c>32||d+c>64,u=c+64,m=c+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let y=[],b=0,E=0;this.pack=this.encode=function(O,R){if(G||(G=new Ni(8192),Ve=G.dataView||(G.dataView=new DataView(G.buffer,0,8192)),U=0),ct=G.length-10,ct-U<2048?(G=new Ni(G.length),Ve=G.dataView||(G.dataView=new DataView(G.buffer,0,G.length)),ct=G.length-10,U=0):U=U+7&2147483640,t=U,R&hh&&(U+=R&255),n=o.structuredClone?new Map:null,o.bundleStrings&&typeof O!="string"?(He=[],He.size=1/0):He=null,i=o.structures,i){i.uninitialized&&(i=o._mergeStructures(o.getStructures()));let F=i.sharedLength||0;if(F>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let H=0;H<F;H++){let Z=i[H];if(!Z)continue;let ee,re=i.transitions;for(let le=0,ce=Z.length;le<ce;le++){let ae=Z[le];ee=re[ae],ee||(ee=re[ae]=Object.create(null)),re=ee}re[$s]=H+64}this.lastNamedStructuresLength=F}r||(i.nextId=F+64)}s&&(s=!1);let M;try{o.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?W(O):x(O);let F=He;if(He&&za(t,x,0),n&&n.idsToInsert){let H=n.idsToInsert.sort((le,ce)=>le.offset>ce.offset?1:-1),Z=H.length,ee=-1;for(;F&&Z>0;){let le=H[--Z].offset+t;le<F.stringsPosition+t&&ee===-1&&(ee=0),le>F.position+t?ee>=0&&(ee+=6):(ee>=0&&(Ve.setUint32(F.position+t,Ve.getUint32(F.position+t)+ee),ee=-1),F=F.previous,Z++)}ee>=0&&F&&Ve.setUint32(F.position+t,Ve.getUint32(F.position+t)+ee),U+=H.length*6,U>ct&&L(U),o.offset=U;let re=bu(G.subarray(t,U),H);return n=null,re}return o.offset=U,R&oh?(G.start=t,G.end=U,G):G.subarray(t,U)}catch(F){throw M=F,F}finally{if(i&&(v(),s&&o.saveStructures)){let F=i.sharedLength||0,H=G.subarray(t,U),Z=xu(i,o);if(!M)return o.saveStructures(Z,Z.isCompatible)===!1?o.pack(O,R):(o.lastNamedStructuresLength=F,G.length>1073741824&&(G=null),H)}G.length>1073741824&&(G=null),R&lh&&(U=t)}};const v=()=>{E<10&&E++;let O=i.sharedLength||0;if(i.length>O&&!r&&(i.length=O),b>1e4)i.transitions=null,E=0,b=0,y.length>0&&(y=[]);else if(y.length>0&&!r){for(let R=0,M=y.length;R<M;R++)y[R][$s]=0;y=[]}},S=O=>{var R=O.length;R<16?G[U++]=144|R:R<65536?(G[U++]=220,G[U++]=R>>8,G[U++]=R&255):(G[U++]=221,Ve.setUint32(U,R),U+=4);for(let M=0;M<R;M++)x(O[M])},x=O=>{U>ct&&(G=L(U));var R=typeof O,M;if(R==="string"){let F=O.length;if(He&&F>=4&&F<4096){if((He.size+=F)>gu){let re,le=(He[0]?He[0].length*3+He[1].length:0)+10;U+le>ct&&(G=L(U+le));let ce;He.position?(ce=He,G[U]=200,U+=3,G[U++]=98,re=U-t,U+=4,za(t,x,0),Ve.setUint16(re+t-3,U-t-re)):(G[U++]=214,G[U++]=98,re=U-t,U+=4),He=["",""],He.previous=ce,He.size=0,He.position=re}let ee=pu.test(O);He[ee?0:1]+=O,G[U++]=193,x(ee?-F:F);return}let H;F<32?H=1:F<256?H=2:F<65536?H=3:H=5;let Z=F*3;if(U+Z>ct&&(G=L(U+Z)),F<64||!a){let ee,re,le,ce=U+H;for(ee=0;ee<F;ee++)re=O.charCodeAt(ee),re<128?G[ce++]=re:re<2048?(G[ce++]=re>>6|192,G[ce++]=re&63|128):(re&64512)===55296&&((le=O.charCodeAt(ee+1))&64512)===56320?(re=65536+((re&1023)<<10)+(le&1023),ee++,G[ce++]=re>>18|240,G[ce++]=re>>12&63|128,G[ce++]=re>>6&63|128,G[ce++]=re&63|128):(G[ce++]=re>>12|224,G[ce++]=re>>6&63|128,G[ce++]=re&63|128);M=ce-U-H}else M=a(O,U+H);M<32?G[U++]=160|M:M<256?(H<2&&G.copyWithin(U+2,U+1,U+1+M),G[U++]=217,G[U++]=M):M<65536?(H<3&&G.copyWithin(U+3,U+2,U+2+M),G[U++]=218,G[U++]=M>>8,G[U++]=M&255):(H<5&&G.copyWithin(U+5,U+3,U+3+M),G[U++]=219,Ve.setUint32(U,M),U+=4),U+=M}else if(R==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?G[U++]=O:O<256?(G[U++]=204,G[U++]=O):O<65536?(G[U++]=205,G[U++]=O>>8,G[U++]=O&255):(G[U++]=206,Ve.setUint32(U,O),U+=4);else if(O>>0===O)O>=-32?G[U++]=256+O:O>=-128?(G[U++]=208,G[U++]=O+256):O>=-32768?(G[U++]=209,Ve.setInt16(U,O),U+=2):(G[U++]=210,Ve.setInt32(U,O),U+=4);else{let F;if((F=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){G[U++]=202,Ve.setFloat32(U,O);let H;if(F<4||(H=O*pn[(G[U]&127)<<1|G[U+1]>>7])>>0===H){U+=4;return}else U--}G[U++]=203,Ve.setFloat64(U,O),U+=8}else if(R==="object"||R==="function")if(!O)G[U++]=192;else{if(n){let H=n.get(O);if(H){if(!H.id){let Z=n.idsToInsert||(n.idsToInsert=[]);H.id=Z.push(H)}G[U++]=214,G[U++]=112,Ve.setUint32(U,H.id),U+=4;return}else n.set(O,{offset:U-t})}let F=O.constructor;if(F===Object)_(O);else if(F===Array)S(O);else if(F===Map)if(this.mapAsEmptyObject)G[U++]=128;else{M=O.size,M<16?G[U++]=128|M:M<65536?(G[U++]=222,G[U++]=M>>8,G[U++]=M&255):(G[U++]=223,Ve.setUint32(U,M),U+=4);for(let[H,Z]of O)x(H),x(Z)}else{for(let H=0,Z=sn.length;H<Z;H++){let ee=wr[H];if(O instanceof ee){let re=sn[H];if(re.write){re.type&&(G[U++]=212,G[U++]=re.type,G[U++]=0);let Pe=re.write.call(this,O);Pe===O?Array.isArray(O)?S(O):_(O):x(Pe);return}let le=G,ce=Ve,ae=U;G=null;let Ie;try{Ie=re.pack.call(this,O,Pe=>(G=le,le=null,U+=Pe,U>ct&&L(U),{target:G,targetView:Ve,position:U-Pe}),x)}finally{le&&(G=le,Ve=ce,U=ae,ct=G.length-10)}Ie&&(Ie.length+U>ct&&L(Ie.length+U),U=yu(Ie,G,U,re.type));return}}if(Array.isArray(O))S(O);else{if(O.toJSON){const H=O.toJSON();if(H!==O)return x(H)}if(R==="function")return x(this.writeFunction&&this.writeFunction(O));_(O)}}}else if(R==="boolean")G[U++]=O?195:194;else if(R==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))G[U++]=211,Ve.setBigInt64(U,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)G[U++]=207,Ve.setBigUint64(U,O);else if(this.largeBigIntToFloat)G[U++]=203,Ve.setFloat64(U,Number(O));else{if(this.largeBigIntToString)return x(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){G[U++]=199,U++,G[U++]=66;let F=[],H;do{let Z=O&BigInt(255);H=(Z&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),F.push(Z),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&H));G[U-2]=F.length;for(let Z=F.length;Z>0;)G[U++]=Number(F[--Z]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}U+=8}else if(R==="undefined")this.encodeUndefinedAsNil?G[U++]=192:(G[U++]=212,G[U++]=0,G[U++]=0);else throw new Error("Unknown type: "+R)},A=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let R;if(this.skipValues){R=[];for(let H in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(H))&&!this.skipValues.includes(O[H])&&R.push(H)}else R=Object.keys(O);let M=R.length;M<16?G[U++]=128|M:M<65536?(G[U++]=222,G[U++]=M>>8,G[U++]=M&255):(G[U++]=223,Ve.setUint32(U,M),U+=4);let F;if(this.coercibleKeyAsNumber)for(let H=0;H<M;H++){F=R[H];let Z=Number(F);x(isNaN(Z)?F:Z),x(O[F])}else for(let H=0;H<M;H++)x(F=R[H]),x(O[F])}:O=>{G[U++]=222;let R=U-t;U+=2;let M=0;for(let F in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(F))&&(x(F),x(O[F]),M++);if(M>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');G[R+++t]=M>>8,G[R+t]=M&255},C=this.useRecords===!1?A:e.progressiveRecords&&!g?O=>{let R,M=i.transitions||(i.transitions=Object.create(null)),F=U++-t,H;for(let Z in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(Z)){if(R=M[Z],R)M=R;else{let ee=Object.keys(O),re=M;M=i.transitions;let le=0;for(let ce=0,ae=ee.length;ce<ae;ce++){let Ie=ee[ce];R=M[Ie],R||(R=M[Ie]=Object.create(null),le++),M=R}F+t+1==U?(U--,N(M,ee,le)):V(M,ee,F,le),H=!0,M=re[Z]}x(O[Z])}if(!H){let Z=M[$s];Z?G[F+t]=Z:V(M,Object.keys(O),F,0)}}:O=>{let R,M=i.transitions||(i.transitions=Object.create(null)),F=0;for(let Z in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(Z))&&(R=M[Z],R||(R=M[Z]=Object.create(null),F++),M=R);let H=M[$s];H?H>=96&&g?(G[U++]=((H-=96)&31)+96,G[U++]=H>>5):G[U++]=H:N(M,M.__keys__||Object.keys(O),F);for(let Z in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(Z))&&x(O[Z])},k=typeof this.useRecords=="function"&&this.useRecords,_=k?O=>{k(O)?C(O):A(O)}:C,L=O=>{let R;if(O>16777216){if(O-t>Xa)throw new Error("Packed buffer would be larger than maximum buffer size");R=Math.min(Xa,Math.round(Math.max((O-t)*(O>67108864?1.25:2),4194304)/4096)*4096)}else R=(Math.max(O-t<<2,G.length-1)>>12)+1<<12;let M=new Ni(R);return Ve=M.dataView||(M.dataView=new DataView(M.buffer,0,R)),O=Math.min(O,G.length),G.copy?G.copy(M,0,t,O):M.set(G.slice(t,O)),U-=t,t=0,ct=M.length-10,G=M},N=(O,R,M)=>{let F=i.nextId;F||(F=64),F<u&&this.shouldShareStructure&&!this.shouldShareStructure(R)?(F=i.nextOwnId,F<m||(F=u),i.nextOwnId=F+1):(F>=m&&(F=u),i.nextId=F+1);let H=R.highByte=F>=96&&g?F-96>>5:-1;O[$s]=F,O.__keys__=R,i[F-64]=R,F<u?(R.isShared=!0,i.sharedLength=F-63,s=!0,H>=0?(G[U++]=(F&31)+96,G[U++]=H):G[U++]=F):(H>=0?(G[U++]=213,G[U++]=114,G[U++]=(F&31)+96,G[U++]=H):(G[U++]=212,G[U++]=114,G[U++]=F),M&&(b+=E*M),y.length>=d&&(y.shift()[$s]=0),y.push(O),x(R))},V=(O,R,M,F)=>{let H=G,Z=U,ee=ct,re=t;G=hi,U=0,t=0,G||(hi=G=new Ni(8192)),ct=G.length-10,N(O,R,F),hi=G;let le=U;if(G=H,U=Z,ct=ee,t=re,le>1){let ce=U+le-1;ce>ct&&L(ce);let ae=M+t;G.copyWithin(ae+le,ae+1,U),G.set(hi.slice(0,le),ae),U=ce}else G[M+t]=hi[0]},W=O=>{let R=mu(O,G,t,U,i,L,(M,F,H)=>{if(H)return s=!0;U=F;let Z=G;return x(M),v(),Z!==G?{position:U,targetView:Ve,target:G}:U},this);if(R===0)return _(O);U=R}}useBuffer(e){G=e,G.dataView||(G.dataView=new DataView(G.buffer,G.byteOffset,G.byteLength)),U=0}set position(e){U=e}get position(){return U}set buffer(e){G=e}get buffer(){return G}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}wr=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,ql];sn=[{pack(l,e,t){let s=l.getTime()/1e3;if((this.useTimestamp32||l.getMilliseconds()===0)&&s>=0&&s<4294967296){let{target:i,targetView:n,position:a}=e(6);i[a++]=214,i[a++]=255,n.setUint32(a,s)}else if(s>0&&s<4294967296){let{target:i,targetView:n,position:a}=e(10);i[a++]=215,i[a++]=255,n.setUint32(a,l.getMilliseconds()*4e6+(s/1e3/4294967296>>0)),n.setUint32(a+4,s)}else if(isNaN(s)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:n,position:a}=e(3);i[a++]=212,i[a++]=255,i[a++]=255}else{let{target:i,targetView:n,position:a}=e(15);i[a++]=199,i[a++]=12,i[a++]=255,n.setUint32(a,l.getMilliseconds()*1e6),n.setBigInt64(a+4,BigInt(Math.floor(s)))}}},{pack(l,e,t){if(this.setAsEmptyObject)return e(0),t({});let s=Array.from(l),{target:i,position:n}=e(this.moreTypes?3:0);this.moreTypes&&(i[n++]=212,i[n++]=115,i[n++]=0),t(s)}},{pack(l,e,t){let{target:s,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=101,s[i++]=0),t([l.name,l.message,l.cause])}},{pack(l,e,t){let{target:s,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=120,s[i++]=0),t([l.source,l.flags])}},{pack(l,e){this.moreTypes?Ua(l,16,e):Va(bn?Buffer.from(l):new Uint8Array(l),e)}},{pack(l,e){let t=l.constructor;t!==rh&&this.moreTypes?Ua(l,th.indexOf(t.name),e):Va(l,e)}},{pack(l,e){let{target:t,position:s}=e(1);t[s]=193}}];function Ua(l,e,t,s){let i=l.byteLength;if(i+1<256){var{target:n,position:a}=t(4+i);n[a++]=199,n[a++]=i+1}else if(i+1<65536){var{target:n,position:a}=t(5+i);n[a++]=200,n[a++]=i+1>>8,n[a++]=i+1&255}else{var{target:n,position:a,targetView:o}=t(7+i);n[a++]=201,o.setUint32(a,i+1),a+=4}n[a++]=116,n[a++]=e,l.buffer||(l=new Uint8Array(l)),n.set(new Uint8Array(l.buffer,l.byteOffset,l.byteLength),a)}function Va(l,e){let t=l.byteLength;var s,i;if(t<256){var{target:s,position:i}=e(t+2);s[i++]=196,s[i++]=t}else if(t<65536){var{target:s,position:i}=e(t+3);s[i++]=197,s[i++]=t>>8,s[i++]=t&255}else{var{target:s,position:i,targetView:n}=e(t+5);s[i++]=198,n.setUint32(i,t),i+=4}s.set(l,i)}function yu(l,e,t,s){let i=l.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=s,e.set(l,t),t+=i,t}function bu(l,e){let t,s=e.length*6,i=l.length-s;for(;t=e.pop();){let n=t.offset,a=t.id;l.copyWithin(n+s,n,i),s-=6;let o=n+s;l[o++]=214,l[o++]=105,l[o++]=a>>24,l[o++]=a>>16&255,l[o++]=a>>8&255,l[o++]=a&255,i=n}return l}function za(l,e,t){if(He.length>0){Ve.setUint32(He.position+l,U+t-He.position-l),He.stringsPosition=U-l;let s=He;He=null,e(s[0]),e(s[1])}}function wu(l){if(l.Class){if(!l.pack&&!l.write)throw new Error("Extension has no pack or write function");if(l.pack&&!l.type)throw new Error("Extension has no type (numeric code to identify the extension)");wr.unshift(l.Class),sn.unshift(l)}lu(l)}function xu(l,e){return l.isCompatible=t=>{let s=!t||(e.lastNamedStructuresLength||0)===t.length;return s||e._mergeStructures(t),s},l}let ah=new Si({useRecords:!1});const Su=ah.pack,vu=ah.pack,Eu=Si,{NEVER:Tu,ALWAYS:Au,DECIMAL_ROUND:Cu,DECIMAL_FIT:Iu}=ih,oh=512,lh=1024,hh=2048;function Ru(l,e={}){if(!l||typeof l!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof l[Symbol.iterator]=="function")return Ou(l,e);if(typeof l.then=="function"||typeof l[Symbol.asyncIterator]=="function")return ku(l,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Ou(l,e){const t=new Si(e);for(const s of l)yield t.pack(s)}async function*ku(l,e){const t=new Si(e);for await(const s of l)yield t.pack(s)}function Pu(l,e={}){if(!l||typeof l!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const t=new ys(e);let s;const i=n=>{let a;s&&(n=Buffer.concat([s,n]),s=void 0);try{a=t.unpackMultiple(n)}catch(o){if(o.incomplete)s=n.slice(o.lastPosition),a=o.values;else throw o}return a};if(typeof l[Symbol.iterator]=="function")return(function*(){for(const a of l)yield*i(a)})();if(typeof l[Symbol.asyncIterator]=="function")return(async function*(){for await(const a of l)yield*i(a)})()}const _u=Pu,Mu=Ru,Lu=!1,Fu=!0,Du=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Au,C1:pr,DECIMAL_FIT:Iu,DECIMAL_ROUND:Cu,Decoder:hu,Encoder:Eu,FLOAT32_OPTIONS:ih,NEVER:Tu,Packr:Si,RESERVE_START_SPACE:hh,RESET_BUFFER_MODE:lh,REUSE_BUFFER_MODE:oh,Unpackr:ys,addExtension:wu,clearSource:tn,decode:fu,decodeIter:_u,encode:vu,encodeIter:Mu,isNativeAccelerationEnabled:nu,mapsAsObjects:Fu,pack:Su,roundFloat32:uu,unpack:cu,unpackMultiple:du,useRecords:Lu},Symbol.toStringTag,{value:"Module"})),Bu=rr(Du);var ja;function dh(){if(ja)return Mn;ja=1;var l=Kf(),e=Gl(),t=Hl(),s=$l(),i=Zf(),n=gr(),a=Wl(),o=gn(),r=Bu;let h=class ch{constructor(d,g){this.onStateChange=i.createSignal(),this.onError=i.createSignal(),this.onLeave=i.createSignal(),this.onJoin=i.createSignal(),this.hasJoined=!1,this.onMessageHandlers=s.createNanoEvents(),this.roomId=null,this.name=d,this.packr=new r.Packr,this.packr.encode(void 0),g&&(this.serializer=new(t.getSerializer("schema")),this.rootSchema=g,this.serializer.state=new g),this.onError((u,m)=>{var y;return(y=console.warn)===null||y===void 0?void 0:y.call(console,`colyseus.js - onError => (${u}) ${m}`)}),this.onLeave(()=>this.removeAllListeners())}connect(d,g,u=this,m,y){const b=new l.Connection(m.protocol);if(u.connection=b,b.events.onmessage=ch.prototype.onMessageCallback.bind(u),b.events.onclose=function(E){var v;if(!u.hasJoined){(v=console.warn)===null||v===void 0||v.call(console,`Room connection was closed unexpectedly (${E.code}): ${E.reason}`),u.onError.invoke(E.code,E.reason);return}E.code===o.CloseCode.DEVMODE_RESTART&&g?g():(u.onLeave.invoke(E.code,E.reason),u.destroy())},b.events.onerror=function(E){var v;(v=console.warn)===null||v===void 0||v.call(console,`Room, onError (${E.code}): ${E.reason}`),u.onError.invoke(E.code,E.reason)},m.protocol==="h3"){const E=new URL(d);b.connect(E.origin,m)}else b.connect(d,y)}leave(d=!0){return new Promise(g=>{this.onLeave(u=>g(u)),this.connection?d?(this.packr.buffer[0]=e.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(o.CloseCode.CONSENTED)})}onMessage(d,g){return this.onMessageHandlers.on(this.getMessageHandlerKey(d),g)}send(d,g){const u={offset:1};this.packr.buffer[0]=e.Protocol.ROOM_DATA,typeof d=="string"?n.encode.string(this.packr.buffer,d,u):n.encode.number(this.packr.buffer,d,u),this.packr.position=0;const m=g!==void 0?this.packr.pack(g,2048+u.offset):this.packr.buffer.subarray(0,u.offset);this.connection.send(m)}sendUnreliable(d,g){const u={offset:1};this.packr.buffer[0]=e.Protocol.ROOM_DATA,typeof d=="string"?n.encode.string(this.packr.buffer,d,u):n.encode.number(this.packr.buffer,d,u),this.packr.position=0;const m=g!==void 0?this.packr.pack(g,2048+u.offset):this.packr.buffer.subarray(0,u.offset);this.connection.sendUnreliable(m)}sendBytes(d,g){const u={offset:1};if(this.packr.buffer[0]=e.Protocol.ROOM_DATA_BYTES,typeof d=="string"?n.encode.string(this.packr.buffer,d,u):n.encode.number(this.packr.buffer,d,u),g.byteLength+u.offset>this.packr.buffer.byteLength){const m=new Uint8Array(u.offset+g.byteLength);m.set(this.packr.buffer),this.packr.useBuffer(m)}this.packr.buffer.set(g,u.offset),this.connection.send(this.packr.buffer.subarray(0,u.offset+g.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof a.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(d){const g=new Uint8Array(d.data),u={offset:1},m=g[0];if(m===e.Protocol.JOIN_ROOM){const y=n.decode.utf8Read(g,u,g[u.offset++]);if(this.serializerId=n.decode.utf8Read(g,u,g[u.offset++]),!this.serializer){const b=t.getSerializer(this.serializerId);this.serializer=new b}g.byteLength>u.offset&&this.serializer.handshake&&this.serializer.handshake(g,u),this.reconnectionToken=`${this.roomId}:${y}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=e.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(m===e.Protocol.ERROR){const y=n.decode.number(g,u),b=n.decode.string(g,u);this.onError.invoke(y,b)}else if(m===e.Protocol.LEAVE_ROOM)this.leave();else if(m===e.Protocol.ROOM_STATE)this.serializer.setState(g,u),this.onStateChange.invoke(this.serializer.getState());else if(m===e.Protocol.ROOM_STATE_PATCH)this.serializer.patch(g,u),this.onStateChange.invoke(this.serializer.getState());else if(m===e.Protocol.ROOM_DATA){const y=n.decode.stringCheck(g,u)?n.decode.string(g,u):n.decode.number(g,u),b=g.byteLength>u.offset?r.unpack(g,{start:u.offset}):void 0;this.dispatchMessage(y,b)}else if(m===e.Protocol.ROOM_DATA_BYTES){const y=n.decode.stringCheck(g,u)?n.decode.string(g,u):n.decode.number(g,u);this.dispatchMessage(y,g.subarray(u.offset))}}dispatchMessage(d,g){var u;const m=this.getMessageHandlerKey(d);this.onMessageHandlers.events[m]?this.onMessageHandlers.emit(m,g):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",d,g):(u=console.warn)===null||u===void 0||u.call(console,`colyseus.js: onMessage() not registered for type '${d}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(d){switch(typeof d){case"string":return d;case"number":return`i${d}`;default:throw new Error("invalid message type.")}}};return Mn.Room=h,Mn}var Un={};function Ga(l,e){e.headers=l.headers||{},e.statusMessage=l.statusText,e.statusCode=l.status,e.data=l.response}function Dt(l,e,t){return new Promise(function(s,i){t=t||{};var n=new XMLHttpRequest,a,o,r,h=t.body,c=t.headers||{};t.timeout&&(n.timeout=t.timeout),n.ontimeout=n.onerror=function(d){d.timeout=d.type=="timeout",i(d)},n.onabort=function(d){d.aborted=!0,i(d)},n.open(l,e.href||e),n.onload=function(){for(r=n.getAllResponseHeaders().trim().split(/[\r\n]+/),Ga(n,n);o=r.shift();)o=o.split(": "),n.headers[o.shift().toLowerCase()]=o.join(": ");if(o=n.headers["content-type"],o&&~o.indexOf("application/json"))try{n.data=JSON.parse(n.data,t.reviver)}catch(d){return Ga(n,d),i(d)}(n.status>=400?i:s)(n)},typeof FormData<"u"&&h instanceof FormData||h&&typeof h=="object"&&(c["content-type"]="application/json",h=JSON.stringify(h)),n.withCredentials=!!t.withCredentials;for(a in c)n.setRequestHeader(a,c[a]);n.send(h),t.signal&&t.signal.addEventListener("abort",function(){n.abort()})})}var Nu=Dt.bind(Dt,"GET"),Yu=Dt.bind(Dt,"POST"),Xu=Dt.bind(Dt,"PATCH"),Uu=Dt.bind(Dt,"DELETE"),Vu=Dt.bind(Dt,"PUT");const zu=Object.freeze(Object.defineProperty({__proto__:null,del:Uu,get:Nu,patch:Xu,post:Yu,put:Vu,send:Dt},Symbol.toStringTag,{value:"Module"})),ju=rr(zu);var Ha;function Gu(){if(Ha)return Un;Ha=1;var l=gn(),e=ju;function t(n){var a=Object.create(null);return n&&Object.keys(n).forEach(function(o){if(o!=="default"){var r=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(a,o,r.get?r:{enumerable:!0,get:function(){return n[o]}})}}),a.default=n,Object.freeze(a)}var s=t(e);let i=class{constructor(a,o={}){this.client=a,this.headers=o}get(a,o={}){return this.request("get",a,o)}post(a,o={}){return this.request("post",a,o)}del(a,o={}){return this.request("del",a,o)}put(a,o={}){return this.request("put",a,o)}request(a,o,r={}){return s[a](this.client.getHttpEndpoint(o),this.getOptions(r)).catch(h=>{var c;if(h.aborted)throw new l.AbortError("Request aborted");const d=h.statusCode,g=((c=h.data)===null||c===void 0?void 0:c.error)||h.statusMessage||h.message;throw!d&&!g?h:new l.ServerError(d,g)})}getOptions(a){return a.headers=Object.assign({},this.headers,a.headers),this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(a.withCredentials=!0),a}};return Un.HTTP=i,Un}var Vn={},ci={},$a;function Hu(){if($a)return ci;$a=1;var l=mn;let e;function t(){if(!e)try{e=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!e&&typeof globalThis.indexedDB<"u"&&(e=new a),e||(e={cache:{},setItem:function(o,r){this.cache[o]=r},getItem:function(o){this.cache[o]},removeItem:function(o){delete this.cache[o]}}),e}function s(o,r){t().setItem(o,r)}function i(o){t().removeItem(o)}function n(o,r){const h=t().getItem(o);typeof Promise>"u"||!(h instanceof Promise)?r(h):h.then(c=>r(c))}class a{constructor(){this.dbPromise=new Promise(r=>{const h=indexedDB.open("_colyseus_storage",1);h.onupgradeneeded=()=>h.result.createObjectStore("store"),h.onsuccess=()=>r(h.result)})}tx(r,h){return l.__awaiter(this,void 0,void 0,function*(){const d=(yield this.dbPromise).transaction("store",r).objectStore("store");return h(d)})}setItem(r,h){return this.tx("readwrite",c=>c.put(h,r)).then()}getItem(r){return l.__awaiter(this,void 0,void 0,function*(){const h=yield this.tx("readonly",c=>c.get(r));return new Promise(c=>{h.onsuccess=()=>c(h.result)})})}removeItem(r){return this.tx("readwrite",h=>h.delete(r)).then()}}return ci.getItem=n,ci.removeItem=i,ci.setItem=s,ci}var Wa;function fh(){if(Wa)return Vn;Wa=1;var l=mn,e=Hu(),t=$l(),s,i,n,a;let o=class{constructor(h){this.http=h,this.settings={path:"/auth",key:"colyseus-auth-token"},s.set(this,!1),i.set(this,void 0),n.set(this,void 0),a.set(this,t.createNanoEvents()),e.getItem(this.settings.key,c=>this.token=c)}set token(h){this.http.authToken=h}get token(){return this.http.authToken}onChange(h){const c=l.__classPrivateFieldGet(this,a,"f").on("change",h);return l.__classPrivateFieldGet(this,s,"f")||l.__classPrivateFieldSet(this,i,new Promise((d,g)=>{this.getUserData().then(u=>{this.emitChange(Object.assign(Object.assign({},u),{token:this.token}))}).catch(u=>{this.emitChange({user:null,token:void 0})}).finally(()=>{d()})}),"f"),l.__classPrivateFieldSet(this,s,!0,"f"),c}getUserData(){return l.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(h,c,d){return l.__awaiter(this,void 0,void 0,function*(){const g=(yield this.http.post(`${this.settings.path}/register`,{body:{email:h,password:c,options:d}})).data;return this.emitChange(g),g})}signInWithEmailAndPassword(h,c){return l.__awaiter(this,void 0,void 0,function*(){const d=(yield this.http.post(`${this.settings.path}/login`,{body:{email:h,password:c}})).data;return this.emitChange(d),d})}signInAnonymously(h){return l.__awaiter(this,void 0,void 0,function*(){const c=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:h}})).data;return this.emitChange(c),c})}sendPasswordResetEmail(h){return l.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:h}})).data})}signInWithProvider(h){return l.__awaiter(this,arguments,void 0,function*(c,d={}){return new Promise((g,u)=>{const m=d.width||480,y=d.height||768,b=this.token?`?token=${this.token}`:"",E=`Login with ${c[0].toUpperCase()+c.substring(1)}`,v=this.http.client.getHttpEndpoint(`${d.prefix||`${this.settings.path}/provider`}/${c}${b}`),S=screen.width/2-m/2,x=screen.height/2-y/2;l.__classPrivateFieldSet(this,n,window.open(v,E,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+m+", height="+y+", top="+x+", left="+S),"f");const A=k=>{k.data.user===void 0&&k.data.token===void 0||(clearInterval(C),l.__classPrivateFieldGet(this,n,"f").close(),l.__classPrivateFieldSet(this,n,void 0,"f"),window.removeEventListener("message",A),k.data.error!==void 0?u(k.data.error):(g(k.data),this.emitChange(k.data)))},C=setInterval(()=>{(!l.__classPrivateFieldGet(this,n,"f")||l.__classPrivateFieldGet(this,n,"f").closed)&&(l.__classPrivateFieldSet(this,n,void 0,"f"),u("cancelled"),window.removeEventListener("message",A))},200);window.addEventListener("message",A)})})}signOut(){return l.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(h){h.token!==void 0&&(this.token=h.token,h.token===null?e.removeItem(this.settings.key):e.setItem(this.settings.key,h.token)),l.__classPrivateFieldGet(this,a,"f").emit("change",h)}};return s=new WeakMap,i=new WeakMap,n=new WeakMap,a=new WeakMap,Vn.Auth=o,Vn}var zn={},qa;function $u(){if(qa)return zn;qa=1;function l(e){var t;const s=((t=window?.location)===null||t===void 0?void 0:t.hostname)||"localhost",i=e.hostname.split("."),n=!e.hostname.includes("trycloudflare.com")&&!e.hostname.includes("discordsays.com")&&i.length>2?`/${i[0]}`:"";return e.pathname.startsWith("/.proxy")?`${e.protocol}//${s}${n}${e.pathname}${e.search}`:`${e.protocol}//${s}/.proxy/colyseus${n}${e.pathname}${e.search}`}return zn.discordURLBuilder=l,zn}var Ja;function Wu(){if(Ja)return Mi;Ja=1;var l=mn,e=gn(),t=dh(),s=Gu(),i=fh(),n=$u(),a;class o extends Error{constructor(d,g){super(d),this.code=g,this.name="MatchMakeError",Object.setPrototypeOf(this,o.prototype)}}const r=typeof window<"u"&&typeof((a=window?.location)===null||a===void 0?void 0:a.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";let h=class{constructor(d=r,g){var u,m;if(typeof d=="string"){const y=d.startsWith("/")?new URL(d,r):new URL(d),b=y.protocol==="https:"||y.protocol==="wss:",E=Number(y.port||(b?443:80));this.settings={hostname:y.hostname,pathname:y.pathname,port:E,secure:b,searchParams:y.searchParams.toString()||void 0}}else d.port===void 0&&(d.port=d.secure?443:80),d.pathname===void 0&&(d.pathname=""),this.settings=d;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new s.HTTP(this,g?.headers||{}),this.auth=new i.Auth(this.http),this.urlBuilder=g?.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((m=(u=window?.location)===null||u===void 0?void 0:u.hostname)===null||m===void 0)&&m.includes("discordsays.com"))&&(this.urlBuilder=n.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(d){return l.__awaiter(this,arguments,void 0,function*(g,u={},m){return yield this.createMatchMakeRequest("joinOrCreate",g,u,m)})}create(d){return l.__awaiter(this,arguments,void 0,function*(g,u={},m){return yield this.createMatchMakeRequest("create",g,u,m)})}join(d){return l.__awaiter(this,arguments,void 0,function*(g,u={},m){return yield this.createMatchMakeRequest("join",g,u,m)})}joinById(d){return l.__awaiter(this,arguments,void 0,function*(g,u={},m){return yield this.createMatchMakeRequest("joinById",g,u,m)})}reconnect(d,g){return l.__awaiter(this,void 0,void 0,function*(){if(typeof d=="string"&&typeof g=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[u,m]=d.split(":");if(!u||!m)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",u,{reconnectionToken:m},g)})}consumeSeatReservation(d,g,u){return l.__awaiter(this,void 0,void 0,function*(){const m=this.createRoom(d.room.name,g);m.roomId=d.room.roomId,m.sessionId=d.sessionId;const y={sessionId:m.sessionId};d.reconnectionToken&&(y.reconnectionToken=d.reconnectionToken);const b=u||m;return m.connect(this.buildEndpoint(d.room,y,d.protocol),d.devMode&&(()=>l.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${m.roomId}'...`);let E=0,v=8;const S=()=>l.__awaiter(this,void 0,void 0,function*(){E++;try{yield this.consumeSeatReservation(d,g,b),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${m.roomId}'`)}catch{E<v?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${E} out of ${v})`),setTimeout(S,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(S,2e3)})),b,d,this.http.headers),new Promise((E,v)=>{const S=(x,A)=>v(new e.ServerError(x,A));b.onError.once(S),b.onJoin.once(()=>{b.onError.remove(S),E(b)})})})}createMatchMakeRequest(d,g){return l.__awaiter(this,arguments,void 0,function*(u,m,y={},b,E){const v=(yield this.http.post(`matchmake/${u}/${m}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y)})).data;if(v.error)throw new o(v.error,v.code);return u==="reconnect"&&(v.reconnectionToken=y.reconnectionToken),yield this.consumeSeatReservation(v,b,E)})}createRoom(d,g){return new t.Room(d,g)}buildEndpoint(d,g={},u="ws"){let m=this.settings.searchParams||"";this.http.authToken&&(g._authToken=this.http.authToken);for(const E in g)g.hasOwnProperty(E)&&(m+=(m?"&":"")+`${E}=${g[E]}`);u==="h3"&&(u="http");let y=this.settings.secure?`${u}s://`:`${u}://`;d.publicAddress?y+=`${d.publicAddress}`:y+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const b=`${y}/${d.processId}/${d.roomId}?${m}`;return this.urlBuilder?this.urlBuilder(new URL(b)):b}getHttpEndpoint(d=""){const g=d.startsWith("/")?d:`/${d}`;let u=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${g}`;return this.settings.searchParams&&(u+=`?${this.settings.searchParams}`),this.urlBuilder?this.urlBuilder(new URL(u)):u}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}};return h.VERSION="0.16.22",Mi.Client=h,Mi.MatchMakeError=o,Mi}var jn={},Ka;function qu(){if(Ka)return jn;Ka=1;let l=class{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}};return jn.NoneSerializer=l,jn}var Za;function Ju(){return Za||(Za=1,(function(l){Vf();var e=Wu(),t=Gl(),s=dh(),i=fh(),n=gn(),a=Wl(),o=qu(),r=Hl();r.registerSerializer("schema",a.SchemaSerializer),r.registerSerializer("none",o.NoneSerializer),l.Client=e.Client,l.MatchMakeError=e.MatchMakeError,Object.defineProperty(l,"ErrorCode",{enumerable:!0,get:function(){return t.ErrorCode}}),Object.defineProperty(l,"Protocol",{enumerable:!0,get:function(){return t.Protocol}}),l.Room=s.Room,l.Auth=i.Auth,l.ServerError=n.ServerError,l.SchemaSerializer=a.SchemaSerializer,l.getStateCallbacks=a.getStateCallbacks,l.registerSerializer=r.registerSerializer})(Pn)),Pn}var Qa=Ju();const qt={FIRE_RATE_MS:100,CANNON_HEIGHT_OFFSET:200,RONKE_CANNON_HEIGHT_OFFSET:110,KATARO_CANNON_HEIGHT_OFFSET:90,INTERPOLATION_DELAY_MS:66,MIN_INTERPOLATION_DELAY_MS:50,MAX_INTERPOLATION_DELAY_MS:120,GROUND_HEIGHT_PERCENTAGE:.925},Ku={SERVER_TICK_RATE_MS:33},Ue={KEYBOARD_MOVEMENT_STEP:10,PLAYER_NAME_RANGE:1e3,BLOCK_DEPTH:12,BOSS_DEPTH:12,BLOCK_SMALL_SCALE:1,BLOCK_MEDIUM_SCALE:1,BLOCK_LARGE_SCALE:1,BOSS_SCALE:1,MYSTERY_BLOCK_MIN_SCALE:.58,MYSTERY_BLOCK_MAX_SCALE:1.2,BLOCK_HP_TEXT_STYLE:{fontFamily:"LilitaOne",fontSize:"18px",color:"#ffffff",stroke:"#000000",strokeThickness:3},POWERUP_DEPTH:2,POWERUP_SCALE:.8,CRYSTAL_DEPTH:2,CRYSTAL_SCALE:.6,POWERUP_ICON_SIZE:38,POWERUP_ICON_SPACING:8,POWERUP_ICON_START_X:10,POWERUP_ICON_START_Y_FROM_BOTTOM:45,POWERUP_ICON_DEPTH:100,POWERUP_ICON_OVERLAY_DEPTH:101};function nr(l){switch(l){case"ronke":return qt.RONKE_CANNON_HEIGHT_OFFSET;case"kataro":return qt.KATARO_CANNON_HEIGHT_OFFSET;default:return qt.CANNON_HEIGHT_OFFSET}}class Zu{client;room;$;positionUpdateCallback;bulletAddedCallback;bulletRemovedCallback;blockAddedCallback;blockChangedCallback;blockRemovedCallback;bossAttackCallback;powerupAddedCallback;powerupChangedCallback;powerupRemovedCallback;crystalAddedCallback;crystalChangedCallback;crystalRemovedCallback;playerPowerupUpdateCallback;scoreUpdateCallback;crystalUpdateCallback;gameOverCallback;positionAckCallback;rttUpdateCallback;rttSamples=[];currentRtt=100;pingInterval;async connectWithAuth(e,t){const s="ws://138.201.133.181:2568";this.client=new Qa.Client(s);const i={name:`Player_${Math.floor(Math.random()*Ue.PLAYER_NAME_RANGE)}`,userId:e,token:t};return this.room=await this.client.create("game_room",i),this.$=Qa.getStateCallbacks(this.room),new Promise((n,a)=>{const o=setTimeout(()=>{a(new Error("Session confirmation timeout"))},15e3);this.room.onMessage("sessionReady",r=>{clearTimeout(o),n(r)}),this.room.onError((r,h)=>{clearTimeout(o),a(new Error(h||`Connection error: ${r}`))})})}sendMove(e,t){this.room&&this.room.send("playerMove",{x:e,sequence:t})}sendStartShooting(){this.room&&this.room.send("startShooting",{})}sendStopShooting(){this.room&&this.room.send("stopShooting",{})}sendRestartGame(){this.room&&this.room.send("restartGame",{})}sendStartGame(){this.room&&this.room.send("startGame",{})}onPositionUpdate(e){this.positionUpdateCallback=e}onBulletAdded(e){this.bulletAddedCallback=e}onBulletRemoved(e){this.bulletRemovedCallback=e}onBlockAdded(e){this.blockAddedCallback=e}onBlockChanged(e){this.blockChangedCallback=e}onBlockRemoved(e){this.blockRemovedCallback=e}onBossAttack(e){this.bossAttackCallback=e}onPowerupAdded(e){this.powerupAddedCallback=e}onPowerupChanged(e){this.powerupChangedCallback=e}onPowerupRemoved(e){this.powerupRemovedCallback=e}onCrystalAdded(e){this.crystalAddedCallback=e}onCrystalChanged(e){this.crystalChangedCallback=e}onCrystalRemoved(e){this.crystalRemovedCallback=e}onPlayerPowerupUpdate(e){this.playerPowerupUpdateCallback=e}onScoreUpdate(e){this.scoreUpdateCallback=e}onCrystalUpdate(e){this.crystalUpdateCallback=e}onGameOver(e){this.gameOverCallback=e}onPositionAck(e){this.positionAckCallback=e}onRttUpdate(e){this.rttUpdateCallback=e}getRtt(){return this.currentRtt}getSessionId(){return this.room?.sessionId}getPlayer(e){return this.room?.state?.players?.get(e)}getServerGameTime(){return this.room?.state?.gameTime??0}setupRoomHandlers(){if(!this.room||!this.room.state||!this.$){console.error("[NETWORK] setupRoomHandlers: room, state, or $ proxy is null");return}const e=this.$;this.room.onMessage("positionAck",i=>{this.positionAckCallback&&this.positionAckCallback(i.x,i.sequence,i.serverTick)}),this.room.onMessage("pong",i=>{const a=Date.now()-i.clientTime;this.rttSamples.push(a),this.rttSamples.length>10&&this.rttSamples.shift();const o=[...this.rttSamples].sort((r,h)=>r-h);this.currentRtt=o[Math.floor(o.length/2)],this.rttUpdateCallback&&this.rttUpdateCallback(this.currentRtt)}),this.pingInterval=window.setInterval(()=>{this.room?.send("ping",{clientTime:Date.now()})},1e3);const t=new Map;let s=!1;e(this.room.state).players.onAdd((i,n)=>{const a=n===this.room?.sessionId,o=this.room.state.serverTick||0;a&&(this.positionUpdateCallback&&this.positionUpdateCallback(i.x,o),this.scoreUpdateCallback&&this.scoreUpdateCallback(i.score),this.crystalUpdateCallback&&this.crystalUpdateCallback(i.crystalCount),this.playerPowerupUpdateCallback&&this.playerPowerupUpdateCallback(i),e(i).onChange(()=>{const r=this.room.state.serverTick||0;this.positionUpdateCallback&&this.positionUpdateCallback(i.x,r),this.scoreUpdateCallback&&this.scoreUpdateCallback(i.score),this.crystalUpdateCallback&&this.crystalUpdateCallback(i.crystalCount),this.playerPowerupUpdateCallback&&this.playerPowerupUpdateCallback(i)}))}),e(this.room.state).bullets.onAdd((i,n)=>{this.bulletAddedCallback&&this.bulletAddedCallback(i,n)}),e(this.room.state).bullets.onRemove((i,n)=>{this.bulletRemovedCallback&&this.bulletRemovedCallback({},n)}),e(this.room.state).blocks.onAdd((i,n)=>{t.set(n,i.blockSpawnTimer||0),this.blockAddedCallback&&this.blockAddedCallback(i,n),e(i).onChange(()=>{const a=t.get(n)||0;i.isBoss&&a>.5&&i.blockSpawnTimer<.5&&this.bossAttackCallback?.(n),t.set(n,i.blockSpawnTimer||0),this.blockChangedCallback?.(i,n)})}),e(this.room.state).blocks.onRemove((i,n)=>{t.delete(n),this.blockRemovedCallback&&this.blockRemovedCallback(i,n)}),e(this.room.state).powerups.onAdd((i,n)=>{this.powerupAddedCallback&&this.powerupAddedCallback(i,n),e(i).onChange(()=>{this.powerupChangedCallback?.(i,n)})}),e(this.room.state).powerups.onRemove((i,n)=>{this.powerupRemovedCallback&&this.powerupRemovedCallback(i,n)}),e(this.room.state).crystals.onAdd((i,n)=>{this.crystalAddedCallback&&this.crystalAddedCallback(i,n),e(i).onChange(()=>{this.crystalChangedCallback?.(i,n)})}),e(this.room.state).crystals.onRemove((i,n)=>{this.crystalRemovedCallback&&this.crystalRemovedCallback(i,n)}),e(this.room.state).listen("isGameOver",i=>{if(i&&!s&&this.gameOverCallback){const n=this.room?.sessionId;if(n){const o=this.room.state.players.get(n)?.score||0;this.gameOverCallback(o)}}s=i})}destroy(){this.pingInterval&&(window.clearInterval(this.pingInterval),this.pingInterval=void 0),this.room&&this.room.leave()}}class Qu extends wt.Scene{energyFrame;energyIcon;energyPlusIcon;energyValueText;userInfo=null;playButton;leaderboardButton;connectingText=null;errorText=null;networkSystem=null;constructor(){super({key:"TitleScene"})}create(){const{width:e,height:t}=this.cameras.main,s=this.add.image(e/2,t/2,"BG");s.setOrigin(.5,.5),s.setDepth(-1),this.add.image(e/2,t*.25,"logo").setOrigin(.5);const n=e-70,a=40;this.energyFrame=this.add.image(n,a,"frame-currency"),this.energyFrame.setOrigin(1,.5),this.energyFrame.setDepth(999);const o=this.energyFrame.width,r=n-o,h=32,c=r;this.energyIcon=this.add.image(c,a,"energy"),this.energyIcon.setOrigin(.5,.5);const d=h/Math.max(this.energyIcon.width,this.energyIcon.height);this.energyIcon.setScale(d),this.energyIcon.setDepth(1e3);const g=this.energyIcon.width*d,u=this.energyIcon.height*d,m=16,y=c+g/2-m/2,b=a+u/2-m;this.energyPlusIcon=this.add.image(y,b,"plus"),this.energyPlusIcon.setOrigin(0,0),this.energyPlusIcon.setDisplaySize(m,m),this.energyPlusIcon.setDepth(1001),this.energyValueText=this.add.text(n-15,a,"...",{fontFamily:"LilitaOne",fontSize:"24px",color:"#ffffff",stroke:"#000000",strokeThickness:2}),this.energyValueText.setOrigin(1,.5),this.energyValueText.setDepth(1e3),this.userInfo=this.registry.get("userInfo"),this.userInfo?this.energyValueText.setText(this.userInfo.gameInfo.availableEnergies.toString()):window.arcadeToken?this.energyValueText.setText("?"):this.energyValueText.setText("100"),this.playButton=new Zi(this,e/2,t*.65,"button-play","Play",{fontFamily:"LilitaOne",fontSize:"48px",fontStyle:"bold",color:"#ffffff",stroke:"#2d5016",strokeThickness:6},()=>this.startGame()),this.playButton.setScale(.9),this.add.existing(this.playButton),this.leaderboardButton=new Zi(this,e/2,t*.78,"button-play","Leaderboard",{fontFamily:"LilitaOne",fontSize:"36px",fontStyle:"bold",color:"#ffffff",stroke:"#2d5016",strokeThickness:4},()=>this.scene.launch("LeaderboardScene")),this.leaderboardButton.setScale(.7),this.add.existing(this.leaderboardButton)}async startGame(){const e=window.arcadeToken||null,t=this.userInfo?.userID||null;if(!t||!e){this.showError("Authentication required. Please reload.");return}this.showConnecting();try{this.networkSystem=new Zu;const s=await this.networkSystem.connectWithAuth(t,e);this.registry.set("networkSystem",this.networkSystem),this.registry.set("sessionData",s),this.scene.start("MainScene")}catch(s){this.hideConnecting(),this.showError(s instanceof Error?s.message:"Connection failed"),this.networkSystem=null}}showConnecting(){this.playButton.setVisible(!1),this.leaderboardButton.setVisible(!1),this.errorText?.destroy(),this.errorText=null;const{width:e,height:t}=this.cameras.main;this.connectingText=this.add.text(e/2,t*.7,"Connecting...",{fontFamily:"LilitaOne",fontSize:"32px",color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5)}hideConnecting(){this.connectingText?.destroy(),this.connectingText=null,this.playButton.setVisible(!0),this.leaderboardButton.setVisible(!0)}showError(e){this.errorText?.destroy();const{width:t,height:s}=this.cameras.main;this.errorText=this.add.text(t/2,s*.85,e,{fontFamily:"LilitaOne",fontSize:"20px",color:"#ff6b6b",stroke:"#000000",strokeThickness:2}).setOrigin(.5)}}class em{static apiBaseUrl="https://waypoint-api.skymavis.one";static gameID="de5a8c64-9c93-46de-b64b-12da3b1b3ad5";static async getLeaderboard(e=1,t=100){try{return(await Ze.post(`${this.apiBaseUrl}/v1/rpc/public/ronin-profile/game-leaderboard`,{gameID:this.gameID,page:e,limit:t},{headers:{"Content-Type":"application/json"},timeout:1e4})).data}catch(s){return console.error("[LEADERBOARD] Failed to fetch leaderboard:",s),null}}}const di=60,eo=8,Yi=20,Ws=40;class tm extends wt.Scene{scrollContainer;scrollY=0;scrollVelocity=0;isDragging=!1;lastPointerY=0;viewportTop=0;viewportHeight=0;maxScroll=0;contentHeight=0;loadingText=null;errorText=null;playerRankContainer=null;backButton=null;userInfo=null;constructor(){super({key:"LeaderboardScene"})}create(){const{width:e,height:t}=this.cameras.main;this.userInfo=this.registry.get("userInfo");const s=this.add.rectangle(e/2,t/2,e,t,0,.7);s.setDepth(-1),s.setInteractive(),this.backButton=new Zi(this,70,45,"button-play","Back",{fontFamily:"LilitaOne",fontSize:"48px",fontStyle:"bold",color:"#ffffff",stroke:"#2d5016",strokeThickness:4},()=>this.scene.stop("LeaderboardScene")),this.backButton.setScale(.4),this.backButton.setDepth(100),this.add.existing(this.backButton);const i=this.add.text(e/2,50,"LEADERBOARD",{fontFamily:"LilitaOne",fontSize:"36px",color:"#ffffff",stroke:"#000000",strokeThickness:4});i.setOrigin(.5,.5),i.setDepth(100),this.viewportTop=100,this.viewportHeight=t-200,this.scrollContainer=this.add.container(e/2,this.viewportTop),this.scrollContainer.setDepth(10);const n=this.add.graphics();n.fillStyle(16777215),n.fillRect(0,this.viewportTop,e,this.viewportHeight);const a=n.createGeometryMask();this.scrollContainer.setMask(a),n.setVisible(!1),this.setupScrollInput(),this.showLoading(),this.fetchLeaderboard()}setupScrollInput(){this.input.on("pointerdown",e=>{e.y>=this.viewportTop&&e.y<=this.viewportTop+this.viewportHeight&&(this.isDragging=!0,this.lastPointerY=e.y,this.scrollVelocity=0)}),this.input.on("pointermove",e=>{if(!this.isDragging)return;const t=e.y-this.lastPointerY;this.scrollY=wt.Math.Clamp(this.scrollY-t,0,this.maxScroll),this.lastPointerY=e.y,this.scrollVelocity=-t,this.updateScrollPosition()}),this.input.on("pointerup",()=>{this.isDragging=!1}),this.input.on("pointerupoutside",()=>{this.isDragging=!1}),this.input.on("wheel",(e,t,s,i)=>{this.scrollY=wt.Math.Clamp(this.scrollY+i*.5,0,this.maxScroll),this.updateScrollPosition()})}update(){!this.isDragging&&Math.abs(this.scrollVelocity)>.1&&(this.scrollVelocity*=.92,this.scrollY=wt.Math.Clamp(this.scrollY+this.scrollVelocity,0,this.maxScroll),this.updateScrollPosition())}updateScrollPosition(){this.scrollContainer.y=this.viewportTop-this.scrollY}showLoading(){this.hideMessages();const{width:e,height:t}=this.cameras.main;this.loadingText=this.add.text(e/2,t/2-50,"Loading...",{fontFamily:"LilitaOne",fontSize:"24px",color:"#ffffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(50)}hideMessages(){this.loadingText?.destroy(),this.loadingText=null,this.errorText?.destroy(),this.errorText=null}showError(e){this.hideMessages();const{width:t,height:s}=this.cameras.main;this.errorText=this.add.text(t/2,s/2-50,e,{fontFamily:"LilitaOne",fontSize:"20px",color:"#ff6b6b",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(50)}async fetchLeaderboard(){const e=await em.getLeaderboard(1,100);if(!e||!e.data){this.showError("Failed to load leaderboard");return}if(e.data.length===0){this.showError("No rankings yet");return}this.hideMessages(),this.loadAvatars(e.data)}loadAvatars(e){const t=new Map;if(e.forEach(n=>{n.avatarUrl&&!this.textures.exists(`avatar-${n.userID}`)&&t.set(n.userID,n.avatarUrl)}),t.size===0){this.renderLeaderboard(e);return}t.forEach((n,a)=>{this.load.image(`avatar-${a}`,n)});const s=this.load,i=()=>{s.off("complete",i),this.renderLeaderboard(e)};s.on("complete",i),s.start()}renderLeaderboard(e){const{width:t,height:s}=this.cameras.main,i=t*.9,n=i+50;this.scrollContainer.removeAll(!0);let a=null;e.forEach((o,r)=>{const h=this.userInfo&&o.userID===this.userInfo.userID;h&&(a=o);const c=this.createEntryRow(o,r,i,h||!1);this.scrollContainer.add(c)}),this.contentHeight=e.length*(di+eo),this.maxScroll=Math.max(0,this.contentHeight-this.viewportHeight),a&&this.renderPlayerRank(a,n,s)}createEntryRow(e,t,s,i){const n=t*(di+eo)+di/2,a=this.add.container(0,n),o=i?"leaderboard-player-rank":"leaderboard-rank",r=this.add.image(0,0,o);r.setDisplaySize(s,di),r.setOrigin(.5,.5);const h=this.add.text(-s/2+Yi,0,`${e.rank}`,{fontFamily:"LilitaOne",fontSize:"22px",color:i?"#ffffff":"#5c4a3d",stroke:i?"#1a5a5a":void 0,strokeThickness:i?2:0});h.setOrigin(0,.5);const c=`avatar-${e.userID}`,d=-s/2+70;if(this.textures.exists(c)){const y=this.add.image(d,0,c);y.setDisplaySize(Ws,Ws),y.setOrigin(.5,.5);const b=this.add.graphics();b.fillStyle(16777215),b.fillCircle(d,n,Ws/2);const E=b.createGeometryMask();y.setMask(E),a.add(y)}const g=this.truncateName(e.name,12),u=this.add.text(-s/2+100,0,g,{fontFamily:"LilitaOne",fontSize:"20px",color:i?"#ffffff":"#5c4a3d"});u.setOrigin(0,.5);const m=this.add.text(s/2-Yi,0,e.scores.toLocaleString(),{fontFamily:"LilitaOne",fontSize:"22px",color:i?"#ffffff":"#5c4a3d"});return m.setOrigin(1,.5),a.add([r,h,u,m]),a}renderPlayerRank(e,t,s){this.playerRankContainer?.destroy();const{width:i}=this.cameras.main,n=s-60,a=this.add.container(i/2,n);a.setDepth(100),this.playerRankContainer=a;const o=this.add.image(0,0,"leaderboard-player-rank");o.setDisplaySize(t,di),o.setOrigin(.5,.5);const r=this.add.text(-t/2+Yi,0,`${e.rank}`,{fontFamily:"LilitaOne",fontSize:"22px",color:"#ffffff",stroke:"#1a5a5a",strokeThickness:2});r.setOrigin(0,.5);const h=`avatar-${e.userID}`,c=-t/2+70;if(this.textures.exists(h)){const m=this.add.image(c,0,h);m.setDisplaySize(Ws,Ws),m.setOrigin(.5,.5);const y=this.add.graphics();y.fillStyle(16777215),y.fillCircle(i/2+c,n,Ws/2);const b=y.createGeometryMask();m.setMask(b),a.add(m)}const d=this.truncateName(e.name,12),g=this.add.text(-t/2+100,0,d,{fontFamily:"LilitaOne",fontSize:"20px",color:"#ffffff"});g.setOrigin(0,.5);const u=this.add.text(t/2-Yi,0,e.scores.toLocaleString(),{fontFamily:"LilitaOne",fontSize:"22px",color:"#ffffff"});u.setOrigin(1,.5),a.add([o,r,g,u])}truncateName(e,t){return e.length<=t?e:e.substring(0,t-3)+"..."}}class sm{scene;isPointerDown=!1;currentX=0;moveCallback;startShootingCallback;stopShootingCallback;lastSentX=0;lastSendTime=0;pendingX;sendInterval;sendThrottleMs=16;constructor(e){this.scene=e,this.currentX=e.cameras.main.centerX,this.lastSentX=this.currentX,this.setupInput(),this.setupSendInterval()}onMove(e){this.moveCallback=e}onStartShooting(e){this.startShootingCallback=e}onStopShooting(e){this.stopShootingCallback=e}getCurrentX(){return this.currentX}setupSendInterval(){this.sendInterval=window.setInterval(()=>{this.pendingX!==void 0&&this.pendingX!==this.lastSentX&&(this.lastSentX=this.pendingX,this.moveCallback&&this.moveCallback(this.pendingX),this.pendingX=void 0)},this.sendThrottleMs)}setupInput(){this.scene.input.on("pointerdown",e=>{this.isPointerDown||(this.isPointerDown=!0,this.handleMovement(e.x),this.startShootingCallback&&this.startShootingCallback())}),this.scene.input.on("pointerup",()=>{this.isPointerDown&&(this.isPointerDown=!1,this.stopShootingCallback&&this.stopShootingCallback())}),this.scene.input.on("pointermove",e=>{this.isPointerDown&&this.handleMovement(e.x)}),this.scene.input.keyboard?.on("keydown",e=>{if(e.key==="ArrowLeft"){const t=Math.max(0,this.currentX-Ue.KEYBOARD_MOVEMENT_STEP);this.handleMovement(t)}else if(e.key==="ArrowRight"){const t=this.scene.cameras.main.width,s=Math.min(t,this.currentX+Ue.KEYBOARD_MOVEMENT_STEP);this.handleMovement(s)}})}handleMovement(e){this.currentX=e;const t=Date.now();t-this.lastSendTime>=this.sendThrottleMs?(this.lastSendTime=t,this.lastSentX=e,this.moveCallback&&this.moveCallback(e),this.pendingX=void 0):this.pendingX=e}destroy(){this.sendInterval&&(window.clearInterval(this.sendInterval),this.sendInterval=void 0),this.scene.input.off("pointerdown"),this.scene.input.off("pointerup"),this.scene.input.off("pointermove"),this.scene.input.keyboard?.off("keydown")}}class im{spineObject;currentState;hasPlayedDeath=!1;deathAnimationCompleteCallback;constructor(e,t,s,i){this.spineObject=e.add.spine(t,s,`${i}-data`,`${i}-atlas`);const n=i==="ronke"?.22:.27;this.spineObject.setOrigin(n,1),this.spineObject.setDepth(10),this.spineObject.setScale(1),this.currentState={isMoving:!1,isShooting:!1,isAlive:!0,isLaserActive:!1};const a=this.spineObject.animationState.setAnimation(0,"idle",!0);a&&(a.mixDuration=.2),this.setupAnimationListeners()}setupAnimationListeners(){this.spineObject.animationState.addListener({complete:e=>{if(e.animation.name==="die"){this.deathAnimationCompleteCallback&&this.deathAnimationCompleteCallback();return}e.trackIndex===1&&(this.currentState.isShooting||this.spineObject.animationState.clearTrack(1))}})}updateState(e){const t={...this.currentState};if(this.currentState={...this.currentState,...e},!this.currentState.isAlive&&!this.hasPlayedDeath){this.playDeathAnimation();return}if(!this.currentState.isAlive)return;(t.isMoving!==this.currentState.isMoving||t.isShooting!==this.currentState.isShooting||t.isLaserActive!==this.currentState.isLaserActive)&&this.updateAnimation()}updateAnimation(){const e=this.spineObject.animationState.getCurrent(0);let t="idle";if(this.currentState.isMoving&&(t="move"),e&&e.animation.name!==t){const s=this.spineObject.animationState.setAnimation(0,t,!0);s&&(s.mixDuration=.2)}else if(!e){const s=this.spineObject.animationState.setAnimation(0,t,!0);s&&(s.mixDuration=.2)}}triggerAttack(){if(!this.currentState.isAlive)return;const e=this.currentState.isLaserActive?"atack_02":"atack_01",t=this.spineObject.animationState.setAnimation(1,e,!1);t&&(t.mixDuration=.1)}playDeathAnimation(){this.hasPlayedDeath=!0,this.spineObject.animationState.clearTracks(),this.spineObject.animationState.setAnimation(0,"die",!1)}setPosition(e,t){this.spineObject.setPosition(e,t)}getPosition(){return{x:this.spineObject.x,y:this.spineObject.y}}destroy(){this.spineObject.destroy()}getSpineObject(){return this.spineObject}setFacingDirection(e){const t=e?-1:1;this.spineObject.scaleX!==t&&this.spineObject.setScale(t,1)}onDeathAnimationComplete(e){this.deathAnimationCompleteCallback=e}resetDeathState(){this.hasPlayedDeath=!1,this.currentState.isAlive=!0,this.spineObject.animationState.clearTracks(),this.spineObject.skeleton.setToSetupPose();const e=this.spineObject.animationState.setAnimation(0,"idle",!0);e&&(e.mixDuration=.2)}}class nm{scene;characterSystem;characterType;cannonY;hitboxGraphics;constructor(e){this.scene=e}setupBackground(){const e=this.scene.cameras.main.centerX,t=this.scene.cameras.main.centerY;this.scene.add.image(e,t,"BG").setOrigin(.5,.5).setDepth(-1)}setupGround(){return this.scene.cameras.main.height*qt.GROUND_HEIGHT_PERCENTAGE}setupCannon(e,t,s){return this.characterSystem=new im(this.scene,e,t,s),this.characterType=s,this.cannonY=t,this.characterSystem}renderHitbox(e,t){this.hitboxGraphics}updateCannonPosition(e){this.characterSystem&&this.cannonY!==void 0&&(this.characterSystem.setPosition(e,this.cannonY),this.renderHitbox(e,this.cannonY))}getCharacterSystem(){return this.characterSystem}getCannonY(){return this.cannonY}update(e=!1){}}class rm{scene;activeBullets=new Map;ghostBulletCounter=0;constructor(e){this.scene=e}getBulletTexture(e){switch(e){case"ronke":return"bullet-gun";case"kataro":return"bullet-shuriken";default:return"bullet"}}createBullet(e,t,s,i,n,a="ronke"){if(this.removeGhostBulletsNearPosition(t,s),this.activeBullets.has(e))return;const o=this.getBulletTexture(a),r=this.scene.add.image(t,s,o);r.setScale(1),r.setDepth(5),r.setVisible(!0),this.activeBullets.set(e,{sprite:r,x:t,y:s,vy:i,isPredicted:!1})}createGhostBullet(e,t,s="ronke"){const i=`ghost_${this.ghostBulletCounter++}`,n=this.getBulletTexture(s),a=this.scene.add.image(e,t,n);return a.setScale(1),a.setDepth(5),a.setAlpha(.6),a.setVisible(!0),this.activeBullets.set(i,{sprite:a,x:e,y:t,vy:-1e3,isPredicted:!0,createdAt:Date.now()}),i}removeGhostBulletsNearPosition(e,t){for(const[i,n]of this.activeBullets)if(n.isPredicted&&Math.abs(n.x-e)<25){n.sprite.destroy(),this.activeBullets.delete(i);return}}update(e){const t=Date.now(),s=500,i=[];this.activeBullets.forEach((n,a)=>{n.y+=n.vy*e,n.sprite.setPosition(n.x,n.y),n.isPredicted&&n.createdAt&&t-n.createdAt>s&&i.push(a)}),i.forEach(n=>this.removeBullet(n))}removeBullet(e){const t=this.activeBullets.get(e);t&&(t.sprite.destroy(),this.activeBullets.delete(e))}clear(){this.activeBullets.forEach(e=>e.sprite.destroy()),this.activeBullets.clear()}}class xr{states=[];maxStates=5;interpolationDelayMs;tickDurationMs=Ku.SERVER_TICK_RATE_MS;renderClock=0;lastUpdateTime=0;initialized=!1;constructor(e){this.interpolationDelayMs=e??qt.INTERPOLATION_DELAY_MS}setInterpolationDelay(e){this.interpolationDelayMs=e}addState(e,t,s,i,n=0){if(this.states.length>0){const o=this.states[this.states.length-1].tick;if(i===o){const r=this.states[this.states.length-1];r.x=e,r.y=t,r.vx=n,r.vy=s;return}if(i<o)return}const a=performance.now();if(this.states.push({x:e,y:t,vx:n,vy:s,tick:i,timestamp:a}),!this.initialized&&this.states.length>=2){const o=this.interpolationDelayMs/this.tickDurationMs;this.renderClock=i-o,this.lastUpdateTime=a,this.initialized=!0}this.states.length>this.maxStates&&this.states.shift()}getInterpolatedPosition(e){if(this.states.length===0)return null;const t=performance.now();if(this.states.length===1){const m=this.states[0],y=(t-m.timestamp)/1e3,b=Math.min(y,.3);return{x:m.x+m.vx*b,y:m.y+m.vy*b}}if(this.lastUpdateTime>0){const y=(t-this.lastUpdateTime)/this.tickDurationMs;this.renderClock+=y}this.lastUpdateTime=t;const s=this.states[this.states.length-1],i=this.interpolationDelayMs/this.tickDurationMs,n=s.tick-i,a=this.states[0].tick;this.renderClock>n+1?this.renderClock=this.renderClock*.8+n*.2:this.renderClock<a-1&&(this.renderClock=this.renderClock*.8+a*.2);const o=this.renderClock;let r=null,h=null;for(let m=0;m<this.states.length-1;m++)if(this.states[m].tick<=o&&this.states[m+1].tick>o){r=this.states[m],h=this.states[m+1];break}if(r&&h){const m=h.tick-r.tick;if(m<=0)return{x:h.x,y:h.y};const y=(o-r.tick)/m,b=Math.max(0,Math.min(1,y)),E=r.x+(h.x-r.x)*b,v=r.y+(h.y-r.y)*b;return{x:E,y:v}}if(o<=this.states[0].tick){const m=this.states[0];return{x:m.x,y:m.y}}const c=this.states[this.states.length-1],g=(o-c.tick)*this.tickDurationMs/1e3,u=Math.min(Math.max(0,g),.3);return{x:c.x+c.vx*u,y:c.y+c.vy*u}}getLastKnownPosition(){if(this.states.length===0)return null;const e=this.states[this.states.length-1];return{x:e.x,y:e.y}}resyncToLatest(){if(this.states.length<2)return;const e=this.states[this.states.length-1],t=this.interpolationDelayMs/this.tickDurationMs;this.renderClock=e.tick-t,this.lastUpdateTime=performance.now()}clear(){this.states=[],this.renderClock=0,this.lastUpdateTime=0,this.initialized=!1}hasStates(){return this.states.length>0}isReadyForInterpolation(){return this.states.length>=1}}class am{scene;activeBlocks=new Map;bounceCallback;constructor(e){this.scene=e}onBlockBounce(e){this.bounceCallback=e}getBlockMaxHp(e){return this.activeBlocks.get(e)?.maxHp}setInterpolationDelay(e){this.activeBlocks.forEach(t=>{t.buffer.setInterpolationDelay(e)})}createBlock(e,t,s,i,n,a,o,r,h,c=!1,d=!1,g="falling",u=!1){if(this.activeBlocks.has(e))return;let m,y=!1;if(a==="boss"){const k=this.scene.add.spine(0,0,"boss-data","boss-atlas");k.setScale(Ue.BOSS_SCALE),k.skeleton.setSkinByName("basic"),k.skeleton.setSlotsToSetupPose(),k.animationState.setAnimation(0,"idle",!0),m=k,y=!0}else{const k=this.getTextureForBlock(a,i,n),_=this.getScaleForBlockType(a),L=this.scene.add.image(0,0,k);if(L.setScale(_),u){const N=L.postFX?.addGlow(16753920,0,0,!1,.1,8);N&&(N.outerStrength=8,N.innerStrength=0)}else if(d){const N=L.postFX?.addGlow(8978312,0,0,!1,.1,8);N&&(N.outerStrength=8,N.innerStrength=0)}m=L}const b=a==="mystery"?"?":i.toString(),E=this.scene.add.text(0,0,b,{fontFamily:Ue.BLOCK_HP_TEXT_STYLE.fontFamily,fontSize:Ue.BLOCK_HP_TEXT_STYLE.fontSize,color:Ue.BLOCK_HP_TEXT_STYLE.color,stroke:Ue.BLOCK_HP_TEXT_STYLE.stroke,strokeThickness:Ue.BLOCK_HP_TEXT_STYLE.strokeThickness});E.setOrigin(.5);let v;const S=[m,E],x=this.scene.add.container(t,s,S),A=c?Ue.BOSS_DEPTH:Ue.BLOCK_DEPTH;x.setDepth(A),g==="entering"?(x.setAlpha(.7),x.setVisible(!0)):x.setVisible(!1);const C=new xr;C.addState(t,s,r,h),this.activeBlocks.set(e,{container:x,sprite:m,hpText:E,hitboxGraphics:v,buffer:C,blockState:g,blockType:a,maxHp:n,isSpine:y,lastHp:i,activeTweens:[],currentVx:0,isFrozen:!1,hasLowHealthSkin:!1,previousVy:r})}updateBlock(e,t,s,i,n,a=0,o=!1){const r=this.activeBlocks.get(e);if(r){const h=r.previousVy<0,c=i>0;h&&c&&this.bounceCallback&&this.bounceCallback(r.maxHp),r.previousVy=i;const d=r.isFrozen&&!o;r.buffer.addState(t,s,i,n,a),r.currentVx=a,r.isFrozen=o,d&&r.buffer.resyncToLatest()}}update(){const e=Date.now();this.activeBlocks.forEach((t,s)=>{t.buffer.isReadyForInterpolation()&&!t.container.visible&&t.container.setVisible(!0);let i=null;t.isFrozen?i=t.buffer.getLastKnownPosition():i=t.buffer.getInterpolatedPosition(e),i&&t.container.setPosition(i.x,i.y)})}updateHealth(e,t,s,i){const n=this.activeBlocks.get(e);if(!n)return;const a=n.lastHp!==void 0&&t<n.lastHp;if(n.isSpine){if(n.hpText.setText(t.toString()),a&&this.applyHitEffects(n,t),!n.hasLowHealthSkin&&s>0&&t/s<=.1){const r=n.sprite;r.skeleton.setSkinByName("skin_01"),r.skeleton.setSlotsToSetupPose(),n.hasLowHealthSkin=!0}n.lastHp=t;return}if(n.blockType==="mystery"){n.hpText.setText("?");const o=t/n.maxHp,r=Ue.MYSTERY_BLOCK_MIN_SCALE,h=Ue.MYSTERY_BLOCK_MAX_SCALE,c=r+(1-o)*(h-r);n.sprite.setScale(c)}else n.hpText.setText(t.toString());a&&this.applyHitEffects(n,t),n.lastHp=t}applyHitEffects(e,t){const s=e.sprite;if(e.activeTweens.some(h=>h.isPlaying()))return;const a=t/e.maxHp>.5?1.08:1.1,o=e.blockType==="mystery"?s.scaleX:1,r=this.scene.tweens.add({targets:s,scaleX:o*a,scaleY:o*a,duration:60,yoyo:!0,ease:"Back.easeOut",onComplete:()=>{const h=e.activeTweens.indexOf(r);h>-1&&e.activeTweens.splice(h,1)}});e.activeTweens.push(r)}updateBlockState(e,t){const s=this.activeBlocks.get(e);s&&s.blockState!==t&&(s.blockState=t,t==="falling"?s.container.setAlpha(1):t==="entering"&&s.container.setAlpha(.7))}triggerBossAttack(e){const t=this.activeBlocks.get(e);if(!t||!t.isSpine)return;const s=t.sprite;s.animationState.setAnimation(0,"attack",!1),s.animationState.addListener({complete:i=>{i.animation.name==="attack"&&this.activeBlocks.has(e)&&s.animationState.setAnimation(0,"idle",!0)}})}removeBlock(e){const t=this.activeBlocks.get(e);t&&(t.activeTweens.forEach(s=>{s&&s.isPlaying()&&s.stop()}),t.activeTweens=[],t.container.destroy(),this.activeBlocks.delete(e))}clear(){this.activeBlocks.forEach(e=>{e.activeTweens.forEach(t=>{t&&t.isPlaying()&&t.stop()}),e.container.destroy()}),this.activeBlocks.clear()}getTextureForBlock(e,t,s){switch(e){case"small":return"block-small";case"medium":return"block-medium";case"large":return"block-large";case"mystery":return"block-mystery";default:return"block-medium"}}getScaleForBlockType(e){switch(e){case"small":return Ue.BLOCK_SMALL_SCALE;case"medium":return Ue.BLOCK_MEDIUM_SCALE;case"large":return Ue.BLOCK_LARGE_SCALE;case"boss":return Ue.BOSS_SCALE;case"mystery":return Ue.MYSTERY_BLOCK_MIN_SCALE;default:return 1}}}class om{scene;activePowerups=new Map;constructor(e){this.scene=e}setInterpolationDelay(e){this.activePowerups.forEach(t=>{t.buffer.setInterpolationDelay(e)})}createPowerup(e,t,s,i,n,a,o=!1){if(this.activePowerups.has(e))return;const r=this.getTextureForPowerup(i),h=this.scene.add.image(0,0,r);h.setScale(Ue.POWERUP_SCALE);let c;const d=[h],g=this.scene.add.container(t,s,d);g.setDepth(Ue.POWERUP_DEPTH),g.setVisible(!1);const u=new xr;u.addState(t,s,n,a),this.activePowerups.set(e,{container:g,sprite:h,hitboxGraphics:c,buffer:u,isOnGround:o})}updatePowerup(e,t,s,i,n,a){const o=this.activePowerups.get(e);o&&(o.buffer.addState(t,s,i,n),o.isOnGround=a)}removePowerup(e){const t=this.activePowerups.get(e);t&&(t.container.destroy(),this.activePowerups.delete(e))}update(e){const t=Date.now();this.activePowerups.forEach(s=>{if(s.buffer.isReadyForInterpolation()&&!s.container.visible&&s.container.setVisible(!0),s.isOnGround)return;const i=s.buffer.getInterpolatedPosition(t);i&&s.container.setPosition(i.x,i.y)})}clear(){this.activePowerups.forEach(e=>{e.container.destroy()}),this.activePowerups.clear()}getTextureForPowerup(e){switch(e){case"damage":return"powerup-damage";case"speed":return"powerup-speed";case"split":return"powerup-multi";case"freeze":return"powerup-freeze";case"slow":return"powerup-slowdown";case"laser":return"powerup-laser";default:return"powerup-damage"}}}class lm{scene;activeCrystals=new Map;constructor(e){this.scene=e}setInterpolationDelay(e){this.activeCrystals.forEach(t=>{t.buffer.setInterpolationDelay(e)})}createCrystal(e,t,s,i,n,a=!1){if(this.activeCrystals.has(e))return;const o=this.scene.add.image(0,0,"crystal");o.setScale(Ue.CRYSTAL_SCALE);let r;const h=[o],c=this.scene.add.container(t,s,h);c.setDepth(Ue.CRYSTAL_DEPTH),c.setVisible(!1);const d=new xr;d.addState(t,s,i,n),this.activeCrystals.set(e,{container:c,sprite:o,hitboxGraphics:r,buffer:d,isOnGround:a})}updateCrystal(e,t,s,i,n,a){const o=this.activeCrystals.get(e);o&&(o.buffer.addState(t,s,i,n),o.isOnGround=a)}removeCrystal(e){const t=this.activeCrystals.get(e);t&&(t.container.destroy(),this.activeCrystals.delete(e))}update(e){const t=Date.now();this.activeCrystals.forEach(s=>{if(s.buffer.isReadyForInterpolation()&&!s.container.visible&&s.container.setVisible(!0),s.isOnGround)return;const i=s.buffer.getInterpolatedPosition(t);i&&s.container.setPosition(i.x,i.y)})}clear(){this.activeCrystals.forEach(e=>{e.container.destroy()}),this.activeCrystals.clear()}}class hm{scene;activeLasers=new Map;constructor(e){this.scene=e}createLaser(e,t,s,i){if(this.activeLasers.has(e))return;const n=this.scene.add.tileSprite(-3,0,42,100,"laser-gun-middle");n.setOrigin(.5,1),n.setDepth(0);const a=this.scene.add.image(0,0,"laser-gun-bottom");a.setOrigin(.5,1),a.setDepth(1);const o=nr(i),r=s-o,h=this.scene.add.container(t,r,[n,a]);h.setDepth(11),this.activeLasers.set(e,{container:h,bottomSprite:a,middleTileSprite:n}),this.updateLaser(e,t,s,i,0)}updateLaser(e,t,s,i,n){const a=this.activeLasers.get(e);if(!a)return;const o=nr(i),r=s-o;a.container.setPosition(t,r);const h=r;a.middleTileSprite.setY(-10),a.middleTileSprite.setSize(a.middleTileSprite.width,h)}removeLaser(e){const t=this.activeLasers.get(e);t&&(t.container.destroy(),this.activeLasers.delete(e))}clear(){this.activeLasers.forEach(e=>{e.container.destroy()}),this.activeLasers.clear()}}class cm{inputSequence=0;pendingInputs=[];targetX=0;displayX=0;serverX=0;blendRate=.3;snapThreshold=250;constructor(e){this.targetX=e,this.displayX=e,this.serverX=e}predictMove(e){this.inputSequence++;const t={sequence:this.inputSequence,x:e,timestamp:Date.now()};return this.pendingInputs.push(t),this.targetX=e,this.cleanOldInputs(),{sequence:this.inputSequence,x:e}}reconcile(e,t){this.serverX=e,this.pendingInputs=this.pendingInputs.filter(s=>s.sequence>t),this.pendingInputs.length===0&&(this.targetX=e)}update(e){if(Math.abs(this.serverX-this.displayX)>this.snapThreshold)return this.displayX=this.serverX,this.targetX=this.serverX,this.displayX;const s=this.pendingInputs.length,i=s===0?1:Math.max(.3,1-s*.1),n=1-i,a=this.targetX*n+this.serverX*i,o=Math.min(1,this.blendRate*e*60);return this.displayX+=(a-this.displayX)*o,this.displayX}getDisplayX(){return this.displayX}reset(e){this.inputSequence=0,this.pendingInputs=[],this.targetX=e,this.displayX=e,this.serverX=e}cleanOldInputs(){const e=Date.now(),t=1e3;this.pendingInputs=this.pendingInputs.filter(s=>e-s.timestamp<t)}}const Mt={BGM:"bgm",FIRE:"sfx-fire",BALL_APPEAR:"sfx-ball-appear",EXPLODE_SMALL:"sfx-explode-small",EXPLODE_MEDIUM:"sfx-explode-medium",EXPLODE_LARGE:"sfx-explode-large",EXPLODE_BOSS:"sfx-explode-boss",BOUNCE_SMALL:"sfx-bounce-small",BOUNCE_MEDIUM:"sfx-bounce-medium",BOUNCE_LARGE:"sfx-bounce-large",BOUNCE_BOSS:"sfx-bounce-boss"},jt={BGM_VOLUME:.5,SFX_VOLUME:1,FIRE_VOLUME:.3,FIRE_DEBOUNCE_MS:50,BOUNCE_HP_SMALL:30,BOUNCE_HP_MEDIUM:60,BOUNCE_HP_LARGE:90,EXPLODE_HP_SMALL:10,EXPLODE_HP_MEDIUM:20,EXPLODE_HP_LARGE:30};class rs{static instance=null;scene=null;bgm=null;musicEnabled=!0;sfxEnabled=!0;bgmVolume=jt.BGM_VOLUME;sfxVolume=jt.SFX_VOLUME;lastFireTime=0;constructor(){}static getInstance(){return rs.instance||(rs.instance=new rs),rs.instance}static destroyInstance(){rs.instance&&(rs.instance.destroy(),rs.instance=null)}initialize(e){this.scene=e}playBGM(){if(!(!this.musicEnabled||!this.scene)){if(this.bgm){if(this.bgm.isPlaying)return;this.bgm.destroy()}this.bgm=this.scene.sound.add(Mt.BGM,{volume:this.bgmVolume,loop:!0}),this.bgm&&this.bgm.play()}}stopBGM(){this.bgm&&(this.bgm.stop(),this.bgm.destroy(),this.bgm=null)}pauseBGM(){this.bgm&&this.bgm.isPlaying&&this.bgm.pause()}resumeBGM(){this.bgm&&this.bgm.isPaused&&this.bgm.resume()}playFireSFX(){if(!this.sfxEnabled||!this.scene)return;const e=Date.now();e-this.lastFireTime<jt.FIRE_DEBOUNCE_MS||(this.lastFireTime=e,this.scene.sound.play(Mt.FIRE,{volume:jt.FIRE_VOLUME}))}playBallAppearSound(){!this.sfxEnabled||!this.scene||this.scene.sound.play(Mt.BALL_APPEAR,{volume:this.sfxVolume})}playBounceSound(e){if(!this.sfxEnabled||!this.scene)return;let t;e<jt.BOUNCE_HP_SMALL?t=Mt.BOUNCE_SMALL:e<jt.BOUNCE_HP_MEDIUM?t=Mt.BOUNCE_MEDIUM:e<jt.BOUNCE_HP_LARGE?t=Mt.BOUNCE_LARGE:t=Mt.BOUNCE_BOSS,this.scene.sound.play(t,{volume:this.sfxVolume})}playExplodeSound(e){if(!this.sfxEnabled||!this.scene)return;let t;e<jt.EXPLODE_HP_SMALL?t=Mt.EXPLODE_SMALL:e<jt.EXPLODE_HP_MEDIUM?t=Mt.EXPLODE_MEDIUM:e<jt.EXPLODE_HP_LARGE?t=Mt.EXPLODE_LARGE:t=Mt.EXPLODE_BOSS,this.scene.sound.play(t,{volume:this.sfxVolume})}toggleMusic(e){this.musicEnabled=e,e||this.stopBGM()}toggleSFX(e){this.sfxEnabled=e}setMusicVolume(e){this.bgmVolume=Math.max(0,Math.min(1,e)),this.bgm&&this.bgm.setVolume(this.bgmVolume)}setSFXVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e))}isMusicEnabled(){return this.musicEnabled}isSFXEnabled(){return this.sfxEnabled}destroy(){this.stopBGM(),this.scene=null}}class dm extends wt.Scene{inputSystem;networkSystem;renderSystem;bulletRenderSystem;blockRenderSystem;powerupRenderSystem;crystalRenderSystem;laserRenderSystem;predictionSystem;audioService;ghostBulletInterval;uiScene;lastMoveTime=0;isShooting=!1;lastTargetX;facingRight=!0;pendingGameOverScore;waitingForServerRestart=!1;isGameOver=!1;targetInterpolationDelay=qt.INTERPOLATION_DELAY_MS;currentInterpolationDelay=qt.INTERPOLATION_DELAY_MS;constructor(){super({key:"MainScene"})}async create(){const e=this.cameras.main.centerX;this.scene.launch("UIScene"),this.uiScene=this.scene.get("UIScene"),this.renderSystem=new nm(this),this.renderSystem.setupBackground();const t=this.renderSystem.setupGround();if(this.bulletRenderSystem=new rm(this),this.blockRenderSystem=new am(this),this.blockRenderSystem.onBlockBounce(n=>{this.isGameOver||this.audioService.playBounceSound(n)}),this.powerupRenderSystem=new om(this),this.crystalRenderSystem=new lm(this),this.laserRenderSystem=new hm(this),this.predictionSystem=new cm(e),this.networkSystem=this.registry.get("networkSystem"),!this.networkSystem){console.error("[MAIN] No network connection - returning to title"),this.scene.start("TitleScene");return}this.renderSystem.setupCannon(e,t,"ronke");try{this.networkSystem.setupRoomHandlers()}catch(n){console.error("[MAIN] Error in setupRoomHandlers:",n)}this.uiScene.setNetworkSystem(this.networkSystem),this.audioService=rs.getInstance(),this.audioService.initialize(this),this.audioService.playBGM(),this.networkSystem.sendStartGame();const i=this.renderSystem.getCharacterSystem();i&&i.onDeathAnimationComplete(()=>{this.pendingGameOverScore!==void 0&&(this.scene.pause(),this.scene.launch("GameOverScene",{score:this.pendingGameOverScore}),this.pendingGameOverScore=void 0)}),this.networkSystem.onPositionAck((n,a,o)=>{this.predictionSystem.reconcile(n,a)}),this.networkSystem.onBulletAdded((n,a)=>{const r=this.networkSystem.getPlayer(n.playerId)?.characterType||"ronke";this.bulletRenderSystem.createBullet(a,n.x,n.y,n.vy,n.lastUpdateTick,r)}),this.networkSystem.onBulletRemoved((n,a)=>{this.bulletRenderSystem.removeBullet(a)}),this.networkSystem.onBlockAdded((n,a)=>{this.audioService.playBallAppearSound(),this.blockRenderSystem.createBlock(a,n.x,n.y,n.hp,n.maxHp,n.blockType,n.size,n.vy,n.lastUpdateTick,n.isBoss,n.willDropPowerup,n.blockState,n.willDropCrystal)}),this.networkSystem.onBlockChanged((n,a)=>{this.blockRenderSystem.updateBlock(a,n.x,n.y,n.vy,n.lastUpdateTick,n.vx,n.isFrozen),this.blockRenderSystem.updateHealth(a,n.hp,n.maxHp,n.blockType),this.blockRenderSystem.updateBlockState(a,n.blockState)}),this.networkSystem.onBlockRemoved((n,a)=>{const o=this.blockRenderSystem.getBlockMaxHp(a);o!==void 0&&this.audioService.playExplodeSound(o),this.blockRenderSystem.removeBlock(a)}),this.networkSystem.onBossAttack(n=>{this.blockRenderSystem.triggerBossAttack(n)}),this.networkSystem.onPowerupAdded((n,a)=>{this.powerupRenderSystem.createPowerup(a,n.x,n.y,n.powerupType,n.vy,n.lastUpdateTick,n.isOnGround)}),this.networkSystem.onPowerupChanged((n,a)=>{this.powerupRenderSystem.updatePowerup(a,n.x,n.y,n.vy,n.lastUpdateTick,n.isOnGround)}),this.networkSystem.onPowerupRemoved((n,a)=>{this.powerupRenderSystem.removePowerup(a)}),this.networkSystem.onCrystalAdded((n,a)=>{this.crystalRenderSystem.createCrystal(a,n.x,n.y,n.vy,n.lastUpdateTick,n.isOnGround)}),this.networkSystem.onCrystalChanged((n,a)=>{this.crystalRenderSystem.updateCrystal(a,n.x,n.y,n.vy,n.lastUpdateTick,n.isOnGround)}),this.networkSystem.onCrystalRemoved((n,a)=>{this.crystalRenderSystem.removeCrystal(a)}),this.networkSystem.onPlayerPowerupUpdate(n=>{const a=this.networkSystem.getSessionId();if(a){if(n.isLaserActive){const o=this.renderSystem.getCharacterSystem(),r=this.renderSystem.getCannonY();if(o&&r!==void 0){const h=o.getPosition(),c=n.characterType||"ronke";this.laserRenderSystem.createLaser(a,h.x,r,c),this.laserRenderSystem.updateLaser(a,h.x,r,c,n.laserCollisionY)}}else this.laserRenderSystem.removeLaser(a);this.uiScene.updatePowerupDisplay(n)}}),this.networkSystem.onScoreUpdate(n=>{this.uiScene.updateScore(n)}),this.networkSystem.onCrystalUpdate(n=>{this.uiScene.updateCrystal(n)}),this.networkSystem.onGameOver(n=>{this.stopGhostBullets(),this.audioService.stopBGM(),this.isGameOver=!0,this.pendingGameOverScore=n,this.time.delayedCall(2e3,()=>{this.pendingGameOverScore!==void 0&&(this.scene.pause(),this.scene.launch("GameOverScene",{score:this.pendingGameOverScore}),this.pendingGameOverScore=void 0)})}),this.networkSystem.onRttUpdate(n=>{const a=Math.min(qt.MAX_INTERPOLATION_DELAY_MS,Math.max(qt.MIN_INTERPOLATION_DELAY_MS,n*.6+15));Math.abs(a-this.targetInterpolationDelay)>10&&(this.targetInterpolationDelay=a)}),this.inputSystem=new sm(this),this.inputSystem.onMove(n=>{const a=this.networkSystem.getSessionId();if(!(a?this.networkSystem.getPlayer(a):void 0)?.isAlive)return;this.lastMoveTime=Date.now();const r=this.renderSystem.getCharacterSystem();if(r&&this.lastTargetX!==void 0){const c=r.getPosition();n>c.x+5?this.facingRight=!0:n<c.x-5&&(this.facingRight=!1)}this.lastTargetX=n;const{sequence:h}=this.predictionSystem.predictMove(n);this.networkSystem.sendMove(n,h)}),this.inputSystem.onStartShooting(()=>{this.isShooting=!0,this.startGhostBullets(),this.networkSystem.sendStartShooting()}),this.inputSystem.onStopShooting(()=>{this.isShooting=!1,this.stopGhostBullets(),this.networkSystem.sendStopShooting()})}startGhostBullets(){this.ghostBulletInterval||(this.createGhostBullet(),this.ghostBulletInterval=window.setInterval(()=>{this.createGhostBullet()},qt.FIRE_RATE_MS))}stopGhostBullets(){this.ghostBulletInterval&&(window.clearInterval(this.ghostBulletInterval),this.ghostBulletInterval=void 0)}createGhostBullet(){const e=this.renderSystem.getCharacterSystem(),t=this.renderSystem.getCannonY();if(e&&t!==void 0){const s=this.networkSystem.getSessionId(),n=(s?this.networkSystem.getPlayer(s):void 0)?.characterType||"ronke",a=nr(n),r=e.getPosition().x,h=t-a;this.bulletRenderSystem.createGhostBullet(r,h,n),this.audioService.playFireSFX(),e.triggerAttack()}}update(e,t){const s=t/1e3,i=this.predictionSystem.update(s);this.renderSystem.updateCannonPosition(i),this.renderSystem.update(!0),this.bulletRenderSystem.update(s),this.blockRenderSystem.update(),this.powerupRenderSystem.update(s),this.crystalRenderSystem.update(s);const n=this.targetInterpolationDelay-this.currentInterpolationDelay;Math.abs(n)>5&&(this.currentInterpolationDelay+=n*.02,this.blockRenderSystem.setInterpolationDelay(this.currentInterpolationDelay),this.powerupRenderSystem.setInterpolationDelay(this.currentInterpolationDelay),this.crystalRenderSystem.setInterpolationDelay(this.currentInterpolationDelay));const a=this.networkSystem.getSessionId();if(!a)return;const o=this.networkSystem.getPlayer(a),r=this.renderSystem.getCharacterSystem();if(!o||!r)return;const c=Date.now()-this.lastMoveTime<150;if(this.waitingForServerRestart&&o.isAlive&&(this.waitingForServerRestart=!1),r.updateState({isMoving:c,isShooting:this.isShooting,isLaserActive:o.isLaserActive,isAlive:this.waitingForServerRestart?!0:o.isAlive}),r.setFacingDirection(this.facingRight),o.isLaserActive){const d=this.renderSystem.getCannonY(),g=r.getPosition();if(d!==void 0){const u=o.characterType||"ronke";this.laserRenderSystem.updateLaser(a,g.x,d,u,o.laserCollisionY)}}}restartGame(){this.pendingGameOverScore=void 0,this.isGameOver=!1,this.waitingForServerRestart=!0,this.audioService.playBGM(),this.networkSystem.sendRestartGame(),this.bulletRenderSystem.clear(),this.blockRenderSystem.clear(),this.powerupRenderSystem.clear(),this.crystalRenderSystem.clear(),this.laserRenderSystem.clear();const e=this.cameras.main.centerX;this.predictionSystem.reset(e),this.renderSystem.updateCannonPosition(e),this.lastMoveTime=0,this.isShooting=!1,this.lastTargetX=void 0,this.facingRight=!0;const t=this.renderSystem.getCharacterSystem();t&&(t.resetDeathState(),t.updateState({isMoving:!1,isShooting:!1,isAlive:!0,isLaserActive:!1}),t.setFacingDirection(!0)),this.scene.resume()}shutdown(){this.stopGhostBullets(),this.inputSystem?.destroy(),this.networkSystem?.destroy(),this.bulletRenderSystem?.clear(),this.blockRenderSystem?.clear(),this.powerupRenderSystem?.clear(),this.crystalRenderSystem?.clear(),this.laserRenderSystem?.clear()}}class fm extends wt.Scene{scoreFrame;scoreLabelText;scoreValueText;currencyFrame;crystalIcon;plusIcon;crystalValueText;powerupIcons=new Map;currentPlayer;networkSystem;constructor(){super({key:"UIScene"})}setNetworkSystem(e){this.networkSystem=e}create(){this.scoreFrame=this.add.image(20,20,"frame-score"),this.scoreFrame.setOrigin(0,0),this.scoreFrame.setDepth(999);const s=this.scoreFrame.width,i=this.scoreFrame.height,n=20+s/2;this.scoreLabelText=this.add.text(n,20+i*.35,"Score",{fontFamily:"LilitaOne",fontSize:"20px",color:"#ffffff",stroke:"#000000",strokeThickness:2}),this.scoreLabelText.setOrigin(.5,.5),this.scoreLabelText.setDepth(1e3),this.scoreValueText=this.add.text(n,20+i*.65,"0",{fontFamily:"LilitaOne",fontSize:"24px",color:"#FFD700",stroke:"#000000",strokeThickness:2}),this.scoreValueText.setOrigin(.5,.5),this.scoreValueText.setDepth(1e3);const a=this.cameras.main.width-70,o=20+i/2;this.currencyFrame=this.add.image(a,o,"frame-currency"),this.currencyFrame.setOrigin(1,.5),this.currencyFrame.setDepth(999);const r=this.currencyFrame.width,h=a-r,c=32,d=h;this.crystalIcon=this.add.image(d,o,"crystal"),this.crystalIcon.setOrigin(.5,.5);const g=c/Math.max(this.crystalIcon.width,this.crystalIcon.height);this.crystalIcon.setScale(g),this.crystalIcon.setDepth(1e3);const u=this.crystalIcon.width*g,m=this.crystalIcon.height*g,y=16,b=d+u/2-y/2,E=o+m/2-y;this.plusIcon=this.add.image(b,E,"plus"),this.plusIcon.setOrigin(0,0),this.plusIcon.setDisplaySize(y,y),this.plusIcon.setDepth(1001),this.crystalValueText=this.add.text(a-15,o,"0",{fontFamily:"LilitaOne",fontSize:"24px",color:"#ffffff",stroke:"#000000",strokeThickness:2}),this.crystalValueText.setOrigin(1,.5),this.crystalValueText.setDepth(1e3)}updateScore(e){this.scoreValueText.setText(e.toString())}updateCrystal(e){this.crystalValueText.setText(e.toString())}updatePowerupDisplay(e){if(this.currentPlayer=e,this.powerupIcons.forEach(({sprite:a,maskSprite:o,overlay:r})=>{a.destroy(),o?.destroy(),r?.destroy()}),this.powerupIcons.clear(),!e.powerupOrder||e.powerupOrder.length===0)return;const t=Ue.POWERUP_ICON_SIZE,s=Ue.POWERUP_ICON_SPACING,i=Ue.POWERUP_ICON_START_X,n=this.cameras.main.height-Ue.POWERUP_ICON_START_Y_FROM_BOTTOM;e.powerupOrder.forEach((a,o)=>{const r=i+o*(t+s),h=n,c=this.getPowerupTextureKey(a),d=this.add.image(r,h,c);d.setOrigin(0,0),d.setDisplaySize(t,t),d.setDepth(Ue.POWERUP_ICON_DEPTH);const g={sprite:d,type:a};if(this.isDurationBasedPowerup(a)){const u=this.add.image(r,h,c);u.setOrigin(0,0),u.setDisplaySize(t,t),u.setVisible(!1);const m=this.add.graphics();m.setDepth(Ue.POWERUP_ICON_OVERLAY_DEPTH);const y=u.createBitmapMask();m.setMask(y),g.maskSprite=u,g.overlay=m}this.powerupIcons.set(o,g)})}update(e,t){this.currentPlayer&&this.powerupIcons.forEach((s,i)=>{if(!s.overlay)return;const n=Ue.POWERUP_ICON_SIZE,a=Ue.POWERUP_ICON_SPACING,o=Ue.POWERUP_ICON_START_X,r=this.cameras.main.height-Ue.POWERUP_ICON_START_Y_FROM_BOTTOM,h=o+i*(n+a),c=r;let d=0,g=0;if(s.type==="laser"&&this.currentPlayer?(d=this.currentPlayer.activePowerupEndTime,g=5):s.type==="freeze"&&this.currentPlayer?(d=this.currentPlayer.activeFreezeEndTime,g=3):s.type==="slow"&&this.currentPlayer&&(d=this.currentPlayer.activeSlowEndTime,g=8),s.overlay.clear(),d>0&&this.networkSystem){const u=this.networkSystem.getServerGameTime(),y=Math.max(0,d-u)/g,b=n*(1-y);s.overlay.fillStyle(0,.7),s.overlay.fillRect(h,c,n,b)}})}getPowerupTextureKey(e){switch(e){case"damage":return"powerup-damage";case"speed":return"powerup-speed";case"split":return"powerup-multi";case"freeze":return"powerup-freeze";case"slow":return"powerup-slowdown";case"laser":return"powerup-laser";default:return"powerup-damage"}}isDurationBasedPowerup(e){return e==="laser"||e==="freeze"||e==="slow"}}const to="ronke-blast-highscore";class um extends wt.Scene{finalScore=0;highScore=0;constructor(){super({key:"GameOverScene"})}init(e){this.finalScore=e.score||0,this.loadHighScore(),this.updateHighScore()}create(){const{width:e,height:t}=this.cameras.main;this.add.rectangle(e/2,t/2,e,t,0,.7).setDepth(999),this.createGameOverContainer(e,t),this.createScoreContainer(e,t),this.createRetryButton(e,t)}createGameOverContainer(e,t){const s=Math.floor(t*.3);this.add.image(Math.floor(e/2),s,"gameover-container").setDepth(1e3);const n=this.add.text(Math.floor(e/2),Math.floor(s-12),"GAME OVER",{fontFamily:"LilitaOne",fontSize:"45px",fontStyle:"bold",color:"#FEF9E8",stroke:"#823D18",strokeThickness:8});n.setOrigin(.5),n.setDepth(1001)}createScoreContainer(e,t){const s=Math.floor(t*.5);this.add.image(Math.floor(e/2),s,"score-container").setDepth(1e3);const n={fontFamily:"LilitaOne",fontSize:"21px",color:"#823D18"},a={fontFamily:"LilitaOne",fontSize:"48px",color:"#FEF9E8",stroke:"#823D18",strokeThickness:8,shadow:{offsetX:3,offsetY:3,color:"#00000066",blur:4,fill:!0},padding:{x:10,y:10}},o={fontFamily:"LilitaOne",fontSize:"21px",color:"#823D18"},r=this.add.text(Math.floor(e/2),Math.floor(s-44),"SCORE:",n);r.setOrigin(.5),r.setDepth(1001);const h=this.add.text(Math.floor(e/2),s,`${this.finalScore}`,a);h.setOrigin(.5),h.setDepth(1001);const c=this.add.text(Math.floor(e/2),Math.floor(s+44),`Highscore: ${this.highScore}`,o);c.setOrigin(.5),c.setDepth(1001)}createRetryButton(e,t){const s=new Zi(this,Math.floor(e/2),Math.floor(t*.75),"button-retry","Try Again",{fontFamily:"LilitaOne",fontSize:"24px",fontStyle:"bold",color:"#ffffff",stroke:"#823D18",strokeThickness:6},()=>this.restartGame());s.setDepth(1e3),this.add.existing(s)}loadHighScore(){const e=localStorage.getItem(to);this.highScore=e?parseInt(e,10):0}updateHighScore(){this.finalScore>this.highScore&&(this.highScore=this.finalScore,localStorage.setItem(to,this.highScore.toString()))}restartGame(){const e=this.scene.get("MainScene");e&&e.restartGame&&e.restartGame(),this.scene.stop()}}const mm={type:wt.AUTO,width:536,height:953,parent:"game",backgroundColor:"#282c34",scene:[Uf,Qu,tm,dm,fm,um],physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:wt.Scale.FIT,autoCenter:wt.Scale.CENTER_BOTH},plugins:{scene:[{key:"SpinePlugin",plugin:Rs,mapping:"spine"}]}};window.addEventListener("message",l=>{if(l.data?.type==="ARCADE_TOKEN"){const e=l.data.token;window.arcadeToken=e,sessionStorage.setItem("arcadeToken",e)}});const gm=new URLSearchParams(window.location.search),Gn=gm.get("token");Gn&&(window.arcadeToken=Gn,sessionStorage.setItem("arcadeToken",Gn));const so=sessionStorage.getItem("arcadeToken");so&&!window.arcadeToken&&(window.arcadeToken=so);async function io(){try{await document.fonts.load("16px LilitaOne")}catch(l){console.warn("Font loading failed, using fallback:",l)}new wt.Game(mm)}document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>{io()}):io();
